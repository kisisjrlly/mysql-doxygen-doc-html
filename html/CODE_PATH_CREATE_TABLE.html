<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: CREATE TABLE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('CODE_PATH_CREATE_TABLE.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">CREATE TABLE </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="CREATE_TABLE_PARSER"></a>
Parser</h1>
<p>When a query is sent to the server, the first step is to invoke the bison parser to build an Abstract Syntax Tree to represent the query text.</p>
<p>Assume the following statement: </p><pre class="fragment">CREATE TABLE test.t1 (a int) ENGINE = "INNODB";
</pre><p>In the bison grammar file, the rule implementing the CREATE TABLE statement is <code>create_table_stmt</code>.</p>
<p>The tree created is an object of class <a class="el" href="classPT__create__table__stmt.html">PT_create_table_stmt</a>.</p>
<p>This parse tree node has several related nodes, such as:</p><ul>
<li><a class="el" href="classPT__create__table__option.html">PT_create_table_option</a> and sub classes, for table options.</li>
<li><a class="el" href="classPT__table__element.html">PT_table_element</a> and sub classes, for the columns, indexes, etc.</li>
</ul>
<p>The collection of nodes returned after the bison parsing is known as the "Abstract Syntax Tree" that represents a SQL query.</p>
<h1><a class="anchor" id="CREATE_TABLE_CMD"></a>
Sql command</h1>
<p>Once the bison parser has finished parsing a query text, the next step is to build a SQL command from the Abstract Syntax Tree.</p>
<p>In the Abstract Syntax Tree, attributes like a storage engine name ("INNODB") are represented as strings, taken from the query text.</p>
<p>These attributes need to be converted to objects in the SQL context, such as an <a class="el" href="mysqld_8h.html#a175649aedb4e392a8364d601b0ef6785">innodb_hton</a> pointer to represent the INNODB storage engine.</p>
<p>The process that performs these transformations is contextualize().</p>
<p>The <a class="el" href="classParse__tree__root.html">Parse_tree_root</a> class is an abstract factory, building <a class="el" href="classSql__cmd.html">Sql_cmd</a> objects.</p>
<p>For a CREATE TABLE statement, class <a class="el" href="classPT__create__table__stmt.html">PT_create_table_stmt</a> builds a concrete <a class="el" href="classSql__cmd__create__table.html">Sql_cmd_create_table</a> object.</p>
<p><a class="el" href="classPT__create__table__stmt.html#a2ad534923ad633557774b8667f4fd286">PT_create_table_stmt::make_cmd()</a> in particular performs the following actions:</p><ul>
<li>contextualize the parse tree for the CREATE TABLE statement.</li>
<li>build a <a class="el" href="structHA__CREATE__INFO.html">HA_CREATE_INFO</a> structure to represent the table DDL.</li>
<li>resolve the storage engine name to an actual <a class="el" href="structhandlerton.html">handlerton</a> pointer, in <a class="el" href="classPT__create__table__engine__option.html#adf2cf686f08af05b733de9d50689af75">PT_create_table_engine_option::contextualize()</a></li>
</ul>
<h1><a class="anchor" id="CREATE_TABLE_RUNTIME"></a>
Runtime execution</h1>
<p>Execution of a CREATE TABLE statement invokes <a class="el" href="classSql__cmd__create__table.html#ad718a2668ba042361e2d3cafc6e07dae">Sql_cmd_create_table::execute()</a>, which in turns calls:</p><ul>
<li><a class="el" href="sql__table_8cc.html#a5b79add4051d2a2fe457467fe05a0aac">mysql_create_table()</a>,</li>
<li><a class="el" href="sql__table_8cc.html#aac109e7af12d382e332f956abcf35397">mysql_create_table_no_lock()</a>,</li>
<li><a class="el" href="sql__table_8cc.html#af217534f45ac047fa71627a34e1b85b8">create_table_impl()</a>,</li>
<li><a class="el" href="sql__table_8cc.html#ab2b16045e2aab65b0c9cb119f0774ee4">rea_create_base_table()</a>.</li>
</ul>
<p>Execution of this code is the runtime implementation of the CREATE TABLE statement, and eventually leads to:</p><ul>
<li><a class="el" href="namespacedd.html#ae2615a1006b6e1601c0dddac23939623">dd::create_table()</a>, to create the table in the Data Dictionary,</li>
<li><a class="el" href="sql_2handler_8cc.html#a18a316a977da09110206d170c74f261e">ha_create_table()</a>, to create the table in the handlerton.</li>
</ul>
<p>Details about the dictionary and the storage engine are expanded in the following two sections.</p>
<h1><a class="anchor" id="CREATE_TABLE_DD"></a>
Data Dictionary</h1>
<p>In the data dictionary, creation of a new table calls:</p><ul>
<li><a class="el" href="namespacedd.html#a36ebd607bd07571d194aac6e466295bd">dd::create_dd_user_table()</a></li>
<li><a class="el" href="namespacedd.html#ac91c6959f93d53c8652c4f9184e371c8">fill_dd_table_from_create_info()</a></li>
</ul>
<p>The data dictionary code parses the content of the HA_CREATE_INFO input, and builds a <a class="el" href="classdd_1_1Table.html">dd::Table</a> object, to represent the table metadata. Part of this metadata includes the storage engine name.</p>
<p>The runtime code then calls <code>store()</code> to save this new metadata.</p>
<p>To store a table metadata, the data dictionary code first serialize it into an sdi format.</p>
<p>The serialized object is then stored in persistence, either in a tablespace or in a file:</p><ul>
<li><a class="el" href="namespacedd_1_1sdi__file.html#ac508512c2afbe3ca2deeab6ac1960c67">sdi_tablespace::store_tbl_sdi()</a></li>
<li><a class="el" href="namespacedd_1_1sdi__file.html#ac508512c2afbe3ca2deeab6ac1960c67">sfi_file::store_tbl_sdi()</a></li>
</ul>
<p>When storing data into a tablespace, the storage engine handlerton is invoked, so that the storage engine can ultimately store the table metadata in the tablespace maintained by the storage engine.</p>
<h1><a class="anchor" id="CREATE_TABLE_SE"></a>
Storage Engine</h1>
<p>When execution of the CREATE TABLE statement reaches the storage engine interface, the SQL layer function <a class="el" href="sql_2handler_8cc.html#a18a316a977da09110206d170c74f261e">ha_create_table()</a> invokes the storage engine <a class="el" href="structhandlerton.html#a1a64f0f1ef50d1727effb20b61a261e0">handlerton::create()</a> method to instantiate a new storage engine table, represented by <a class="el" href="classhandler.html">handler</a>. The SQL layer then calls <a class="el" href="classhandler.html#af642f26e84f63386742df472343be117">handler::create()</a> to create the table inside the storage engine. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_CODE_PATHS.html">Code paths</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
