<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: sql/join_optimizer/subgraph_enumeration.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('subgraph__enumeration_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">subgraph_enumeration.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file implements the DPhyp algorithm for enumerating connected subgraphs of hypergraphs (see hypergraph.h for a hypergraph definition).  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string&gt;</code><br />
<code>#include &quot;<a class="el" href="bit__utils_8h_source.html">sql/join_optimizer/bit_utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hypergraph_8h_source.html">sql/join_optimizer/hypergraph.h</a>&quot;</code><br />
</div>
<p><a href="subgraph__enumeration_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhypergraph_1_1NeighborhoodCache.html">hypergraph::NeighborhoodCache</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacehypergraph"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html">hypergraph</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:abe7d73b1e0d62ebfab037a055dd51154"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="subgraph__enumeration_8h.html#abe7d73b1e0d62ebfab037a055dd51154">HYPERGRAPH_PRINTF</a>(...)</td></tr>
<tr class="separator:abe7d73b1e0d62ebfab037a055dd51154"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abaa2b027ee3421a58c4a59800542b036"><td class="memTemplParams" colspan="2">template&lt;class Receiver &gt; </td></tr>
<tr class="memitem:abaa2b027ee3421a58c4a59800542b036"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html#abaa2b027ee3421a58c4a59800542b036">hypergraph::EnumerateAllConnectedPartitions</a> (Receiver *receiver)</td></tr>
<tr class="separator:abaa2b027ee3421a58c4a59800542b036"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e082bce088604edec091b4076879f90"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html#a2e082bce088604edec091b4076879f90">hypergraph::PrintSet</a> (NodeMap x)</td></tr>
<tr class="separator:a2e082bce088604edec091b4076879f90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2abeb7b4e667d73795a2ff60033488ca"><td class="memItemLeft" align="right" valign="top">NodeMap&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html#a2abeb7b4e667d73795a2ff60033488ca">hypergraph::FindNeighborhood</a> (const Hypergraph &amp;g, NodeMap subgraph, NodeMap forbidden, NodeMap just_grown_by, NeighborhoodCache *cache, NodeMap *full_neighborhood_arg)</td></tr>
<tr class="memdesc:a2abeb7b4e667d73795a2ff60033488ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the neighborhood of the given subgraph (S); informally, the set of nodes immediately reachable from that subgraph.  <a href="namespacehypergraph.html#a2abeb7b4e667d73795a2ff60033488ca">More...</a><br /></td></tr>
<tr class="separator:a2abeb7b4e667d73795a2ff60033488ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac36f9e32245334c17b0fa1c293c8ff1b"><td class="memTemplParams" colspan="2">template&lt;class Receiver &gt; </td></tr>
<tr class="memitem:ac36f9e32245334c17b0fa1c293c8ff1b"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html#ac36f9e32245334c17b0fa1c293c8ff1b">hypergraph::EnumerateComplementsTo</a> (const Hypergraph &amp;g, size_t lowest_node_idx, NodeMap subgraph, NodeMap full_neighborhood, NodeMap neighborhood, Receiver *receiver)</td></tr>
<tr class="separator:ac36f9e32245334c17b0fa1c293c8ff1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f8c33b93940de62576a835c1171efae"><td class="memTemplParams" colspan="2">template&lt;class Receiver &gt; </td></tr>
<tr class="memitem:a2f8c33b93940de62576a835c1171efae"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html#a2f8c33b93940de62576a835c1171efae">hypergraph::ExpandSubgraph</a> (const Hypergraph &amp;g, size_t lowest_node_idx, NodeMap subgraph, NodeMap full_neighborhood, NodeMap neighborhood, NodeMap forbidden, Receiver *receiver)</td></tr>
<tr class="separator:a2f8c33b93940de62576a835c1171efae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fcb179a08b628cb047e87121949c37a"><td class="memTemplParams" colspan="2">template&lt;class Receiver &gt; </td></tr>
<tr class="memitem:a2fcb179a08b628cb047e87121949c37a"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html#a2fcb179a08b628cb047e87121949c37a">hypergraph::TryConnecting</a> (const Hypergraph &amp;g, NodeMap subgraph, NodeMap subgraph_full_neighborhood, NodeMap complement, Receiver *receiver)</td></tr>
<tr class="separator:a2fcb179a08b628cb047e87121949c37a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f7efd5210140c3c093def30df0e8778"><td class="memTemplParams" colspan="2">template&lt;class Receiver &gt; </td></tr>
<tr class="memitem:a8f7efd5210140c3c093def30df0e8778"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html#a8f7efd5210140c3c093def30df0e8778">hypergraph::ExpandComplement</a> (const Hypergraph &amp;g, size_t lowest_node_idx, NodeMap subgraph, NodeMap subgraph_full_neighborhood, NodeMap complement, NodeMap neighborhood, NodeMap forbidden, Receiver *receiver)</td></tr>
<tr class="separator:a8f7efd5210140c3c093def30df0e8778"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8eca33005c05d8bb5f9797a6a10539ab"><td class="memTemplParams" colspan="2">template&lt;class Receiver &gt; </td></tr>
<tr class="memitem:a8eca33005c05d8bb5f9797a6a10539ab"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacehypergraph.html#a8eca33005c05d8bb5f9797a6a10539ab">hypergraph::EnumerateAllConnectedPartitions</a> (const Hypergraph &amp;g, Receiver *receiver)</td></tr>
<tr class="separator:a8eca33005c05d8bb5f9797a6a10539ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file implements the DPhyp algorithm for enumerating connected subgraphs of hypergraphs (see hypergraph.h for a hypergraph definition). </p>
<p>The core idea of the algorithm is that if the join structure of a query is expressed as a hypergraph, where the relations are nodes and the join predicates are hyperedges, one can efficiently find all legal join orders without Cartesian products by finding all possible subpartitions of the hypergraph. (Simple inner joins will have regular edges, but outer joins, antijoins etc., can be encoded as hyperedges to constrain the allowed join orderings, so that we do not join e.g. an inner and outer table together before said inner table has been joined to the entire set. Also, hyper-predicates such as t1.a + t2.b = t3.c will naturally give rise to hyperedges.)</p>
<p>The algorithm is described in the paper “Dynamic Programming Strikes Back” by Neumann and Moerkotte. There is a somewhat extended version of the paper (that also contains a few corrections) in Moerkotte's treatise “Building Query Compilers”. Some critical details are still missing, which we've had to fill in ourselves. We don't currently implement the extension to generalized hypergraphs, but it should be fairly straightforward to do later. The algorithm is simple in concept but hard to grasp; we will only give a very rough outline here:</p>
<ol type="1">
<li>Pick a seed node of the graph.</li>
<li>Grow that seed along hyperedges, taking care never to make an unconnected graph or seeing the same subgraph twice.</li>
<li>For each connected subgraph (csg): Repeat steps 1–2 independently to create a separate connected subgraph (the so-called complement, cmp), and try to connect the subgraph and its complement to create a larger graph (a so-called csg-cmp-pair).</li>
<li>When such a csg-cmp-pair is found, call the receiver back with the csg and cmp. This is a valid subjoin that can be costed.</li>
</ol>
<p>The entry point for doing this is EnumerateAllConnectedPartitions().</p>
<p>For complex joins, we may have to run DPhyp multiple times in a mode where we just count the number of partitions over various constrained graphs, and this will be a critical part of query planning time. Thus, it is coded as a template over a receiver type that gets callbacks for each partition. If the receiver just interested in counting, this saves a significant amount of call overhead. The templatization also allows the microbenchmarks to more accurately measure changes in the algorithm itself without having to benchmark the receiver. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="abe7d73b1e0d62ebfab037a055dd51154"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe7d73b1e0d62ebfab037a055dd51154">&#9670;&nbsp;</a></span>HYPERGRAPH_PRINTF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HYPERGRAPH_PRINTF</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5bd71961b401a432086d0fb290a87f3f.html">sql</a></li><li class="navelem"><a class="el" href="dir_1f86367b51bdf0480350d65a01d95833.html">join_optimizer</a></li><li class="navelem"><a class="el" href="subgraph__enumeration_8h.html">subgraph_enumeration.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
