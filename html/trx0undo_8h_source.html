<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: storage/innobase/include/trx0undo.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('trx0undo_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">trx0undo.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="trx0undo_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">Copyright (c) 1996, 2020, Oracle and/or its affiliates. All Rights Reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">This program is free software; you can redistribute it and/or modify it under</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">the terms of the GNU General Public License, version 2.0, as published by the</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">Free Software Foundation.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">This program is also distributed with certain software (including but not</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">limited to OpenSSL) that is licensed under separate terms, as designated in a</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">particular file or component or in included license documentation. The authors</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">of MySQL hereby grant you an additional permission to link the program and</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">your derivative works with the separately licensed software that they have</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">included with MySQL.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License, version 2.0,</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">for more details.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">You should have received a copy of the GNU General Public License along with</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">this program; if not, write to the Free Software Foundation, Inc.,</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">*****************************************************************************/</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/** @file include/trx0undo.h</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> Transaction undo log</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> Created 3/26/1996 Heikki Tuuri</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *******************************************************/</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#ifndef trx0undo_h</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#define trx0undo_h</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mtr0mtr_8h.html">mtr0mtr.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="page0types_8h.html">page0types.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="xa_8h.html">sql/xa.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trx0sys_8h.html">trx0sys.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trx0types_8h.html">trx0types.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trx0xa_8h.html">trx0xa.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;univ.i&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">/** Returns TRUE if the roll pointer is of the insert type.</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> @return true if insert undo log */</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;ibool <a class="code" href="trx0undo_8h.html#a07f8a1930550c8e69e70cea94428aa59">trx_undo_roll_ptr_is_insert</a>(<a class="code" href="trx0types_8h.html#ad3ccac613ce33a8680d147c4a4f12e94">roll_ptr_t</a> roll_ptr); <span class="comment">/*!&lt; in: roll pointer */</span><span class="comment"></span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">/** Returns true if the record is of the insert type.</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> @return true if the record was freshly inserted (not updated). */</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="trx0undo_8h.html#a4604d8632bffdcc38ae2b42c6c48ff3f">trx_undo_trx_id_is_insert</a>(</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *trx_id) <span class="comment">/*!&lt; in: DB_TRX_ID, followed by DB_ROLL_PTR */</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/** Writes a roll ptr to an index page. In case that the size changes in</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">some future version, this function should be used instead of</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">mach_write_...</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">@param[in]      ptr             pointer to memory where written</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">@param[in]      roll_ptr        roll ptr */</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#a217d801284210e8ce80b23e6caf1f7e1">trx_write_roll_ptr</a>(<a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *ptr, <a class="code" href="trx0types_8h.html#ad3ccac613ce33a8680d147c4a4f12e94">roll_ptr_t</a> roll_ptr);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/** Reads a roll ptr from an index page. In case that the roll ptr size</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> changes in some future version, this function should be used instead of</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"> mach_read_...</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"> @return roll ptr */</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<a class="code" href="trx0types_8h.html#ad3ccac613ce33a8680d147c4a4f12e94">roll_ptr_t</a> <a class="code" href="trx0undo_8h.html#a0310ed42747e8c3e3ab2158aab3857d7">trx_read_roll_ptr</a>(</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *ptr); <span class="comment">/*!&lt; in: pointer to memory from where to read */</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/** Gets an undo log page and x-latches it.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">@param[in]      page_id         Page id</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">@param[in]      page_size       Page size</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">@param[in,out]  mtr             Mini-transaction</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">@return pointer to page x-latched */</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *<a class="code" href="trx0undo_8h.html#abae1094db7dcce1c08c7c1dafa72e4f7">trx_undo_page_get</a>(<span class="keyword">const</span> <a class="code" href="classpage__id__t.html">page_id_t</a> &amp;page_id,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                          <span class="keyword">const</span> <a class="code" href="classpage__size__t.html">page_size_t</a> &amp;page_size, <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">/** Gets an undo log page and s-latches it.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">@param[in]      page_id         Page id</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">@param[in]      page_size       Page size</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">@param[in,out]  mtr             Mini-transaction</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">@return pointer to page s-latched */</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *<a class="code" href="trx0undo_8h.html#a4a54b672a527b51531cce2bd9283fa52">trx_undo_page_get_s_latched</a>(<span class="keyword">const</span> <a class="code" href="classpage__id__t.html">page_id_t</a> &amp;page_id,</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classpage__size__t.html">page_size_t</a> &amp;page_size, <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">/** Returns the previous undo record on the page in the specified log, or</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">NULL if none exists.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">@param[in]      rec             undo log record</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">@param[in]      page_no         undo log header page number</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">@param[in]      offset          undo log header offset on page</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">@return pointer to record, NULL if none */</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *<a class="code" href="trx0undo_8h.html#a22e6291c6bb7526fcc06a44eb762e856">trx_undo_page_get_prev_rec</a>(<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *rec,</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                                           <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> page_no, ulint offset);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">/** Returns the next undo log record on the page in the specified log, or</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">NULL if none exists.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">@param[in]      rec             undo log record</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">@param[in]      page_no         undo log header page number</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">@param[in]      offset          undo log header offset on page</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">@return pointer to record, NULL if none */</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *<a class="code" href="trx0undo_8h.html#abe26d8b4feba8014169ba870a077bd1a">trx_undo_page_get_next_rec</a>(<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *rec,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                                           <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> page_no, ulint offset);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">/** Returns the last undo record on the page in the specified undo log, or</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">NULL if none exists.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">@param[in]      undo_page       undo log page</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">@param[in]      page_no         undo log header page number</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">@param[in]      offset          undo log header offset on page</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">@return pointer to record, NULL if none */</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *<a class="code" href="trx0undo_8h.html#a90c1e778639f67befa0675a202a44635">trx_undo_page_get_last_rec</a>(<a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *undo_page, <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> page_no,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                           ulint offset);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">/** Returns the first undo record on the page in the specified undo log, or</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">NULL if none exists.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">@param[in]      undo_page       undo log page</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">@param[in]      page_no         undo log header page number</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">@param[in]      offset          undo log header offset on page</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">@return pointer to record, NULL if none */</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *<a class="code" href="trx0undo_8h.html#aca7e294a6373aed9aced791f1ea1063b">trx_undo_page_get_first_rec</a>(<a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *undo_page,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                            <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> page_no, ulint offset);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">/** Gets the previous record in an undo log.</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> @return undo log record, the page s-latched, NULL if none */</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *<a class="code" href="trx0undo_8h.html#a07f8de1ab8faf28c0b1e676ca6686c8b">trx_undo_get_prev_rec</a>(</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *rec, <span class="comment">/*!&lt; in: undo record */</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> page_no,   <span class="comment">/*!&lt; in: undo log header page number */</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    ulint offset,        <span class="comment">/*!&lt; in: undo log header offset on page */</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordtype">bool</span> shared,         <span class="comment">/*!&lt; in: true=S-latch, false=X-latch */</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);         <span class="comment">/*!&lt; in: mtr */</span><span class="comment"></span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">/** Gets the next record in an undo log.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> @return undo log record, the page s-latched, NULL if none */</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *<a class="code" href="trx0undo_8h.html#aa6b0cc6da71acecc913dc8619c2bf1ff">trx_undo_get_next_rec</a>(</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *rec, <span class="comment">/*!&lt; in: undo record */</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> page_no,   <span class="comment">/*!&lt; in: undo log header page number */</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    ulint offset,        <span class="comment">/*!&lt; in: undo log header offset on page */</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);         <span class="comment">/*!&lt; in: mtr */</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">/** Gets the first record in an undo log.</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">@param[out]     modifier_trx_id The modifier trx identifier.</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">@param[in]      space           Undo log header space</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">@param[in]      page_size       Page size</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">@param[in]      page_no         Undo log header page number</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">@param[in]      offset          Undo log header offset on page</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">@param[in]      mode            Latching mode: RW_S_LATCH or RW_X_LATCH</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">@param[in,out]  mtr             Mini-transaction</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">@return undo log record, the page latched, NULL if none */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<a class="code" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *<a class="code" href="trx0undo_8h.html#a0efdc7034cfaf28df8ad2b826ab68ca5">trx_undo_get_first_rec</a>(<a class="code" href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a> *modifier_trx_id,</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                                       <a class="code" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space,</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classpage__size__t.html">page_size_t</a> &amp;page_size,</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                                       <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> page_no, ulint offset,</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                                       ulint <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>, <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">/** Tries to add a page to the undo log segment where the undo log is placed.</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"> @return X-latched block if success, else NULL */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<a class="code" href="structbuf__block__t.html">buf_block_t</a> *<a class="code" href="trx0undo_8h.html#aa48dbdbc99a6e2448e999d63a3474b86">trx_undo_add_page</a>(</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="structtrx__t.html">trx_t</a> *trx,               <span class="comment">/*!&lt; in: transaction */</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="namespaceundo.html">undo</a>,         <span class="comment">/*!&lt; in: undo log memory object */</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> *undo_ptr, <span class="comment">/*!&lt; in: assign undo log from</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">                              referred rollback segment. */</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="structmtr__t.html">mtr_t</a> *mtr)               <span class="comment">/*!&lt; in: mtr which does not have</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">                              a latch to any undo log page;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">                              the caller must have reserved</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">                              the rollback segment mutex */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    MY_ATTRIBUTE((warn_unused_result));<span class="comment"></span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">/** Frees the last undo log page.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment"> The caller must hold the rollback segment mutex. */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#aed6fca708c095122afd8e0f7b2edf3b9">trx_undo_free_last_page_func</a>(</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;#ifdef UNIV_DEBUG</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="comment">/*!&lt; in: transaction */</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;#endif                <span class="comment">/* UNIV_DEBUG */</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="namespaceundo.html">undo</a>, <span class="comment">/*!&lt; in/out: undo log memory copy */</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);      <span class="comment">/*!&lt; in/out: mini-transaction which does not</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">                      have a latch to any undo log page or which</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">                      has allocated the undo log page */</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a84f83daf1e089d2b97861cedfaf18ebb">  186</a></span>&#160;<span class="preprocessor">#define trx_undo_free_last_page(trx, undo, mtr) \</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">  trx_undo_free_last_page_func(trx, undo, mtr)</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="preprocessor">#define trx_undo_free_last_page(trx, undo, mtr) \</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">  trx_undo_free_last_page_func(undo, mtr)</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">/** Truncates an undo log from the end. This function is used during</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">a rollback to free space from an undo log. */</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">@param[in]  trx    transaction for this undo log */</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">@param[in]  undo   undo log</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">@param[in]  limit  all undo records with undo number;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">                   This value should be truncated. */</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#adac98cb19c93a1716dd808f1a4b5ac0b">trx_undo_truncate_end_func</a>(</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;#ifdef UNIV_DEBUG</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx,</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;#endif <span class="comment">/* UNIV_DEBUG */</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="namespaceundo.html">undo</a>, <a class="code" href="trx0types_8h.html#a4661d2883c1cd5d8f1cfbd63b553f1bc">undo_no_t</a> limit);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a35e400616ed7fad9e013a366c9285bd0">  210</a></span>&#160;<span class="preprocessor">#define trx_undo_truncate_end(trx, undo, limit) \</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="preprocessor">  trx_undo_truncate_end_func(trx, undo, limit)</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="preprocessor">#define trx_undo_truncate_end(trx, undo, limit) \</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="preprocessor">  trx_undo_truncate_end_func(undo, limit)</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">/** Truncate the head of an undo log.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">NOTE that only whole pages are freed; the header page is not</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">freed, but emptied, if all the records there are below the limit.</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">@param[in,out]  rseg            rollback segment</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">@param[in]      hdr_page_no     header page number</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">@param[in]      hdr_offset      header offset on the page</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">@param[in]      limit           first undo number to preserve</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">(everything below the limit will be truncated) */</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#abc4d8f8dc577f8289b89ba6f9e9bd0bf">trx_undo_truncate_start</a>(<a class="code" href="structtrx__rseg__t.html">trx_rseg_t</a> *rseg, <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> hdr_page_no,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                             ulint hdr_offset, <a class="code" href="trx0types_8h.html#a4661d2883c1cd5d8f1cfbd63b553f1bc">undo_no_t</a> limit);<span class="comment"></span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">/** Initializes the undo log lists for a rollback segment memory copy.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"> This function is only called when the database is started or a new</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"> rollback segment created.</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"> @return the combined size of undo log segments in pages */</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;ulint <a class="code" href="trx0undo_8h.html#a7dc016181eb351d124de9ae2e48690ed">trx_undo_lists_init</a>(</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="structtrx__rseg__t.html">trx_rseg_t</a> *rseg); <span class="comment">/*!&lt; in: rollback segment memory object */</span><span class="comment"></span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">/** Assigns an undo log for a transaction. A new undo log is created or a cached</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"> undo log reused.</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"> @return DB_SUCCESS if undo log assign successful, possible error codes</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment"> are: DB_TOO_MANY_CONCURRENT_TRXS DB_OUT_OF_FILE_SPACE DB_READ_ONLY</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment"> DB_OUT_OF_MEMORY */</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<a class="code" href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a> <a class="code" href="trx0undo_8h.html#aaf6122e2f1a1b66d8f4098566c0cea5d">trx_undo_assign_undo</a>(</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="structtrx__t.html">trx_t</a> *trx,               <span class="comment">/*!&lt; in: transaction */</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> *undo_ptr, <span class="comment">/*!&lt; in: assign undo log from</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">                              referred rollback segment. */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    ulint <a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a>)               <span class="comment">/*!&lt; in: TRX_UNDO_INSERT or</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">                              TRX_UNDO_UPDATE */</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    MY_ATTRIBUTE((warn_unused_result));<span class="comment"></span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">/** Sets the state of the undo log segment at a transaction finish.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"> @return undo log segment header page, x-latched */</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *<a class="code" href="trx0undo_8h.html#aff740afe5e5ab8f920dc5d4ecd0d06a4">trx_undo_set_state_at_finish</a>(</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="namespaceundo.html">undo</a>, <span class="comment">/*!&lt; in: undo log memory copy */</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);      <span class="comment">/*!&lt; in: mtr */</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">/** Set the state of the undo log segment at a XA PREPARE or XA ROLLBACK.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">@param[in,out]  trx             Transaction</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">@param[in,out]  undo            Insert_undo or update_undo log</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">@param[in]      rollback        false=XA PREPARE, true=XA ROLLBACK</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">@param[in,out]  mtr             Mini-transaction</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">@return undo log segment header page, x-latched */</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *<a class="code" href="trx0undo_8h.html#aae998dd3eefe1c2b7b411324b7677eaf">trx_undo_set_state_at_prepare</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="namespaceundo.html">undo</a>,</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                      <span class="keywordtype">bool</span> <a class="code" href="sql__cmd__srs_8cc.html#ae1f3a7aed6d381dcd98b265913716fd4">rollback</a>, <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">/** Adds the update undo log header as the first in the history list, and</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"> frees the memory object, or puts it to the list of cached update undo log</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment"> segments.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">@param[in] trx Trx owning the update undo log</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">@param[in] undo_ptr Update undo log.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">@param[in] undo_page Update undo log header page, x-latched</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">@param[in] update_rseg_history_len If true: update rseg history len else</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">skip updating it.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">@param[in] n_added_logs Number of logs added</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">@param[in] mtr Mini-transaction */</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#a3a13e9d79998ebeb63174e5efab7cf9e">trx_undo_update_cleanup</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <a class="code" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> *undo_ptr,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                             <a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *undo_page, <span class="keywordtype">bool</span> update_rseg_history_len,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                             ulint n_added_logs, <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">/** Frees an insert undo log after a transaction commit or rollback.</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">Knowledge of inserts is not needed after a commit or rollback, therefore</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">the data can be discarded.</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">@param[in,out]  undo_ptr        undo log to clean up</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">@param[in]      noredo          whether the undo tablespace is redo logged */</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#a91f07d8a94d3c532561ad788123d3b54">trx_undo_insert_cleanup</a>(<a class="code" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> *undo_ptr, <span class="keywordtype">bool</span> noredo);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">/** At shutdown, frees the undo logs of a transaction which was either</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">PREPARED or (ACTIVE and recovered).</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">@param[in]  trx                   transation which undo logs are freed</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">@param[in]  expected_undo_state   expected state of undo logs */</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#af4971a01bdf3e862d13ac6d58c8ebf67">trx_undo_free_trx_with_prepared_or_active_logs</a>(</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="structtrx__t.html">trx_t</a> *trx, ulint expected_undo_state) UNIV_COLD;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">/* Forward declaration. */</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceundo.html">undo</a> {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="keyword">struct </span><a class="code" href="classTablespace.html">Tablespace</a>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="keyword">class </span>Truncate;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;}  <span class="comment">// namespace undo</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">/** Truncate UNDO tablespace, reinitialize header and rseg.</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">@param[in]  marked_space  UNDO tablespace to truncate</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">@return true if success else false. */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="trx0undo_8h.html#a779c2b358e8d65f9ec13f5939f537e78">trx_undo_truncate_tablespace</a>(<a class="code" href="structundo_1_1Tablespace.html">undo::Tablespace</a> *marked_space);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">/** Parses the redo log entry of an undo log page initialization.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"> @return end of log record or NULL */</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *<a class="code" href="trx0undo_8h.html#a5c8f3e16e21731ea56e0497aaf5d2302">trx_undo_parse_page_init</a>(<span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *ptr,     <span class="comment">/*!&lt; in: buffer */</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                               <span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *end_ptr, <span class="comment">/*!&lt; in: buffer end */</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                               <a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *<a class="code" href="ctype-mb_8cc.html#adf406aa6822ceac22d62ef63cc2879c0">page</a>,        <span class="comment">/*!&lt; in: page or NULL */</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                               <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);         <span class="comment">/*!&lt; in: mtr or NULL */</span><span class="comment"></span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">/** Parse the redo log entry of an undo log page header create or reuse.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">@param[in]      type    MLOG_UNDO_HDR_CREATE or MLOG_UNDO_HDR_REUSE</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">@param[in]      ptr     Redo log record</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">@param[in]      end_ptr End of log buffer</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">@param[in,out]  page    Page frame or NULL</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">@param[in,out]  mtr     Mini-transaction or NULL</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">@return end of log record or NULL */</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *<a class="code" href="trx0undo_8h.html#a676b69b6eb4edc717e170df954a7249f">trx_undo_parse_page_header</a>(<a class="code" href="mtr0types_8h.html#a11a0f116bed9e1c33900d379901595d1">mlog_id_t</a> <a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a>, <span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *ptr,</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *end_ptr, <a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *<a class="code" href="ctype-mb_8cc.html#adf406aa6822ceac22d62ef63cc2879c0">page</a>, <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">/************************************************************************</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">Frees an undo log memory copy. */</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#af0d814de5175af1f4c7db624fe3b6f14">trx_undo_mem_free</a>(<a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="namespaceundo.html">undo</a>); <span class="comment">/* in: the undo object to be freed */</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">/* Types of an undo log segment */</span></div><div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a1bf638ea4eb0c03cc4ae3df50af3dbcd">  321</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_INSERT 1 </span><span class="comment">/* contains undo entries for inserts */</span><span class="preprocessor"></span></div><div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a690ce47aca0d2f09063384c8b50a2f43">  322</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_UPDATE                  \</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor">  2 </span><span class="comment">/* contains undo entries for updates \</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">    and delete markings: in short,       \</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">    modifys (the name &#39;UPDATE&#39; is a      \</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">    historical relic) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">/* States of an undo log segment */</span></div><div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a836092df0b82917a8ff0fc9570ee515a">  328</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_ACTIVE                                         \</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor">  1                        </span><span class="comment">/* contains an undo log of an active \</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">                           transaction */</span><span class="preprocessor"></span></div><div class="line"><a name="l00331"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a9acec71cf2def1abe4f3ab2b110dc4ee">  331</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_CACHED 2  </span><span class="comment">/* cached for quick reuse */</span><span class="preprocessor"></span></div><div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a0e83df7aa1685c6ba3118bae30cf688e">  332</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_TO_FREE 3 </span><span class="comment">/* insert undo segment can be freed */</span><span class="preprocessor"></span></div><div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a3cb915c175c75cf318cfa7a8a1a2ad5b">  333</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_TO_PURGE                 \</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">  4 </span><span class="comment">/* update undo segment will not be    \</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">    reused: it can be freed in purge when \</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">    all undo data in it is removed */</span><span class="preprocessor"></span></div><div class="line"><a name="l00337"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a6e14b9b7912ad2052aee60e138571454">  337</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_PREPARED         \</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor">  5 </span><span class="comment">/* contains an undo log of an \</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">    prepared transaction */</span><span class="preprocessor"></span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">/** Transaction undo log memory object; this is protected by the undo_mutex</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">in the corresponding transaction object */</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html">  345</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structtrx__undo__t.html">trx_undo_t</a> {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">/* Set undo segment to prepared state and set XID</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">  @param[in]    in_xid  transaction XID. */</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordtype">void</span> set_prepared(<span class="keyword">const</span> <a class="code" href="structxid__t.html">XID</a> *in_xid);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">/*-----------------------------*/</span></div><div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a6e9044b584e7263885832f649e56a6f8">  351</a></span>&#160;  ulint <a class="code" href="structtrx__undo__t.html#a6e9044b584e7263885832f649e56a6f8">id</a>;        <span class="comment">/*!&lt; undo log slot number within the</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">                   rollback segment */</span></div><div class="line"><a name="l00353"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a3d88cc2d85a556ba2857b540af191ab1">  353</a></span>&#160;  ulint <a class="code" href="structtrx__undo__t.html#a3d88cc2d85a556ba2857b540af191ab1">type</a>;      <span class="comment">/*!&lt; TRX_UNDO_INSERT or</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">                   TRX_UNDO_UPDATE */</span></div><div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#abc4145ee910bc266d95e707527807b23">  355</a></span>&#160;  ulint <a class="code" href="structtrx__undo__t.html#abc4145ee910bc266d95e707527807b23">state</a>;     <span class="comment">/*!&lt; state of the corresponding undo log</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">                   segment */</span></div><div class="line"><a name="l00357"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a67b388d96c8d6893eb5c1887711aaad3">  357</a></span>&#160;  ibool <a class="code" href="structtrx__undo__t.html#a67b388d96c8d6893eb5c1887711aaad3">del_marks</a>; <span class="comment">/*!&lt; relevant only in an update undo</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">                   log: this is TRUE if the transaction may</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">                   have delete marked records, because of</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">                   a delete of a row or an update of an</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">                   indexed field; purge is then</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">                   necessary; also TRUE if the transaction</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">                   has updated an externally stored</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">                   field */</span></div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a67572cf8f4531e1a3c340d7283dce8ba">  365</a></span>&#160;  <a class="code" href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a> <a class="code" href="structtrx__undo__t.html#a67572cf8f4531e1a3c340d7283dce8ba">trx_id</a>; <span class="comment">/*!&lt; id of the trx assigned to the undo</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">                   log */</span></div><div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a9002884e0ae33110ff4462e45f869680">  367</a></span>&#160;  <a class="code" href="structxid__t.html">XID</a> <a class="code" href="structtrx__undo__t.html#a9002884e0ae33110ff4462e45f869680">xid</a>;         <span class="comment">/*!&lt; X/Open XA transaction</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">                   identification */</span></div><div class="line"><a name="l00369"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#abe1af679a6f9712c054707f2adab92b3">  369</a></span>&#160;  ulint <a class="code" href="structtrx__undo__t.html#abe1af679a6f9712c054707f2adab92b3">flag</a>;      <span class="comment">/*!&lt; flag for current transaction XID and GTID.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">                   Persisted in TRX_UNDO_FLAGS flag of undo header. */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">  /** Set if space for GTID is allocated. */</span></div><div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a3a09663d3d4f4c0c8fcfad1899dd9c6d">  373</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__undo__t.html#a3a09663d3d4f4c0c8fcfad1899dd9c6d">gtid_allocated</a>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a280871327e9772d42503dae2670fb4bc">  375</a></span>&#160;  ibool <a class="code" href="structtrx__undo__t.html#a280871327e9772d42503dae2670fb4bc">dict_operation</a>; <span class="comment">/*!&lt; TRUE if a dict operation trx */</span></div><div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a8f3d2792093262598c4f4ea11d37f27d">  376</a></span>&#160;  <a class="code" href="structtrx__rseg__t.html">trx_rseg_t</a> *<a class="code" href="structtrx__undo__t.html#a8f3d2792093262598c4f4ea11d37f27d">rseg</a>;     <span class="comment">/*!&lt; rseg where the undo log belongs */</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">/*-----------------------------*/</span></div><div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a7cce265556362c596ad5bd682c167f23">  378</a></span>&#160;  <a class="code" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> <a class="code" href="structtrx__undo__t.html#a7cce265556362c596ad5bd682c167f23">space</a>; <span class="comment">/*!&lt; space id where the undo log</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">                    placed */</span></div><div class="line"><a name="l00380"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a4c1344ff7591c3c92a1fd4edc1bc364d">  380</a></span>&#160;  <a class="code" href="classpage__size__t.html">page_size_t</a> <a class="code" href="structtrx__undo__t.html#a4c1344ff7591c3c92a1fd4edc1bc364d">page_size</a>;</div><div class="line"><a name="l00381"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#ac33eeedee74fb711c96708ede207a752">  381</a></span>&#160;  <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> <a class="code" href="structtrx__undo__t.html#ac33eeedee74fb711c96708ede207a752">hdr_page_no</a>;  <span class="comment">/*!&lt; page number of the header page in</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">                          the undo log */</span></div><div class="line"><a name="l00383"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#ad2fb0cf08a3c40245b7205f90f950ba1">  383</a></span>&#160;  ulint <a class="code" href="structtrx__undo__t.html#ad2fb0cf08a3c40245b7205f90f950ba1">hdr_offset</a>;       <span class="comment">/*!&lt; header offset of the undo log on</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">                          the page */</span></div><div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a1baccf2d7f75c112eadea67ccb0444dc">  385</a></span>&#160;  <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> <a class="code" href="structtrx__undo__t.html#a1baccf2d7f75c112eadea67ccb0444dc">last_page_no</a>; <span class="comment">/*!&lt; page number of the last page in the</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">                          undo log; this may differ from</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">                          top_page_no during a rollback */</span></div><div class="line"><a name="l00388"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#af885e218b36ec32ad5a6e57970250fa8">  388</a></span>&#160;  ulint <a class="code" href="structtrx__undo__t.html#af885e218b36ec32ad5a6e57970250fa8">size</a>;             <span class="comment">/*!&lt; current size in pages */</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">/*-----------------------------*/</span></div><div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a70502c4798fe0cd554a4e15fa52024cb">  390</a></span>&#160;  ulint <a class="code" href="structtrx__undo__t.html#a70502c4798fe0cd554a4e15fa52024cb">empty</a>;              <span class="comment">/*!&lt; TRUE if the stack of undo log</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">                            records is currently empty */</span></div><div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a812f9a716a5d2e7949229069c3ca5f7c">  392</a></span>&#160;  <a class="code" href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a> <a class="code" href="structtrx__undo__t.html#a812f9a716a5d2e7949229069c3ca5f7c">top_page_no</a>;    <span class="comment">/*!&lt; page number where the latest undo</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">                            log record was catenated; during</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">                            rollback the page from which the latest</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">                            undo record was chosen */</span></div><div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#af01a14c7c05251eb80d93224e8b72138">  396</a></span>&#160;  ulint <a class="code" href="structtrx__undo__t.html#af01a14c7c05251eb80d93224e8b72138">top_offset</a>;         <span class="comment">/*!&lt; offset of the latest undo record,</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">                            i.e., the topmost element in the undo</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">                            log if we think of it as a stack */</span></div><div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a98de3be99c525e76aea79abff8e63d2e">  399</a></span>&#160;  <a class="code" href="trx0types_8h.html#a4661d2883c1cd5d8f1cfbd63b553f1bc">undo_no_t</a> <a class="code" href="structtrx__undo__t.html#a98de3be99c525e76aea79abff8e63d2e">top_undo_no</a>;    <span class="comment">/*!&lt; undo number of the latest record */</span></div><div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="structtrx__undo__t.html#a513a3200227355e2711e2a74139e0c51">  400</a></span>&#160;  <a class="code" href="structbuf__block__t.html">buf_block_t</a> *<a class="code" href="structtrx__undo__t.html#a513a3200227355e2711e2a74139e0c51">guess_block</a>; <span class="comment">/*!&lt; guess for the buffer block where</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">                            the top page might reside */</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">/*-----------------------------*/</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <a class="code" href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a>(<a class="code" href="structtrx__undo__t.html">trx_undo_t</a>) undo_list;<span class="comment"></span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">  /*!&lt; undo log objects in the rollback</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">  segment are chained into lists */</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;};</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">/** Write any previous GTIDs to disk. Used for external XA</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">Commit and Rollback to write XA prepare GTID to disk table</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">before updating undo log GTID with commit/rollback GTID.</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">@param[in]      trx     transaction</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#a4904164174f613fd3742fca7b8491266">trx_undo_gtid_flush_prepare</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">/** For saving GTID add update undo slot, if required.</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">@param[in]      trx             transaction</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">@param[in]      prepare         operation is prepare</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">@param[in]      rollback        operation is rollback</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">@return innodb error code. */</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<a class="code" href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a> <a class="code" href="trx0undo_8h.html#a709ead64d1a58f7cbb8564eba985a0e5">trx_undo_gtid_add_update_undo</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keywordtype">bool</span> prepare, <span class="keywordtype">bool</span> <a class="code" href="sql__cmd__srs_8cc.html#ae1f3a7aed6d381dcd98b265913716fd4">rollback</a>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/** Set GTID flag in undo if transaction has GTID/</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">@param[in,out]  trx             transaction</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">@param[in,out]  undo            undo log memory object */</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#a4478cc9b951f1a1542d423815cfb6b26">trx_undo_gtid_set</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="namespaceundo.html">undo</a>);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">/** Read and persist GTID from undo header during recovery.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">@param[in]      undo_log        undo log header */</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#a2b8701cda5460bc9dca42af927400446">trx_undo_gtid_read_and_persist</a>(<a class="code" href="trx0types_8h.html#a64150d81cbf5eba60e4a902c2c8d7a1a">trx_ulogf_t</a> *undo_log);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">/** Write GTID information to undo log header.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">@param[in,out]  trx             transaction</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">@param[in,out]  undo_header     undo log header</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">@param[in,out]  undo            undo log memory object</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">@param[in,out]  mtr             minit transaction for write */</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0undo_8h.html#a44765cc7f3e1ef14e3215d902ca5b181">trx_undo_gtid_write</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <a class="code" href="trx0types_8h.html#a64150d81cbf5eba60e4a902c2c8d7a1a">trx_ulogf_t</a> *undo_header, <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="namespaceundo.html">undo</a>,</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                         <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">/** The offset of the undo log page header on pages of the undo log */</span></div><div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#ab91980ce604cd0800f205cb4b2508cc6">  442</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_PAGE_HDR FSEG_PAGE_DATA</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">/*-------------------------------------------------------------*/</span><span class="comment"></span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">/** Transaction undo log page header offsets */</span><span class="comment"></span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">/** @{ */</span></div><div class="line"><a name="l00446"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a304a793a3cc253b520910aa34547da96">  446</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_PAGE_TYPE  \</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="preprocessor">  0 </span><span class="comment">/*!&lt; TRX_UNDO_INSERT or \</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">    TRX_UNDO_UPDATE */</span><span class="preprocessor"></span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="preprocessor">#define TRX_UNDO_PAGE_START               \</span></div><div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a602caf71da94134c9529c3a05bd56776">  450</a></span>&#160;<span class="preprocessor">  2 </span><span class="comment">/*!&lt; Byte offset where the undo log   \</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">    records for the LATEST transaction    \</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">    start on this page (remember that     \</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">    in an update undo log, the first page \</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">    can contain several undo logs) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="preprocessor">#define TRX_UNDO_PAGE_FREE                 \</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="preprocessor">  4 </span><span class="comment">/*!&lt; On each page of the undo log this \</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">    field contains the byte offset of the  \</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">    first free byte on the page */</span><span class="preprocessor"></span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor">#define TRX_UNDO_PAGE_NODE               \</span></div><div class="line"><a name="l00460"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a5fb4e65d422c3cd4cd73d6e37e60b8ce">  460</a></span>&#160;<span class="preprocessor">  6 </span><span class="comment">/*!&lt; The file list node in the chain \</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">    of undo log pages */</span><span class="preprocessor"></span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">/*-------------------------------------------------------------*/</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor">#define TRX_UNDO_PAGE_HDR_SIZE (6 + FLST_NODE_SIZE)</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">/*!&lt; Size of the transaction undo</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">log page header, in bytes */</span><span class="comment"></span></div><div class="line"><a name="l00466"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#ab9f7746023b72bd8aec2a3661f88f42b">  466</a></span>&#160;<span class="comment">/** @} */</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">/** An update undo segment with just one page can be reused if it has</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">at most this many bytes used; we must leave space at least for one new undo</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">log header on the page */</span></div><div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a81f0cffd9e576d90308dcde3aa9a7098">  471</a></span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="preprocessor">#define TRX_UNDO_PAGE_REUSE_LIMIT (3 * UNIV_PAGE_SIZE / 4)</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">/* An update undo log segment may contain several undo logs on its first page</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">if the undo logs took so little space that the segment could be cached and</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">reused. All the undo log headers are then on the first page, and the last one</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">owns the undo log records on subsequent pages if the segment is bigger than</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">one page. If an undo log is stored in a segment, then on the first page it is</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">allowed to have zero undo records, but if the segment extends to several</span></div><div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a7f68b6afdd7d85380279245d3fab531c">  480</a></span>&#160;<span class="comment">pages, then all the rest of the pages must contain at least one undo log</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">record. */</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">/** The offset of the undo log segment header on the first page of the undo</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">log segment */</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="preprocessor">#define TRX_UNDO_SEG_HDR (TRX_UNDO_PAGE_HDR + TRX_UNDO_PAGE_HDR_SIZE)</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">/** Undo log segment header */</span><span class="comment"></span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">/** @{ */</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">/*-------------------------------------------------------------*/</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="preprocessor">#define TRX_UNDO_STATE 0 </span><span class="comment">/*!&lt; TRX_UNDO_ACTIVE, ... */</span><span class="preprocessor"></span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor">#define TRX_UNDO_LAST_LOG                   \</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">  2 </span><span class="comment">/*!&lt; Offset of the last undo log header \</span></div><div class="line"><a name="l00494"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a7080a21a75110243d8b9c1a43c442085">  494</a></span>&#160;<span class="comment">    on the segment header page, 0 if        \</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">    none */</span><span class="preprocessor"></span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="preprocessor">#define TRX_UNDO_FSEG_HEADER               \</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor">  4 </span><span class="comment">/*!&lt; Header for the file segment which \</span></div><div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a363a78c092573b7b84181c2c95480da6">  498</a></span>&#160;<span class="comment">    the undo log segment occupies */</span><span class="preprocessor"></span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="preprocessor">#define TRX_UNDO_PAGE_LIST (4 + FSEG_HEADER_SIZE)</span></div><div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#afc1b18c4418c42c02071eb629d202c71">  500</a></span>&#160;<span class="comment">/*!&lt; Base node for the list of pages in</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">the undo log segment; defined only on</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">the undo log segment&#39;s first page */</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">/*-------------------------------------------------------------*/</span><span class="comment"></span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">/** Size of the undo log segment header */</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor">#define TRX_UNDO_SEG_HDR_SIZE (4 + FSEG_HEADER_SIZE + FLST_BASE_NODE_SIZE)</span></div><div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#aef35459c9c8dc977e3f7cc1091ccc6a6">  506</a></span>&#160;<span class="comment">/** @} */</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">/** The undo log header. There can be several undo log headers on the first</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">page of an update undo log segment. */</span><span class="comment"></span></div><div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a8c332908af74a82f679a3ca31544a69b">  510</a></span>&#160;<span class="comment">/** @{ */</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">/*-------------------------------------------------------------*/</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="preprocessor">#define TRX_UNDO_TRX_ID 0 </span><span class="comment">/*!&lt; Transaction id */</span><span class="preprocessor"></span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="preprocessor">#define TRX_UNDO_TRX_NO                  \</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="preprocessor">  8 </span><span class="comment">/*!&lt; Transaction number of the       \</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">    transaction; defined only if the log \</span></div><div class="line"><a name="l00516"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a1f2cdc055cdda13b163edd2e8e26f505">  516</a></span>&#160;<span class="comment">    is in a history list */</span><span class="preprocessor"></span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="preprocessor">#define TRX_UNDO_DEL_MARKS                 \</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="preprocessor">  16 </span><span class="comment">/*!&lt; Defined only in an update undo   \</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">     log: TRUE if the transaction may have \</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">     done delete markings of records, and  \</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">     thus purge is necessary */</span><span class="preprocessor"></span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#define TRX_UNDO_LOG_START                    \</span></div><div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#ad731492924e06471984f99d5f59d59a8">  523</a></span>&#160;<span class="preprocessor">  18 </span><span class="comment">/*!&lt; Offset of the first undo log record \</span></div><div class="line"><a name="l00524"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a719b18197bfb01c0292995506538f445">  524</a></span>&#160;<span class="comment">     of this log on the header page; purge    \</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">     may remove undo log record from the      \</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">     log start, and therefore this is not     \</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">     necessarily the same as this log         \</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">     header end offset */</span><span class="preprocessor"></span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="preprocessor">#define TRX_UNDO_FLAGS                               \</span></div><div class="line"><a name="l00530"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a6b0e667037fdd3dee1b299a455a233aa">  530</a></span>&#160;<span class="preprocessor">  20 </span><span class="comment">/*! Transaction UNDO flags in one byte. This is \</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">     backward compatible as earlier we were storing  \</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">     either 1 or 0 for TRX_UNDO_XID_EXISTS. */</span><span class="preprocessor"></span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#define TRX_UNDO_FLAG_XID                    \</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor">  0x01 </span><span class="comment">/*!&lt; TRUE if undo log header includes \</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">       X/Open XA transaction identification  \</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">       XID */</span><span class="preprocessor"></span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor">#define TRX_UNDO_FLAG_GTID                   \</span></div><div class="line"><a name="l00538"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#ad3093a267fe72ea95329bab4130d50e8">  538</a></span>&#160;<span class="preprocessor">  0x02 </span><span class="comment">/*!&lt; TRUE if undo log header includes \</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">       GTID information from replication */</span><span class="preprocessor"></span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="preprocessor">#define TRX_UNDO_DICT_TRANS                  \</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="preprocessor">  21 </span><span class="comment">/*!&lt; TRUE if the transaction is a table \</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">     create, index create, or drop           \</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">     transaction: in recovery                \</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">     the transaction cannot be rolled back   \</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">     in the usual way: a &#39;rollback&#39; rather   \</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">     means dropping the created or dropped   \</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">     table, if it still exists */</span><span class="preprocessor"></span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#define TRX_UNDO_TABLE_ID                  \</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="preprocessor">  22 </span><span class="comment">/*!&lt; Id of the table if the preceding \</span></div><div class="line"><a name="l00550"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a8159617bd1f173e9184a44dca06fdef1">  550</a></span>&#160;<span class="comment">     field is TRUE. Note: deprecated */</span><span class="preprocessor"></span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="preprocessor">#define TRX_UNDO_NEXT_LOG                    \</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="preprocessor">  30 </span><span class="comment">/*!&lt; Offset of the next undo log header \</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">     on this page, 0 if none */</span><span class="preprocessor"></span></div><div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a4a8a6ef3e57f0b321c534318067ec70e">  554</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_PREV_LOG                 \</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="preprocessor">  32 </span><span class="comment">/*!&lt; Offset of the previous undo log \</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">     header on this page, 0 if none */</span><span class="preprocessor"></span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="preprocessor">#define TRX_UNDO_HISTORY_NODE              \</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="preprocessor">  34 </span><span class="comment">/*!&lt; If the log is put to the history \</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">     list, the file list node is here */</span><span class="preprocessor"></span></div><div class="line"><a name="l00560"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a7523bd5eba6d88f3a29edbf1eb01a651">  560</a></span>&#160;<span class="comment">/*-------------------------------------------------------------*/</span><span class="comment"></span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">/** Size of the undo log header without XID information */</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="preprocessor">#define TRX_UNDO_LOG_OLD_HDR_SIZE (34 + FLST_NODE_SIZE)</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#aff82d1140d6d6e2f9cf0bbb00bf0500e">  564</a></span>&#160;<span class="comment">/* Note: the writing of the undo log old header is coded by a log record</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">MLOG_UNDO_HDR_CREATE or MLOG_UNDO_HDR_REUSE. The appending of an XID to the</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">header is logged separately. In this sense, the XID is not really a member</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">of the undo log header. TODO: do not append the XID to the log header if XA</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">is not needed by the user. The XID wastes about 150 bytes of space in every</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">undo log. In the history list we may have millions of undo logs, which means</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">quite a large overhead. */</span><span class="comment"></span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">/** @} */</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">/** X/Open XA Transaction Identification (XID) */</span><span class="comment"></span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">/** @{ */</span><span class="comment"></span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">/** xid_t::formatID */</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="preprocessor">#define TRX_UNDO_XA_FORMAT (TRX_UNDO_LOG_OLD_HDR_SIZE)</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">/** xid_t::gtrid_length */</span></div><div class="line"><a name="l00578"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a52ac1fb2fe68ae017021f0a7cde9b892">  578</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_XA_TRID_LEN (TRX_UNDO_XA_FORMAT + 4)</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">/** xid_t::bqual_length */</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="preprocessor">#define TRX_UNDO_XA_BQUAL_LEN (TRX_UNDO_XA_TRID_LEN + 4)</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">/** Distributed transaction identifier data */</span></div><div class="line"><a name="l00582"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#ae028eab2bea87c744818f15e312e51f9">  582</a></span>&#160;<span class="preprocessor">#define TRX_UNDO_XA_XID (TRX_UNDO_XA_BQUAL_LEN + 4)</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">/*--------------------------------------------------------------*/</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="preprocessor">#define TRX_UNDO_LOG_XA_HDR_SIZE (TRX_UNDO_XA_XID + XIDDATASIZE)</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">/*!&lt; Total size of the undo log header</span></div><div class="line"><a name="l00586"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#af46da26879663fa2a46a5a8a0e23cae4">  586</a></span>&#160;<span class="comment">with the XA XID */</span><span class="comment"></span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">/** @} */</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">/* GTID is generated by replication when binlog and GTID mode is on. We</span></div><div class="line"><a name="l00590"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#abda919ac9fd0edefd4dfac71098ba3ad">  590</a></span>&#160;<span class="comment">persist GTID with undo record till it is written to gtid_exeuted table.</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">GTID information is present when TRX_UNDO_FLAG_GTID set. It follows XID</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">information */</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">/** GTID version offset */</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#define TRX_UNDO_LOG_GTID_VERSION (TRX_UNDO_LOG_XA_HDR_SIZE)</span></div><div class="line"><a name="l00596"></a><span class="lineno"><a class="line" href="trx0undo_8h.html#a1102a9f4843a83f67018860e0bcf5b20">  596</a></span>&#160;<span class="comment"></span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">/** GTID offset */</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="preprocessor">#define TRX_UNDO_LOG_GTID (TRX_UNDO_LOG_XA_HDR_SIZE + 1)</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">/** Total length of GTID */</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="preprocessor">#define TRX_UNDO_LOG_GTID_LEN 64</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">/** Total size of GTID information. */</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor">#define TRX_UNDO_LOG_HDR_SIZE (TRX_UNDO_LOG_GTID + TRX_UNDO_LOG_GTID_LEN)</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="preprocessor">#include &quot;trx0undo.ic&quot;</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="structtrx__undo__t_html_a67b388d96c8d6893eb5c1887711aaad3"><div class="ttname"><a href="structtrx__undo__t.html#a67b388d96c8d6893eb5c1887711aaad3">trx_undo_t::del_marks</a></div><div class="ttdeci">ibool del_marks</div><div class="ttdoc">relevant only in an update undo log: this is TRUE if the transaction may have delete marked records...</div><div class="ttdef"><b>Definition:</b> trx0undo.h:357</div></div>
<div class="ttc" id="trx0undo_8h_html_a2b8701cda5460bc9dca42af927400446"><div class="ttname"><a href="trx0undo_8h.html#a2b8701cda5460bc9dca42af927400446">trx_undo_gtid_read_and_persist</a></div><div class="ttdeci">void trx_undo_gtid_read_and_persist(trx_ulogf_t *undo_log)</div><div class="ttdoc">Read and persist GTID from undo header during recovery. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:649</div></div>
<div class="ttc" id="trx0types_8h_html_a0b302ec5d015d6388eb98277b58048c7"><div class="ttname"><a href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a></div><div class="ttdeci">byte trx_undo_rec_t</div><div class="ttdoc">Undo log record. </div><div class="ttdef"><b>Definition:</b> trx0types.h:173</div></div>
<div class="ttc" id="api0api_8h_html_a3a920291a017c14a72331c818adf2265"><div class="ttname"><a href="api0api_8h.html#a3a920291a017c14a72331c818adf2265">page_no_t</a></div><div class="ttdeci">uint32 page_no_t</div><div class="ttdoc">Page number. </div><div class="ttdef"><b>Definition:</b> api0api.h:57</div></div>
<div class="ttc" id="structtrx__undo__t_html_ac33eeedee74fb711c96708ede207a752"><div class="ttname"><a href="structtrx__undo__t.html#ac33eeedee74fb711c96708ede207a752">trx_undo_t::hdr_page_no</a></div><div class="ttdeci">page_no_t hdr_page_no</div><div class="ttdoc">page number of the header page in the undo log </div><div class="ttdef"><b>Definition:</b> trx0undo.h:381</div></div>
<div class="ttc" id="trx0types_8h_html_ad3ccac613ce33a8680d147c4a4f12e94"><div class="ttname"><a href="trx0types_8h.html#ad3ccac613ce33a8680d147c4a4f12e94">roll_ptr_t</a></div><div class="ttdeci">ib_id_t roll_ptr_t</div><div class="ttdoc">Rollback pointer (DB_ROLL_PTR, DATA_ROLL_PTR) </div><div class="ttdef"><b>Definition:</b> trx0types.h:146</div></div>
<div class="ttc" id="trx0xa_8h_html"><div class="ttname"><a href="trx0xa_8h.html">trx0xa.h</a></div></div>
<div class="ttc" id="structtrx__undo__t_html_af01a14c7c05251eb80d93224e8b72138"><div class="ttname"><a href="structtrx__undo__t.html#af01a14c7c05251eb80d93224e8b72138">trx_undo_t::top_offset</a></div><div class="ttdeci">ulint top_offset</div><div class="ttdoc">offset of the latest undo record, i.e., the topmost element in the undo log if we think of it as a st...</div><div class="ttdef"><b>Definition:</b> trx0undo.h:396</div></div>
<div class="ttc" id="structtrx__undo__t_html_a513a3200227355e2711e2a74139e0c51"><div class="ttname"><a href="structtrx__undo__t.html#a513a3200227355e2711e2a74139e0c51">trx_undo_t::guess_block</a></div><div class="ttdeci">buf_block_t * guess_block</div><div class="ttdoc">guess for the buffer block where the top page might reside </div><div class="ttdef"><b>Definition:</b> trx0undo.h:400</div></div>
<div class="ttc" id="trx0undo_8h_html_a4478cc9b951f1a1542d423815cfb6b26"><div class="ttname"><a href="trx0undo_8h.html#a4478cc9b951f1a1542d423815cfb6b26">trx_undo_gtid_set</a></div><div class="ttdeci">void trx_undo_gtid_set(trx_t *trx, trx_undo_t *undo)</div><div class="ttdoc">Set GTID flag in undo if transaction has GTID/. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:631</div></div>
<div class="ttc" id="trx0undo_8h_html_af4971a01bdf3e862d13ac6d58c8ebf67"><div class="ttname"><a href="trx0undo_8h.html#af4971a01bdf3e862d13ac6d58c8ebf67">trx_undo_free_trx_with_prepared_or_active_logs</a></div><div class="ttdeci">void trx_undo_free_trx_with_prepared_or_active_logs(trx_t *trx, ulint expected_undo_state) UNIV_COLD</div><div class="ttdoc">At shutdown, frees the undo logs of a transaction which was either PREPARED or (ACTIVE and recovered)...</div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1919</div></div>
<div class="ttc" id="structtrx__t_html"><div class="ttname"><a href="structtrx__t.html">trx_t</a></div><div class="ttdef"><b>Definition:</b> trx0trx.h:833</div></div>
<div class="ttc" id="namespaceundo_html"><div class="ttname"><a href="namespaceundo.html">undo</a></div><div class="ttdef"><b>Definition:</b> trx0purge.h:135</div></div>
<div class="ttc" id="structbuf__block__t_html"><div class="ttname"><a href="structbuf__block__t.html">buf_block_t</a></div><div class="ttdoc">The buffer control block structure. </div><div class="ttdef"><b>Definition:</b> buf0buf.h:1324</div></div>
<div class="ttc" id="classpage__id__t_html"><div class="ttname"><a href="classpage__id__t.html">page_id_t</a></div><div class="ttdoc">Page identifier. </div><div class="ttdef"><b>Definition:</b> buf0types.h:158</div></div>
<div class="ttc" id="trx0undo_8h_html_a779c2b358e8d65f9ec13f5939f537e78"><div class="ttname"><a href="trx0undo_8h.html#a779c2b358e8d65f9ec13f5939f537e78">trx_undo_truncate_tablespace</a></div><div class="ttdeci">bool trx_undo_truncate_tablespace(undo::Tablespace *marked_space)</div><div class="ttdoc">Truncate UNDO tablespace, reinitialize header and rseg. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1964</div></div>
<div class="ttc" id="structtrx__undo__t_html_a3d88cc2d85a556ba2857b540af191ab1"><div class="ttname"><a href="structtrx__undo__t.html#a3d88cc2d85a556ba2857b540af191ab1">trx_undo_t::type</a></div><div class="ttdeci">ulint type</div><div class="ttdoc">TRX_UNDO_INSERT or TRX_UNDO_UPDATE. </div><div class="ttdef"><b>Definition:</b> trx0undo.h:353</div></div>
<div class="ttc" id="trx0types_8h_html_a64150d81cbf5eba60e4a902c2c8d7a1a"><div class="ttname"><a href="trx0types_8h.html#a64150d81cbf5eba60e4a902c2c8d7a1a">trx_ulogf_t</a></div><div class="ttdeci">byte trx_ulogf_t</div><div class="ttdoc">Undo log header. </div><div class="ttdef"><b>Definition:</b> trx0types.h:169</div></div>
<div class="ttc" id="sql__cmd__srs_8cc_html_ae1f3a7aed6d381dcd98b265913716fd4"><div class="ttname"><a href="sql__cmd__srs_8cc.html#ae1f3a7aed6d381dcd98b265913716fd4">rollback</a></div><div class="ttdeci">static bool rollback(THD *thd)</div><div class="ttdoc">Abort the current statement and transaction. </div><div class="ttdef"><b>Definition:</b> sql_cmd_srs.cc:139</div></div>
<div class="ttc" id="mtr0types_8h_html_a11a0f116bed9e1c33900d379901595d1"><div class="ttname"><a href="mtr0types_8h.html#a11a0f116bed9e1c33900d379901595d1">mlog_id_t</a></div><div class="ttdeci">mlog_id_t</div><div class="ttdef"><b>Definition:</b> mtr0types.h:62</div></div>
<div class="ttc" id="trx0undo_8h_html_a676b69b6eb4edc717e170df954a7249f"><div class="ttname"><a href="trx0undo_8h.html#a676b69b6eb4edc717e170df954a7249f">trx_undo_parse_page_header</a></div><div class="ttdeci">byte * trx_undo_parse_page_header(mlog_id_t type, const byte *ptr, const byte *end_ptr, page_t *page, mtr_t *mtr)</div><div class="ttdoc">Parse the redo log entry of an undo log page header create or reuse. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:782</div></div>
<div class="ttc" id="structtrx__undo__t_html_a98de3be99c525e76aea79abff8e63d2e"><div class="ttname"><a href="structtrx__undo__t.html#a98de3be99c525e76aea79abff8e63d2e">trx_undo_t::top_undo_no</a></div><div class="ttdeci">undo_no_t top_undo_no</div><div class="ttdoc">undo number of the latest record </div><div class="ttdef"><b>Definition:</b> trx0undo.h:399</div></div>
<div class="ttc" id="namespacestdx_1_1io_html_a2c9b563b772005f7960909d0d12186f5"><div class="ttname"><a href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">stdx::io::mode</a></div><div class="ttdeci">mode</div><div class="ttdef"><b>Definition:</b> file_handle.h:59</div></div>
<div class="ttc" id="trx0undo_8h_html_a3a13e9d79998ebeb63174e5efab7cf9e"><div class="ttname"><a href="trx0undo_8h.html#a3a13e9d79998ebeb63174e5efab7cf9e">trx_undo_update_cleanup</a></div><div class="ttdeci">void trx_undo_update_cleanup(trx_t *trx, trx_undo_ptr_t *undo_ptr, page_t *undo_page, bool update_rseg_history_len, ulint n_added_logs, mtr_t *mtr)</div><div class="ttdoc">Adds the update undo log header as the first in the history list, and frees the memory object...</div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1847</div></div>
<div class="ttc" id="trx0undo_8h_html_a4604d8632bffdcc38ae2b42c6c48ff3f"><div class="ttname"><a href="trx0undo_8h.html#a4604d8632bffdcc38ae2b42c6c48ff3f">trx_undo_trx_id_is_insert</a></div><div class="ttdeci">UNIV_INLINE bool trx_undo_trx_id_is_insert(const byte *trx_id)</div><div class="ttdoc">Returns true if the record is of the insert type. </div></div>
<div class="ttc" id="page0types_8h_html"><div class="ttname"><a href="page0types_8h.html">page0types.h</a></div><div class="ttdoc">Index page routines. </div></div>
<div class="ttc" id="trx0undo_8h_html_a4a54b672a527b51531cce2bd9283fa52"><div class="ttname"><a href="trx0undo_8h.html#a4a54b672a527b51531cce2bd9283fa52">trx_undo_page_get_s_latched</a></div><div class="ttdeci">UNIV_INLINE page_t * trx_undo_page_get_s_latched(const page_id_t &amp;page_id, const page_size_t &amp;page_size, mtr_t *mtr)</div><div class="ttdoc">Gets an undo log page and s-latches it. </div></div>
<div class="ttc" id="structtrx__rseg__t_html"><div class="ttname"><a href="structtrx__rseg__t.html">trx_rseg_t</a></div><div class="ttdoc">The rollback segment memory object. </div><div class="ttdef"><b>Definition:</b> trx0types.h:183</div></div>
<div class="ttc" id="structtrx__undo__t_html_af885e218b36ec32ad5a6e57970250fa8"><div class="ttname"><a href="structtrx__undo__t.html#af885e218b36ec32ad5a6e57970250fa8">trx_undo_t::size</a></div><div class="ttdeci">ulint size</div><div class="ttdoc">current size in pages </div><div class="ttdef"><b>Definition:</b> trx0undo.h:388</div></div>
<div class="ttc" id="structtrx__undo__t_html_a70502c4798fe0cd554a4e15fa52024cb"><div class="ttname"><a href="structtrx__undo__t.html#a70502c4798fe0cd554a4e15fa52024cb">trx_undo_t::empty</a></div><div class="ttdeci">ulint empty</div><div class="ttdoc">TRUE if the stack of undo log records is currently empty. </div><div class="ttdef"><b>Definition:</b> trx0undo.h:390</div></div>
<div class="ttc" id="trx0undo_8h_html_a0310ed42747e8c3e3ab2158aab3857d7"><div class="ttname"><a href="trx0undo_8h.html#a0310ed42747e8c3e3ab2158aab3857d7">trx_read_roll_ptr</a></div><div class="ttdeci">UNIV_INLINE roll_ptr_t trx_read_roll_ptr(const byte *ptr)</div><div class="ttdoc">Reads a roll ptr from an index page. </div></div>
<div class="ttc" id="structtrx__undo__t_html_a812f9a716a5d2e7949229069c3ca5f7c"><div class="ttname"><a href="structtrx__undo__t.html#a812f9a716a5d2e7949229069c3ca5f7c">trx_undo_t::top_page_no</a></div><div class="ttdeci">page_no_t top_page_no</div><div class="ttdoc">page number where the latest undo log record was catenated; during rollback the page from which the l...</div><div class="ttdef"><b>Definition:</b> trx0undo.h:392</div></div>
<div class="ttc" id="trx0undo_8h_html_a90c1e778639f67befa0675a202a44635"><div class="ttname"><a href="trx0undo_8h.html#a90c1e778639f67befa0675a202a44635">trx_undo_page_get_last_rec</a></div><div class="ttdeci">UNIV_INLINE trx_undo_rec_t * trx_undo_page_get_last_rec(page_t *undo_page, page_no_t page_no, ulint offset)</div><div class="ttdoc">Returns the last undo record on the page in the specified undo log, or NULL if none exists...</div></div>
<div class="ttc" id="trx0undo_8h_html_aed6fca708c095122afd8e0f7b2edf3b9"><div class="ttname"><a href="trx0undo_8h.html#aed6fca708c095122afd8e0f7b2edf3b9">trx_undo_free_last_page_func</a></div><div class="ttdeci">void trx_undo_free_last_page_func(const trx_t *trx, trx_undo_t *undo, mtr_t *mtr)</div><div class="ttdoc">Frees the last undo log page. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:977</div></div>
<div class="ttc" id="structtrx__undo__t_html_a3a09663d3d4f4c0c8fcfad1899dd9c6d"><div class="ttname"><a href="structtrx__undo__t.html#a3a09663d3d4f4c0c8fcfad1899dd9c6d">trx_undo_t::gtid_allocated</a></div><div class="ttdeci">bool gtid_allocated</div><div class="ttdoc">Set if space for GTID is allocated. </div><div class="ttdef"><b>Definition:</b> trx0undo.h:373</div></div>
<div class="ttc" id="structtrx__undo__t_html_a9002884e0ae33110ff4462e45f869680"><div class="ttname"><a href="structtrx__undo__t.html#a9002884e0ae33110ff4462e45f869680">trx_undo_t::xid</a></div><div class="ttdeci">XID xid</div><div class="ttdoc">X/Open XA transaction identification. </div><div class="ttdef"><b>Definition:</b> trx0undo.h:367</div></div>
<div class="ttc" id="structtrx__undo__t_html_abc4145ee910bc266d95e707527807b23"><div class="ttname"><a href="structtrx__undo__t.html#abc4145ee910bc266d95e707527807b23">trx_undo_t::state</a></div><div class="ttdeci">ulint state</div><div class="ttdoc">state of the corresponding undo log segment </div><div class="ttdef"><b>Definition:</b> trx0undo.h:355</div></div>
<div class="ttc" id="trx0undo_8h_html_a22e6291c6bb7526fcc06a44eb762e856"><div class="ttname"><a href="trx0undo_8h.html#a22e6291c6bb7526fcc06a44eb762e856">trx_undo_page_get_prev_rec</a></div><div class="ttdeci">UNIV_INLINE trx_undo_rec_t * trx_undo_page_get_prev_rec(trx_undo_rec_t *rec, page_no_t page_no, ulint offset)</div><div class="ttdoc">Returns the previous undo record on the page in the specified log, or NULL if none exists...</div></div>
<div class="ttc" id="trx0undo_8h_html_abae1094db7dcce1c08c7c1dafa72e4f7"><div class="ttname"><a href="trx0undo_8h.html#abae1094db7dcce1c08c7c1dafa72e4f7">trx_undo_page_get</a></div><div class="ttdeci">UNIV_INLINE page_t * trx_undo_page_get(const page_id_t &amp;page_id, const page_size_t &amp;page_size, mtr_t *mtr)</div><div class="ttdoc">Gets an undo log page and x-latches it. </div></div>
<div class="ttc" id="ctype-mb_8cc_html_adf406aa6822ceac22d62ef63cc2879c0"><div class="ttname"><a href="ctype-mb_8cc.html#adf406aa6822ceac22d62ef63cc2879c0">page</a></div><div class="ttdeci">int page</div><div class="ttdef"><b>Definition:</b> ctype-mb.cc:1234</div></div>
<div class="ttc" id="trx0undo_8h_html_a0efdc7034cfaf28df8ad2b826ab68ca5"><div class="ttname"><a href="trx0undo_8h.html#a0efdc7034cfaf28df8ad2b826ab68ca5">trx_undo_get_first_rec</a></div><div class="ttdeci">trx_undo_rec_t * trx_undo_get_first_rec(trx_id_t *modifier_trx_id, space_id_t space, const page_size_t &amp;page_size, page_no_t page_no, ulint offset, ulint mode, mtr_t *mtr)</div><div class="ttdoc">Gets the first record in an undo log. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:291</div></div>
<div class="ttc" id="structtrx__undo__t_html_a280871327e9772d42503dae2670fb4bc"><div class="ttname"><a href="structtrx__undo__t.html#a280871327e9772d42503dae2670fb4bc">trx_undo_t::dict_operation</a></div><div class="ttdeci">ibool dict_operation</div><div class="ttdoc">TRUE if a dict operation trx. </div><div class="ttdef"><b>Definition:</b> trx0undo.h:375</div></div>
<div class="ttc" id="trx0undo_8h_html_abc4d8f8dc577f8289b89ba6f9e9bd0bf"><div class="ttname"><a href="trx0undo_8h.html#abc4d8f8dc577f8289b89ba6f9e9bd0bf">trx_undo_truncate_start</a></div><div class="ttdeci">void trx_undo_truncate_start(trx_rseg_t *rseg, page_no_t hdr_page_no, ulint hdr_offset, undo_no_t limit)</div><div class="ttdoc">Truncate the head of an undo log. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1138</div></div>
<div class="ttc" id="structundo_1_1Tablespace_html"><div class="ttname"><a href="structundo_1_1Tablespace.html">undo::Tablespace</a></div><div class="ttdoc">An undo::Tablespace object is used to easily convert between undo_space_id and undo_space_num and to ...</div><div class="ttdef"><b>Definition:</b> trx0purge.h:308</div></div>
<div class="ttc" id="trx0undo_8h_html_a709ead64d1a58f7cbb8564eba985a0e5"><div class="ttname"><a href="trx0undo_8h.html#a709ead64d1a58f7cbb8564eba985a0e5">trx_undo_gtid_add_update_undo</a></div><div class="ttdeci">dberr_t trx_undo_gtid_add_update_undo(trx_t *trx, bool prepare, bool rollback)</div><div class="ttdoc">For saving GTID add update undo slot, if required. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:595</div></div>
<div class="ttc" id="db0err_8h_html_a6fdd08971b32ee513b20967238f1654d"><div class="ttname"><a href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a></div><div class="ttdeci">dberr_t</div><div class="ttdef"><b>Definition:</b> db0err.h:38</div></div>
<div class="ttc" id="structtrx__undo__t_html_a8f3d2792093262598c4f4ea11d37f27d"><div class="ttname"><a href="structtrx__undo__t.html#a8f3d2792093262598c4f4ea11d37f27d">trx_undo_t::rseg</a></div><div class="ttdeci">trx_rseg_t * rseg</div><div class="ttdoc">rseg where the undo log belongs </div><div class="ttdef"><b>Definition:</b> trx0undo.h:376</div></div>
<div class="ttc" id="xa_8h_html"><div class="ttname"><a href="xa_8h.html">xa.h</a></div></div>
<div class="ttc" id="trx0undo_8h_html_a217d801284210e8ce80b23e6caf1f7e1"><div class="ttname"><a href="trx0undo_8h.html#a217d801284210e8ce80b23e6caf1f7e1">trx_write_roll_ptr</a></div><div class="ttdeci">UNIV_INLINE void trx_write_roll_ptr(byte *ptr, roll_ptr_t roll_ptr)</div><div class="ttdoc">Writes a roll ptr to an index page. </div></div>
<div class="ttc" id="structtrx__undo__t_html_ad2fb0cf08a3c40245b7205f90f950ba1"><div class="ttname"><a href="structtrx__undo__t.html#ad2fb0cf08a3c40245b7205f90f950ba1">trx_undo_t::hdr_offset</a></div><div class="ttdeci">ulint hdr_offset</div><div class="ttdoc">header offset of the undo log on the page </div><div class="ttdef"><b>Definition:</b> trx0undo.h:383</div></div>
<div class="ttc" id="trx0undo_8h_html_abe26d8b4feba8014169ba870a077bd1a"><div class="ttname"><a href="trx0undo_8h.html#abe26d8b4feba8014169ba870a077bd1a">trx_undo_page_get_next_rec</a></div><div class="ttdeci">UNIV_INLINE trx_undo_rec_t * trx_undo_page_get_next_rec(trx_undo_rec_t *rec, page_no_t page_no, ulint offset)</div><div class="ttdoc">Returns the next undo log record on the page in the specified log, or NULL if none exists...</div></div>
<div class="ttc" id="structxid__t_html"><div class="ttname"><a href="structxid__t.html">xid_t</a></div><div class="ttdoc">struct xid_t is binary compatible with the XID structure as in the X/Open CAE Specification, Distributed Transaction Processing: The XA Specification, X/Open Company Ltd., 1991. </div><div class="ttdef"><b>Definition:</b> xa.h:215</div></div>
<div class="ttc" id="trx0undo_8h_html_aa48dbdbc99a6e2448e999d63a3474b86"><div class="ttname"><a href="trx0undo_8h.html#aa48dbdbc99a6e2448e999d63a3474b86">trx_undo_add_page</a></div><div class="ttdeci">buf_block_t * trx_undo_add_page(trx_t *trx, trx_undo_t *undo, trx_undo_ptr_t *undo_ptr, mtr_t *mtr)</div><div class="ttdoc">Tries to add a page to the undo log segment where the undo log is placed. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:862</div></div>
<div class="ttc" id="trx0undo_8h_html_aaf6122e2f1a1b66d8f4098566c0cea5d"><div class="ttname"><a href="trx0undo_8h.html#aaf6122e2f1a1b66d8f4098566c0cea5d">trx_undo_assign_undo</a></div><div class="ttdeci">dberr_t trx_undo_assign_undo(trx_t *trx, trx_undo_ptr_t *undo_ptr, ulint type)</div><div class="ttdoc">Assigns an undo log for a transaction. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1646</div></div>
<div class="ttc" id="namespacebinary__log_1_1transaction_1_1compression_html_a22a3b5d8096f4c73ced74c0b668df0be"><div class="ttname"><a href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">binary_log::transaction::compression::type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> base.h:36</div></div>
<div class="ttc" id="trx0types_8h_html"><div class="ttname"><a href="trx0types_8h.html">trx0types.h</a></div><div class="ttdoc">Transaction system global type definitions. </div></div>
<div class="ttc" id="trx0undo_8h_html_aa6b0cc6da71acecc913dc8619c2bf1ff"><div class="ttname"><a href="trx0undo_8h.html#aa6b0cc6da71acecc913dc8619c2bf1ff">trx_undo_get_next_rec</a></div><div class="ttdeci">trx_undo_rec_t * trx_undo_get_next_rec(trx_undo_rec_t *rec, page_no_t page_no, ulint offset, mtr_t *mtr)</div><div class="ttdoc">Gets the next record in an undo log. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:256</div></div>
<div class="ttc" id="trx0undo_8h_html_af0d814de5175af1f4c7db624fe3b6f14"><div class="ttname"><a href="trx0undo_8h.html#af0d814de5175af1f4c7db624fe3b6f14">trx_undo_mem_free</a></div><div class="ttdeci">void trx_undo_mem_free(trx_undo_t *undo)</div><div class="ttdoc">Frees an undo log memory copy. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1481</div></div>
<div class="ttc" id="trx0undo_8h_html_aca7e294a6373aed9aced791f1ea1063b"><div class="ttname"><a href="trx0undo_8h.html#aca7e294a6373aed9aced791f1ea1063b">trx_undo_page_get_first_rec</a></div><div class="ttdeci">UNIV_INLINE trx_undo_rec_t * trx_undo_page_get_first_rec(page_t *undo_page, page_no_t page_no, ulint offset)</div><div class="ttdoc">Returns the first undo record on the page in the specified undo log, or NULL if none exists...</div></div>
<div class="ttc" id="api0api_8h_html_a02e9c11b4a9783f4b0b89fcf060f8f28"><div class="ttname"><a href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a></div><div class="ttdeci">uint32 space_id_t</div><div class="ttdoc">Tablespace identifier. </div><div class="ttdef"><b>Definition:</b> api0api.h:59</div></div>
<div class="ttc" id="trx0undo_8h_html_aae998dd3eefe1c2b7b411324b7677eaf"><div class="ttname"><a href="trx0undo_8h.html#aae998dd3eefe1c2b7b411324b7677eaf">trx_undo_set_state_at_prepare</a></div><div class="ttdeci">page_t * trx_undo_set_state_at_prepare(trx_t *trx, trx_undo_t *undo, bool rollback, mtr_t *mtr)</div><div class="ttdoc">Set the state of the undo log segment at a XA PREPARE or XA ROLLBACK. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1796</div></div>
<div class="ttc" id="structtrx__undo__t_html_a67572cf8f4531e1a3c340d7283dce8ba"><div class="ttname"><a href="structtrx__undo__t.html#a67572cf8f4531e1a3c340d7283dce8ba">trx_undo_t::trx_id</a></div><div class="ttdeci">trx_id_t trx_id</div><div class="ttdoc">id of the trx assigned to the undo log </div><div class="ttdef"><b>Definition:</b> trx0undo.h:365</div></div>
<div class="ttc" id="classpage__size__t_html"><div class="ttname"><a href="classpage__size__t.html">page_size_t</a></div><div class="ttdoc">Page size descriptor. </div><div class="ttdef"><b>Definition:</b> page0size.h:49</div></div>
<div class="ttc" id="trx0types_8h_html_a91afca43a639c098efe14a9069a1d4ec"><div class="ttname"><a href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a></div><div class="ttdeci">ib_id_t trx_id_t</div><div class="ttdoc">Transaction identifier (DB_TRX_ID, DATA_TRX_ID) </div><div class="ttdef"><b>Definition:</b> trx0types.h:144</div></div>
<div class="ttc" id="trx0sys_8h_html"><div class="ttname"><a href="trx0sys_8h.html">trx0sys.h</a></div><div class="ttdoc">Transaction system. </div></div>
<div class="ttc" id="structtrx__undo__t_html_a7cce265556362c596ad5bd682c167f23"><div class="ttname"><a href="structtrx__undo__t.html#a7cce265556362c596ad5bd682c167f23">trx_undo_t::space</a></div><div class="ttdeci">space_id_t space</div><div class="ttdoc">space id where the undo log placed </div><div class="ttdef"><b>Definition:</b> trx0undo.h:378</div></div>
<div class="ttc" id="structtrx__undo__t_html"><div class="ttname"><a href="structtrx__undo__t.html">trx_undo_t</a></div><div class="ttdoc">Transaction undo log memory object; this is protected by the undo_mutex in the corresponding transact...</div><div class="ttdef"><b>Definition:</b> trx0undo.h:345</div></div>
<div class="ttc" id="trx0undo_8h_html_a7dc016181eb351d124de9ae2e48690ed"><div class="ttname"><a href="trx0undo_8h.html#a7dc016181eb351d124de9ae2e48690ed">trx_undo_lists_init</a></div><div class="ttdeci">ulint trx_undo_lists_init(trx_rseg_t *rseg)</div><div class="ttdoc">Initializes the undo log lists for a rollback segment memory copy. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1358</div></div>
<div class="ttc" id="structtrx__undo__t_html_a6e9044b584e7263885832f649e56a6f8"><div class="ttname"><a href="structtrx__undo__t.html#a6e9044b584e7263885832f649e56a6f8">trx_undo_t::id</a></div><div class="ttdeci">ulint id</div><div class="ttdoc">undo log slot number within the rollback segment </div><div class="ttdef"><b>Definition:</b> trx0undo.h:351</div></div>
<div class="ttc" id="structtrx__undo__t_html_a1baccf2d7f75c112eadea67ccb0444dc"><div class="ttname"><a href="structtrx__undo__t.html#a1baccf2d7f75c112eadea67ccb0444dc">trx_undo_t::last_page_no</a></div><div class="ttdeci">page_no_t last_page_no</div><div class="ttdoc">page number of the last page in the undo log; this may differ from top_page_no during a rollback ...</div><div class="ttdef"><b>Definition:</b> trx0undo.h:385</div></div>
<div class="ttc" id="page0types_8h_html_ac84908ddc97c37107986280aa8f37897"><div class="ttname"><a href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a></div><div class="ttdeci">byte page_t</div><div class="ttdoc">Type of the index page. </div><div class="ttdef"><b>Definition:</b> page0types.h:148</div></div>
<div class="ttc" id="trx0undo_8h_html_a91f07d8a94d3c532561ad788123d3b54"><div class="ttname"><a href="trx0undo_8h.html#a91f07d8a94d3c532561ad788123d3b54">trx_undo_insert_cleanup</a></div><div class="ttdeci">void trx_undo_insert_cleanup(trx_undo_ptr_t *undo_ptr, bool noredo)</div><div class="ttdoc">Frees an insert undo log after a transaction commit or rollback. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1882</div></div>
<div class="ttc" id="structtrx__undo__t_html_abe1af679a6f9712c054707f2adab92b3"><div class="ttname"><a href="structtrx__undo__t.html#abe1af679a6f9712c054707f2adab92b3">trx_undo_t::flag</a></div><div class="ttdeci">ulint flag</div><div class="ttdoc">flag for current transaction XID and GTID. </div><div class="ttdef"><b>Definition:</b> trx0undo.h:369</div></div>
<div class="ttc" id="mtr0mtr_8h_html"><div class="ttname"><a href="mtr0mtr_8h.html">mtr0mtr.h</a></div><div class="ttdoc">Mini-transaction buffer. </div></div>
<div class="ttc" id="trx0undo_8h_html_a07f8de1ab8faf28c0b1e676ca6686c8b"><div class="ttname"><a href="trx0undo_8h.html#a07f8de1ab8faf28c0b1e676ca6686c8b">trx_undo_get_prev_rec</a></div><div class="ttdeci">trx_undo_rec_t * trx_undo_get_prev_rec(trx_undo_rec_t *rec, page_no_t page_no, ulint offset, bool shared, mtr_t *mtr)</div><div class="ttdoc">Gets the previous record in an undo log. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:187</div></div>
<div class="ttc" id="trx0undo_8h_html_adac98cb19c93a1716dd808f1a4b5ac0b"><div class="ttname"><a href="trx0undo_8h.html#adac98cb19c93a1716dd808f1a4b5ac0b">trx_undo_truncate_end_func</a></div><div class="ttdeci">void trx_undo_truncate_end_func(const trx_t *trx, trx_undo_t *undo, undo_no_t limit)</div><div class="ttdoc">Truncates an undo log from the end. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1081</div></div>
<div class="ttc" id="structtrx__undo__ptr__t_html"><div class="ttname"><a href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a></div><div class="ttdoc">The transaction handle. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:796</div></div>
<div class="ttc" id="trx0undo_8h_html_a5c8f3e16e21731ea56e0497aaf5d2302"><div class="ttname"><a href="trx0undo_8h.html#a5c8f3e16e21731ea56e0497aaf5d2302">trx_undo_parse_page_init</a></div><div class="ttdeci">byte * trx_undo_parse_page_init(const byte *ptr, const byte *end_ptr, page_t *page, mtr_t *mtr)</div><div class="ttdoc">Parses the redo log entry of an undo log page initialization. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:340</div></div>
<div class="ttc" id="classTablespace_html"><div class="ttname"><a href="classTablespace.html">Tablespace</a></div><div class="ttdoc">Data structure that contains the information about shared tablespaces. </div><div class="ttdef"><b>Definition:</b> fsp0space.h:46</div></div>
<div class="ttc" id="libmysql_2authentication__win_2common_8h_html_a0c8186d9b9b7880309c27230bbb5e69d"><div class="ttname"><a href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a></div><div class="ttdeci">unsigned char byte</div><div class="ttdoc">Blob class. </div><div class="ttdef"><b>Definition:</b> common.h:159</div></div>
<div class="ttc" id="structmtr__t_html"><div class="ttname"><a href="structmtr__t.html">mtr_t</a></div><div class="ttdoc">Mini-transaction handle and buffer. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:169</div></div>
<div class="ttc" id="innodb__utility_8h_html_a496a8f8646bff5c74c18ee0c04134b6d"><div class="ttname"><a href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a></div><div class="ttdeci">#define UT_LIST_NODE_T(TYPE)</div><div class="ttdef"><b>Definition:</b> innodb_utility.h:40</div></div>
<div class="ttc" id="trx0types_8h_html_a4661d2883c1cd5d8f1cfbd63b553f1bc"><div class="ttname"><a href="trx0types_8h.html#a4661d2883c1cd5d8f1cfbd63b553f1bc">undo_no_t</a></div><div class="ttdeci">ib_id_t undo_no_t</div><div class="ttdoc">Undo number. </div><div class="ttdef"><b>Definition:</b> trx0types.h:148</div></div>
<div class="ttc" id="trx0undo_8h_html_a4904164174f613fd3742fca7b8491266"><div class="ttname"><a href="trx0undo_8h.html#a4904164174f613fd3742fca7b8491266">trx_undo_gtid_flush_prepare</a></div><div class="ttdeci">void trx_undo_gtid_flush_prepare(trx_t *trx)</div><div class="ttdoc">Write any previous GTIDs to disk. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:581</div></div>
<div class="ttc" id="trx0undo_8h_html_aff740afe5e5ab8f920dc5d4ecd0d06a4"><div class="ttname"><a href="trx0undo_8h.html#aff740afe5e5ab8f920dc5d4ecd0d06a4">trx_undo_set_state_at_finish</a></div><div class="ttdeci">page_t * trx_undo_set_state_at_finish(trx_undo_t *undo, mtr_t *mtr)</div><div class="ttdoc">Sets the state of the undo log segment at a transaction finish. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:1756</div></div>
<div class="ttc" id="trx0undo_8h_html_a07f8a1930550c8e69e70cea94428aa59"><div class="ttname"><a href="trx0undo_8h.html#a07f8a1930550c8e69e70cea94428aa59">trx_undo_roll_ptr_is_insert</a></div><div class="ttdeci">UNIV_INLINE ibool trx_undo_roll_ptr_is_insert(roll_ptr_t roll_ptr)</div><div class="ttdoc">Returns TRUE if the roll pointer is of the insert type. </div></div>
<div class="ttc" id="trx0undo_8h_html_a44765cc7f3e1ef14e3215d902ca5b181"><div class="ttname"><a href="trx0undo_8h.html#a44765cc7f3e1ef14e3215d902ca5b181">trx_undo_gtid_write</a></div><div class="ttdeci">void trx_undo_gtid_write(trx_t *trx, trx_ulogf_t *undo_header, trx_undo_t *undo, mtr_t *mtr)</div><div class="ttdoc">Write GTID information to undo log header. </div><div class="ttdef"><b>Definition:</b> trx0undo.cc:677</div></div>
<div class="ttc" id="structtrx__undo__t_html_a4c1344ff7591c3c92a1fd4edc1bc364d"><div class="ttname"><a href="structtrx__undo__t.html#a4c1344ff7591c3c92a1fd4edc1bc364d">trx_undo_t::page_size</a></div><div class="ttdeci">page_size_t page_size</div><div class="ttdef"><b>Definition:</b> trx0undo.h:380</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_70f20ecf11358dff00a0daf546d3147e.html">storage</a></li><li class="navelem"><a class="el" href="dir_3fec0aa9607ea05e0bb1c96aee1a8c4e.html">innobase</a></li><li class="navelem"><a class="el" href="dir_9b7ed1f29269ffabdc4c5f5522a0db25.html">include</a></li><li class="navelem"><a class="el" href="trx0undo_8h.html">trx0undo.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
