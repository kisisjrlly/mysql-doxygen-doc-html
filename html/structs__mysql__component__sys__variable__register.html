<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: s_mysql_component_sys_variable_register Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structs__mysql__component__sys__variable__register.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structs__mysql__component__sys__variable__register-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">s_mysql_component_sys_variable_register Struct Reference<div class="ingroups"><a class="el" href="group__group__components__services__inventory.html">Component Services Inventory</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Service to register variable and get variable value.  
 <a href="structs__mysql__component__sys__variable__register.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="component__sys__var__service_8h_source.html">component_sys_var_service.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a889f78976b902de735bafa603456c41d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="service_8h.html#a9b62a937fdf9b9103052f5e660dcd258">mysql_service_status_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structs__mysql__component__sys__variable__register.html#a889f78976b902de735bafa603456c41d">register_variable</a> )(const char *component_name, const char *<a class="el" href="persisted__variable_8cc.html#a02b8247840db27f85191d734d51598fa">name</a>, int <a class="el" href="mi__test1_8cc.html#a6eec09a91807e20d7b3d6ef3da594067">flags</a>, const char *<a class="el" href="lexyy_8cc.html#a43be22b7a1b528eaf759e034ec581543">comment</a>, <a class="el" href="component__sys__var__service_8h.html#a6961277ab2ffcc5e747513052a14afd6">mysql_sys_var_check_func</a> check, <a class="el" href="component__sys__var__service_8h.html#aaa37ba63245757b3c7a0ea1fd0ad7daf">mysql_sys_var_update_func</a> <a class="el" href="myisamlog_8cc.html#a63c3b620cc1cd0b4a2850c8d9804fde2">update</a>, void *check_arg, void *variable_value)</td></tr>
<tr class="memdesc:a889f78976b902de735bafa603456c41d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register a new system variable.  <a href="#a889f78976b902de735bafa603456c41d">More...</a><br /></td></tr>
<tr class="separator:a889f78976b902de735bafa603456c41d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f5875a6b428847f6e13306d16bfb6ce"><td class="memItemLeft" align="right" valign="top"><a class="el" href="service_8h.html#a9b62a937fdf9b9103052f5e660dcd258">mysql_service_status_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structs__mysql__component__sys__variable__register.html#a4f5875a6b428847f6e13306d16bfb6ce">get_variable</a> )(const char *component_name, const char *<a class="el" href="persisted__variable_8cc.html#a02b8247840db27f85191d734d51598fa">name</a>, void **val, size_t *out_length_of_val)</td></tr>
<tr class="memdesc:a4f5875a6b428847f6e13306d16bfb6ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fetches the global value of a system variable.  <a href="#a4f5875a6b428847f6e13306d16bfb6ce">More...</a><br /></td></tr>
<tr class="separator:a4f5875a6b428847f6e13306d16bfb6ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Service to register variable and get variable value. </p>
<dl class="section see"><dt>See also</dt><dd>mysql_component_sys_variable_imp </dd></dl>
</div><h2 class="groupheader">Member Data Documentation</h2>
<a id="a4f5875a6b428847f6e13306d16bfb6ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f5875a6b428847f6e13306d16bfb6ce">&#9670;&nbsp;</a></span>get_variable</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="service_8h.html#a9b62a937fdf9b9103052f5e660dcd258">mysql_service_status_t</a>(*  s_mysql_component_sys_variable_register::get_variable) (const char *component_name, const char *<a class="el" href="persisted__variable_8cc.html#a02b8247840db27f85191d734d51598fa">name</a>, void **val, size_t *out_length_of_val)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fetches the global value of a system variable. </p>
<p>Call this to get the global value of a variable. You can access both the component variables (SELECT @global.component_name.variable_name) and the "legacy" system variables (SELECT @global.variable_name) that are registered by the server component. To access the latter you need to pass "mysql_server" (lowercase) as a component name.</p>
<p>A pointer to the value is returned into the val input/output argument. And the length of the value (as applicable) is returned into the out_length_of_val argument.</p>
<p>In case when the user buffer was too small to copy the value, the call fails and needed buffer size is returned by 'out_length_of_val'.</p>
<p>Typical use (char * variable): </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> *<a class="code" href="persisted__variable_8cc.html#a211d620ef86d6a09b1d29b51b6e44f06">value</a>, buffer_for_value[160];</div><div class="line"><span class="keywordtype">size_t</span> value_length;</div><div class="line"></div><div class="line">value= &amp;buffer_for_value[0];</div><div class="line">value_length= <span class="keyword">sizeof</span>(buffer_for_value) - 1;</div><div class="line"><a class="code" href="structs__mysql__component__sys__variable__register.html#a4f5875a6b428847f6e13306d16bfb6ce">get_variable</a>(<span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;bar&quot;</span>, &amp;value, &amp;value_length);</div><div class="line"></div><div class="line">printf(<span class="stringliteral">&quot;%.*s&quot;</span>, (<span class="keywordtype">int</span>) value_length, value);</div></div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">component_name</td><td>Name of the component or "mysql_server" for the legacy ones. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">name</td><td>name of the variable </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">val</td><td>On input: a buffer to hold the value. On output a pointer to the value. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">out_length_of_val</td><td>On input: the buffer size. On output the length of the data copied.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>failure </td></tr>
    <tr><td class="paramname">false</td><td>success </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a889f78976b902de735bafa603456c41d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a889f78976b902de735bafa603456c41d">&#9670;&nbsp;</a></span>register_variable</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="service_8h.html#a9b62a937fdf9b9103052f5e660dcd258">mysql_service_status_t</a>(*  s_mysql_component_sys_variable_register::register_variable) (const char *component_name, const char *<a class="el" href="persisted__variable_8cc.html#a02b8247840db27f85191d734d51598fa">name</a>, int <a class="el" href="mi__test1_8cc.html#a6eec09a91807e20d7b3d6ef3da594067">flags</a>, const char *<a class="el" href="lexyy_8cc.html#a43be22b7a1b528eaf759e034ec581543">comment</a>, <a class="el" href="component__sys__var__service_8h.html#a6961277ab2ffcc5e747513052a14afd6">mysql_sys_var_check_func</a> check, <a class="el" href="component__sys__var__service_8h.html#aaa37ba63245757b3c7a0ea1fd0ad7daf">mysql_sys_var_update_func</a> <a class="el" href="myisamlog_8cc.html#a63c3b620cc1cd0b4a2850c8d9804fde2">update</a>, void *check_arg, void *variable_value)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register a new system variable. </p>
<p>The variable registered is then accessible in SQL as "SELECT
component_name.name" The variable registration needs a global of the relevant type that stores the value.</p>
<p>To define a new variable you need to:</p><ol type="1">
<li>Decide on a variable type among one of the <a class="el" href="group__group__components__services__sys__var__service__types.html">Variable types</a></li>
<li>Decide on attributes of the type among one of the <a class="el" href="group__group__components__services__sys__var__service__flags.html">Variable flags</a></li>
<li>Declare a local variable placeholder matching the type using one of the <a class="el" href="group__group__components__services__sys__var__service__args.html">Variable</a> macros.</li>
<li>Fill in the placeholder values (min, max, default etc) as appropriate for the selected type.</li>
<li>Provide storage for the variable value: usually a global variable of the relevant type.</li>
<li>Call the function with all of the above to register the system variable.</li>
</ol>
<dl class="section warning"><dt>Warning</dt><dd>: Make sure to unregister the system variable when you no longer intend to have it or when your component deinitializes. Failure to do so will lead to resource leaks and crashes.</dd></dl>
<p>Typical use </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="test__status__var__service_8cc.html#a98eabf613d081b056c03c70df3cdffa2">int_variable_value</a>;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="test__sys__var__service_8cc.html#ab9a7e62931fc9a90229b363611bc3380">str_variable_value</a>;</div><div class="line"><span class="keyword">static</span> <a class="code" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> <a class="code" href="test__sys__var__service_8cc.html#a7df090767d81e119449f061b5cb84246">enum_variable_value</a>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *enums[] = {<span class="stringliteral">&quot;LOW&quot;</span>, <span class="stringliteral">&quot;MEDIUM&quot;</span>, <span class="stringliteral">&quot;STRONG&quot;</span>, <a class="code" href="m__string_8h.html#a01a1e214486d9454ca611f01cb1cfc39">NullS</a>};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="structTYPE__LIB.html">TYPE_LIB</a> enums_typelib_t = {<a class="code" href="validate__password__imp_8cc.html#a16b6cf0b1e75b701a4a8d303cc4a5abd">array_elements</a>(enums) - 1,</div><div class="line">  <span class="stringliteral">&quot;enums_typelib_t&quot;</span>,</div><div class="line">  enums, <a class="code" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">INTEGRAL_CHECK_ARG(<span class="keywordtype">int</span>) <a class="code" href="task_8h.html#a70e133f12f150741d0280568d536b8a4">int_arg</a>;</div><div class="line"><a class="code" href="task_8h.html#a70e133f12f150741d0280568d536b8a4">int_arg</a>.def_val = 8;</div><div class="line"><a class="code" href="task_8h.html#a70e133f12f150741d0280568d536b8a4">int_arg</a>.min_val = 0;</div><div class="line"><a class="code" href="task_8h.html#a70e133f12f150741d0280568d536b8a4">int_arg</a>.max_val = 1024;</div><div class="line"><a class="code" href="task_8h.html#a70e133f12f150741d0280568d536b8a4">int_arg</a>.blk_sz = 0;</div><div class="line"><span class="keywordflow">if</span> (mysql_service_component_sys_variable_register-&gt;register_variable(</div><div class="line">  <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;int_sys_var&quot;</span>, <a class="code" href="group__group__components__services__sys__var__service__types.html#ga18097be00b3db8be3d923ef64fde5627">PLUGIN_VAR_INT</a>,</div><div class="line">  <span class="stringliteral">&quot;Registering int sys_variable&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="task_8h.html#a70e133f12f150741d0280568d536b8a4">int_arg</a>,</div><div class="line">  (<span class="keywordtype">void</span> *)&amp;int_variable_value)) {</div><div class="line">  deal_with_error();</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__group__components__services__sys__var__service__args.html#gace6cc318804fda33d7f04a494e0f98d9">STR_CHECK_ARG</a>(str) str_arg;</div><div class="line">str_arg.def_val = <a class="code" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><span class="keywordflow">if</span> (mysql_service_component_sys_variable_register-&gt;register_variable(</div><div class="line">  <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;str_sys_var&quot;</span>, <a class="code" href="group__group__components__services__sys__var__service__types.html#ga2a5579db5470ecccdda87401e5193190">PLUGIN_VAR_STR</a> | <a class="code" href="group__group__components__services__sys__var__service__flags.html#ga671d6f0e0f7dc81ba387b926f907d3e5">PLUGIN_VAR_MEMALLOC</a>,</div><div class="line">  <span class="stringliteral">&quot;Registering string sys_variable&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span> *)&amp;str_arg,</div><div class="line">(<span class="keywordtype">void</span> *)&amp;str_variable_value)) {</div><div class="line">  deal_with_error();</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__group__components__services__sys__var__service__args.html#ga239bfd368ffaf038c73f34cf7e6d753c">ENUM_CHECK_ARG</a>(<span class="keyword">enum</span>) enum_arg;</div><div class="line">enum_arg.def_val = 1; <span class="comment">//  medium</span></div><div class="line">enum_arg.typelib = &amp;enum_typelib_t;</div><div class="line"><a class="code" href="lexyy_8cc.html#ad4a65b873df5c05570846b5413b41dfd">if</a> (mysql_service_component_sys_variable_register-&gt;<a class="code" href="structs__mysql__component__sys__variable__register.html#a889f78976b902de735bafa603456c41d">register_variable</a>(</div><div class="line">&quot;foo&quot;, &quot;enum_sys_var&quot;, <a class="code" href="group__group__components__services__sys__var__service__types.html#ga3cc60781c0444a8fb32a34bcbc2b0354">PLUGIN_VAR_ENUM</a>,</div><div class="line">&quot;Registering enum sys_variable&quot;, NULL, NULL, (<span class="keywordtype">void</span> *)&amp;enum_arg,</div><div class="line">(<span class="keywordtype">void</span> *)&amp;enum_variable_value)) {</div><div class="line">  deal_with_error();</div><div class="line">}</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd>mysql_service_component_sys_variable_unregister_t</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">component_name</td><td>The name of the component the system variable belongs to. </td></tr>
    <tr><td class="paramname">name</td><td>The name of the variable. </td></tr>
    <tr><td class="paramname">flags</td><td>one of <a class="el" href="group__group__components__services__sys__var__service__types.html">Variable types</a> plus zero or more of group_components_services_sys_var_service_flags </td></tr>
    <tr><td class="paramname">comment</td><td>explanation of what the variable is to be shown in metadata tables </td></tr>
    <tr><td class="paramname">check</td><td>A function to be called to check for validity of the new value. </td></tr>
    <tr><td class="paramname">update</td><td>A function to be called when the variable value is updated </td></tr>
    <tr><td class="paramname">check_arg</td><td>The variable declared through one of <a class="el" href="group__group__components__services__sys__var__service__args.html">Variable</a> </td></tr>
    <tr><td class="paramname">variable_value</td><td>A pointer to a storage location of the relevant type. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>operation failed </td></tr>
    <tr><td class="paramname">false</td><td>operation succeeded </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>include/mysql/components/services/<a class="el" href="component__sys__var__service_8h_source.html">component_sys_var_service.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="structs__mysql__component__sys__variable__register.html">s_mysql_component_sys_variable_register</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
