<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: What defines a &quot;good&quot; plugin service ?</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_ext_plugin_api_goodservices.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">What defines a "good" plugin service ? </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The following is an attempt to explain what is a good plugin service.</p>
<p>It is also an attempt to mention some bad practices that should be avoided. The text is in no way conclusive and is a constant work in progress to keep it updated.</p>
<h2>Avoid exposing the definitions of complex server structure </h2>
<p><a class="el" href="page_ext_plugin_svc_new_service_howto.html">How to add a new service</a> states that the service header should be self-contained, i.e. all data structures used by the API need to be defined by the service header.</p>
<p>The service headers are considered "public" and are packaged into the binary packages for users of these binary packages to use when developing plugins that are using the service.</p>
<p>When you combine the two together it becomes evident that complex server data structures should definitely be avoided as parts of the API.</p>
<p>The main inconvenience is that a complex structure's definition should be copied into the service's header. And if that is a frequently changed structure all plugins using it will need to be recompiled every time it changes.</p>
<p>That is the reason why it is always better to pass individual members of these structures that are simpler. Even if this means passing more than just a single argument.</p>
<p>If you absolutely must pass references to complex structure instances it is better to do it as a "handle", i.e. a <code>void *</code>. For convenience, you can have a named class for that, e.g. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">void</span> *my_new_handle_t;</div></div><!-- fragment --><p>This isolates the layout of the server structure from the plugin code while still allowing the plugins to operate on it via accessor and mutator methods.</p>
<h2>Strive to make reusable services </h2>
<p>Services have some extra processing associated with them. So they should be used only for functionality that more than one plugin will probably use.</p>
<p>How do we know if a service is reusable ?</p>
<p>If a service deals with complex structures related to a specific plugin API or does not provide a logically complete set of operations chances are that there will not be much re-use of this service.</p>
<h2>Keep the identifier namespace clean </h2>
<p>As discussed in <a class="el" href="page_ext_plugin_svc_anathomy.html">Plugin Service Anathomy</a> each function of each service API is added to the global C/C++ namespace for all plugins via a set of preprocessor defines.</p>
<p>So if you name your plugin service functions after single common words, e.g. <code>get</code> or <code>put</code> etc you will strongly pollute the namespace that the plugin authors will use. They will either have to refrain from using such methods or go to the extra trouble of using either preprocessor or C++ namespace tricks.</p>
<p>Thus, prefix your APIs. We typically use the <code>my_</code> prefix for all MySQL exported functions (note that the <code>mysql_</code> prefix is reserved for the C API functions, e.g. mysql_real_connect()). We also add a subsystem prefix, e.g. my_plugin_log_message() is the service API name for plugins to log messages to the server's error log.</p>
<h2>Use services for "published" APIs only </h2>
<p>Plugin services are an element of the binary APIs that must be kept stable to keep existing plugins operating. Plugin service APIs are thus versioned to allow the server to check if the plugins are using the right version of the particular service API. The server's build scripts also package the service API headers in a designated directory and are documented in a specific service API document.</p>
<p>This stability comes at a price. All of the above should be observed and the versions should be increased accoringly.</p>
<p>Major should be bumped (and the minor reset) when there are incompatible changes: signature change, meaning change etc.</p>
<p>Minor should be bumped when there are backward compatible changes: adding new functions at the end of the API, adding new named constants to be used by the API etc.</p>
<h2>Use services to make plugins "clean" </h2>
<p>A clean plugin is one that does not need to reference the symbols of the server binary that loads it. Such plugin can be loaded by any binary and it is guaranteed to operate in a predictable way as long as the right plugin APIs are called and the relevant plugin service APIs are defined by the loading binary.</p>
<h2>Always make fully-formed plugin service APIs </h2>
<p>Follow strictly and completely the steps defined in <a class="el" href="page_ext_plugin_svc_new_service_howto.html">How to add a new service</a>.</p>
<p>Don't skip steps or you'll be decresing the usability of the service API. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_EXTENDING.html">Extending MySQL</a></li><li class="navelem"><a class="el" href="page_ext_plugin_services.html">Plugin Services</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
