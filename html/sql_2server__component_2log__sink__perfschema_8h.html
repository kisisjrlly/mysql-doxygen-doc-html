<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: sql/server_component/log_sink_perfschema.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sql_2server__component_2log__sink__perfschema_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">log_sink_perfschema.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file contains.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="log__builtins__internal_8h_source.html">log_builtins_internal.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__thread__local_8h_source.html">my_thread_local.h</a>&quot;</code><br />
</div>
<p><a href="sql_2server__component_2log__sink__perfschema_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__log__sink__pfs__event.html">_log_sink_pfs_event</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af4f5e4404f3170755abc77b71180f17d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#af4f5e4404f3170755abc77b71180f17d">LOG_SINK_PFS_ERROR_CODE_LENGTH</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:af4f5e4404f3170755abc77b71180f17d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a940e66b6cfe5e4a50e26c87469d41523"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a940e66b6cfe5e4a50e26c87469d41523">LOG_SINK_PFS_SUBSYS_LENGTH</a>&#160;&#160;&#160;7</td></tr>
<tr class="separator:a940e66b6cfe5e4a50e26c87469d41523"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ab8b7fe57d7cf2ee022cd07f6af5133d1"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__log__sink__pfs__event.html">_log_sink_pfs_event</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a></td></tr>
<tr class="separator:ab8b7fe57d7cf2ee022cd07f6af5133d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abf1f68911a2428aac55296c72e89e1c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#abf1f68911a2428aac55296c72e89e1c2">log_sink_pfs_read_start</a> ()</td></tr>
<tr class="memdesc:abf1f68911a2428aac55296c72e89e1c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire a read-lock on the ring-buffer.  <a href="#abf1f68911a2428aac55296c72e89e1c2">More...</a><br /></td></tr>
<tr class="separator:abf1f68911a2428aac55296c72e89e1c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eab702b4404ad96b099d05ce679c741"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a7eab702b4404ad96b099d05ce679c741">log_sink_pfs_read_end</a> ()</td></tr>
<tr class="memdesc:a7eab702b4404ad96b099d05ce679c741"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release read-lock on ring-buffer.  <a href="#a7eab702b4404ad96b099d05ce679c741">More...</a><br /></td></tr>
<tr class="separator:a7eab702b4404ad96b099d05ce679c741"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfaf0693b985ff1a1807ae00b5a72240"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#abfaf0693b985ff1a1807ae00b5a72240">log_sink_pfs_event_count</a> ()</td></tr>
<tr class="memdesc:abfaf0693b985ff1a1807ae00b5a72240"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get number of events currently in ring-buffer.  <a href="#abfaf0693b985ff1a1807ae00b5a72240">More...</a><br /></td></tr>
<tr class="separator:abfaf0693b985ff1a1807ae00b5a72240"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab53eb09536a80350811f6f5230ecd5d7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab53eb09536a80350811f6f5230ecd5d7">log_sink_pfs_event_first</a> ()</td></tr>
<tr class="memdesc:ab53eb09536a80350811f6f5230ecd5d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get oldest event still in ring-buffer.  <a href="#ab53eb09536a80350811f6f5230ecd5d7">More...</a><br /></td></tr>
<tr class="separator:ab53eb09536a80350811f6f5230ecd5d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fe7b57f498c03a8ddd81e3443e23449"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a9fe7b57f498c03a8ddd81e3443e23449">log_sink_pfs_event_next</a> (<a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *e)</td></tr>
<tr class="memdesc:a9fe7b57f498c03a8ddd81e3443e23449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get event following the supplied one.  <a href="#a9fe7b57f498c03a8ddd81e3443e23449">More...</a><br /></td></tr>
<tr class="separator:a9fe7b57f498c03a8ddd81e3443e23449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9c7dacfa8528b5ca33bee4092dce911"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#af9c7dacfa8528b5ca33bee4092dce911">log_sink_pfs_event_valid</a> (<a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *e, <a class="el" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a> logged)</td></tr>
<tr class="memdesc:af9c7dacfa8528b5ca33bee4092dce911"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use timestamp to check whether a given event-pointer still points to a valid event in the ring-buffer.  <a href="#af9c7dacfa8528b5ca33bee4092dce911">More...</a><br /></td></tr>
<tr class="separator:af9c7dacfa8528b5ca33bee4092dce911"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48e79e355c0f683d799a12840ae7c743"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a48e79e355c0f683d799a12840ae7c743">log_error_read_log_init</a> ()</td></tr>
<tr class="memdesc:a48e79e355c0f683d799a12840ae7c743"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up ring-buffer for error-log.  <a href="#a48e79e355c0f683d799a12840ae7c743">More...</a><br /></td></tr>
<tr class="separator:a48e79e355c0f683d799a12840ae7c743"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab20616346d20473a4884c35288a71de9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab20616346d20473a4884c35288a71de9">log_error_read_log_exit</a> ()</td></tr>
<tr class="memdesc:ab20616346d20473a4884c35288a71de9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release error log ring-buffer.  <a href="#ab20616346d20473a4884c35288a71de9">More...</a><br /></td></tr>
<tr class="separator:ab20616346d20473a4884c35288a71de9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a4fd23c87434111828aa9752a5bfbfa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="log__service_8h.html#ae4871f54cbb0619a0c304c2818298685">log_service_error</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a2a4fd23c87434111828aa9752a5bfbfa">log_error_read_log</a> (const char *log_name)</td></tr>
<tr class="memdesc:a2a4fd23c87434111828aa9752a5bfbfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Restore error log messages from previous shutdown.  <a href="#a2a4fd23c87434111828aa9752a5bfbfa">More...</a><br /></td></tr>
<tr class="separator:a2a4fd23c87434111828aa9752a5bfbfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08cbbbd8a5605884faf120ffca5ac904"><td class="memItemLeft" align="right" valign="top"><a class="el" href="log__service_8h.html#ae4871f54cbb0619a0c304c2818298685">log_service_error</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a08cbbbd8a5605884faf120ffca5ac904">log_sink_pfs_event_add</a> (<a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *e, const char *blob_src)</td></tr>
<tr class="memdesc:a08cbbbd8a5605884faf120ffca5ac904"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a log-event to the ring buffer.  <a href="#a08cbbbd8a5605884faf120ffca5ac904">More...</a><br /></td></tr>
<tr class="separator:a08cbbbd8a5605884faf120ffca5ac904"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1f049b09d81331ce4a9dcee18f58269"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#af1f049b09d81331ce4a9dcee18f58269">log_sink_perfschema</a> (void *instance, <a class="el" href="log__shared_8h.html#abef61f7610a42c29cd8b3a92f391143f">log_line</a> *ll)</td></tr>
<tr class="memdesc:af1f049b09d81331ce4a9dcee18f58269"><td class="mdescLeft">&#160;</td><td class="mdescRight">services: log sinks: logging to performance_schema ring-buffer  <a href="#af1f049b09d81331ce4a9dcee18f58269">More...</a><br /></td></tr>
<tr class="separator:af1f049b09d81331ce4a9dcee18f58269"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3780f414eb0dbc015e50faebdc66fb5f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a3780f414eb0dbc015e50faebdc66fb5f">log_sink_pfs_buffered_bytes</a></td></tr>
<tr class="separator:a3780f414eb0dbc015e50faebdc66fb5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae71af9b2c798b467abe2378c76eee39d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ae71af9b2c798b467abe2378c76eee39d">log_sink_pfs_buffered_events</a></td></tr>
<tr class="separator:ae71af9b2c798b467abe2378c76eee39d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a771f46c65d936046af9e1c38b06b1ab6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a771f46c65d936046af9e1c38b06b1ab6">log_sink_pfs_expired_events</a></td></tr>
<tr class="separator:a771f46c65d936046af9e1c38b06b1ab6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4db6fba25f8830deebe4f4d898d3f71"><td class="memItemLeft" align="right" valign="top"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ac4db6fba25f8830deebe4f4d898d3f71">log_sink_pfs_longest_event</a></td></tr>
<tr class="separator:ac4db6fba25f8830deebe4f4d898d3f71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16c69b1e4a0c54098b41f916f474c33a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#a16c69b1e4a0c54098b41f916f474c33a">log_sink_pfs_latest_timestamp</a></td></tr>
<tr class="separator:a16c69b1e4a0c54098b41f916f474c33a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains. </p>
<p>a) The API for the reading of previously written error logs. (These functions will in turn use a parse-function defined in a log-sink. Whichever log-sink that has a parse-function is listed first in @global.log_error_services will be used; that service will decide what log-file to read (i.e. its name) and how to parse it. We initially support the reading of JSON- formatted error log files and of the traditional MySQL error log files.) This lets us restore error log information from previous runs when the server starts. These functions are called from mysqld.cc at start-up.</p>
<p>b) The log-sink that adds errors logged at run-time to the ring-buffer (to be called from </p><dl class="section see"><dt>See also</dt><dd>log_line_submit() during normal operation, i.e. when loadable log-components are available, connections are accepted, and so on). </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="af4f5e4404f3170755abc77b71180f17d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4f5e4404f3170755abc77b71180f17d">&#9670;&nbsp;</a></span>LOG_SINK_PFS_ERROR_CODE_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_SINK_PFS_ERROR_CODE_LENGTH&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a940e66b6cfe5e4a50e26c87469d41523"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a940e66b6cfe5e4a50e26c87469d41523">&#9670;&nbsp;</a></span>LOG_SINK_PFS_SUBSYS_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_SINK_PFS_SUBSYS_LENGTH&#160;&#160;&#160;7</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ab8b7fe57d7cf2ee022cd07f6af5133d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8b7fe57d7cf2ee022cd07f6af5133d1">&#9670;&nbsp;</a></span>log_sink_pfs_event</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__log__sink__pfs__event.html">_log_sink_pfs_event</a>  <a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2a4fd23c87434111828aa9752a5bfbfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a4fd23c87434111828aa9752a5bfbfa">&#9670;&nbsp;</a></span>log_error_read_log()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="log__service_8h.html#ae4871f54cbb0619a0c304c2818298685">log_service_error</a> log_error_read_log </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>log_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Restore error log messages from previous shutdown. </p>
<p>We try restoring from the first (leftmost) of those services listed in @global.log_error_services that have the LOG_SERVICE_LOG_PARSER characteristic.</p>
<p>It is assumed that the last run's log file name is the same as the current one's. That is to say, we check whether the file supplied to &ndash;log-error already exists.</p>
<p>Once we have determined what file to read from, we'll call </p><dl class="section see"><dt>See also</dt><dd>log_error_read_loop() to do the actual reading and parsing.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">log_name</td><td>The log file to read (log_error_dest).</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">LOG_SERVICE_SUCCESS</td><td>Success (log read and parsed) </td></tr>
    <tr><td class="paramname">LOG_SERVICE_UNABLE_TO_READ</td><td>Could not read/access() file </td></tr>
    <tr><td class="paramname">LOG_SERVICE_INVALID_ARGUMENT</td><td>Invalid file-name (no '.') </td></tr>
    <tr><td class="paramname">LOG_SERVICE_NOT_AVAILABLE</td><td>No log_component active that can parse log-files </td></tr>
    <tr><td class="paramname">LOG_SERVICE_ARGUMENT_TOO_LONG</td><td>File-name too long </td></tr>
    <tr><td class="paramname">LOG_SERVICE_COULD_NOT_MAKE_LOG_NAME</td><td>Could not determine file extension </td></tr>
    <tr><td class="paramname">otherwise</td><td>Return value from reader</td></tr>
  </table>
  </dd>
</dl>
<p>We try restoring from the first (leftmost) of those services listed in @global.log_error_services that have the LOG_SERVICE_LOG_PARSER characteristic.</p>
<p>It is assumed that the last run's log file name is the same as the current one's. That is to say, we check whether the file supplied to &ndash;log-error already exists.</p>
<p>Once we have determined what file to read from, we'll call </p><dl class="section see"><dt>See also</dt><dd>log_error_read_loop() to do the actual reading and parsing.</dd></dl>
<p>It should be noted that at the point this function is normally called, buffered error logging will not have flushed yet.</p>
<p>a) If we are using the built-in "trad" sink/reader, the start-up messages are usually not buffered, and have already been written to the error log. In this case, they will be restored from the log (and flushing won't add another event to the ring-buffer).</p>
<p>b) If we are using a reader in a loadable log-service,</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">log_name</td><td>The log file to read (log_error_dest).</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">LOG_SERVICE_SUCCESS</td><td>Success (log read and parsed) </td></tr>
    <tr><td class="paramname">LOG_SERVICE_UNABLE_TO_READ</td><td>Could not read/access() file </td></tr>
    <tr><td class="paramname">LOG_SERVICE_INVALID_ARGUMENT</td><td>Invalid file-name (no '.') </td></tr>
    <tr><td class="paramname">LOG_SERVICE_NOT_AVAILABLE</td><td>No log_component active that can parse log-files </td></tr>
    <tr><td class="paramname">LOG_SERVICE_ARGUMENT_TOO_LONG</td><td>File-name too long </td></tr>
    <tr><td class="paramname">LOG_SERVICE_COULD_NOT_MAKE_LOG_NAME</td><td>Could not determine file extension </td></tr>
    <tr><td class="paramname">otherwise</td><td>Return value from reader </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab20616346d20473a4884c35288a71de9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab20616346d20473a4884c35288a71de9">&#9670;&nbsp;</a></span>log_error_read_log_exit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int log_error_read_log_exit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release error log ring-buffer. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success - buffer was released, or did not exist in the first place. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a48e79e355c0f683d799a12840ae7c743"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48e79e355c0f683d799a12840ae7c743">&#9670;&nbsp;</a></span>log_error_read_log_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int log_error_read_log_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up ring-buffer for error-log. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success - buffer was allocated. </td></tr>
    <tr><td class="paramname">!=0</td><td>Failure - buffer was not allocated. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af1f049b09d81331ce4a9dcee18f58269"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1f049b09d81331ce4a9dcee18f58269">&#9670;&nbsp;</a></span>log_sink_perfschema()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int log_sink_perfschema </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="log__shared_8h.html#abef61f7610a42c29cd8b3a92f391143f">log_line</a> *&#160;</td>
          <td class="paramname"><em>ll</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>services: log sinks: logging to performance_schema ring-buffer </p>
<p>Will write timestamp, label, thread-ID, and message to stderr/file. If you should not be able to specify a label, one will be generated for you from the line's priority field.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>instance handle </td></tr>
    <tr><td class="paramname">ll</td><td>the log line to write</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>number of added fields, if any </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a08cbbbd8a5605884faf120ffca5ac904"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08cbbbd8a5605884faf120ffca5ac904">&#9670;&nbsp;</a></span>log_sink_pfs_event_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="log__service_8h.html#ae4871f54cbb0619a0c304c2818298685">log_service_error</a> log_sink_pfs_event_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>blob_src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a log-event to the ring buffer. </p>
<p>In the ring-buffer, each event exists as a header and a blob. The header is a log_sink_pfs_event struct containing the traditional error-log columns. It is followed by a variable-length blob that contains just the message string in traditional log mode, and the complete event as JSON in JSON log format. If the variable-length is odd, we adjust to the next even boundary.</p>
<p>If writing the event would go past the end of the ring-buffer, we wrap around to the beginning of the buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>filled-in event struct to copy into the ring-buffer </td></tr>
    <tr><td class="paramname">blob_src</td><td>variable-length part of the event to add to the ring-buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">LOG_SERVICE_SUCCESS</td><td></td></tr>
    <tr><td class="paramname">LOG_SERVICE_INVALID_ARGUMENT</td><td>In the ring-buffer, each event exists as a header and a blob. The header is a log_sink_pfs_event struct containing the traditional error-log columns. It is followed by a variable-length blob that contains just the message string in traditional log mode, and the complete event as JSON in JSON log format. The length of the event will be align to the correct boundary.</td></tr>
  </table>
  </dd>
</dl>
<p>If writing the event would go past the end of the ring-buffer, we wrap around to the beginning of the buffer.</p>
<p>After the function success, <code>ring_buffer_read</code> will be set to a valid, non-zero value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>filled-in event struct to copy into the ring-buffer </td></tr>
    <tr><td class="paramname">blob_src</td><td>variable-length part of the event to add to the ring-buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">LOG_SERVICE_SUCCESS</td><td>event was added </td></tr>
    <tr><td class="paramname">LOG_SERVICE_NOT_AVAILABLE</td><td>ring-buffer not available </td></tr>
    <tr><td class="paramname">LOG_SERVICE_INVALID_ARGUMENT</td><td>event has no message </td></tr>
    <tr><td class="paramname">LOG_SERVICE_ARGUMENT_TOO_LONG</td><td>event is larger than buffer(!) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abfaf0693b985ff1a1807ae00b5a72240"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfaf0693b985ff1a1807ae00b5a72240">&#9670;&nbsp;</a></span>log_sink_pfs_event_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t log_sink_pfs_event_count </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get number of events currently in ring-buffer. </p>
<p>Caller should hold THR_LOCK_log_perschema when reading this.</p>
<dl class="section return"><dt>Returns</dt><dd>number of events current in ring-buffer (0..) </dd></dl>

</div>
</div>
<a id="ab53eb09536a80350811f6f5230ecd5d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab53eb09536a80350811f6f5230ecd5d7">&#9670;&nbsp;</a></span>log_sink_pfs_event_first()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a>* log_sink_pfs_event_first </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get oldest event still in ring-buffer. </p>
<p>Caller should hold read-lock on THR_LOCK_log_perfschema when calling this.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nullptr</td><td>No events in buffer </td></tr>
    <tr><td class="paramname">otherwise</td><td>Address of oldest event in ring-buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9fe7b57f498c03a8ddd81e3443e23449"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fe7b57f498c03a8ddd81e3443e23449">&#9670;&nbsp;</a></span>log_sink_pfs_event_next()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a>* log_sink_pfs_event_next </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get event following the supplied one. </p>
<p>Caller should hold read-lock on THR_LOCK_log_perfschema when calling this.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>Last event the caller was processing. This event should be valid, non-NULL, and should not be a wrap-around marker (m_messages_length == 0).</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nullptr</td><td>No more events in ring-buffer </td></tr>
    <tr><td class="paramname">otherwise</td><td>Address of the next event in the ring-buffer</td></tr>
  </table>
  </dd>
</dl>
<p>Caller should hold read-lock on THR_LOCK_log_perfschema when calling this.</p>
<p>If advancing the read position puts the read-pointer beyond the highest-address event in the ring-buffer (which isn't necessarily the latest event, which is defined as the last event before catching up with the write-pointer), i.e. at a position where either a wrap- around marker exists, or there is not enough space for a header, we wrap around to the start of the ring-buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>Last event the caller was processing. This event should be valid, non-NULL, and should not be a wrap-around marker (m_messages_length == 0).</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nullptr</td><td>No more events in ring-buffer (caught up with writer) </td></tr>
    <tr><td class="paramname">otherwise</td><td>Address of the next event in the ring-buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af9c7dacfa8528b5ca33bee4092dce911"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9c7dacfa8528b5ca33bee4092dce911">&#9670;&nbsp;</a></span>log_sink_pfs_event_valid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a>* log_sink_pfs_event_valid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a>&#160;</td>
          <td class="paramname"><em>logged</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use timestamp to check whether a given event-pointer still points to a valid event in the ring-buffer. </p>
<p>Caller should hold THR_LOCK_log_perfschema when calling this.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>Address of event </td></tr>
    <tr><td class="paramname">logged</td><td>unique timestamp of event</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nullptr</td><td>Event no longer exists in ring-buffer </td></tr>
    <tr><td class="paramname">otherwise</td><td>Address of the event in the ring-buffer</td></tr>
  </table>
  </dd>
</dl>
<p>Caller should hold read-lock on THR_LOCK_log_perfschema when calling this.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>Address of event </td></tr>
    <tr><td class="paramname">logged</td><td>unique timestamp of event</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nullptr</td><td>Event no longer exists in ring-buffer </td></tr>
    <tr><td class="paramname">otherwise</td><td>Address of the event in the ring-buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7eab702b4404ad96b099d05ce679c741"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7eab702b4404ad96b099d05ce679c741">&#9670;&nbsp;</a></span>log_sink_pfs_read_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void log_sink_pfs_read_end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release read-lock on ring-buffer. </p>

</div>
</div>
<a id="abf1f68911a2428aac55296c72e89e1c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf1f68911a2428aac55296c72e89e1c2">&#9670;&nbsp;</a></span>log_sink_pfs_read_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void log_sink_pfs_read_start </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Acquire a read-lock on the ring-buffer. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a3780f414eb0dbc015e50faebdc66fb5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3780f414eb0dbc015e50faebdc66fb5f">&#9670;&nbsp;</a></span>log_sink_pfs_buffered_bytes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> log_sink_pfs_buffered_bytes</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae71af9b2c798b467abe2378c76eee39d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae71af9b2c798b467abe2378c76eee39d">&#9670;&nbsp;</a></span>log_sink_pfs_buffered_events</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> log_sink_pfs_buffered_events</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a771f46c65d936046af9e1c38b06b1ab6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a771f46c65d936046af9e1c38b06b1ab6">&#9670;&nbsp;</a></span>log_sink_pfs_expired_events</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> log_sink_pfs_expired_events</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a16c69b1e4a0c54098b41f916f474c33a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16c69b1e4a0c54098b41f916f474c33a">&#9670;&nbsp;</a></span>log_sink_pfs_latest_timestamp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a> log_sink_pfs_latest_timestamp</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac4db6fba25f8830deebe4f4d898d3f71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4db6fba25f8830deebe4f4d898d3f71">&#9670;&nbsp;</a></span>log_sink_pfs_longest_event</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> log_sink_pfs_longest_event</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5bd71961b401a432086d0fb290a87f3f.html">sql</a></li><li class="navelem"><a class="el" href="dir_12a5ab756a4de267189eabf05ec2ce08.html">server_component</a></li><li class="navelem"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html">log_sink_perfschema.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
