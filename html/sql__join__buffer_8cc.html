<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: sql/sql_join_buffer.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sql__join__buffer_8cc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sql_join_buffer.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>join cache optimizations  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="sql__join__buffer_8h_source.html">sql/sql_join_buffer.h</a>&quot;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;unordered_map&gt;</code><br />
<code>#include &quot;<a class="el" href="my__alloc_8h_source.html">my_alloc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__bitmap_8h_source.html">my_bitmap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__dbug_8h_source.html">my_dbug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sql_2field_8h_source.html">sql/field.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sql__bitmap_8h_source.html">sql/sql_bitmap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sql__const_8h_source.html">sql/sql_const.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sql__executor_8h_source.html">sql/sql_executor.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sql_2table_8h_source.html">sql/table.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a76c1193d65b0dfc62b17c2abb65b0a39"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__join__buffer_8cc.html#a76c1193d65b0dfc62b17c2abb65b0a39">filter_gcol_for_dynamic_range_scan</a> (const <a class="el" href="classQEP__TAB.html">QEP_TAB</a> *tab)</td></tr>
<tr class="memdesc:a76c1193d65b0dfc62b17c2abb65b0a39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Filter base columns of virtual generated columns that might not be read by a dynamic range scan.  <a href="#a76c1193d65b0dfc62b17c2abb65b0a39">More...</a><br /></td></tr>
<tr class="separator:a76c1193d65b0dfc62b17c2abb65b0a39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8ec3e74c38a5b84bf9213986f66ef09"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__join__buffer_8cc.html#aa8ec3e74c38a5b84bf9213986f66ef09">filter_virtual_gcol_base_cols</a> (const <a class="el" href="classQEP__TAB.html">QEP_TAB</a> *qep_tab)</td></tr>
<tr class="memdesc:aa8ec3e74c38a5b84bf9213986f66ef09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Filter the base columns of virtual generated columns if using a covering index scan.  <a href="#aa8ec3e74c38a5b84bf9213986f66ef09">More...</a><br /></td></tr>
<tr class="separator:aa8ec3e74c38a5b84bf9213986f66ef09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade78ec405322067a30414512c647f0af"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sql__join__buffer_8cc.html#ade78ec405322067a30414512c647f0af">add_virtual_gcol_base_cols</a> (<a class="el" href="structTABLE.html">TABLE</a> *table, <a class="el" href="structMEM__ROOT.html">MEM_ROOT</a> *<a class="el" href="client__plugin_8cc.html#a7d0fe2f135db987da18cea87b4778737">mem_root</a>, <a class="el" href="structMY__BITMAP.html">MY_BITMAP</a> *completed_read_set)</td></tr>
<tr class="memdesc:ade78ec405322067a30414512c647f0af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a read set that undoes the work of filter_virtual_gcol_base_cols(); ie., for every virtual generated column that is part of the given table's read set, we also include the base tables.  <a href="#ade78ec405322067a30414512c647f0af">More...</a><br /></td></tr>
<tr class="separator:ade78ec405322067a30414512c647f0af"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>join cache optimizations </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ade78ec405322067a30414512c647f0af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade78ec405322067a30414512c647f0af">&#9670;&nbsp;</a></span>add_virtual_gcol_base_cols()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_virtual_gcol_base_cols </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTABLE.html">TABLE</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structMEM__ROOT.html">MEM_ROOT</a> *&#160;</td>
          <td class="paramname"><em>mem_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structMY__BITMAP.html">MY_BITMAP</a> *&#160;</td>
          <td class="paramname"><em>completed_read_set</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a read set that undoes the work of filter_virtual_gcol_base_cols(); ie., for every virtual generated column that is part of the given table's read set, we also include the base tables. </p>
<p>This is needed if we revert from a covering index back to a table scan (which doesn't store the virtual generated columns themselves, unlike the covering index). This happens in DynamicRangeIterator and AlternativeIterator.</p>
<p>The new read set gets a new buffer, allocated on the given MEM_ROOT. table-&gt;read_set is not changed. </p>

</div>
</div>
<a id="a76c1193d65b0dfc62b17c2abb65b0a39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76c1193d65b0dfc62b17c2abb65b0a39">&#9670;&nbsp;</a></span>filter_gcol_for_dynamic_range_scan()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void filter_gcol_for_dynamic_range_scan </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classQEP__TAB.html">QEP_TAB</a> *&#160;</td>
          <td class="paramname"><em>tab</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Filter base columns of virtual generated columns that might not be read by a dynamic range scan. </p>
<p>A dynamic range scan will read the data from a table using either a table scan, a range scan on a covering index, or a range scan on a non-covering index. The table's read set contains all columns that will be read by the table scan. This might be base columns that are used to evaluate virtual column values that are part of an index. When the table is read using a table scan, these base columns will be read from the storage engine, but when a index/range scan on a covering index is used, the base columns will not be read by the storage engine. To avoid that these potentially un-read columns are inserted into the join buffer, we need to adjust the read set to only contain columns that are read independently of which access method that is used: these are the only columns needed in the join buffer for the query.</p>
<p>This function does the following manipulations of table's read_set:</p>
<p>if one or more of the alternative range scan indexes are covering, then the table's read_set is intersected with the read_set for each of the covering indexes.</p>
<p>For potential range indexes that are not covering, no adjustment to the read_set is done.</p>
<dl class="section note"><dt>Note</dt><dd>The table-&gt;read_set will be changed by this function. It is the caller's responsibility to save a copy of this in table-&gt;tmp_set.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tab</td><td>the query execution tab </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa8ec3e74c38a5b84bf9213986f66ef09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8ec3e74c38a5b84bf9213986f66ef09">&#9670;&nbsp;</a></span>filter_virtual_gcol_base_cols()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void filter_virtual_gcol_base_cols </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classQEP__TAB.html">QEP_TAB</a> *&#160;</td>
          <td class="paramname"><em>qep_tab</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Filter the base columns of virtual generated columns if using a covering index scan. </p>
<p>Adjust table-&gt;read_set so that it only contains the columns that are needed in the join operation and afterwards.</p>
<p>For a virtual generated column, all base columns are added to the read_set of the table. The storage engine will then copy all base column values so that the value of the GC can be calculated inside the executor. But when a virtual GC is fetched using a covering index, the actual GC value is fetched by the storage engine and the base column values are not needed. Code that looks at the read sets (join buffering, hash join, filesort) must not try to copy them. So, we eliminate from read_set those columns that are available from the covering index.</p>
<p>Note that some iterators (DynamicRangeIterator and AlternativeIterator) may need to switch back to table scans. If so, they will adjust the table's read set before reading; see add_virtual_gcol_base_cols(). </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5bd71961b401a432086d0fb290a87f3f.html">sql</a></li><li class="navelem"><a class="el" href="sql__join__buffer_8cc.html">sql_join_buffer.cc</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
