<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: sql/server_component/log_sink_buffer.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('log__sink__buffer_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">log_sink_buffer.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file contains.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="log__builtins__internal_8h_source.html">log_builtins_internal.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__sys_8h_source.html">my_sys.h</a>&quot;</code><br />
</div>
<p><a href="log__sink__buffer_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a5a9c85d36e64f53662a7f430146b009f"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__buffer_8h.html#a5a9c85d36e64f53662a7f430146b009f">log_sink_buffer_flush_mode</a> { <a class="el" href="log__sink__buffer_8h.html#a5a9c85d36e64f53662a7f430146b009fa263654e95f9303b7bd4bc25013628c04">LOG_BUFFER_DISCARD_ONLY</a>, 
<a class="el" href="log__sink__buffer_8h.html#a5a9c85d36e64f53662a7f430146b009fa9cb9deeeac342b882a01301ed74a5939">LOG_BUFFER_PROCESS_AND_DISCARD</a>, 
<a class="el" href="log__sink__buffer_8h.html#a5a9c85d36e64f53662a7f430146b009fa7fcda8bc28760ab2a59ca7388f781f8d">LOG_BUFFER_REPORT_AND_KEEP</a>
 }</td></tr>
<tr class="separator:a5a9c85d36e64f53662a7f430146b009f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a7a6d95fb0fabf276fc81d77744f881"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881">log_error_stage</a> { <br />
&#160;&#160;<a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881a0f55c0b0bda900bcac0696ee051a882c">LOG_ERROR_STAGE_BUFFERING_EARLY</a>, 
<a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881a7040e5f88a3fdfe5c31a6f2f7c96af7a">LOG_ERROR_STAGE_BUFFERING_UNIPLEX</a>, 
<a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881a7b26b9d6e2d90407d9eef3520dc5faa2">LOG_ERROR_STAGE_BUFFERING_MULTIPLEX</a>, 
<a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881a9d27f1e1390f531cf36ad00dd08eecdd">LOG_ERROR_STAGE_EXTERNAL_SERVICES_AVAILABLE</a>, 
<br />
&#160;&#160;<a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881ae2ec1d4bb5759f3bc53ddea48f4a9332">LOG_ERROR_STAGE_SHUTTING_DOWN</a>
<br />
 }</td></tr>
<tr class="separator:a3a7a6d95fb0fabf276fc81d77744f881"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac6b0be9d5fdc357180ec1b5a08f1677f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__buffer_8h.html#ac6b0be9d5fdc357180ec1b5a08f1677f">log_error_stage_set</a> (enum <a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881">log_error_stage</a> les)</td></tr>
<tr class="memdesc:ac6b0be9d5fdc357180ec1b5a08f1677f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set error-logging stage hint (e.g. are loadable services available yet?).  <a href="#ac6b0be9d5fdc357180ec1b5a08f1677f">More...</a><br /></td></tr>
<tr class="separator:ac6b0be9d5fdc357180ec1b5a08f1677f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2beb18042a9265469104013a8dcf20c4"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881">log_error_stage</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__buffer_8h.html#a2beb18042a9265469104013a8dcf20c4">log_error_stage_get</a> (void)</td></tr>
<tr class="memdesc:a2beb18042a9265469104013a8dcf20c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">What mode is error-logging in (e.g. are loadable services available yet)?  <a href="#a2beb18042a9265469104013a8dcf20c4">More...</a><br /></td></tr>
<tr class="separator:a2beb18042a9265469104013a8dcf20c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a216407f8dcaa5ae843066fd8259ce70a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__buffer_8h.html#a216407f8dcaa5ae843066fd8259ce70a">log_sink_buffer</a> (void *instance, <a class="el" href="log__shared_8h.html#abef61f7610a42c29cd8b3a92f391143f">log_line</a> *ll)</td></tr>
<tr class="memdesc:a216407f8dcaa5ae843066fd8259ce70a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a log-event to the buffer sink.  <a href="#a216407f8dcaa5ae843066fd8259ce70a">More...</a><br /></td></tr>
<tr class="separator:a216407f8dcaa5ae843066fd8259ce70a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5743494132998ba89241f24691a6aa21"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__buffer_8h.html#a5743494132998ba89241f24691a6aa21">log_sink_buffer_flush</a> (enum <a class="el" href="log__sink__buffer_8h.html#a5a9c85d36e64f53662a7f430146b009f">log_sink_buffer_flush_mode</a> mode)</td></tr>
<tr class="memdesc:a5743494132998ba89241f24691a6aa21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release all buffered log-events (discard_error_log_messages()), optionally after running them through the error log stack first (flush_error_log_messages()).  <a href="#a5743494132998ba89241f24691a6aa21">More...</a><br /></td></tr>
<tr class="separator:a5743494132998ba89241f24691a6aa21"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a384c1fb529a0d4cbc788bc35a1b94fcc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmysql__mutex__t.html">mysql_mutex_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__buffer_8h.html#a384c1fb529a0d4cbc788bc35a1b94fcc">THR_LOCK_log_buffered</a></td></tr>
<tr class="memdesc:a384c1fb529a0d4cbc788bc35a1b94fcc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make sure only one instance of the buffered "writer" runs at a time.  <a href="#a384c1fb529a0d4cbc788bc35a1b94fcc">More...</a><br /></td></tr>
<tr class="separator:a384c1fb529a0d4cbc788bc35a1b94fcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadd25abc8da9150fe606bfe90e74585e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__buffer_8h.html#aadd25abc8da9150fe606bfe90e74585e">log_buffering_flushworthy</a></td></tr>
<tr class="memdesc:aadd25abc8da9150fe606bfe90e74585e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does buffer contain SYSTEM or ERROR prio messages? Flush early only then!  <a href="#aadd25abc8da9150fe606bfe90e74585e">More...</a><br /></td></tr>
<tr class="separator:aadd25abc8da9150fe606bfe90e74585e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains. </p>
<p>a) the API for the log-sink that buffers errors logged during start-up so they can be flushed once all configured log-components have become available;</p>
<p>b) the API for querying and setting the phase the server is in with regard to logging (buffering, normal operation, and so forth);</p>
<p>c) the API for flushing the buffered information (to force writing out this information in cases of early shutdowns and so on). </p>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a3a7a6d95fb0fabf276fc81d77744f881"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a7a6d95fb0fabf276fc81d77744f881">&#9670;&nbsp;</a></span>log_error_stage</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881">log_error_stage</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a3a7a6d95fb0fabf276fc81d77744f881a0f55c0b0bda900bcac0696ee051a882c"></a>LOG_ERROR_STAGE_BUFFERING_EARLY&#160;</td><td class="fielddoc"><p>no log-destination yet </p>
</td></tr>
<tr><td class="fieldname"><a id="a3a7a6d95fb0fabf276fc81d77744f881a7040e5f88a3fdfe5c31a6f2f7c96af7a"></a>LOG_ERROR_STAGE_BUFFERING_UNIPLEX&#160;</td><td class="fielddoc"><p>1 sink, or individual files </p>
</td></tr>
<tr><td class="fieldname"><a id="a3a7a6d95fb0fabf276fc81d77744f881a7b26b9d6e2d90407d9eef3520dc5faa2"></a>LOG_ERROR_STAGE_BUFFERING_MULTIPLEX&#160;</td><td class="fielddoc"><p>2+ sinks writing to stderr </p>
</td></tr>
<tr><td class="fieldname"><a id="a3a7a6d95fb0fabf276fc81d77744f881a9d27f1e1390f531cf36ad00dd08eecdd"></a>LOG_ERROR_STAGE_EXTERNAL_SERVICES_AVAILABLE&#160;</td><td class="fielddoc"><p>external services available </p>
</td></tr>
<tr><td class="fieldname"><a id="a3a7a6d95fb0fabf276fc81d77744f881ae2ec1d4bb5759f3bc53ddea48f4a9332"></a>LOG_ERROR_STAGE_SHUTTING_DOWN&#160;</td><td class="fielddoc"><p>no external components </p>
</td></tr>
</table>

</div>
</div>
<a id="a5a9c85d36e64f53662a7f430146b009f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a9c85d36e64f53662a7f430146b009f">&#9670;&nbsp;</a></span>log_sink_buffer_flush_mode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="log__sink__buffer_8h.html#a5a9c85d36e64f53662a7f430146b009f">log_sink_buffer_flush_mode</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a5a9c85d36e64f53662a7f430146b009fa263654e95f9303b7bd4bc25013628c04"></a>LOG_BUFFER_DISCARD_ONLY&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a9c85d36e64f53662a7f430146b009fa9cb9deeeac342b882a01301ed74a5939"></a>LOG_BUFFER_PROCESS_AND_DISCARD&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a9c85d36e64f53662a7f430146b009fa7fcda8bc28760ab2a59ca7388f781f8d"></a>LOG_BUFFER_REPORT_AND_KEEP&#160;</td><td class="fielddoc"></td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2beb18042a9265469104013a8dcf20c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2beb18042a9265469104013a8dcf20c4">&#9670;&nbsp;</a></span>log_error_stage_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881">log_error_stage</a> log_error_stage_get </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>What mode is error-logging in (e.g. are loadable services available yet)? </p>

</div>
</div>
<a id="ac6b0be9d5fdc357180ec1b5a08f1677f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6b0be9d5fdc357180ec1b5a08f1677f">&#9670;&nbsp;</a></span>log_error_stage_set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void log_error_stage_set </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="log__sink__buffer_8h.html#a3a7a6d95fb0fabf276fc81d77744f881">log_error_stage</a>&#160;</td>
          <td class="paramname"><em>les</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set error-logging stage hint (e.g. are loadable services available yet?). </p>

</div>
</div>
<a id="a216407f8dcaa5ae843066fd8259ce70a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a216407f8dcaa5ae843066fd8259ce70a">&#9670;&nbsp;</a></span>log_sink_buffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int log_sink_buffer </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="log__shared_8h.html#abef61f7610a42c29cd8b3a92f391143f">log_line</a> *&#160;</td>
          <td class="paramname"><em>ll</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a log-event to the buffer sink. </p>
<p>Write a log-event to the buffer sink.</p>
<p>During start-up, we buffer log-info until a) we have basic info for the built-in logger (what file to log to, verbosity, and so on), and b) advanced info (any logging components to load, any configuration for them, etc.).</p>
<p>As a failsafe, if start-up takes very, very long, and a time-out is reached before reaching b) and we actually have something worth reporting (e.g. errors, as opposed to info), we try to keep the user informed by using the basic logger configured in a), while going on buffering all info and flushing it to any advanced loggers when b) is reached.</p>
<p>1) This function checks and, if needed, updates the time-out, and calls the flush functions as needed. It is internal to the logger and should not be called from elsewhere.</p>
<p>2) Function will save log-event (if given) for later filtering and output.</p>
<p>3) Function acquires/releases THR_LOCK_log_buffered if initialized.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>instance handle Not currently used in this writer; if this changes later, keep in mind that nullptr will be passed if this is called before the structured logger's locks are initialized, so that must remain a valid argument! </td></tr>
    <tr><td class="paramname">ll</td><td>The log line to write, or nullptr to not add a new logline, but to just check whether the time-out has been reached and if so, flush as needed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>can not add event to buffer (OOM?) </td></tr>
    <tr><td class="paramname">&gt;0</td><td>number of added fields </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; log-line buffer </p>

</div>
</div>
<a id="a5743494132998ba89241f24691a6aa21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5743494132998ba89241f24691a6aa21">&#9670;&nbsp;</a></span>log_sink_buffer_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void log_sink_buffer_flush </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="log__sink__buffer_8h.html#a5a9c85d36e64f53662a7f430146b009f">log_sink_buffer_flush_mode</a>&#160;</td>
          <td class="paramname"><em>mode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release all buffered log-events (discard_error_log_messages()), optionally after running them through the error log stack first (flush_error_log_messages()). </p>
<p>Safe to call repeatedly (though subsequent calls will only output anything if further events occurred after the previous flush).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mode</td><td>LOG_BUFFER_DISCARD_ONLY (to just throw away the buffered events), or LOG_BUFFER_PROCESS_AND_DISCARD to filter/print them first, or LOG_BUFFER_REPORT_AND_KEEP to print an intermediate report on time-out</td></tr>
  </table>
  </dd>
</dl>
<p>Release all buffered log-events (discard_error_log_messages()), optionally after running them through the error log stack first (flush_error_log_messages()).</p>
<p>LOG_BUFFER_DISCARD_ONLY simply releases all buffered log-events (used when called from discard_error_log_messages()).</p>
<p>LOG_BUFFER_PROCESS_AND_DISCARD sends the events through the configured error log stack first before discarding them. (used when called from flush_error_log_messages()). Must remain safe to call repeatedly (with subsequent calls only outputting any events added after the previous flush).</p>
<p>LOG_BUFFER_REPORT_AND_KEEP is used to show incremental status updates when the start-up takes unusually long. When that happens, we "report" the intermediate state using the built-in sink (as that's the only one we available to us at the time), and "keep" the events around. That way if log sinks other that the built-in one are configured, we can flush all of the buffered events there once initialization completes. (used when log_sink_buffer() detects a time-out, see also: LOG_BUFFERING_TIMEOUT_AFTER, LOG_BUFFERING_TIMEOUT_EVERY)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mode</td><td>LOG_BUFFER_DISCARD_ONLY (to just throw away the buffered events), or LOG_BUFFER_PROCESS_AND_DISCARD to filter/print them first, or LOG_BUFFER_REPORT_AND_KEEP to print an intermediate report on time-out.</td></tr>
  </table>
  </dd>
</dl>
<p>To use LOG_BUFFER_REPORT_AND_KEEP in a multi-threaded environment, the caller needs to hold THR_LOCK_log_buffered while calling this; for the other modes, this function will acquire and release the lock as needed; in this second scenario, the lock will not be held while calling log_services (via log_line_submit()). </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aadd25abc8da9150fe606bfe90e74585e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadd25abc8da9150fe606bfe90e74585e">&#9670;&nbsp;</a></span>log_buffering_flushworthy</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int log_buffering_flushworthy</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does buffer contain SYSTEM or ERROR prio messages? Flush early only then! </p>

</div>
</div>
<a id="a384c1fb529a0d4cbc788bc35a1b94fcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a384c1fb529a0d4cbc788bc35a1b94fcc">&#9670;&nbsp;</a></span>THR_LOCK_log_buffered</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmysql__mutex__t.html">mysql_mutex_t</a> THR_LOCK_log_buffered</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Make sure only one instance of the buffered "writer" runs at a time. </p>
<p>In normal operation, the log-event will be created dynamically, then it will be fed through the pipeline, and then it will be released. Since the event is allocated in the caller, we can be sure it won't go away wholesale during processing, and since the event is local to the caller, no other thread will tangle with it. It is therefore safe in those cases not to wrap a lock around the event. (The log-pipeline will still grab a shared lock, THR_LOCK_log_stack, to protect the pipeline (not the event) and the log-services cache from being changed while the pipeline is being applied. Likewise, log-services may protect their resources (file-writers will usually take a lock to serialize their writes; the built-in filter will take a lock on its rule-set as that is shared between concurrent threads running the filter, and so on). None of these are intended to protect the event itself though.</p>
<p>In buffered mode on the other hand, we copy each log-event (the original of which, see above, is owned by the caller and local to the thread, and therefore safe without locking) to a global buffer / backlog. As this backlog can be added to by all threads, it must be protected by a lock (once we have fully initialized the subsystem with log_builtins_init() and support multi-threaded mode anyway, as indicated by log_builtins_inited being true, see below). This is that lock. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5bd71961b401a432086d0fb290a87f3f.html">sql</a></li><li class="navelem"><a class="el" href="dir_12a5ab756a4de267189eabf05ec2ce08.html">server_component</a></li><li class="navelem"><a class="el" href="log__sink__buffer_8h.html">log_sink_buffer.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
