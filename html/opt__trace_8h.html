<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: sql/opt_trace.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('opt__trace_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">opt_trace.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>API for the Optimizer trace (WL#5257)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;my_config.h&quot;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;<a class="el" href="string_8h_source.html">string.h</a>&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &quot;<a class="el" href="m__ctype_8h_source.html">m_ctype.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__compiler_8h_source.html">my_compiler.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__inttypes_8h_source.html">my_inttypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__sqlcommand_8h_source.html">my_sqlcommand.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="opt__trace__context_8h_source.html">sql/opt_trace_context.h</a>&quot;</code><br />
</div>
<p><a href="opt__trace_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classList.html">List&lt; T &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structOpt__trace__info.html">Opt_trace_info</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">User-visible information about a trace.  <a href="structOpt__trace__info.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOpt__trace__iterator.html">Opt_trace_iterator</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterator over the list of remembered traces.  <a href="classOpt__trace__iterator.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOpt__trace__struct.html">Opt_trace_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object and array are both "structured data" and have lots in common, so the Opt_trace_struct is a base class for them.  <a href="classOpt__trace__struct.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOpt__trace__object.html">Opt_trace_object</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A JSON object (unordered set of key/value pairs).  <a href="classOpt__trace__object.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOpt__trace__array.html">Opt_trace_array</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A JSON array (ordered set of values).  <a href="classOpt__trace__array.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOpt__trace__disable__I__S.html">Opt_trace_disable_I_S</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instantiate an instance of this class for specific cases where optimizer trace, in a certain section of Optimizer code, should write only to DBUG and not I_S.  <a href="classOpt__trace__disable__I__S.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOpt__trace__start.html">Opt_trace_start</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a59d70b2ae6079bf75c52dafefd5f915a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="opt__trace_8h.html#a59d70b2ae6079bf75c52dafefd5f915a">OPT_TRACE_TRANSFORM</a>(trace,  object_level0,  object_level1,  select_number,  from,  to)</td></tr>
<tr class="memdesc:a59d70b2ae6079bf75c52dafefd5f915a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper for defining query-transformation-related trace objects in one code line.  <a href="#a59d70b2ae6079bf75c52dafefd5f915a">More...</a><br /></td></tr>
<tr class="separator:a59d70b2ae6079bf75c52dafefd5f915a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Helpers connecting the optimizer trace to THD or Information Schema.</div></td></tr>
<tr class="memitem:ad5083b2bc0f7b5d1d4082274b5c3eb1d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="opt__trace_8h.html#ad5083b2bc0f7b5d1d4082274b5c3eb1d">opt_trace_print_expanded_query</a> (const <a class="el" href="classTHD.html">THD</a> *thd, <a class="el" href="classSELECT__LEX.html">SELECT_LEX</a> *select_lex, <a class="el" href="classOpt__trace__object.html">Opt_trace_object</a> *trace_object)</td></tr>
<tr class="memdesc:ad5083b2bc0f7b5d1d4082274b5c3eb1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints SELECT query to optimizer trace.  <a href="#ad5083b2bc0f7b5d1d4082274b5c3eb1d">More...</a><br /></td></tr>
<tr class="separator:ad5083b2bc0f7b5d1d4082274b5c3eb1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4260c574cdc8c291d180dcc7d457b9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="opt__trace_8h.html#af4260c574cdc8c291d180dcc7d457b9f">opt_trace_disable_if_no_security_context_access</a> (<a class="el" href="classTHD.html">THD</a> *thd)</td></tr>
<tr class="memdesc:af4260c574cdc8c291d180dcc7d457b9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">If the security context is not that of the connected user, inform the trace system that a privilege is missing.  <a href="#af4260c574cdc8c291d180dcc7d457b9f">More...</a><br /></td></tr>
<tr class="separator:af4260c574cdc8c291d180dcc7d457b9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d92cd88ab12f99239d3edde721c7196"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="opt__trace_8h.html#a7d92cd88ab12f99239d3edde721c7196">opt_trace_disable_if_no_view_access</a> (<a class="el" href="classTHD.html">THD</a> *thd, <a class="el" href="structTABLE__LIST.html">TABLE_LIST</a> *view, <a class="el" href="structTABLE__LIST.html">TABLE_LIST</a> *underlying_tables)</td></tr>
<tr class="memdesc:a7d92cd88ab12f99239d3edde721c7196"><td class="mdescLeft">&#160;</td><td class="mdescRight">If tracing is on, checks additional privileges for a view, to make sure that the user has the right to do SHOW CREATE VIEW.  <a href="#a7d92cd88ab12f99239d3edde721c7196">More...</a><br /></td></tr>
<tr class="separator:a7d92cd88ab12f99239d3edde721c7196"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a286d971b046e57be9c7dce2b2703528f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="opt__trace_8h.html#a286d971b046e57be9c7dce2b2703528f">opt_trace_disable_if_no_stored_proc_func_access</a> (<a class="el" href="classTHD.html">THD</a> *thd, <a class="el" href="classsp__head.html">sp_head</a> *sp)</td></tr>
<tr class="memdesc:a286d971b046e57be9c7dce2b2703528f"><td class="mdescLeft">&#160;</td><td class="mdescRight">If tracing is on, checks additional privileges on a stored routine, to make sure that the user has the right to do SHOW CREATE PROCEDURE/FUNCTION.  <a href="#a286d971b046e57be9c7dce2b2703528f">More...</a><br /></td></tr>
<tr class="separator:a286d971b046e57be9c7dce2b2703528f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4171cf4a219e5db2abc6f3ca12b563e5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="opt__trace_8h.html#a4171cf4a219e5db2abc6f3ca12b563e5">fill_optimizer_trace_info</a> (<a class="el" href="classTHD.html">THD</a> *thd, <a class="el" href="structTABLE__LIST.html">TABLE_LIST</a> *tables, <a class="el" href="classItem.html">Item</a> *)</td></tr>
<tr class="memdesc:a4171cf4a219e5db2abc6f3ca12b563e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fills information_schema.OPTIMIZER_TRACE with rows (one per trace)  <a href="#a4171cf4a219e5db2abc6f3ca12b563e5">More...</a><br /></td></tr>
<tr class="separator:a4171cf4a219e5db2abc6f3ca12b563e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>API for the Optimizer trace (WL#5257) </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a59d70b2ae6079bf75c52dafefd5f915a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59d70b2ae6079bf75c52dafefd5f915a">&#9670;&nbsp;</a></span>OPT_TRACE_TRANSFORM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OPT_TRACE_TRANSFORM</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">trace, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">object_level0, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">object_level1, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">select_number, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">from, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">to&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><a class="code" href="classOpt__trace__object.html">Opt_trace_object</a> object_level0(trace);                         \</div><div class="line">  Opt_trace_object object_level1(trace, <span class="stringliteral">&quot;transformation&quot;</span>);       \</div><div class="line">  object_level1.add_select_number(select_number);                \</div><div class="line">  object_level1.add_alnum(<span class="stringliteral">&quot;from&quot;</span>, from).add_alnum(<span class="stringliteral">&quot;to&quot;</span>, to);</div><div class="ttc" id="classOpt__trace__object_html"><div class="ttname"><a href="classOpt__trace__object.html">Opt_trace_object</a></div><div class="ttdoc">A JSON object (unordered set of key/value pairs). </div><div class="ttdef"><b>Definition:</b> opt_trace.h:813</div></div>
</div><!-- fragment -->
<p>Helper for defining query-transformation-related trace objects in one code line. </p>
<p>This produces { "transformation": { "select#": &lt;select_number&gt;, "from": &lt;from&gt;, "to": &lt;to&gt; The objects are left open, so that one can add more to them (often a "chosen" property after making some computation). Objects get closed when going out of scope as usual. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trace</td><td>optimizer trace </td></tr>
    <tr><td class="paramname">object_level0</td><td>name of the outer Opt_trace_object C++ object </td></tr>
    <tr><td class="paramname">object_level1</td><td>name of the inner Opt_trace_object C++ object </td></tr>
    <tr><td class="paramname">select_number</td><td>number of the being-transformed SELECT_LEX </td></tr>
    <tr><td class="paramname">from</td><td>description of the before-transformation state </td></tr>
    <tr><td class="paramname">to</td><td>description of the after-transformation state </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a4171cf4a219e5db2abc6f3ca12b563e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4171cf4a219e5db2abc6f3ca12b563e5">&#9670;&nbsp;</a></span>fill_optimizer_trace_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fill_optimizer_trace_info </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTHD.html">THD</a> *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTABLE__LIST.html">TABLE_LIST</a> *&#160;</td>
          <td class="paramname"><em>tables</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classItem.html">Item</a> *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fills information_schema.OPTIMIZER_TRACE with rows (one per trace) </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>ok </td></tr>
    <tr><td class="paramname">1</td><td>error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af4260c574cdc8c291d180dcc7d457b9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4260c574cdc8c291d180dcc7d457b9f">&#9670;&nbsp;</a></span>opt_trace_disable_if_no_security_context_access()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void opt_trace_disable_if_no_security_context_access </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTHD.html">THD</a> *&#160;</td>
          <td class="paramname"><em>thd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If the security context is not that of the connected user, inform the trace system that a privilege is missing. </p>
<p>With one exception: see below.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>the THD</td></tr>
  </table>
  </dd>
</dl>
<p>This serves to eliminate the following issue. Any information readable by a SELECT may theoretically end up in the trace. And a SELECT may read information from other places than tables:</p><ul>
<li>from views (reading their bodies)</li>
<li>from stored routines (reading their bodies)</li>
<li>from files (reading their content), with LOAD_FILE()</li>
<li>from the list of connections (reading their queries...), with I_S.PROCESSLIST. If the connected user has EXECUTE privilege on a routine which does a security context change, the routine can retrieve information internally (if allowed by the SUID context's privileges), and present only a portion of it to the connected user. But with tracing on, all information is possibly in the trace. So the connected user receives more information than the routine's definer intended to provide. Fixing this issue would require adding, near many privilege checks in the server, a new optimizer-trace-specific check done against the connected user's context, to verify that the connected user has the right to see the retrieved information.</li>
</ul>
<p>Instead, our chosen simpler solution is that if we see a security context change where SUID user is not the connected user, we disable tracing. With only one safe exception: if the connected user has all global privileges (because then she/he can find any information anyway). By "all global
privileges" we mean everything but WITH GRANT OPTION (that latter one isn't related to information gathering).</p>
<p>Read access to I_S.OPTIMIZER_TRACE by another user than the connected user is restricted: </p><dl class="section see"><dt>See also</dt><dd>fill_optimizer_trace_info(). </dd></dl>

</div>
</div>
<a id="a286d971b046e57be9c7dce2b2703528f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a286d971b046e57be9c7dce2b2703528f">&#9670;&nbsp;</a></span>opt_trace_disable_if_no_stored_proc_func_access()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void opt_trace_disable_if_no_stored_proc_func_access </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTHD.html">THD</a> *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsp__head.html">sp_head</a> *&#160;</td>
          <td class="paramname"><em>sp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If tracing is on, checks additional privileges on a stored routine, to make sure that the user has the right to do SHOW CREATE PROCEDURE/FUNCTION. </p>
<p>For that, we use the same checks as in those SHOW commands. If a privilege is missing, notifies the trace system.</p>
<p>This function is not redundant with opt_trace_disable_if_no_security_context_access(). Indeed, for a SQL SECURITY INVOKER routine, there is no context change, but we must still verify that the invoker can do SHOW CREATE.</p>
<p>For triggers, see note in sp_head::execute_trigger().</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>The THD </td></tr>
    <tr><td class="paramname">sp</td><td>routine to check </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7d92cd88ab12f99239d3edde721c7196"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d92cd88ab12f99239d3edde721c7196">&#9670;&nbsp;</a></span>opt_trace_disable_if_no_view_access()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void opt_trace_disable_if_no_view_access </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTHD.html">THD</a> *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTABLE__LIST.html">TABLE_LIST</a> *&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTABLE__LIST.html">TABLE_LIST</a> *&#160;</td>
          <td class="paramname"><em>underlying_tables</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If tracing is on, checks additional privileges for a view, to make sure that the user has the right to do SHOW CREATE VIEW. </p>
<p>For that:</p><ul>
<li>this function checks SHOW VIEW</li>
<li>SELECT is tested in opt_trace_disable_if_no_tables_access()</li>
<li>SELECT + SHOW VIEW is sufficient for SHOW CREATE VIEW. We also check underlying tables. If a privilege is missing, notifies the trace system. This function should be called when the view's underlying tables have not yet been merged.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>THD context </td></tr>
    <tr><td class="paramname">view</td><td>view to check </td></tr>
    <tr><td class="paramname">underlying_tables</td><td>underlying tables/views of 'view' </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad5083b2bc0f7b5d1d4082274b5c3eb1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5083b2bc0f7b5d1d4082274b5c3eb1d">&#9670;&nbsp;</a></span>opt_trace_print_expanded_query()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void opt_trace_print_expanded_query </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTHD.html">THD</a> *&#160;</td>
          <td class="paramname"><em>thd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classSELECT__LEX.html">SELECT_LEX</a> *&#160;</td>
          <td class="paramname"><em>select_lex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classOpt__trace__object.html">Opt_trace_object</a> *&#160;</td>
          <td class="paramname"><em>trace_object</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints SELECT query to optimizer trace. </p>
<p>It is not the original query (as in <code>Opt_trace_context::set_query()</code>) but a printout of the parse tree (Item-s). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thd</td><td>the THD </td></tr>
    <tr><td class="paramname">select_lex</td><td>query's parse tree </td></tr>
    <tr><td class="paramname">trace_object</td><td>Opt_trace_object to which the query will be added </td></tr>
  </table>
  </dd>
</dl>
<p>It's hard to prove that SELECT_LEX::print() doesn't modify any of its Item-s in a dangerous way. Item_int::print(), for example, modifies its internal str_value. To make the danger rare, we print the expanded query as rarely as possible: only if I_S output is needed. If only &ndash;debug is on, we don't print it. See also the corresponding call to "set_items_ref_array" at end of JOIN::exec().</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5bd71961b401a432086d0fb290a87f3f.html">sql</a></li><li class="navelem"><a class="el" href="opt__trace_8h.html">opt_trace.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
