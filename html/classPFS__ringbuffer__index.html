<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: PFS_ringbuffer_index Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classPFS__ringbuffer__index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classPFS__ringbuffer__index-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">PFS_ringbuffer_index Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Index in the error-log ring-buffer.  
 <a href="classPFS__ringbuffer__index.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="cursor__by__error__log_8h_source.html">cursor_by_error_log.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a46398583f46951cf8e132f4e976da5d1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#a46398583f46951cf8e132f4e976da5d1">reset</a> ()</td></tr>
<tr class="memdesc:a46398583f46951cf8e132f4e976da5d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset index.  <a href="#a46398583f46951cf8e132f4e976da5d1">More...</a><br /></td></tr>
<tr class="separator:a46398583f46951cf8e132f4e976da5d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a594f0b1fd50d13430377e15825de7364"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#a594f0b1fd50d13430377e15825de7364">PFS_ringbuffer_index</a> ()</td></tr>
<tr class="memdesc:a594f0b1fd50d13430377e15825de7364"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#a594f0b1fd50d13430377e15825de7364">More...</a><br /></td></tr>
<tr class="separator:a594f0b1fd50d13430377e15825de7364"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a825be2d8ec762f3b604517665b5d45aa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#a825be2d8ec762f3b604517665b5d45aa">set_at</a> (const <a class="el" href="classPFS__ringbuffer__index.html">PFS_ringbuffer_index</a> *other)</td></tr>
<tr class="memdesc:a825be2d8ec762f3b604517665b5d45aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set this index to a given position.  <a href="#a825be2d8ec762f3b604517665b5d45aa">More...</a><br /></td></tr>
<tr class="separator:a825be2d8ec762f3b604517665b5d45aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e78c91ba23d78c816948b59af773f43"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#a0e78c91ba23d78c816948b59af773f43">set_after</a> (const <a class="el" href="classPFS__ringbuffer__index.html">PFS_ringbuffer_index</a> *other)</td></tr>
<tr class="memdesc:a0e78c91ba23d78c816948b59af773f43"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set our index to the element after the given one (if that is valid; otherwise, we cannot determine a next element).  <a href="#a0e78c91ba23d78c816948b59af773f43">More...</a><br /></td></tr>
<tr class="separator:a0e78c91ba23d78c816948b59af773f43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44bfc4511727eebcc2f804aa1053358e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#a44bfc4511727eebcc2f804aa1053358e">get_event</a> ()</td></tr>
<tr class="memdesc:a44bfc4511727eebcc2f804aa1053358e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get event if it's still valid.  <a href="#a44bfc4511727eebcc2f804aa1053358e">More...</a><br /></td></tr>
<tr class="separator:a44bfc4511727eebcc2f804aa1053358e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7a8ea1a5d4f56d61dfe83ae09d49ec7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#ae7a8ea1a5d4f56d61dfe83ae09d49ec7">scan_next</a> (void)</td></tr>
<tr class="memdesc:ae7a8ea1a5d4f56d61dfe83ae09d49ec7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return current record (if valid), then set index to the next record.  <a href="#ae7a8ea1a5d4f56d61dfe83ae09d49ec7">More...</a><br /></td></tr>
<tr class="separator:ae7a8ea1a5d4f56d61dfe83ae09d49ec7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a7872f9cf2c41804bea0f92cc5f5eb86b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#a7872f9cf2c41804bea0f92cc5f5eb86b">m_index</a></td></tr>
<tr class="memdesc:a7872f9cf2c41804bea0f92cc5f5eb86b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Numeric row index.  <a href="#a7872f9cf2c41804bea0f92cc5f5eb86b">More...</a><br /></td></tr>
<tr class="separator:a7872f9cf2c41804bea0f92cc5f5eb86b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9686df977a4d5ba3f8269ef49282ce3a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#a9686df977a4d5ba3f8269ef49282ce3a">m_event</a></td></tr>
<tr class="memdesc:a9686df977a4d5ba3f8269ef49282ce3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to an event in the ring-buffer.  <a href="#a9686df977a4d5ba3f8269ef49282ce3a">More...</a><br /></td></tr>
<tr class="separator:a9686df977a4d5ba3f8269ef49282ce3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cd9c1b131eca8b4f7d8b9b8ccde868a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPFS__ringbuffer__index.html#a1cd9c1b131eca8b4f7d8b9b8ccde868a">m_timestamp</a></td></tr>
<tr class="memdesc:a1cd9c1b131eca8b4f7d8b9b8ccde868a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Time-stamp we copied from the event we point to when setting this index.  <a href="#a1cd9c1b131eca8b4f7d8b9b8ccde868a">More...</a><br /></td></tr>
<tr class="separator:a1cd9c1b131eca8b4f7d8b9b8ccde868a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Index in the error-log ring-buffer. </p>
<p>Has a numeric index, a pointer to an event in the buffer, and the timestamp for that event. This lets us easily check whether this index is still valid: its timestamp must be greater than or equal to that of the ring-buffer's oldest entry (the tail or "read-position"). If our timestamp is older than that value, it points to an event that has since expired. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a594f0b1fd50d13430377e15825de7364"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a594f0b1fd50d13430377e15825de7364">&#9670;&nbsp;</a></span>PFS_ringbuffer_index()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PFS_ringbuffer_index::PFS_ringbuffer_index </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a44bfc4511727eebcc2f804aa1053358e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44bfc4511727eebcc2f804aa1053358e">&#9670;&nbsp;</a></span>get_event()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a>* PFS_ringbuffer_index::get_event </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get event if it's still valid. </p>
<p>Caller should hold read-lock on ring-buffer.</p>
<p>If <code>m_index</code> is 0, the index was reset, and we re-obtain the ring-buffer's read-pointer / tail. This updates m_event and m_timestamp.</p>
<p>If <code>m_index</code> is -1 (EOF), we return <code>nullptr</code>.</p>
<p>Otherwise, we try to obtain the event in the ring-buffer pointed to by m_event. If that event is still valid, we return it; otherwise, we return nullptr (but leave the stale pointer on the object for debugging). It is therefore vital to to determine success/failure by checking the retval rather than calling this method and then checking m_event directly!</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nullptr</td><td>no event (EOF, empty buffer, or stale index) </td></tr>
    <tr><td class="paramname">!=nullptr</td><td>the event this index is referring to </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a46398583f46951cf8e132f4e976da5d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46398583f46951cf8e132f4e976da5d1">&#9670;&nbsp;</a></span>reset()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PFS_ringbuffer_index::reset </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reset index. </p>

</div>
</div>
<a id="ae7a8ea1a5d4f56d61dfe83ae09d49ec7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7a8ea1a5d4f56d61dfe83ae09d49ec7">&#9670;&nbsp;</a></span>scan_next()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a>* PFS_ringbuffer_index::scan_next </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return current record (if valid), then set index to the next record. </p>
<p>Caller should hold read-lock on ring-buffer. Returned value is only valid as long as the lock is held.</p>
<p>Note that three states are possible: a) an event-pointer is returned, and the index points to a valid succeeding event (i.e. is not EOF): there are more elements b) an event-pointer is returned, but the index now flags EOF: this was the last element c) NULL is returned, and the index flags EOF: no event could be obtained (the buffer is empty, or we're at EOF)</p>
<p>Updates m_event, m_timestamp, and m_index.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nullptr</td><td>no valid record could be obtained (end of buffer etc.) </td></tr>
    <tr><td class="paramname">!=nullptr</td><td>pointer to an entry in the ring-buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0e78c91ba23d78c816948b59af773f43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e78c91ba23d78c816948b59af773f43">&#9670;&nbsp;</a></span>set_after()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PFS_ringbuffer_index::set_after </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classPFS__ringbuffer__index.html">PFS_ringbuffer_index</a> *&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set our index to the element after the given one (if that is valid; otherwise, we cannot determine a next element). </p>
<p>Caller should hold read-lock on ring-buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">other</td><td>set our index to the position after the given one </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a825be2d8ec762f3b604517665b5d45aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a825be2d8ec762f3b604517665b5d45aa">&#9670;&nbsp;</a></span>set_at()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PFS_ringbuffer_index::set_at </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classPFS__ringbuffer__index.html">PFS_ringbuffer_index</a> *&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set this index to a given position. </p>
<p>This copies <code>other</code> without validating it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">other</td><td>set our index from the given one </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a9686df977a4d5ba3f8269ef49282ce3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9686df977a4d5ba3f8269ef49282ce3a">&#9670;&nbsp;</a></span>m_event</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sql_2server__component_2log__sink__perfschema_8h.html#ab8b7fe57d7cf2ee022cd07f6af5133d1">log_sink_pfs_event</a>* PFS_ringbuffer_index::m_event</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pointer to an event in the ring-buffer. </p>
<p>Before dereferencing this pointer, use </p><dl class="section see"><dt>See also</dt><dd>log_sink_pfs_event_valid() to make sure it has not become stale. </dd></dl>

</div>
</div>
<a id="a7872f9cf2c41804bea0f92cc5f5eb86b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7872f9cf2c41804bea0f92cc5f5eb86b">&#9670;&nbsp;</a></span>m_index</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int PFS_ringbuffer_index::m_index</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Numeric row index. </p>
<p>valid range [0;num_events[. -1 == EOF </p>

</div>
</div>
<a id="a1cd9c1b131eca8b4f7d8b9b8ccde868a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cd9c1b131eca8b4f7d8b9b8ccde868a">&#9670;&nbsp;</a></span>m_timestamp</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a> PFS_ringbuffer_index::m_timestamp</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Time-stamp we copied from the event we point to when setting this index. </p>
<p>The ring-buffer keeps track of what the oldest item in it is. If our timestamp is older than that item's timestamp, the event we're pointing too has been purged from the ring-buffer, and our pointer is stale. 0 for undefined. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>storage/perfschema/<a class="el" href="cursor__by__error__log_8h_source.html">cursor_by_error_log.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classPFS__ringbuffer__index.html">PFS_ringbuffer_index</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
