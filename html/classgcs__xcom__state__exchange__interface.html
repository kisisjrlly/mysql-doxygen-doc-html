<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: gcs_xcom_state_exchange_interface Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classgcs__xcom__state__exchange__interface.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">gcs_xcom_state_exchange_interface Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Interface that defines the operations that state exchange will provide.  
 <a href="classgcs__xcom__state__exchange__interface.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="gcs__xcom__state__exchange_8h_source.html">gcs_xcom_state_exchange.h</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Interface that defines the operations that state exchange will provide. </p>
<p>In what follows, we describe how the state exchange algorithm works and the view change process where it is inserted and which is an essential part of our system.</p>
<p>The view change process is comprised of two major parts:</p><ul>
<li>Adding or removing a node from the system, accomplished in the XCom/Paxos layer: "The SMART Way to Migrate Replicated Stateful
    Services"</li>
<li>A state exchange phase in which all members distribute data among themselves.</li>
</ul>
<p>Whenever a node wants to add or remove itself from the group, or after a failure when a healthy member expels the faulty node from the group, a reconfiguration request is sent in the form of an add_node or remove_node message.</p>
<p>After the success of the request, XCOM sends a global view message that contains information on all nodes tagging them as alive or faulty to all non-faulty members. MySQL GCS looks at this information and computes who has joined and who has left the group. The computation is trivially simple and compares the set of nodes received in the current view with the set of nodes in the previous view:</p>
<p>. left nodes = (alive_members in old_set) - (alive_members in new_set)</p>
<p>. joined nodes = (alive_members in new_set) - (alive_members in old_set)</p>
<p>However, the new view is only delivered to an upper layer after all members exchange what we call a state message. While the view is being processed and the state exchange is ongoing, all incoming data messages are not delivered to the application and are put into a buffer. So after getting state messages from all members, the view change is delivered to the upper layer along with the content of the state messages and any buffered message is delivered afterwards.</p>
<p>Why blocking the delivery of data messages and why these state messages?</p>
<p>Recall that all messages are atomically delivered and we can guarantee that all nodes will have the same state which encompasses messages (e.g. transactions) in queues and in the storage (e.g. binary log) because all new data messages are buffered while the state messages are being exchanged.</p>
<p>Blocking the delivery of new data messages give us a synchronization point.</p>
<p>But if all nodes have the same state why gathering a state message from all members?</p>
<p>The power of choice. Let us use MySQL Group Replication as a concrete example of an upper layer to understand why. This is done because having information on all members allow the new node to choose a member that is not lagging behind (i.e. has a small queue) as a donor in a recovery phase. Besides, the state message also carries information on IPs and Ports used to access the MySQL Instances. This information is necessary to start the recovery which will be asynchronously started and will dump the missing data from a donor.</p>
<p>Note that the content of the state message is opaque to the MySQL GCS layer which only provides a synchronization point. </p>
</div><hr/>The documentation for this class was generated from the following file:<ul>
<li>plugin/group_replication/libmysqlgcs/src/bindings/xcom/<a class="el" href="gcs__xcom__state__exchange_8h_source.html">gcs_xcom_state_exchange.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classgcs__xcom__state__exchange__interface.html">gcs_xcom_state_exchange_interface</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
