<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: sql/server_component/log_sink_trad.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('log__sink__trad_8cc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">log_sink_trad.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The built-in log-sink (i.e.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="log__sink__trad_8h_source.html">log_sink_trad.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sql_2server__component_2log__sink__perfschema_8h_source.html">log_sink_perfschema.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__systime_8h_source.html">my_systime.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="log_8h_source.html">sql/log.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a31cb96bb6eacae67bb182a072153b6a3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__trad_8cc.html#a31cb96bb6eacae67bb182a072153b6a3">log_item_inconsistent</a> (<a class="el" href="log__shared_8h.html#ad21911bb1e1fa9dd868e83040531f7e8">log_item</a> *li)</td></tr>
<tr class="memdesc:a31cb96bb6eacae67bb182a072153b6a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sanity check an item.  <a href="#a31cb96bb6eacae67bb182a072153b6a3">More...</a><br /></td></tr>
<tr class="separator:a31cb96bb6eacae67bb182a072153b6a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a831d9d11724dff52b7c1c08528f208f4"><td class="memItemLeft" align="right" valign="top">static ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__trad_8cc.html#a831d9d11724dff52b7c1c08528f208f4">parse_trad_field</a> (const char *parse_from, const char **token_end, const char *buf_end)</td></tr>
<tr class="memdesc:a831d9d11724dff52b7c1c08528f208f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the end of the current field (' ')  <a href="#a831d9d11724dff52b7c1c08528f208f4">More...</a><br /></td></tr>
<tr class="separator:a831d9d11724dff52b7c1c08528f208f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a674b03aaaf2922706c1876211c49626b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="log__service_8h.html#ae4871f54cbb0619a0c304c2818298685">log_service_error</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__trad_8cc.html#a674b03aaaf2922706c1876211c49626b">log_sink_trad_parse_log_line</a> (const char *line_start, size_t line_length)</td></tr>
<tr class="memdesc:a674b03aaaf2922706c1876211c49626b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a single line in the traditional error log.  <a href="#a674b03aaaf2922706c1876211c49626b">More...</a><br /></td></tr>
<tr class="separator:a674b03aaaf2922706c1876211c49626b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc7c9977d0ab71ba79e00176d9792418"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__trad_8cc.html#afc7c9977d0ab71ba79e00176d9792418">log_sink_trad</a> (void *instance, <a class="el" href="log__shared_8h.html#abef61f7610a42c29cd8b3a92f391143f">log_line</a> *ll)</td></tr>
<tr class="memdesc:afc7c9977d0ab71ba79e00176d9792418"><td class="mdescLeft">&#160;</td><td class="mdescRight">services: log sinks: basic logging ("classic error-log") Will write timestamp, label, thread-ID, and message to stderr/file.  <a href="#afc7c9977d0ab71ba79e00176d9792418">More...</a><br /></td></tr>
<tr class="separator:afc7c9977d0ab71ba79e00176d9792418"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a4d659f573f1cf1e14cc5e87cd355763e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__sink__trad_8cc.html#a4d659f573f1cf1e14cc5e87cd355763e">log_sink_trad_last</a> = 0</td></tr>
<tr class="memdesc:a4d659f573f1cf1e14cc5e87cd355763e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestamp of when we last flushed to traditional error-log (built-in sink).  <a href="#a4d659f573f1cf1e14cc5e87cd355763e">More...</a><br /></td></tr>
<tr class="separator:a4d659f573f1cf1e14cc5e87cd355763e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The built-in log-sink (i.e. </p>
<p>the writer for the traditional MySQL error log):</p>
<p>a) writing of an error log event to the traditional error log file b) parsing of a line from the traditional error log file </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a31cb96bb6eacae67bb182a072153b6a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31cb96bb6eacae67bb182a072153b6a3">&#9670;&nbsp;</a></span>log_item_inconsistent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int log_item_inconsistent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="log__shared_8h.html#ad21911bb1e1fa9dd868e83040531f7e8">log_item</a> *&#160;</td>
          <td class="paramname"><em>li</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sanity check an item. </p>
<p>Certain log sinks have very low requirements with regard to the data they receive; they write keys as strings, and then data according to the item's class (string, integer, or float), formatted to the sink's standards (e.g. JSON, XML, ...). Code that has higher requirements can use this check to see whether the given item is of a known type (whether generic or wellknown), whether the given type and class agree, and whether in case of a well-known type, the given key is correct for that type. If your code generates items that don't pass this check, you should probably go meditate on it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">li</td><td>the log_item to check</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">LOG_ITEM_OK</td><td>no problems </td></tr>
    <tr><td class="paramname">LOG_ITEM_TYPE_NOT_FOUND</td><td>unknown item type </td></tr>
    <tr><td class="paramname">LOG_ITEM_CLASS_MISMATCH</td><td>item_class derived from type isn't what's set on the item </td></tr>
    <tr><td class="paramname">LOG_ITEM_KEY_MISMATCH</td><td>class not generic, so key should match wellknown </td></tr>
    <tr><td class="paramname">LOG_ITEM_STRING_NULL</td><td>class is string, pointer is nullptr </td></tr>
    <tr><td class="paramname">LOG_ITEM_KEY_NULL</td><td>no key set (this is legal e.g. on aux items of filter rules, but should not occur in a log_line, i.e., log_sinks are within their rights to discard such items) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afc7c9977d0ab71ba79e00176d9792418"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc7c9977d0ab71ba79e00176d9792418">&#9670;&nbsp;</a></span>log_sink_trad()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int log_sink_trad </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="log__shared_8h.html#abef61f7610a42c29cd8b3a92f391143f">log_line</a> *&#160;</td>
          <td class="paramname"><em>ll</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>services: log sinks: basic logging ("classic error-log") Will write timestamp, label, thread-ID, and message to stderr/file. </p>
<p>If you should not be able to specify a label, one will be generated for you from the line's priority field.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>instance handle </td></tr>
    <tr><td class="paramname">ll</td><td>the log line to write</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>number of added fields, if any </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a674b03aaaf2922706c1876211c49626b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a674b03aaaf2922706c1876211c49626b">&#9670;&nbsp;</a></span>log_sink_trad_parse_log_line()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="log__service_8h.html#ae4871f54cbb0619a0c304c2818298685">log_service_error</a> log_sink_trad_parse_log_line </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>line_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>line_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse a single line in the traditional error log. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">line_start</td><td>pointer to the beginning of the line ('2' of the ISO-date) </td></tr>
    <tr><td class="paramname">line_length</td><td>length of the line</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">LOG_SERVICE_ARGUMENT_TOO_LONG</td><td>Token too long for its field </td></tr>
    <tr><td class="paramname">LOG_SERVICE_PARSE_ERROR</td><td>No more spaces in line, cannot find expected end of token, or input otherwise malformed </td></tr>
    <tr><td class="paramname">LOG_SERVICE_SUCCESS</td><td>Event added to ring-buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a831d9d11724dff52b7c1c08528f208f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a831d9d11724dff52b7c1c08528f208f4">&#9670;&nbsp;</a></span>parse_trad_field()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ssize_t parse_trad_field </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>parse_from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>token_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf_end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find the end of the current field (' ') </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">parse_from</td><td>start of the token </td></tr>
    <tr><td class="paramname">token_end</td><td>where to store the address of the delimiter found </td></tr>
    <tr><td class="paramname">buf_end</td><td>end of the input line</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>delimiter not found, "parsing" failed </td></tr>
    <tr><td class="paramname">&gt;=0</td><td>length of token </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a4d659f573f1cf1e14cc5e87cd355763e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d659f573f1cf1e14cc5e87cd355763e">&#9670;&nbsp;</a></span>log_sink_trad_last</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a> log_sink_trad_last = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timestamp of when we last flushed to traditional error-log (built-in sink). </p>
<p>Log lines with timestamps older than this have already been flushed to the default log-sink, so we won't do so again to prevent duplicates. (The buffered events are still kept around until buffered logging ends however in case we need to flush them to other log-writers then. This timestamp is updated to the present and then drifts into the past, in contrast to the time-out value (see there). </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5bd71961b401a432086d0fb290a87f3f.html">sql</a></li><li class="navelem"><a class="el" href="dir_12a5ab756a4de267189eabf05ec2ce08.html">server_component</a></li><li class="navelem"><a class="el" href="log__sink__trad_8cc.html">log_sink_trad.cc</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
