<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: storage/innobase/include/trx0trx.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('trx0trx_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">trx0trx.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="trx0trx_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">Copyright (c) 1996, 2020, Oracle and/or its affiliates. All Rights Reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">This program is free software; you can redistribute it and/or modify it under</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">the terms of the GNU General Public License, version 2.0, as published by the</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">Free Software Foundation.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">This program is also distributed with certain software (including but not</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">limited to OpenSSL) that is licensed under separate terms, as designated in a</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">particular file or component or in included license documentation. The authors</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">of MySQL hereby grant you an additional permission to link the program and</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">your derivative works with the separately licensed software that they have</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">included with MySQL.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License, version 2.0,</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">for more details.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">You should have received a copy of the GNU General Public License along with</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">this program; if not, write to the Free Software Foundation, Inc.,</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">*****************************************************************************/</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/** @file include/trx0trx.h</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> The transaction</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> Created 3/26/1996 Heikki Tuuri</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *******************************************************/</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#ifndef trx0trx_h</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#define trx0trx_h</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;atomic&gt;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ha__prototypes_8h.html">ha_prototypes.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dict0types_8h.html">dict0types.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trx0types_8h.html">trx0types.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ut0new_8h.html">ut0new.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lock0types_8h.html">lock0types.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="log0log_8h.html">log0log.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mem0mem_8h.html">mem0mem.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="que0types_8h.html">que0types.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trx0xa_8h.html">trx0xa.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="usr0types_8h.html">usr0types.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ut0vec_8h.html">ut0vec.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fts0fts_8h.html">fts0fts.h</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="srv0srv_8h.html">srv0srv.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">// Forward declaration</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keyword">struct </span><a class="code" href="structmtr__t.html">mtr_t</a>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">// Forward declaration</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">class </span><a class="code" href="classReadView.html">ReadView</a>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">// Forward declaration</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">class </span><a class="code" href="classFlushObserver.html">FlushObserver</a>;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">/** Dummy session used currently in MySQL interface */</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword">extern</span> <a class="code" href="structsess__t.html">sess_t</a> *<a class="code" href="trx0trx_8h.html#a1c64d381cc36d6df16ab94be98f23116">trx_dummy_sess</a>;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">/** Set flush observer for the transaction</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">@param[in,out]  trx             transaction struct</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">@param[in]      observer        flush observer */</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#adcc5876d6636810e0b96bd22ea5a3e6f">trx_set_flush_observer</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <a class="code" href="classFlushObserver.html">FlushObserver</a> *observer);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">/** Set detailed error message for the transaction.</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">@param[in] trx Transaction struct</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">@param[in] msg Detailed error message */</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#af9066529c44667bed3ddb904c4adbfdd">trx_set_detailed_error</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="test__sql__9__sessions_8cc.html#af6a786aadb2fc26d9c6d8dcb60c181f9">msg</a>);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/** Set detailed error message for the transaction from a file. Note that the</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> file is rewinded before reading from it. */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a8c7f576bf5e13ddc8a29be5b9200c0c4">trx_set_detailed_error_from_file</a>(</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="structtrx__t.html">trx_t</a> *trx,  <span class="comment">/*!&lt; in: transaction struct */</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="namespaceconsts.html#a2497d532ccb12f859b91cdaba0fb4c9a">FILE</a> *<a class="code" href="namespacefile.html">file</a>); <span class="comment">/*!&lt; in: file to read message from */</span><span class="comment"></span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">/** Retrieves the error_info field from a trx.</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> @return the error index */</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">const</span> <a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="trx0trx_8h.html#a93995ce4037f0b629f78dee251b141a1">trx_get_error_index</a>(</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in: trx object */</span><span class="comment"></span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">/** Creates a transaction object for MySQL.</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> @return own: transaction object */</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<a class="code" href="structtrx__t.html">trx_t</a> *<a class="code" href="trx0trx_8h.html#ae8d19073df69b437e6fa9396fd6c9806">trx_allocate_for_mysql</a>(<span class="keywordtype">void</span>);<span class="comment"></span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">/** Creates a transaction object for background operations by the master thread.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> @return own: transaction object */</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<a class="code" href="structtrx__t.html">trx_t</a> *<a class="code" href="trx0trx_8h.html#a2cb464dfd1e6c2ff6000867e63fee8cc">trx_allocate_for_background</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">/** Resurrect table locks for resurrected transactions. */</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a62da6d484835d0aab2f3aa1b5c4cfa0d">trx_resurrect_locks</a>();</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">/** Free and initialize a transaction object instantiated during recovery.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">@param[in,out]  trx     transaction object to free and initialize */</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a5779006f2811622c6c980e36c7837441">trx_free_resurrected</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">/** Free a transaction that was allocated by background or user threads.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">@param[in,out]  trx     transaction object to free */</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a2a2d65d23b63d13b2f010a8c8359b250">trx_free_for_background</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">/** At shutdown, frees a transaction object that represents either:</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> - a PREPARED transaction,</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> - or a recovered ACTIVE transaction.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">@param[in, out]  trx   transaction object to free */</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a29f1cd3a693f103cc1dae338aa65cf86">trx_free_prepared_or_active_recovered</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">/** Free a transaction object for MySQL.</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">@param[in,out]  trx     transaction */</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a45828097bb852e4c45d34165fb115cf9">trx_free_for_mysql</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">/** Disconnect a transaction from MySQL.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">@param[in,out]  trx     transaction */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a4ddb5503a735f4540830f8fff6ed05d7">trx_disconnect_plain</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">/** Disconnect a prepared transaction from MySQL.</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">@param[in,out]  trx     transaction */</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#ae5f3f22daed412fac70def43c6560c45">trx_disconnect_prepared</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">/** Creates trx objects for transactions and initializes the trx list of</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"> trx_sys at database start. Rollback segment and undo log lists must</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"> already exist when this function is called, because the lists of</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"> transactions to be rolled back or cleaned up are built based on the</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"> undo log lists. */</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#adf5afc626305a6fe095445d741a765ae">trx_lists_init_at_db_start</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">/** Starts the transaction if it is not yet started.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">@param[in,out] trx Transaction</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">@param[in] read_write True if read write transaction */</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#aff869b3dc21337797d3f4e177c30e930">trx_start_if_not_started_xa_low</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keywordtype">bool</span> read_write);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">/** Starts the transaction if it is not yet started.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">@param[in] trx Transaction</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">@param[in] read_write True if read write transaction */</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a068ef6ef1d38ac54c6e5c8c6ad1294fe">trx_start_if_not_started_low</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keywordtype">bool</span> read_write);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">/** Starts a transaction for internal processing. */</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#acb9d9e94366336ff875699f4f9223bb4">trx_start_internal_low</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in/out: transaction */</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/** Starts a read-only transaction for internal processing.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">@param[in,out] trx      transaction to be started */</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a9f0ab6e6668f9846426da7c7e2d975c9">trx_start_internal_read_only_low</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a5b75bf99d785dde6579f0360107894a5">  151</a></span>&#160;<span class="preprocessor">#define trx_start_if_not_started_xa(t, rw)    \</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">  do {                                        \</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">    (t)-&gt;start_line = __LINE__;               \</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">    (t)-&gt;start_file = __FILE__;               \</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">    trx_start_if_not_started_xa_low((t), rw); \</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="preprocessor">  } while (false)</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a0000b81548ffa235feae627a2ce6ac5d">  158</a></span>&#160;<span class="preprocessor">#define trx_start_if_not_started(t, rw)    \</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">  do {                                     \</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">    (t)-&gt;start_line = __LINE__;            \</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">    (t)-&gt;start_file = __FILE__;            \</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">    trx_start_if_not_started_low((t), rw); \</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">  } while (false)</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a0407502f2e8bc067035afd50b8d1ae0a">  165</a></span>&#160;<span class="preprocessor">#define trx_start_internal(t)    \</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">  do {                           \</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="preprocessor">    (t)-&gt;start_line = __LINE__;  \</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">    (t)-&gt;start_file = __FILE__;  \</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">    trx_start_internal_low((t)); \</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">  } while (false)</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#aecf86f30d06714cbe788898c036e19b0">  172</a></span>&#160;<span class="preprocessor">#define trx_start_internal_read_only(t)  \</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">  do {                                   \</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">    (t)-&gt;start_line = __LINE__;          \</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">    (t)-&gt;start_file = __FILE__;          \</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">    trx_start_internal_read_only_low(t); \</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="preprocessor">  } while (false)</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#define trx_start_if_not_started(t, rw) trx_start_if_not_started_low((t), rw)</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="preprocessor">#define trx_start_internal(t) trx_start_internal_low((t))</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#define trx_start_internal_read_only(t) trx_start_internal_read_only_low(t)</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor">#define trx_start_if_not_started_xa(t, rw) \</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">  trx_start_if_not_started_xa_low((t), (rw))</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">/** Commits a transaction. */</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a7ad2939baf98996b4536611285e30916">trx_commit</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in/out: transaction */</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">/** Commits a transaction and a mini-transaction.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">@param[in,out] trx Transaction</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">@param[in,out] mtr Mini-transaction (will be committed), or null if trx made no</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">modifications */</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#aaae4a91cb2920a6e0ac1465c3eee7409">trx_commit_low</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <a class="code" href="structmtr__t.html">mtr_t</a> *mtr);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">/** Cleans up a transaction at database startup. The cleanup is needed if</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"> the transaction already got to the middle of a commit when the database</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment"> crashed, and we cannot roll it back. */</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#af9bee0e9d7331369cd78cd83247b79b3">trx_cleanup_at_db_startup</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in: transaction */</span><span class="comment"></span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">/** Does the transaction commit for MySQL.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment"> @return DB_SUCCESS or error number */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<a class="code" href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a> <a class="code" href="trx0trx_8h.html#afc0bc1af38fae5aef2a9669887c182f5">trx_commit_for_mysql</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in/out: transaction */</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">Does the transaction prepare for MySQL.</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">@param[in, out] trx             Transaction instance to prepare */</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<a class="code" href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a> <a class="code" href="trx0trx_8h.html#afd3d96e663aa75dd8974743e0e24cd10">trx_prepare_for_mysql</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">/** This function is used to find number of prepared transactions and</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment"> their transaction objects for a recovery.</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment"> @return number of prepared transactions */</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keywordtype">int</span> <a class="code" href="trx0trx_8h.html#ab53d050821092784b2653e176263c5d2">trx_recover_for_mysql</a>(</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="structst__xarecover__txn.html">XA_recover_txn</a> *txn_list, <span class="comment">/*!&lt; in/out: prepared transactions */</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    ulint len,                <span class="comment">/*!&lt; in: number of slots in xid_list */</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="structMEM__ROOT.html">MEM_ROOT</a> *<a class="code" href="client__plugin_8cc.html#a7d0fe2f135db987da18cea87b4778737">mem_root</a>);      <span class="comment">/*!&lt; in: memory for table names */</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">/** This function is used to find one X/Open XA distributed transaction</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"> which is in the prepared state</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment"> @param[in]   xid   X/Open XA transaction identifier</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment"> @return trx or NULL; on match, the trx-&gt;xid will be invalidated;</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment"> note that the trx may have been committed */</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<a class="code" href="structtrx__t.html">trx_t</a> *<a class="code" href="trx0trx_8h.html#a5292ad6e2ddaf68f9d7c97897828fca5">trx_get_trx_by_xid</a>(<span class="keyword">const</span> <a class="code" href="structxid__t.html">XID</a> *xid);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">/** If required, flushes the log to disk if we called trx_commit_for_mysql()</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"> with trx-&gt;flush_log_later == TRUE. */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#ae0c29148646b50fa199ed713bde256b6">trx_commit_complete_for_mysql</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in/out: transaction */</span><span class="comment"></span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">/** Marks the latest SQL statement ended. */</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a76e191adc5826a5f78886df503183ebe">trx_mark_sql_stat_end</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in: trx handle */</span><span class="comment"></span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">/** Assigns a read view for a consistent read query. All the consistent reads</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"> within the same transaction will get the same read view, which is created</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"> when this function is first called for a new started transaction. */</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<a class="code" href="classReadView.html">ReadView</a> *<a class="code" href="trx0trx_8h.html#abdf39b1615cfa159e1dc50f50d97141c">trx_assign_read_view</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in: active transaction */</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">/** @return the transaction&#39;s read view or NULL if one not assigned. */</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<a class="code" href="classReadView.html">ReadView</a> *<a class="code" href="trx0trx_8h.html#ac618a169bc66ee27280522b021a2d9ae">trx_get_read_view</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">/** @return the transaction&#39;s read view or NULL if one not assigned. */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="keyword">const</span> <a class="code" href="classReadView.html">ReadView</a> *<a class="code" href="trx0trx_8h.html#ac618a169bc66ee27280522b021a2d9ae">trx_get_read_view</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">/** Prepares a transaction for commit/rollback. */</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#af273fab04e0e0f86def42b181448203f">trx_commit_or_rollback_prepare</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in/out: transaction */</span><span class="comment"></span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">/** Creates a commit command node struct.</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment"> @return own: commit node struct */</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<a class="code" href="structcommit__node__t.html">commit_node_t</a> *<a class="code" href="trx0trx_8h.html#affaac0949d19f8f98f68fd6cb8ab6429">trx_commit_node_create</a>(</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="structmem__block__info__t.html">mem_heap_t</a> *heap); <span class="comment">/*!&lt; in: mem heap where created */</span><span class="comment"></span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">/** Performs an execution step for a commit type node in a query graph.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"> @return query thread to run next, or NULL */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<a class="code" href="structque__thr__t.html">que_thr_t</a> *<a class="code" href="trx0trx_8h.html#a7d3e131a908fd0050ff73bc5b27f7dba">trx_commit_step</a>(<a class="code" href="structque__thr__t.html">que_thr_t</a> *thr); <span class="comment">/*!&lt; in: query thread */</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">/** Prints info about a transaction.</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"> Caller must hold trx_sys-&gt;mutex. */</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#afda78355fbbfe044da5291535faa95fb">trx_print_low</a>(<a class="code" href="namespaceconsts.html#a2497d532ccb12f859b91cdaba0fb4c9a">FILE</a> *f,<span class="comment"></span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">                   /*!&lt; in: output stream */</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                   <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx,<span class="comment"></span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">                   /*!&lt; in: transaction */</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                   ulint max_query_len,<span class="comment"></span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">                   /*!&lt; in: max query length to print,</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">                   or 0 to use the default max length */</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                   ulint n_rec_locks,<span class="comment"></span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">                   /*!&lt; in: lock_number_of_rows_locked(&amp;trx-&gt;lock) */</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                   ulint n_trx_locks,<span class="comment"></span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">                   /*!&lt; in: length of trx-&gt;lock.trx_locks */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                   ulint heap_size);<span class="comment"></span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">/*!&lt; in: mem_heap_get_size(trx-&gt;lock.lock_heap) */</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">/** Prints info about a transaction.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">The caller must hold lock_sys exclusive global latch and trx_sys-&gt;mutex.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">@param[in]  f               output stream</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">@param[in]  trx             transaction</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">@param[in]  max_query_len   max query length to print, or 0 to use the default</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">                            max length */</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a5d672f17aef4ef582fbd8f80ad5ae756">trx_print_latched</a>(<a class="code" href="namespaceconsts.html#a2497d532ccb12f859b91cdaba0fb4c9a">FILE</a> *f, <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx, ulint max_query_len);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">/** Prints info about a transaction.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">Acquires and releases lock_sys exclusive global latch and trx_sys-&gt;mutex.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">@param[in]  f               output stream</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">@param[in]  trx             transaction</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">@param[in]  max_query_len   max query length to print, or 0 to use the default</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">                            max length */</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#ac4d97ad86d27e5c07b87a6c1b149f4d9">trx_print</a>(<a class="code" href="namespaceconsts.html#a2497d532ccb12f859b91cdaba0fb4c9a">FILE</a> *f, <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx, ulint max_query_len);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">/** Determine if a transaction is a dictionary operation.</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment"> @return dictionary operation mode */</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keyword">enum</span> <a class="code" href="trx0types_8h.html#af79319b3cdfff988f01995fa51880599">trx_dict_op_t</a> <a class="code" href="trx0trx_8h.html#a690d5d04746f73ed3a29199e45fdcf29">trx_get_dict_operation</a>(</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) <span class="comment">/*!&lt; in: transaction */</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">/** Flag a transaction a dictionary operation.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">@param[in,out]  trx     transaction</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">@param[in]      op      operation, not TRX_DICT_OP_NONE */</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a2897a812badb5f6c9f6ebdc5a0f84ae9">trx_set_dict_operation</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keyword">enum</span> <a class="code" href="trx0types_8h.html#af79319b3cdfff988f01995fa51880599">trx_dict_op_t</a> op);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">/** Determines if a transaction is in the given state.</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment"> The caller must hold trx_sys-&gt;mutex, or it must be the thread</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"> that is serving a running transaction.</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"> A running RW transaction must be in trx_sys-&gt;rw_trx_list.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment"> @return true if trx-&gt;state == state */</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="trx0trx_8h.html#aba5b87828afc483ac0875159cd440598">trx_state_eq</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx,  <span class="comment">/*!&lt; in: transaction */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                  <a class="code" href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfe">trx_state_t</a> state) <span class="comment">/*!&lt; in: state */</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">/** Determines if trx can be handled by current thread, which is when</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">trx-&gt;mysql_thd is nullptr (a &quot;background&quot; trx) or equals current_thd.</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">@param[in]    trx   The transaction to check</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">@return true iff current thread can handle the transaction</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="trx0trx_8h.html#a8fb6471220ce01c07a8fae94bf27b989">trx_can_be_handled_by_current_thread</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">/** Asserts that a transaction has been started.</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"> The caller must hold trx_sys-&gt;mutex.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"> @return true if started */</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;ibool <a class="code" href="trx0trx_8h.html#a2c8fd0a774b3be32177da1c54db92352">trx_assert_started</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) <span class="comment">/*!&lt; in: transaction */</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">/** Determines if the currently running transaction has been interrupted.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"> @return true if interrupted */</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;ibool <a class="code" href="trx0trx_8h.html#a1a5ce0995025643b07a6bd0691c3a92d">trx_is_interrupted</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in: transaction */</span><span class="comment"></span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">/** Determines if the currently running transaction is in strict mode.</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"> @return true if strict */</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;ibool <a class="code" href="trx0trx_8h.html#afd763791d1b59356b2d0f6f4ca90cae4">trx_is_strict</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in: transaction */</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">/** Calculates the &quot;weight&quot; of a transaction. The weight of one transaction</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"> is estimated as the number of altered rows + the number of locked rows.</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"> @param t transaction</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"> @return transaction weight */</span></div><div class="line"><a name="l00335"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a56f0896d94fab6eeb73cbcb164a40945">  335</a></span>&#160;<span class="preprocessor">#define TRX_WEIGHT(t) ((t)-&gt;undo_no + UT_LIST_GET_LEN((t)-&gt;lock.trx_locks))</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">/** Compares the &quot;weight&quot; (or size) of two transactions. Transactions that</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> have edited non-transactional tables are considered heavier than ones</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"> that have not.</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment"> @return true if weight(a) &gt;= weight(b) */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="trx0trx_8h.html#a4df89e9a279e9b27588c4c7b8d14533e">trx_weight_ge</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *a,  <span class="comment">/*!&lt; in: the transaction to be compared */</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                   <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *b); <span class="comment">/*!&lt; in: the transaction to be compared */</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">/* Maximum length of a string that can be returned by</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">trx_get_que_state_str(). */</span></div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a0081be50a0239c2f91a1c7e35804380c">  345</a></span>&#160;<span class="preprocessor">#define TRX_QUE_STATE_STR_MAX_LEN 12 </span><span class="comment">/* &quot;ROLLING BACK&quot; */</span><span class="preprocessor"></span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">/** Retrieves transaction&#39;s que state in a human readable string. The string</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment"> should not be free()&#39;d or modified.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"> @return string in the data segment */</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="trx0trx_8h.html#a70150f2448c48ddb2ace0e7335e61b05">trx_get_que_state_str</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx); <span class="comment">/*!&lt; in: transaction */</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">/** Retreieves the transaction ID.</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">In a given point in time it is guaranteed that IDs of the running</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">transactions are unique. The values returned by this function for readonly</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">transactions may be reused, so a subsequent RO transaction may get the same ID</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">as a RO transaction that existed in the past. The values returned by this</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">function should be used for printing purposes only.</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">@param[in]      trx     transaction whose id to retrieve</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">@return transaction id */</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<a class="code" href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a> <a class="code" href="trx0trx_8h.html#a2b7ae91f363c7ac77c2d86bc27eb39f1">trx_get_id_for_print</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">/** Assign a temp-tablespace bound rollback-segment to a transaction.</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">@param[in,out]  trx     transaction that involves write to temp-table. */</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a8acaf6c0654f6e9825f06d0abc109d17">trx_assign_rseg_temp</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">/** Create the trx_t pool */</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a41eb566dad1d8483afc0fb1f6ec09022">trx_pool_init</a>();</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">/** Destroy the trx_t pool */</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#abddd49c761d973bbf99a159d2261fc9d">trx_pool_close</a>();</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">Set the transaction as a read-write transaction if it is not already</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">tagged as such.</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">@param[in,out] trx      Transaction that needs to be &quot;upgraded&quot; to RW from RO */</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a7e980f48dd611cefdaf1842c0c64c094">trx_set_rw_mode</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">Increase the reference count. If the transaction is in state</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">TRX_STATE_COMMITTED_IN_MEMORY then the transaction is considered</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">committed and the reference count is not incremented.</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">@param trx Transaction that is being referenced</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">@param do_ref_count Increment the reference iff this is true</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">@return transaction instance if it is not committed */</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<a class="code" href="structtrx__t.html">trx_t</a> *<a class="code" href="trx0trx_8h.html#ac39e946db2a5f720fe25d2a5aeae914c">trx_reference</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keywordtype">bool</span> do_ref_count);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">Release the transaction. Decrease the reference count.</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">@param trx Transaction that is being released */</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#af21f360b739c58f875010707f9740b46">trx_release_reference</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">Check if the transaction is being referenced. */</span></div><div class="line"><a name="l00398"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#afe4c0faddcc992c34c3b13be5b72fe42">  398</a></span>&#160;<span class="preprocessor">#define trx_is_referenced(t) ((t)-&gt;n_ref &gt; 0)</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">@param[in] requestor    Transaction requesting the lock</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">@param[in] holder       Transaction holding the lock</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">@return the transaction that will be rolled back, null don&#39;t care */</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *<a class="code" href="trx0trx_8h.html#aceabcaa371d826f2a22aa2565d904602">trx_arbitrate</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *requestor, <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *holder);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">@param[in] trx          Transaction to check</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">@return true if the transaction is a high priority transaction.*/</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="trx0trx_8h.html#a1a144ee93ff1061b38218c3ff33a6112">trx_is_high_priority</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">If this is a high priority transaction,</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">kill all transactions that are blocking this transaction from acquiring locks.</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">@param[in,out] trx      High priority transaction */</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a49e6e5415aa5cddeb201c75974f4f51d">trx_kill_blocking</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">/** Provides an id of the transaction which does not change over time.</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">Contrast this with trx-&gt;id and trx_get_id_for_print(trx) which change value once</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">a transaction can no longer be treated as read-only and becomes read-write.</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">@param[in]  trx   The transaction for which you want an immutable id</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">@return the transaction&#39;s immutable id */</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00426"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a5d0f7f590f17ab052505bbb43ce0c25b">  426</a></span>&#160;uint64_t <a class="code" href="trx0trx_8h.html#a5d0f7f590f17ab052505bbb43ce0c25b">trx_immutable_id</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">return</span> (uint64_t{<span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(trx)});</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">Check if redo/noredo rseg is modified for insert/update.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">@param[in] trx          Transaction to check */</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="trx0trx_8h.html#a13e56b49b2943c1b4dcf68f41690202b">trx_is_rseg_updated</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">Transactions that aren&#39;t started by the MySQL server don&#39;t set</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">the trx_t::mysql_thd field. For such transactions we set the lock</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">wait timeout to 0 instead of the user configured value that comes</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">from innodb_lock_wait_timeout via trx_t::mysql_thd.</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">@param  t transaction</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">@return lock wait timeout in seconds */</span></div><div class="line"><a name="l00443"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a99829ee6699e2af1b9c8789bc736bb67">  443</a></span>&#160;<span class="preprocessor">#define trx_lock_wait_timeout_get(t) thd_lock_wait_timeout((t)-&gt;mysql_thd)</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">Determine if the transaction is a non-locking autocommit select</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">(implied read-only).</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">@param t transaction</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">@return true if non-locking autocommit select transaction. */</span></div><div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a087a90c619c86978766f279a156dae2e">  450</a></span>&#160;<span class="preprocessor">#define trx_is_autocommit_non_locking(t) \</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="preprocessor">  ((t)-&gt;auto_commit &amp;&amp; (t)-&gt;will_lock == 0)</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">Determine if the transaction is a non-locking autocommit select</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">with an explicit check for the read-only status.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">@param t transaction</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">@return true if non-locking autocommit read-only transaction. */</span></div><div class="line"><a name="l00458"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a02fc96ab8d1a9a437a032d4d82a57381">  458</a></span>&#160;<span class="preprocessor">#define trx_is_ac_nl_ro(t) \</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor">  ((t)-&gt;read_only &amp;&amp; trx_is_autocommit_non_locking((t)))</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">Assert that the transaction is in the trx_sys_t::rw_trx_list */</span></div><div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a3c91c1715241613f6ac4ce942590b2af">  463</a></span>&#160;<span class="preprocessor">#define assert_trx_in_rw_list(t)                         \</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="preprocessor">  do {                                                   \</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="preprocessor">    ut_ad(!(t)-&gt;read_only);                              \</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="preprocessor">    ut_ad((t)-&gt;in_rw_trx_list ==                         \</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">          !((t)-&gt;read_only || !(t)-&gt;rsegs.m_redo.rseg)); \</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor">    check_trx_state(t);                                  \</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="preprocessor">  } while (0)</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">Check transaction state */</span></div><div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#afde7d20699cfd043fa15ee48463bc9aa">  473</a></span>&#160;<span class="preprocessor">#define check_trx_state(t)                      \</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="preprocessor">  do {                                          \</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="preprocessor">    ut_ad(!trx_is_autocommit_non_locking((t))); \</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="preprocessor">    switch ((t)-&gt;state) {                       \</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="preprocessor">      case TRX_STATE_PREPARED:                  \</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor">        </span><span class="comment">/* fall through */</span><span class="preprocessor">                      \</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="preprocessor">      case TRX_STATE_ACTIVE:                    \</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="preprocessor">      case TRX_STATE_COMMITTED_IN_MEMORY:       \</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="preprocessor">        continue;                               \</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="preprocessor">      case TRX_STATE_NOT_STARTED:               \</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="preprocessor">      case TRX_STATE_FORCED_ROLLBACK:           \</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="preprocessor">        break;                                  \</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="preprocessor">    }                                           \</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="preprocessor">    ut_error;                                   \</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="preprocessor">  } while (0)</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">/** Check if transaction is free so that it can be re-initialized.</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">@param t transaction handle */</span></div><div class="line"><a name="l00491"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a71fd3d6e042a40d9ec7497bbcca0bcb5">  491</a></span>&#160;<span class="preprocessor">#define assert_trx_is_free(t)                            \</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor">  do {                                                   \</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">    ut_ad(trx_state_eq((t), TRX_STATE_NOT_STARTED) ||    \</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="preprocessor">          trx_state_eq((t), TRX_STATE_FORCED_ROLLBACK)); \</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="preprocessor">    ut_ad(!trx_is_rseg_updated(trx));                    \</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="preprocessor">    ut_ad(!MVCC::is_view_active((t)-&gt;read_view));        \</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor">    ut_ad((t)-&gt;lock.wait_thr == NULL);                   \</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="preprocessor">    ut_ad(UT_LIST_GET_LEN((t)-&gt;lock.trx_locks) == 0);    \</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="preprocessor">    ut_ad((t)-&gt;dict_operation == TRX_DICT_OP_NONE);      \</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="preprocessor">  } while (0)</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">/** Check if transaction is in-active so that it can be freed and put back to</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">transaction pool.</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">@param t transaction handle */</span></div><div class="line"><a name="l00505"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#afbd9c1e66ed02a17b5c501ffd7c35a77">  505</a></span>&#160;<span class="preprocessor">#define assert_trx_is_inactive(t)              \</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="preprocessor">  do {                                         \</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="preprocessor">    assert_trx_is_free((t));                   \</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="preprocessor">    ut_ad((t)-&gt;dict_operation_lock_mode == 0); \</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="preprocessor">  } while (0)</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">/** Assert that an autocommit non-locking select cannot be in the</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment"> rw_trx_list and that it is a read-only transaction.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment"> The tranasction must be in the mysql_trx_list. */</span></div><div class="line"><a name="l00515"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a4668f84b3a9c5687a0e1d733c3fbfa19">  515</a></span>&#160;<span class="preprocessor">#define assert_trx_nonlocking_or_in_list(t)         \</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="preprocessor">  do {                                              \</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="preprocessor">    if (trx_is_autocommit_non_locking(t)) {         \</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="preprocessor">      trx_state_t t_state = (t)-&gt;state;             \</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="preprocessor">      ut_ad((t)-&gt;read_only);                        \</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor">      ut_ad(!(t)-&gt;is_recovered);                    \</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="preprocessor">      ut_ad(!(t)-&gt;in_rw_trx_list);                  \</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">      ut_ad((t)-&gt;in_mysql_trx_list);                \</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="preprocessor">      ut_ad(t_state == TRX_STATE_NOT_STARTED ||     \</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="preprocessor">            t_state == TRX_STATE_FORCED_ROLLBACK || \</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor">            t_state == TRX_STATE_ACTIVE);           \</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="preprocessor">    } else {                                        \</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">      check_trx_state(t);                           \</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="preprocessor">    }                                               \</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="preprocessor">  } while (0)</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">/** Assert that an autocommit non-locking slect cannot be in the</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment"> rw_trx_list and that it is a read-only transaction.</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment"> The tranasction must be in the mysql_trx_list. */</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor">#define assert_trx_nonlocking_or_in_list(trx) ((void)0)</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#afaaac1afb77620ef89dbd971c181b04b">  538</a></span>&#160;<span class="keyword">typedef</span> std::vector&lt;ib_lock_t *, ut_allocator&lt;ib_lock_t *&gt;&gt; <a class="code" href="trx0trx_8h.html#afaaac1afb77620ef89dbd971c181b04b">lock_pool_t</a>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">/** Latching protocol for trx_lock_t::que_state.  trx_lock_t::que_state</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment"> captures the state of the query thread during the execution of a query.</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"> This is different from a transaction state. The query state of a transaction</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment"> can be updated asynchronously by other threads.  The other threads can be</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment"> system threads, like the timeout monitor thread or user threads executing</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment"> other queries. Another thing to be mindful of is that there is a delay between</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment"> when a query thread is put into LOCK_WAIT state and before it actually starts</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment"> waiting.  Between these two events it is possible that the query thread is</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"> granted the lock it was waiting for, which implies that the state can be</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment"> changed asynchronously.</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment"> All these operations take place within the context of locking. Therefore state</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment"> changes within the locking code must latch the shard with the wait_lock and</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment"> the trx-&gt;mutex when changing trx-&gt;lock.que_state to TRX_QUE_LOCK_WAIT or</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment"> trx-&gt;lock.wait_lock to non-NULL but when the lock wait ends it is sufficient</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"> to only acquire the trx-&gt;mutex.</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment"> To query the state either of the mutexes is sufficient within the locking</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment"> code and no mutex is required when the query thread is no longer waiting. */</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">/** The locks and state of an active transaction.</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">Protected by exclusive lock_sys latch or trx-&gt;mutex combined with shared</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">lock_sys latch (unless stated otherwise for particular field). */</span></div><div class="line"><a name="l00562"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html">  562</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structtrx__lock__t.html">trx_lock_t</a> {</div><div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a8b7f840c1deb4b3322a24bff1a9d11b8">  563</a></span>&#160;  ulint <a class="code" href="structtrx__lock__t.html#a8b7f840c1deb4b3322a24bff1a9d11b8">n_active_thrs</a>; <span class="comment">/*!&lt; number of active query threads */</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a5b5a11c3bcbef8f9f71497710587ba90">  565</a></span>&#160;  <a class="code" href="trx0types_8h.html#a34bba6fbd37f499f7874fc416547759f">trx_que_t</a> <a class="code" href="structtrx__lock__t.html#a5b5a11c3bcbef8f9f71497710587ba90">que_state</a>; <span class="comment">/*!&lt; valid when trx-&gt;state</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">                       == TRX_STATE_ACTIVE: TRX_QUE_RUNNING,</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">                       TRX_QUE_LOCK_WAIT, ... */</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">  /** Incremented each time a lock is added or removed from the</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">  trx-&gt;lock.trx_locks, so that the thread which iterates over the list can spot</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">  a change if it occurred while it was reacquiring latches.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">  Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a59226dd4afa12903c6be80f6588cd9ef">  573</a></span>&#160;  uint64_t <a class="code" href="structtrx__lock__t.html#a59226dd4afa12903c6be80f6588cd9ef">trx_locks_version</a>;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">  /** If this transaction is waiting for a lock, then blocking_trx points to a</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">  transaction which holds a conflicting lock.</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">  It is possible that the transaction has trx-&gt;lock.wait_lock == nullptr, yet it</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">  has non-null value of trx-&gt;lock.blocking_trx. For example this can happen when</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">  we are in the process of moving locks from one heap_no to another. This</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">  however is always done while the lock_sys shards which contain the queues</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">  involved are latched and conceptually it is true that the blocking_trx is</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">  the one for which the transaction waits, even though temporarily there is no</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">  pointer to a particular WAITING lock object.</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">  This field is changed from null to non-null, when holding this-&gt;mutex and</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">  mutex for lock_sys shard containing the new value of trx-&gt;lock.wait_lock.</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">  The field is changed from non-null to different non-null value, while holding</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">  mutex for lock_sys shard containing the trx-&gt;lock.wait_lock.</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">  The field is changed from non-null to null, while holding this-&gt;mutex,</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">  mutex for lock_sys shard containing the old value of trx-&gt;lock.wait_lock,</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">  before it was changed to null.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">  Readers might read it without any latch, but then they should validate the</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">  value, i.e. test if it is not-null, and points to a valid trx.</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">  To make any definite judgments one needs to latch the lock_sys shard</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">  containing the trx-&gt;lock.wait_lock. */</span></div><div class="line"><a name="l00597"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a30ee2ac214b98e29698601177dbf3cd6">  597</a></span>&#160;  std::atomic&lt;trx_t *&gt; <a class="code" href="structtrx__lock__t.html#a30ee2ac214b98e29698601177dbf3cd6">blocking_trx</a>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">  /** The lock request of this transaction is waiting for.</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">  It might be NULL if the transaction is not currently waiting, or if the lock</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">  was temporarily removed during B-tree reorganization and will be recreated in</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">  a different queue. Such move is protected by latching the shards containing</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">  both queues, so the intermediate state should not be observed by readers who</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">  latch the old shard.</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">  Changes from NULL to non-NULL while holding trx-&gt;mutex and latching the shard</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">  containing the new wait_lock value.</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">  Changes from non-NULL to NULL while latching the shard containing the old</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">  wait_lock value.</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">  Never changes from non-NULL to other non-NULL directly.</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">  Readers should hold exclusive global latch on lock_sys, as in general they</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">  can&#39;t know what shard the lock belongs to before reading it.</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">  However, in debug assertions, where we strongly believe to know the value of</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">  this field in advance, we can:</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">  - read without any latch if we believe the value should be NULL</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">  - read latching only the shard containing the wait_lock we expect */</span></div><div class="line"><a name="l00618"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a44bc50f6732e67f6bbd1a1c19f03af6c">  618</a></span>&#160;  std::atomic&lt;lock_t *&gt; <a class="code" href="structtrx__lock__t.html#a44bc50f6732e67f6bbd1a1c19f03af6c">wait_lock</a>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">  /** Stores the type of the most recent lock for which this trx had to wait.</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">  Set to lock_get_type_low(wait_lock) together with wait_lock in</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">  lock_set_lock_and_trx_wait().</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">  This field is not cleared when wait_lock is set to NULL during</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">  lock_reset_lock_and_trx_wait() as in lock_wait_suspend_thread() we are</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">  interested in reporting the last known value of this field via</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">  thd_wait_begin(). When a thread has to wait for a lock, it first releases</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">  lock-sys latch, and then calls lock_wait_suspend_thread() where among other</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">  things it tries to report statistic via thd_wait_begin() about the kind of</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">  lock (THD_WAIT_ROW_LOCK vs THD_WAIT_TABLE_LOCK) that caused the wait. But</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">  there is a possibility that before it gets to call thd_wait_begin() some other</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">  thread could latch lock-sys and grant the lock and call</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">  lock_reset_lock_and_trx_wait(). In other words: in case another thread was</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">  quick enough to grant the lock, we still would like to report the reason for</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">  attempting to sleep.</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">  Another common scenario of &quot;setting trx-&gt;lock.wait_lock to NULL&quot; is page</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">  reorganization: when we have to move records between pages, we also move</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">  locks, and when doing so, we temporarily remove the old waiting lock, and then</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">  add another one. For example look at lock_rec_move_low(). It first calls</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">  lock_reset_lock_and_trx_wait() which changes trx-&gt;lock.wait_lock to NULL, but</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">  then calls lock_rec_add_to_queue() -&gt; RecLock::create() -&gt; RecLock::lock_add()</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">  -&gt; lock_set_lock_and_trx_wait() to set it again to the new lock. This all</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">  happens while holding lock-sys latch, but we read wait_lock_type without this</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">  latch, so we should not clear the wait_lock_type simply because somebody</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">  changed wait_lock to NULL.</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">  Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00646"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#adfe2615dace4086b723bd4646004402c">  646</a></span>&#160;  uint32_t <a class="code" href="structtrx__lock__t.html#adfe2615dace4086b723bd4646004402c">wait_lock_type</a>;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#abe07936c64ae62254ce3e9ac845d0a02">  648</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__lock__t.html#abe07936c64ae62254ce3e9ac845d0a02">was_chosen_as_deadlock_victim</a>;<span class="comment"></span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">  /*!&lt; when the transaction decides to</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">  wait for a lock, it sets this to false;</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">  if another transaction chooses this</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">  transaction as a victim in deadlock</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">  resolution, it sets this to true.</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">  Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">  /** Lock wait started at this time.</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">  Writes under shared lock_sys latch combined with trx-&gt;mutex.</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">  Reads require either trx-&gt;mutex or exclusive lock_sys latch. */</span></div><div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a4ab2bc88e411af161ff3c1e447c30ae4">  659</a></span>&#160;  time_t <a class="code" href="structtrx__lock__t.html#a4ab2bc88e411af161ff3c1e447c30ae4">wait_started</a>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">  /** query thread belonging to this trx that is in QUE_THR_LOCK_WAIT state.</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">  For threads suspended in a lock wait, this is protected by lock_sys latch for</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">  the wait_lock&#39;s shard.</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">  Otherwise, this may only be modified by the thread that is serving the running</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">  transaction.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00667"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#affae4ec9c18be6c1f774472fae0bfbc9">  667</a></span>&#160;  <a class="code" href="structque__thr__t.html">que_thr_t</a> *<a class="code" href="structtrx__lock__t.html#affae4ec9c18be6c1f774472fae0bfbc9">wait_thr</a>;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">  /** Pre-allocated record locks. Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00670"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#ae2ab8b4add0aaff028acf918f8334a9e">  670</a></span>&#160;  lock_pool_t <a class="code" href="structtrx__lock__t.html#ae2ab8b4add0aaff028acf918f8334a9e">rec_pool</a>;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">  /** Pre-allocated table locks. Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00673"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a78ad4c453b000f28a03f561e5d531b14">  673</a></span>&#160;  lock_pool_t <a class="code" href="structtrx__lock__t.html#a78ad4c453b000f28a03f561e5d531b14">table_pool</a>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">  /** Next free record lock in pool. Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00676"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a7ecafab6cff6b97a66367feb5fa0b998">  676</a></span>&#160;  ulint <a class="code" href="structtrx__lock__t.html#a7ecafab6cff6b97a66367feb5fa0b998">rec_cached</a>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">  /** Next free table lock in pool. Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00679"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#afc47115095f89b26d9b3ed0a024d04d9">  679</a></span>&#160;  ulint <a class="code" href="structtrx__lock__t.html#afc47115095f89b26d9b3ed0a024d04d9">table_cached</a>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">  /** Memory heap for trx_locks. Protected by trx-&gt;mutex */</span></div><div class="line"><a name="l00682"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a2b3a26f3c5dc889837e30b8bccd2f572">  682</a></span>&#160;  <a class="code" href="structmem__block__info__t.html">mem_heap_t</a> *<a class="code" href="structtrx__lock__t.html#a2b3a26f3c5dc889837e30b8bccd2f572">lock_heap</a>;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">  /** Locks requested by the transaction.</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">  Modifications are protected by trx-&gt;mutex and shard of lock_sys mutex.</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">  Reads can be performed while holding trx-&gt;mutex or exclusive lock_sys latch.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">  One can also check if this list is empty or not from the thread running this</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">  transaction without holding any latches, keeping in mind that other threads</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">  might modify the list in parallel (for example during implicit-to-explicit</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">  conversion, or when B-tree split or merge causes locks to be moved from one</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">  page to another) - we rely on assumption that such operations do not change</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">  the &quot;emptiness&quot; of the list and that one can check for emptiness in a safe</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">  manner (in current implementation length of the list is stored explicitly so</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">  one can read it without risking unsafe pointer operations) */</span></div><div class="line"><a name="l00695"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a3a4d09bc7b1ab30c068be9c870789a1d">  695</a></span>&#160;  trx_lock_list_t <a class="code" href="structtrx__lock__t.html#a3a4d09bc7b1ab30c068be9c870789a1d">trx_locks</a>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">  /** All table locks requested by this transaction, including AUTOINC locks.</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">  Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00699"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#aba8e3a71adc427f9e6b6d48feb999975">  699</a></span>&#160;  lock_pool_t <a class="code" href="structtrx__lock__t.html#aba8e3a71adc427f9e6b6d48feb999975">table_locks</a>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">  /** AUTOINC locks held by this transaction. Note that these are also in the</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">  lock list trx_locks and table_locks. This vector needs to be freed explicitly</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">  when the trx instance is destroyed.</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">  Protected by trx-&gt;mutex. */</span></div><div class="line"><a name="l00705"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#adb0a194559352f5ee17e901cb23545e2">  705</a></span>&#160;  <a class="code" href="structib__vector__t.html">ib_vector_t</a> *<a class="code" href="structtrx__lock__t.html#adb0a194559352f5ee17e901cb23545e2">autoinc_locks</a>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">  /** Number of rec locks in this trx.</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">  It is modified with shared lock_sys latch.</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">  It is read with exclusive lock_sys latch. */</span></div><div class="line"><a name="l00710"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a282d12e7244c934015d3e515f6cdb0e5">  710</a></span>&#160;  std::atomic&lt;ulint&gt; <a class="code" href="structtrx__lock__t.html#a282d12e7244c934015d3e515f6cdb0e5">n_rec_locks</a>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">  /** Used to indicate that every lock of this transaction placed on a record</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">  which is being purged should be inherited to the gap.</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">  Readers should hold a latch on the lock they&#39;d like to learn about whether or</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">  not it should be inherited.</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">  Writers who want to set it to true, should hold a latch on the lock-sys queue</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">  they intend to add a lock to.</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">  Writers may set it to false at any time. */</span></div><div class="line"><a name="l00719"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a2045b09acdd16afe124784b7505ee6fd">  719</a></span>&#160;  std::atomic&lt;bool&gt; <a class="code" href="structtrx__lock__t.html#a2045b09acdd16afe124784b7505ee6fd">inherit_all</a>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">  /** Weight of the waiting transaction used for scheduling.</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">  The higher the weight the more we are willing to grant a lock to this</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">  transaction.</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">  Values are updated and read without any synchronization beyond that provided</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">  by atomics, as slightly stale values do not hurt correctness, just the</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">  performance. */</span></div><div class="line"><a name="l00727"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a8ef0c5b015cbdab070f3ecd71f4a2ad3">  727</a></span>&#160;  std::atomic&lt;trx_schedule_weight_t&gt; <a class="code" href="structtrx__lock__t.html#a8ef0c5b015cbdab070f3ecd71f4a2ad3">schedule_weight</a>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">  /** When a transaction is forced to rollback due to a deadlock</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">  check or by another high priority transaction this is true. Used</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">  by debug checks in lock0lock.cc */</span></div><div class="line"><a name="l00733"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a5cdbd90ac21c4ea933e01e835dfe27a2">  733</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__lock__t.html#a5cdbd90ac21c4ea933e01e835dfe27a2">in_rollback</a>;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">  /** The transaction called ha_innobase::start_stmt() to</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">  lock a table. Most likely a temporary table. */</span></div><div class="line"><a name="l00738"></a><span class="lineno"><a class="line" href="structtrx__lock__t.html#a2e6d8a21a1999c8c7547dfd353a60483">  738</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__lock__t.html#a2e6d8a21a1999c8c7547dfd353a60483">start_stmt</a>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;};</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">/** Type used to store the list of tables that are modified by a given</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">transaction. We store pointers to the table objects in memory because</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">we know that a table object will not be destroyed while a transaction</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">that modified it is running. */</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="keyword">typedef</span> std::set&lt;dict_table_t *, std::less&lt;dict_table_t *&gt;,</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                 <a class="code" href="classut__allocator.html">ut_allocator&lt;dict_table_t *&gt;</a>&gt;</div><div class="line"><a name="l00747"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#afe5c6b4af5918cfb0725dbde42c65d3b">  747</a></span>&#160;    <a class="code" href="trx0trx_8h.html#afe5c6b4af5918cfb0725dbde42c65d3b">trx_mod_tables_t</a>;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">/** The transaction handle</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">Normally, there is a 1:1 relationship between a transaction handle</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">(trx) and a session (client connection). One session is associated</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">with exactly one user transaction. There are some exceptions to this:</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">* For DDL operations, a subtransaction is allocated that modifies the</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">data dictionary tables. Lock waits and deadlocks are prevented by</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">acquiring the dict_operation_lock before starting the subtransaction</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">and releasing it after committing the subtransaction.</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">* The purge system uses a special transaction that is not associated</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">with any session.</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">* If the system crashed or it was quickly shut down while there were</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">transactions in the ACTIVE or PREPARED state, these transactions would</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">no longer be associated with a session when the server is restarted.</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">A session may be served by at most one thread at a time. The serving</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">thread of a session might change in some MySQL implementations.</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">Therefore we do not have os_thread_get_curr_id() assertions in the code.</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">Normally, only the thread that is currently associated with a running</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">transaction may access (read and modify) the trx object, and it may do</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">so without holding any mutex. The following are exceptions to this:</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">* trx_rollback_resurrected() may access resurrected (connectionless)</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">transactions while the system is already processing new user</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">transactions. The trx_sys-&gt;mutex prevents a race condition between it</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">and lock_trx_release_locks() [invoked by trx_commit()].</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">* Print of transactions may access transactions not associated with</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">the current thread. The caller must be holding trx_sys-&gt;mutex and</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">exclusive global lock_sys latch.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">* When a transaction handle is in the trx_sys-&gt;mysql_trx_list or</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">trx_sys-&gt;trx_list, some of its fields must not be modified without</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">holding trx_sys-&gt;mutex exclusively.</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">* The locking code (in particular, deadlock checking and implicit to</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">explicit conversion) will access transactions associated to other</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">connections. The locks of transactions are protected by lock_sys latches</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">and sometimes by trx-&gt;mutex.</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">* Killing of asynchronous transactions. */</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">/** Represents an instance of rollback segment along with its state variables.*/</span></div><div class="line"><a name="l00796"></a><span class="lineno"><a class="line" href="structtrx__undo__ptr__t.html">  796</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> {<span class="comment"></span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">  /** @return true iff no undo segment is allocated yet. */</span></div><div class="line"><a name="l00798"></a><span class="lineno"><a class="line" href="structtrx__undo__ptr__t.html#aff789791d03c80f21465bf48821caad7">  798</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__undo__ptr__t.html#aff789791d03c80f21465bf48821caad7">is_empty</a>() { <span class="keywordflow">return</span> (insert_undo == <span class="keyword">nullptr</span> &amp;&amp; update_undo == <span class="keyword">nullptr</span>); }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">  /** @return true iff only insert undo segment is allocated. */</span></div><div class="line"><a name="l00801"></a><span class="lineno"><a class="line" href="structtrx__undo__ptr__t.html#a522c5bd7a276be36b1c5e36299c4d4c7">  801</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__undo__ptr__t.html#a522c5bd7a276be36b1c5e36299c4d4c7">is_insert_only</a>() {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">return</span> (insert_undo != <span class="keyword">nullptr</span> &amp;&amp; update_undo == <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno"><a class="line" href="structtrx__undo__ptr__t.html#ab0da0621a5c40ca1d8883352a204ac1c">  805</a></span>&#160;  <a class="code" href="structtrx__rseg__t.html">trx_rseg_t</a> *<a class="code" href="structtrx__undo__ptr__t.html#ab0da0621a5c40ca1d8883352a204ac1c">rseg</a>;        <span class="comment">/*!&lt; rollback segment assigned to the</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">                           transaction, or NULL if not assigned</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">                           yet */</span></div><div class="line"><a name="l00808"></a><span class="lineno"><a class="line" href="structtrx__undo__ptr__t.html#a530652272d927e8db448caec5578f2a0">  808</a></span>&#160;  <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="structtrx__undo__ptr__t.html#a530652272d927e8db448caec5578f2a0">insert_undo</a>; <span class="comment">/*!&lt; pointer to the insert undo log, or</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">                           NULL if no inserts performed yet */</span></div><div class="line"><a name="l00810"></a><span class="lineno"><a class="line" href="structtrx__undo__ptr__t.html#a72820a898bd5e339ecd05f94156aeed0">  810</a></span>&#160;  <a class="code" href="structtrx__undo__t.html">trx_undo_t</a> *<a class="code" href="structtrx__undo__ptr__t.html#a72820a898bd5e339ecd05f94156aeed0">update_undo</a>; <span class="comment">/*!&lt; pointer to the update undo log, or</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">                           NULL if no update performed yet */</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;};</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">/** Rollback segments assigned to a transaction for undo logging. */</span></div><div class="line"><a name="l00815"></a><span class="lineno"><a class="line" href="structtrx__rsegs__t.html">  815</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structtrx__rsegs__t.html">trx_rsegs_t</a> {<span class="comment"></span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">  /** undo log ptr holding reference to a rollback segment that resides in</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">  system/undo tablespace used for undo logging of tables that needs</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">  to be recovered on crash. */</span></div><div class="line"><a name="l00819"></a><span class="lineno"><a class="line" href="structtrx__rsegs__t.html#a4abdf5295c90071b307d6800c22767c4">  819</a></span>&#160;  <a class="code" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> <a class="code" href="structtrx__rsegs__t.html#a4abdf5295c90071b307d6800c22767c4">m_redo</a>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">  /** undo log ptr holding reference to a rollback segment that resides in</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment">  temp tablespace used for undo logging of tables that doesn&#39;t need</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">  to be recovered on crash. */</span></div><div class="line"><a name="l00824"></a><span class="lineno"><a class="line" href="structtrx__rsegs__t.html#a0aae8ec577276dafc1b8733e527beea7">  824</a></span>&#160;  <a class="code" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> <a class="code" href="structtrx__rsegs__t.html#a0aae8ec577276dafc1b8733e527beea7">m_noredo</a>;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;};</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ad">  827</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ad">trx_rseg_type_t</a> {</div><div class="line"><a name="l00828"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ada5c185d046ad70533f17062eef4eaa413">  828</a></span>&#160;  <a class="code" href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ada5c185d046ad70533f17062eef4eaa413">TRX_RSEG_TYPE_NONE</a> = 0, <span class="comment">/*!&lt; void rollback segment type. */</span></div><div class="line"><a name="l00829"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7adac8063fb269c9aa562acaf56267ddc56e">  829</a></span>&#160;  <a class="code" href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7adac8063fb269c9aa562acaf56267ddc56e">TRX_RSEG_TYPE_REDO</a>,     <span class="comment">/*!&lt; redo rollback segment. */</span></div><div class="line"><a name="l00830"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ada8db8b9302c6ad8af2abba7588ddc65e8">  830</a></span>&#160;  <a class="code" href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ada8db8b9302c6ad8af2abba7588ddc65e8">TRX_RSEG_TYPE_NOREDO</a>    <span class="comment">/*!&lt; non-redo rollback segment. */</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;};</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno"><a class="line" href="structtrx__t.html">  833</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structtrx__t.html">trx_t</a> {</div><div class="line"><a name="l00834"></a><span class="lineno"><a class="line" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38c">  834</a></span>&#160;  <span class="keyword">enum</span> <a class="code" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38c">isolation_level_t</a> {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">    /** dirty read: non-locking SELECTs are performed so that we</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">    do not look at a possible earlier version of a record; thus</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">    they are not &#39;consistent&#39; reads under this isolation level;</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">    otherwise like level 2 */</span></div><div class="line"><a name="l00840"></a><span class="lineno"><a class="line" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38caf03f2a86cf3d23a65c93aff89fd26d36">  840</a></span>&#160;    <a class="code" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38caf03f2a86cf3d23a65c93aff89fd26d36">READ_UNCOMMITTED</a>,</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">    /** somewhat Oracle-like isolation, except that in range UPDATE</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">    and DELETE we must block phantom rows with next-key locks;</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">    SELECT ... FOR UPDATE and ...  LOCK IN SHARE MODE only lock</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">    the index records, NOT the gaps before them, and thus allow</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">    free inserting; each consistent read reads its own snapshot */</span></div><div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38ca7a293644531f3b2913bc427939620d0a">  847</a></span>&#160;    <a class="code" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38ca7a293644531f3b2913bc427939620d0a">READ_COMMITTED</a>,</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">    /** this is the default; all consistent reads in the same trx</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">    read the same snapshot; full next-key locking used in locking</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">    reads to block insertions into gaps */</span></div><div class="line"><a name="l00852"></a><span class="lineno"><a class="line" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38ca3bb1d2ea4d41428c2f8a2388e8ea0a77">  852</a></span>&#160;    <a class="code" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38ca3bb1d2ea4d41428c2f8a2388e8ea0a77">REPEATABLE_READ</a>,</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">    /** all plain SELECTs are converted to LOCK IN SHARE MODE</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">    reads */</span></div><div class="line"><a name="l00856"></a><span class="lineno"><a class="line" href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38caecb18c711dc933dc20df1ceabb71737b">  856</a></span>&#160;    SERIALIZABLE</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  };</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">  /** Mutex protecting the fields `state` and `lock` (except some fields of</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">  `lock`,  which are protected by lock_sys latches) */</span></div><div class="line"><a name="l00861"></a><span class="lineno"><a class="line" href="structtrx__t.html#a48e4b784a6c02168e4d30ae329d4261d">  861</a></span>&#160;  <span class="keyword">mutable</span> <a class="code" href="trx0types_8h.html#a044545240fb71e3a64171596e66e0336">TrxMutex</a> <a class="code" href="structtrx__t.html#a48e4b784a6c02168e4d30ae329d4261d">mutex</a>;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="comment">/* Note: in_depth was split from in_innodb for fixing a RO</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">  performance issue. Acquiring the trx_t::mutex for each row</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">  costs ~3% in performance. It is not required for correctness.</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">  Therefore we increment/decrement in_depth without holding any</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment">  mutex. The assumption is that the Server will only ever call</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">  the handler from one thread. This is not true for kill_connection.</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">  Therefore in innobase_kill_connection. We don&#39;t increment this</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">  counter via TrxInInnoDB. */</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno"><a class="line" href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">  872</a></span>&#160;  ib_uint32_t <a class="code" href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">in_depth</a>; <span class="comment">/*!&lt; Track nested TrxInInnoDB</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">                        count */</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno"><a class="line" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">  875</a></span>&#160;  ib_uint32_t <a class="code" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">in_innodb</a>; <span class="comment">/*!&lt; if the thread is executing</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">                         in the InnoDB context count &gt; 0. */</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno"><a class="line" href="structtrx__t.html#ad26749c886fb7a6e27c6d3128455cb22">  878</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#ad26749c886fb7a6e27c6d3128455cb22">abort</a>; <span class="comment">/*!&lt; if this flag is set then</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">              this transaction must abort when</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">              it can */</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno"><a class="line" href="structtrx__t.html#ac338a1e2873f7bdd52ac2d9929946ed9">  882</a></span>&#160;  <a class="code" href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a> <a class="code" href="structtrx__t.html#ac338a1e2873f7bdd52ac2d9929946ed9">id</a>; <span class="comment">/*!&lt; transaction id */</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno"><a class="line" href="structtrx__t.html#ae402b5cd189094a817150f921246ad13">  884</a></span>&#160;  <a class="code" href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a> <a class="code" href="structtrx__t.html#ae402b5cd189094a817150f921246ad13">no</a>; <span class="comment">/*!&lt; transaction serialization number:</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">               max trx id shortly before the</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">               transaction is moved to</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">               COMMITTED_IN_MEMORY state.</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">               Protected by trx_sys_t::mutex</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">               when trx-&gt;in_rw_trx_list. Initially</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">               set to TRX_ID_MAX. */</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">  /** State of the trx from the point of view of concurrency control</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">  and the valid state transitions.</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">  Possible states:</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">  TRX_STATE_NOT_STARTED</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">  TRX_STATE_FORCED_ROLLBACK</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">  TRX_STATE_ACTIVE</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">  TRX_STATE_PREPARED</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">  TRX_STATE_COMMITTED_IN_MEMORY (alias below COMMITTED)</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">  Valid state transitions are:</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">  Regular transactions:</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">  * NOT_STARTED -&gt; ACTIVE -&gt; COMMITTED -&gt; NOT_STARTED</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">  Auto-commit non-locking read-only:</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">  * NOT_STARTED -&gt; ACTIVE -&gt; NOT_STARTED</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">  XA (2PC):</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">  * NOT_STARTED -&gt; ACTIVE -&gt; PREPARED -&gt; COMMITTED -&gt; NOT_STARTED</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">  Recovered XA:</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">  * NOT_STARTED -&gt; PREPARED -&gt; COMMITTED -&gt; (freed)</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">  XA (2PC) (shutdown or disconnect before ROLLBACK or COMMIT):</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">  * NOT_STARTED -&gt; PREPARED -&gt; (freed)</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">  Disconnected XA can become recovered:</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">  * ... -&gt; ACTIVE -&gt; PREPARED (connected) -&gt; PREPARED (disconnected)</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">  Disconnected means from mysql e.g due to the mysql client disconnection.</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">  Latching and various transaction lists membership rules:</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">  XA (2PC) transactions are always treated as non-autocommit.</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">  Transitions to ACTIVE or NOT_STARTED occur when</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">  !in_rw_trx_list (no trx_sys-&gt;mutex needed).</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">  Autocommit non-locking read-only transactions move between states</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">  without holding any mutex. They are !in_rw_trx_list.</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">  All transactions, unless they are determined to be ac-nl-ro,</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">  explicitly tagged as read-only or read-write, will first be put</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">  on the read-only transaction list. Only when a !read-only transaction</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">  in the read-only list tries to acquire an X or IX lock on a table</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">  do we remove it from the read-only list and put it on the read-write</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">  list. During this switch we assign it a rollback segment.</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">  When a transaction is NOT_STARTED, it can be in_mysql_trx_list if</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">  it is a user transaction. It cannot be in rw_trx_list.</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">  ACTIVE-&gt;PREPARED-&gt;COMMITTED is only possible when trx-&gt;in_rw_trx_list.</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">  The transition ACTIVE-&gt;PREPARED is protected by trx_sys-&gt;mutex.</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">  ACTIVE-&gt;COMMITTED is possible when the transaction is in</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">  rw_trx_list.</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">  Transitions to COMMITTED are protected by trx-&gt;mutex.</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">  NOTE: Some of these state change constraints are an overkill,</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">  currently only required for a consistent view for printing stats.</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">  This unnecessarily adds a huge cost for the general case. */</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno"><a class="line" href="structtrx__t.html#a5d0ace463c8eb18ed152f9400395a308">  955</a></span>&#160;  <a class="code" href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfe">trx_state_t</a> <a class="code" href="structtrx__t.html#a5d0ace463c8eb18ed152f9400395a308">state</a>;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">/* If set, this transaction should stop inheriting (GAP)locks.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">  Generally set to true during transaction prepare for RC or lower</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">  isolation, if requested. Needed for replication replay where</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">  we don&#39;t want to get blocked on GAP locks taken for protecting</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">  concurrent unique insert or replace operation. */</span></div><div class="line"><a name="l00962"></a><span class="lineno"><a class="line" href="structtrx__t.html#a7da3d2f24253f195c51d92f114925c92">  962</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#a7da3d2f24253f195c51d92f114925c92">skip_lock_inheritance</a>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno"><a class="line" href="structtrx__t.html#ae500ddb754125146585f483602bd2f9d">  964</a></span>&#160;  <a class="code" href="classReadView.html">ReadView</a> *<a class="code" href="structtrx__t.html#ae500ddb754125146585f483602bd2f9d">read_view</a>; <span class="comment">/*!&lt; consistent read view used in the</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">                       transaction, or NULL if not yet set */</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <a class="code" href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a>(<a class="code" href="structtrx__t.html">trx_t</a>)</div><div class="line"><a name="l00968"></a><span class="lineno"><a class="line" href="structtrx__t.html#ae38bd97c08bf373dfd6ba0228f643407">  968</a></span>&#160;  trx_list; <span class="comment">/*!&lt; list of transactions;</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">            protected by trx_sys-&gt;mutex. */</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <a class="code" href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a>(<a class="code" href="structtrx__t.html">trx_t</a>)</div><div class="line"><a name="l00971"></a><span class="lineno"><a class="line" href="structtrx__t.html#a2668b027c114fb2205273950c313b293">  971</a></span>&#160;  no_list; <span class="comment">/*!&lt; Required during view creation</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">           to check for the view limit for</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">           transactions that are committing */</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">  /** Information about the transaction locks and state.</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">  Protected by trx-&gt;mutex or lock_sys latches or both */</span></div><div class="line"><a name="l00977"></a><span class="lineno"><a class="line" href="structtrx__t.html#af30d46c475f9c53eb258989c6acdfef6">  977</a></span>&#160;  <a class="code" href="structtrx__lock__t.html">trx_lock_t</a> lock;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno"><a class="line" href="structtrx__t.html#a0bc6b32fe4b1c1f1ad233d38a3135d26">  979</a></span>&#160;  <span class="keywordtype">bool</span> is_recovered; <span class="comment">/*!&lt; 0=normal transaction,</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">                     1=recovered, must be rolled back,</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">                     protected by trx_sys-&gt;mutex when</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">                     trx-&gt;in_rw_trx_list holds */</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno"><a class="line" href="structtrx__t.html#af0676fde714c596cdf94e5d02e0a7fb9">  984</a></span>&#160;  <a class="code" href="os0thread_8h.html#ab8ad022ed5dafb1f9defb66ac1b6a62a">os_thread_id_t</a> killed_by; <span class="comment">/*!&lt; The thread ID that wants to</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">                            kill this transaction asynchronously.</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">                            This is required because we recursively</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">                            enter the handlerton methods and need</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">                            to distinguish between the kill thread</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">                            and the transaction thread.</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">                            Note: We need to be careful w.r.t the</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">                            Thread Pool. The thread doing the kill</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">                            should not leave InnoDB between the</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">                            mark and the actual async kill because</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">                            the running thread can change. */</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">/* These fields are not protected by any mutex. */</span></div><div class="line"><a name="l00998"></a><span class="lineno"><a class="line" href="structtrx__t.html#a023389350da41bea69078545e494655c">  998</a></span>&#160;  const <span class="keywordtype">char</span> *op_info;   <span class="comment">/*!&lt; English text describing the</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">                         current operation, or an empty</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">                         string */</span></div><div class="line"><a name="l01001"></a><span class="lineno"><a class="line" href="structtrx__t.html#a031c9cbd7de217c5ffb61294833a819e"> 1001</a></span>&#160;  ulint isolation_level; <span class="comment">/*!&lt; TRX_ISO_REPEATABLE_READ, ... */</span></div><div class="line"><a name="l01002"></a><span class="lineno"><a class="line" href="structtrx__t.html#adeb5f63a3c8bfdb9297b9fd9b9afb929"> 1002</a></span>&#160;  <span class="keywordtype">bool</span> check_foreigns;   <span class="comment">/*!&lt; normally TRUE, but if the user</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">                         wants to suppress foreign key checks,</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">                         (in table imports, for example) we</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">                         set this FALSE */</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">/* MySQL has a transaction coordinator to coordinate two phase</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">  commit between multiple storage engines and the binary log. When</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">  an engine participates in a transaction, it&#39;s responsible for</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">  registering itself using the trans_register_ha() API. */</span></div><div class="line"><a name="l01011"></a><span class="lineno"><a class="line" href="structtrx__t.html#a9d7ad9f43f2df4de8d53cc9154da149c"> 1011</a></span>&#160;  <span class="keywordtype">bool</span> is_registered; <span class="comment">/* This flag is set to true after the</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">                      transaction has been registered with</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">                      the coordinator using the XA API, and</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">                      is set to false  after commit or</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">                      rollback. */</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01017"></a><span class="lineno"><a class="line" href="structtrx__t.html#ab5aad4fc0dec77810698edf7559df960"> 1017</a></span>&#160;  <span class="keywordtype">bool</span> check_unique_secondary;<span class="comment"></span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">  /*!&lt; normally TRUE, but if the user</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">  wants to speed up inserts by</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">  suppressing unique key checks</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">  for secondary indexes when we decide</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">  if we can use the insert buffer for</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">  them, we set this FALSE */</span></div><div class="line"><a name="l01024"></a><span class="lineno"><a class="line" href="structtrx__t.html#a260fbf627f61f5543f047007d0694947"> 1024</a></span>&#160;  <span class="keywordtype">bool</span> flush_log_later;      <span class="comment">/* In 2PC, we hold the</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">                             prepare_commit mutex across</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">                             both phases. In that case, we</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">                             defer flush of the logs to disk</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">                             until after we release the</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">                             mutex. */</span></div><div class="line"><a name="l01030"></a><span class="lineno"><a class="line" href="structtrx__t.html#a1b7625f06e3c5c73318f0c7d835be698"> 1030</a></span>&#160;  <span class="keywordtype">bool</span> must_flush_log_later; <span class="comment">/*!&lt; this flag is set to TRUE in</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">                        trx_commit() if flush_log_later was</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">                        TRUE, and there were modifications by</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">                        the transaction; in that case we must</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">                        flush the log in</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">                        trx_commit_complete_for_mysql() */</span></div><div class="line"><a name="l01036"></a><span class="lineno"><a class="line" href="structtrx__t.html#aef5fcd8b67cfa68207396f3ac7da093c"> 1036</a></span>&#160;  <span class="keywordtype">bool</span> has_search_latch;<span class="comment"></span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">  /*!&lt; TRUE if this trx has latched the</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">  search system latch in S-mode.</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">  This now can only be true in</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">  row_search_mvcc, the btr search latch</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">  must has been released before exiting,</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">  and this flag would be set to false */</span></div><div class="line"><a name="l01043"></a><span class="lineno"><a class="line" href="structtrx__t.html#a2e030f01e44726f7ae3049c77f4c07e8"> 1043</a></span>&#160;  <a class="code" href="trx0types_8h.html#af79319b3cdfff988f01995fa51880599">trx_dict_op_t</a> dict_operation; <span class="comment">/**&lt; @see enum trx_dict_op_t */</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"><a class="line" href="structtrx__t.html#af7f7a15e4b5594437e05b38ee7f2cbe2"> 1045</a></span>&#160;  <span class="keywordtype">bool</span> ddl_operation;  <span class="comment">/*!&lt; True if this trx involves dd table</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">                        change */</span></div><div class="line"><a name="l01047"></a><span class="lineno"><a class="line" href="structtrx__t.html#a93a1e90cd3490a8598bded2182be2c0f"> 1047</a></span>&#160;  <span class="keywordtype">bool</span> ddl_must_flush; <span class="comment">/*!&lt; True if this trx involves dd table</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">                       change, and must flush */</span></div><div class="line"><a name="l01049"></a><span class="lineno"><a class="line" href="structtrx__t.html#ad3865cd233fa693851c19bfa6254b640"> 1049</a></span>&#160;  <span class="keywordtype">bool</span> in_truncate;    <span class="comment">/* This trx is doing truncation */</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="comment">/* Fields protected by the srv_conc_mutex. */</span></div><div class="line"><a name="l01052"></a><span class="lineno"><a class="line" href="structtrx__t.html#ad7b240f8de5eb6e48990f790d9a3b5f0"> 1052</a></span>&#160;  <span class="keywordtype">bool</span> declared_to_be_inside_innodb;<span class="comment"></span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">  /*!&lt; this is TRUE if we have declared</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">  this transaction in</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">  srv_conc_enter_innodb to be inside the</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">  InnoDB engine */</span></div><div class="line"><a name="l01057"></a><span class="lineno"><a class="line" href="structtrx__t.html#abbe96e1167c1c6568ba51291eb852c7d"> 1057</a></span>&#160;  ib_uint32_t n_tickets_to_enter_innodb;<span class="comment"></span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">  /*!&lt; this can be &gt; 0 only when</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">  declared_to_... is TRUE; when we come</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">  to srv_conc_innodb_enter, if the value</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">  here is &gt; 0, we decrement this by 1 */</span></div><div class="line"><a name="l01062"></a><span class="lineno"><a class="line" href="structtrx__t.html#a796d4e3a7196bf907844316e7ee3ae43"> 1062</a></span>&#160;  ib_uint32_t dict_operation_lock_mode;<span class="comment"></span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">  /*!&lt; 0, RW_S_LATCH, or RW_X_LATCH:</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">  the latch mode trx currently holds</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">  on dict_operation_lock. Protected</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">  by dict_operation_lock. */</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"><a class="line" href="structtrx__t.html#a184ca1bd5d1d1b627567dd41def4fdf6"> 1068</a></span>&#160;  time_t start_time; <span class="comment">/*!&lt; time the state last time became</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">                     TRX_STATE_ACTIVE */</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"><a class="line" href="structtrx__t.html#ab28ecf315b8371f05688c0da4756ad56"> 1071</a></span>&#160;  <a class="code" href="log0types_8h.html#aa7401e3081ffb8ee7e8fb182647f475c">lsn_t</a> commit_lsn; <span class="comment">/*!&lt; lsn at the time of the commit */</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01074"></a><span class="lineno"><a class="line" href="structtrx__t.html#a32585bbb70013a866ce34d8962d9745b"> 1074</a></span>&#160;  <a class="code" href="classTHD.html">THD</a> *mysql_thd; <span class="comment">/*!&lt; MySQL thread handle corresponding</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">                  to this trx, or NULL */</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"><a class="line" href="structtrx__t.html#a4cd491491a8ecbd5b4d763cc84b7ca74"> 1077</a></span>&#160;  const <span class="keywordtype">char</span> *mysql_log_file_name;<span class="comment"></span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">  /*!&lt; if MySQL binlog is used, this field</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">  contains a pointer to the latest file</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">  name; this is NULL if binlog is not</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">  used */</span></div><div class="line"><a name="l01082"></a><span class="lineno"><a class="line" href="structtrx__t.html#aa647d1d20ff5d954494a7f9c89afb2b9"> 1082</a></span>&#160;  uint64_t mysql_log_offset;<span class="comment"></span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">  /*!&lt; if MySQL binlog is used, this</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">  field contains the end offset of the</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">  binlog entry */</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01087"></a><span class="lineno"><a class="line" href="structtrx__t.html#a433196a85d8389677670d1bca3be53ba"> 1087</a></span>&#160;  ib_uint32_t n_mysql_tables_in_use; <span class="comment">/*!&lt; number of Innobase tables</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">                              used in the processing of the current</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">                              SQL statement in MySQL */</span></div><div class="line"><a name="l01090"></a><span class="lineno"><a class="line" href="structtrx__t.html#a0ed6130cc3d3f61e89dfceb7fe821b10"> 1090</a></span>&#160;  ib_uint32_t mysql_n_tables_locked;<span class="comment"></span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">  /*!&lt; how many tables the current SQL</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">  statement uses, except those</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">  in consistent read */</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">  /** The following two fields are mutually exclusive. */</span><span class="comment"></span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment">  /** @{ */</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"><a class="line" href="structtrx__t.html#acde29ab21d858c09fd96e3e49e0aa7be"> 1099</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#acde29ab21d858c09fd96e3e49e0aa7be">in_rw_trx_list</a>; <span class="comment">/*!&lt; true if in trx_sys-&gt;rw_trx_list */</span><span class="comment"></span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">                       /** @} */</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="preprocessor">#endif                 </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <a class="code" href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a>(<a class="code" href="structtrx__t.html">trx_t</a>)</div><div class="line"><a name="l01103"></a><span class="lineno"><a class="line" href="structtrx__t.html#afecad8a5e7c3b16fef95cfc1e5484e4b"> 1103</a></span>&#160;  mysql_trx_list; <span class="comment">/*!&lt; list of transactions created for</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">                  MySQL; protected by trx_sys-&gt;mutex */</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l01106"></a><span class="lineno"><a class="line" href="structtrx__t.html#a6a3af5f2bb3c013cf0be87f00acb33c5"> 1106</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#a6a3af5f2bb3c013cf0be87f00acb33c5">in_mysql_trx_list</a>;<span class="comment"></span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">  /*!&lt; true if in</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">  trx_sys-&gt;mysql_trx_list */</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01111"></a><span class="lineno"><a class="line" href="structtrx__t.html#ae2412d7b54b8f8c98a0ae6195d37779c"> 1111</a></span>&#160;  <a class="code" href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a> <a class="code" href="structtrx__t.html#ae2412d7b54b8f8c98a0ae6195d37779c">error_state</a>;             <span class="comment">/*!&lt; 0 if no error, otherwise error</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">                                   number; NOTE That ONLY the thread</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">                                   doing the transaction is allowed to</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">                                   set this field: this is NOT protected</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">                                   by any mutex */</span></div><div class="line"><a name="l01116"></a><span class="lineno"><a class="line" href="structtrx__t.html#abde7eaeb327d25c61dd2381ad9b24e69"> 1116</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="structtrx__t.html#abde7eaeb327d25c61dd2381ad9b24e69">error_index</a>; <span class="comment">/*!&lt; if the error number indicates a</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">                                   duplicate key error, a pointer to</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">                                   the problematic index is stored here */</span></div><div class="line"><a name="l01119"></a><span class="lineno"><a class="line" href="structtrx__t.html#afaad1dded74040c39906bc5421d15320"> 1119</a></span>&#160;  ulint <a class="code" href="structtrx__t.html#afaad1dded74040c39906bc5421d15320">error_key_num</a>;             <span class="comment">/*!&lt; if the index creation fails to a</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">                                   duplicate key error, a mysql key</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">                                   number of that index is stored here */</span></div><div class="line"><a name="l01122"></a><span class="lineno"><a class="line" href="structtrx__t.html#aea1d5a0e80d35afbdadedd59d9bafe16"> 1122</a></span>&#160;  <a class="code" href="structsess__t.html">sess_t</a> *<a class="code" href="structtrx__t.html#aea1d5a0e80d35afbdadedd59d9bafe16">sess</a>;                    <span class="comment">/*!&lt; session of the trx, NULL if none */</span></div><div class="line"><a name="l01123"></a><span class="lineno"><a class="line" href="structtrx__t.html#a457f9022ae67faf4b8034828367eaa83"> 1123</a></span>&#160;  <a class="code" href="structque__fork__t.html">que_t</a> *<a class="code" href="structtrx__t.html#a457f9022ae67faf4b8034828367eaa83">graph</a>;                    <span class="comment">/*!&lt; query currently run in the session,</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">                                   or NULL if none; NOTE that the query</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">                                   belongs to the session, and it can</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">                                   survive over a transaction commit, if</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">                                   it is a stored procedure with a COMMIT</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">                                   WORK statement, for instance */</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <a class="code" href="innodb__utility_8h.html#af8087cee2d41561b30b9d1903cebfb3d">UT_LIST_BASE_NODE_T</a>(<a class="code" href="structtrx__named__savept__t.html">trx_named_savept_t</a>)</div><div class="line"><a name="l01131"></a><span class="lineno"><a class="line" href="structtrx__t.html#acb8c227dceb06472cf309b9027a6cd85"> 1131</a></span>&#160;  trx_savepoints; <span class="comment">/*!&lt; savepoints set with SAVEPOINT ...,</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">                  oldest first */</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01134"></a><span class="lineno"><a class="line" href="structtrx__t.html#aef39610ccabcd974dead1c58a2e7dd50"> 1134</a></span>&#160;  <a class="code" href="trx0types_8h.html#ac731378a2d6ecb952f6cfe4e093568e8">UndoMutex</a> undo_mutex; <span class="comment">/*!&lt; mutex protecting the fields in this</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">                        section (down to undo_no_arr), EXCEPT</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">                        last_sql_stat_start, which can be</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">                        accessed only when we know that there</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">                        cannot be any activity in the undo</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">                        logs! */</span></div><div class="line"><a name="l01140"></a><span class="lineno"><a class="line" href="structtrx__t.html#a392f340e0e9a4559f562d77e7bcf545e"> 1140</a></span>&#160;  <a class="code" href="trx0types_8h.html#a4661d2883c1cd5d8f1cfbd63b553f1bc">undo_no_t</a> undo_no;    <span class="comment">/*!&lt; next undo log record number to</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">                        assign; since the undo log is</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">                        private for a transaction, this</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">                        is a simple ascending sequence</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">                        with no gaps; thus it represents</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">                        the number of modified/inserted</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">                        rows in a transaction */</span></div><div class="line"><a name="l01147"></a><span class="lineno"><a class="line" href="structtrx__t.html#a056032923428da154c33e805c401041e"> 1147</a></span>&#160;  <a class="code" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> undo_rseg_space;<span class="comment"></span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">  /*!&lt; space id where last undo record</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">  was written */</span></div><div class="line"><a name="l01150"></a><span class="lineno"><a class="line" href="structtrx__t.html#abea5f0bd641a682d22adf945256e7c09"> 1150</a></span>&#160;  <a class="code" href="structtrx__savept__t.html">trx_savept_t</a> last_sql_stat_start;<span class="comment"></span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">  /*!&lt; undo_no when the last sql statement</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">  was started: in case of an error, trx</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">  is rolled back down to this undo</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">  number; see note at undo_mutex! */</span></div><div class="line"><a name="l01155"></a><span class="lineno"><a class="line" href="structtrx__t.html#a9b18f6c40e2ec7f28c32a9a365310982"> 1155</a></span>&#160;  <a class="code" href="structtrx__rsegs__t.html">trx_rsegs_t</a> rsegs;    <span class="comment">/* rollback segments for undo logging */</span></div><div class="line"><a name="l01156"></a><span class="lineno"><a class="line" href="structtrx__t.html#a95e1d10148105b191eb0f006d2746111"> 1156</a></span>&#160;  <a class="code" href="trx0types_8h.html#a4661d2883c1cd5d8f1cfbd63b553f1bc">undo_no_t</a> roll_limit; <span class="comment">/*!&lt; least undo number to undo during</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">                        a partial rollback; 0 otherwise */</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l01159"></a><span class="lineno"><a class="line" href="structtrx__t.html#aedd7de301a2ebe1aca6e724379786cd6"> 1159</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#aedd7de301a2ebe1aca6e724379786cd6">in_rollback</a>;   <span class="comment">/*!&lt; true when the transaction is</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">                      executing a partial or full rollback */</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="preprocessor">#endif                </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01162"></a><span class="lineno"><a class="line" href="structtrx__t.html#a7fc2b40c5715569716756de6471f2dee"> 1162</a></span>&#160;  ulint <a class="code" href="structtrx__t.html#a7fc2b40c5715569716756de6471f2dee">pages_undone</a>; <span class="comment">/*!&lt; number of undo log pages undone</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">                      since the last undo log truncation */</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01165"></a><span class="lineno"><a class="line" href="structtrx__t.html#a15709656eb05fd1d83aba4f7442eca0b"> 1165</a></span>&#160;  ulint <a class="code" href="structtrx__t.html#a15709656eb05fd1d83aba4f7442eca0b">n_autoinc_rows</a>; <span class="comment">/*!&lt; no. of AUTO-INC rows required for</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">                        an SQL statement. This is useful for</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">                        multi-row INSERTs */</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01169"></a><span class="lineno"><a class="line" href="structtrx__t.html#ac35e25ceef180540ee22769c1a06c4d1"> 1169</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#ac35e25ceef180540ee22769c1a06c4d1">read_only</a>;        <span class="comment">/*!&lt; true if transaction is flagged</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">                         as a READ-ONLY transaction.</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">                         if auto_commit &amp;&amp; will_lock == 0</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">                         then it will be handled as a</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">                         AC-NL-RO-SELECT (Auto Commit Non-Locking</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">                         Read Only Select). A read only</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">                         transaction will not be assigned an</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">                         UNDO log. */</span></div><div class="line"><a name="l01177"></a><span class="lineno"><a class="line" href="structtrx__t.html#a5c2f836e619c3197a2c59a440a624198"> 1177</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#a5c2f836e619c3197a2c59a440a624198">auto_commit</a>;      <span class="comment">/*!&lt; true if it is an autocommit */</span></div><div class="line"><a name="l01178"></a><span class="lineno"><a class="line" href="structtrx__t.html#a08f3c6c1bece8285dd86d00c6379c9d0"> 1178</a></span>&#160;  ib_uint32_t <a class="code" href="structtrx__t.html#a08f3c6c1bece8285dd86d00c6379c9d0">will_lock</a>; <span class="comment">/*!&lt; Will acquire some locks. Increment</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">                         each time we determine that a lock will</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">                         be acquired by the MySQL layer. */</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01183"></a><span class="lineno"><a class="line" href="structtrx__t.html#a382fc29c69cb04b73b4dfc2200237709"> 1183</a></span>&#160;  <a class="code" href="structfts__trx__t.html">fts_trx_t</a> *<a class="code" href="structtrx__t.html#a382fc29c69cb04b73b4dfc2200237709">fts_trx</a>;       <span class="comment">/*!&lt; FTS information, or NULL if</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">                            transaction hasn&#39;t modified tables</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">                            with FTS indexes (yet). */</span></div><div class="line"><a name="l01186"></a><span class="lineno"><a class="line" href="structtrx__t.html#a4bb27b88bf50850a7d8da80086fa425b"> 1186</a></span>&#160;  <a class="code" href="fts0fts_8h.html#a380910af8d69503a3e3dcbf6d809a3b6">doc_id_t</a> <a class="code" href="structtrx__t.html#a4bb27b88bf50850a7d8da80086fa425b">fts_next_doc_id</a>; <span class="comment">/* The document id used for updates */</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01188"></a><span class="lineno"><a class="line" href="structtrx__t.html#a19f3ba5572d4482d21db02baad2b0d97"> 1188</a></span>&#160;  ib_uint32_t <a class="code" href="structtrx__t.html#a19f3ba5572d4482d21db02baad2b0d97">flush_tables</a>; <span class="comment">/*!&lt; if &quot;covering&quot; the FLUSH TABLES&quot;,</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">                            count of tables being flushed. */</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01192"></a><span class="lineno"><a class="line" href="structtrx__t.html#a5cf397c07f08cf25ae651ddfb4c23a85"> 1192</a></span>&#160;  <span class="keywordtype">bool</span> <span class="keyword">internal</span>; <span class="comment">/*!&lt; true if it is a system/internal</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">                 transaction background task. Such</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment">                 transactions are always treated as</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment">                 read-write. */</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                 <span class="comment">/*------------------------------*/</span><span class="comment"></span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">  /** Transaction persists GTID. */</span></div><div class="line"><a name="l01198"></a><span class="lineno"><a class="line" href="structtrx__t.html#ae1c5ba51f5d0506b2d4bab3d3e293e1a"> 1198</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#ae1c5ba51f5d0506b2d4bab3d3e293e1a">persists_gtid</a>;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l01201"></a><span class="lineno"><a class="line" href="structtrx__t.html#a3f3e4d250ee898561beef24a088b2911"> 1201</a></span>&#160;  ulint <a class="code" href="structtrx__t.html#a3f3e4d250ee898561beef24a088b2911">start_line</a>;       <span class="comment">/*!&lt; Track where it was started from */</span></div><div class="line"><a name="l01202"></a><span class="lineno"><a class="line" href="structtrx__t.html#aacee494a37d619509b24a4cf07db7656"> 1202</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structtrx__t.html#aacee494a37d619509b24a4cf07db7656">start_file</a>; <span class="comment">/*!&lt; Filename where it was started */</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="preprocessor">#endif                    </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"><a class="line" href="structtrx__t.html#a4dd9f2898a0284cf3a83ba39f0243d0e"> 1205</a></span>&#160;  lint <a class="code" href="structtrx__t.html#a4dd9f2898a0284cf3a83ba39f0243d0e">n_ref</a>; <span class="comment">/*!&lt; Count of references, protected</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">              by trx_t::mutex. We can&#39;t release the</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">              locks nor commit the transaction until</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">              this reference is 0.  We can change</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment">              the state to COMMITTED_IN_MEMORY to</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">              signify that it is no longer</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">              &quot;active&quot;. */</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">  /** Version of this instance. It is incremented each time the</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">  instance is re-used in trx_start_low(). It is used to track</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment">  whether a transaction has been restarted since it was tagged</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment">  for asynchronous rollback. */</span></div><div class="line"><a name="l01217"></a><span class="lineno"><a class="line" href="structtrx__t.html#abce36312c38d56aedb25471e8c8c7b43"> 1217</a></span>&#160;  ulint <a class="code" href="structtrx__t.html#abce36312c38d56aedb25471e8c8c7b43">version</a>;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"><a class="line" href="structtrx__t.html#a379cab489fb30c071cdba5e62730ca10"> 1219</a></span>&#160;  <a class="code" href="structxid__t.html">XID</a> *<a class="code" href="structtrx__t.html#a379cab489fb30c071cdba5e62730ca10">xid</a>;                    <span class="comment">/*!&lt; X/Open XA transaction</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment">                               identification to identify a</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment">                               transaction branch */</span></div><div class="line"><a name="l01222"></a><span class="lineno"><a class="line" href="structtrx__t.html#af79f0debdd3a9185d8d6c94d29b279ed"> 1222</a></span>&#160;  <a class="code" href="trx0trx_8h.html#afe5c6b4af5918cfb0725dbde42c65d3b">trx_mod_tables_t</a> <a class="code" href="structtrx__t.html#af79f0debdd3a9185d8d6c94d29b279ed">mod_tables</a>; <span class="comment">/*!&lt; List of tables that were modified</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">                               by this transaction */</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="preprocessor">#endif                         </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                               <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01226"></a><span class="lineno"><a class="line" href="structtrx__t.html#ace2cb07011f4c03e0b72fa5290376620"> 1226</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#ace2cb07011f4c03e0b72fa5290376620">api_trx</a>;                <span class="comment">/*!&lt; trx started by InnoDB API */</span></div><div class="line"><a name="l01227"></a><span class="lineno"><a class="line" href="structtrx__t.html#a715abb1adae35ae188028cd9d4453157"> 1227</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#a715abb1adae35ae188028cd9d4453157">api_auto_commit</a>;        <span class="comment">/*!&lt; automatic commit */</span></div><div class="line"><a name="l01228"></a><span class="lineno"><a class="line" href="structtrx__t.html#aedf3ed571c05d89fc0218d03d82abe25"> 1228</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#aedf3ed571c05d89fc0218d03d82abe25">read_write</a>;             <span class="comment">/*!&lt; if read and write operation */</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment">  /** This flag is set for trx_t objects used by the purge sys. We use the flag</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">  when validating mysql_trx_list in trx_sys_before_pre_dd_shutdown_validate.</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment">  Purge threads can have allocated trx_t objects visible in the mysql_trx_list</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">  at this point during shutdown, this is acceptable so we need a way to signal</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">  this fact. */</span></div><div class="line"><a name="l01235"></a><span class="lineno"><a class="line" href="structtrx__t.html#ac28ff524b9a24e7c74aafbe3087da78d"> 1235</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#ac28ff524b9a24e7c74aafbe3087da78d">purge_sys_trx</a>;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="comment">/*------------------------------*/</span></div><div class="line"><a name="l01237"></a><span class="lineno"><a class="line" href="structtrx__t.html#a0ec41ae60612631ff8224f6e7e6c8c2f"> 1237</a></span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="structtrx__t.html#a0ec41ae60612631ff8224f6e7e6c8c2f">detailed_error</a>;          <span class="comment">/*!&lt; detailed error message for last</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">                                 error, or empty. */</span></div><div class="line"><a name="l01239"></a><span class="lineno"><a class="line" href="structtrx__t.html#a53afd3bacfbb923b9286f7f576ec542e"> 1239</a></span>&#160;  <a class="code" href="classFlushObserver.html">FlushObserver</a> *<a class="code" href="structtrx__t.html#a53afd3bacfbb923b9286f7f576ec542e">flush_observer</a>; <span class="comment">/*!&lt; flush observer */</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l01242"></a><span class="lineno"><a class="line" href="structtrx__t.html#a5d9eba066c500418ac7196888c77b4e1"> 1242</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#a5d9eba066c500418ac7196888c77b4e1">is_dd_trx</a>; <span class="comment">/*!&lt; True if the transaction is used for</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">                  doing Non-locking Read-only Read</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">                  Committed on DD tables */</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="preprocessor">#endif            </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01246"></a><span class="lineno"><a class="line" href="structtrx__t.html#a14010a79d91496eef11ef92a15a21bef"> 1246</a></span>&#160;  ulint <a class="code" href="structtrx__t.html#a14010a79d91496eef11ef92a15a21bef">magic_n</a>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"><a class="line" href="structtrx__t.html#ac284f3e3e9c3b7210e267c21197cbda6"> 1248</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#ac284f3e3e9c3b7210e267c21197cbda6">is_read_uncommitted</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">return</span> (isolation_level == READ_UNCOMMITTED);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  }</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"><a class="line" href="structtrx__t.html#ace35c2c0cd6b1656f1f7a1cb8ac2c436"> 1252</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#ace35c2c0cd6b1656f1f7a1cb8ac2c436">skip_gap_locks</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">switch</span> (isolation_level) {</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordflow">case</span> READ_UNCOMMITTED:</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="keywordflow">case</span> READ_COMMITTED:</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="keywordflow">return</span> (<span class="keyword">true</span>);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      <span class="keywordflow">case</span> REPEATABLE_READ:</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <span class="keywordflow">case</span> SERIALIZABLE:</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    }</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(0);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  }</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"><a class="line" href="structtrx__t.html#a128e331c12ccd0ed63f23d8bc7c63db4"> 1265</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structtrx__t.html#a128e331c12ccd0ed63f23d8bc7c63db4">allow_semi_consistent</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (skip_gap_locks()); }</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;};</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">/* Transaction isolation levels (trx-&gt;isolation_level) */</span></div><div class="line"><a name="l01270"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a247f389bf8c057c24e8b814bc264df0c"> 1270</a></span>&#160;<span class="preprocessor">#define TRX_ISO_READ_UNCOMMITTED trx_t::READ_UNCOMMITTED</span></div><div class="line"><a name="l01271"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#ac1ee0d3aa89fd432825470965225396b"> 1271</a></span>&#160;<span class="preprocessor">#define TRX_ISO_READ_COMMITTED trx_t::READ_COMMITTED</span></div><div class="line"><a name="l01272"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a69bd5e8425f4f881b741af67a5b7f9fe"> 1272</a></span>&#160;<span class="preprocessor">#define TRX_ISO_REPEATABLE_READ trx_t::REPEATABLE_READ</span></div><div class="line"><a name="l01273"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a45398954a16ffa99d6a2b33bf90b4c9c"> 1273</a></span>&#160;<span class="preprocessor">#define TRX_ISO_SERIALIZABLE trx_t::SERIALIZABLE</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">Check if transaction is started.</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">@param[in] trx          Transaction whose state we need to check</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">@return true if transaction is in state started */</span></div><div class="line"><a name="l01279"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a24187b6b4af390120a5c3d681aecc760"> 1279</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="trx0trx_8h.html#a24187b6b4af390120a5c3d681aecc760">trx_is_started</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordflow">return</span> (trx-&gt;<a class="code" href="structtrx__t.html#a5d0ace463c8eb18ed152f9400395a308">state</a> != <a class="code" href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfeab6d43468942f04bb539f0a0ef3fda5e7">TRX_STATE_NOT_STARTED</a> &amp;&amp;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;          trx-&gt;<a class="code" href="structtrx__t.html#a5d0ace463c8eb18ed152f9400395a308">state</a> != <a class="code" href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfea715252714bf7cbda62aeeed0f155ba59">TRX_STATE_FORCED_ROLLBACK</a>);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;}</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">/** Commit node states */</span></div><div class="line"><a name="l01285"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5"> 1285</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5">commit_node_state</a> {</div><div class="line"><a name="l01286"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5a58c5533d962091dde4f36df4ef999012"> 1286</a></span>&#160;  <a class="code" href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5a58c5533d962091dde4f36df4ef999012">COMMIT_NODE_SEND</a> = 1, <span class="comment">/*!&lt; about to send a commit signal to</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">                        the transaction */</span></div><div class="line"><a name="l01288"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5a9e0ee8ee1fef6293a6178e3bd1288d93"> 1288</a></span>&#160;  <a class="code" href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5a9e0ee8ee1fef6293a6178e3bd1288d93">COMMIT_NODE_WAIT</a>      <span class="comment">/*!&lt; commit signal sent to the transaction,</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">                        waiting for completion */</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;};</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">/** Commit command node in a query graph */</span></div><div class="line"><a name="l01293"></a><span class="lineno"><a class="line" href="structcommit__node__t.html"> 1293</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcommit__node__t.html">commit_node_t</a> {</div><div class="line"><a name="l01294"></a><span class="lineno"><a class="line" href="structcommit__node__t.html#a81b9e989be432c69cb399afbaf7ba82d"> 1294</a></span>&#160;  <a class="code" href="structque__common__t.html">que_common_t</a> <a class="code" href="structcommit__node__t.html#a81b9e989be432c69cb399afbaf7ba82d">common</a>;          <span class="comment">/*!&lt; node type: QUE_NODE_COMMIT */</span></div><div class="line"><a name="l01295"></a><span class="lineno"><a class="line" href="structcommit__node__t.html#a0bbf0c16bdc7370054c6653a4a4b8027"> 1295</a></span>&#160;  <span class="keyword">enum</span> <a class="code" href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5">commit_node_state</a> state; <span class="comment">/*!&lt; node execution state */</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;};</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">/** Test if trx-&gt;mutex is owned by the current thread. */</span></div><div class="line"><a name="l01299"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a2500d5010eab88bcf2f06b519354237f"> 1299</a></span>&#160;<span class="preprocessor">#define trx_mutex_own(t) mutex_own(&amp;t-&gt;mutex)</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment">Verifies the invariants and records debug state related to latching rules.</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">Called during trx_mutex_enter before the actual mutex acquisition.</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">@param[in]  trx             The transaction for which trx_mutex_enter(trx) is</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">                            called</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">@param[in]  allow_another   If false, then no further calls to trx_mutex_enter</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">                            are allowed, until trx_mutex_exit().</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">                            If true, then this must be the first trx acquisition</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">                            and we will allow one more.</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a7ca10184fd4a4edd6199c7d4a51b0820">trx_before_mutex_enter</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keywordtype">bool</span> allow_another);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">Verifies the invariants and records debug state related to latching rules.</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment">Called during trx_mutex_exit before the actual mutex release.</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">@param[in]  trx   The transaction for which trx_mutex_exit(trx) is called</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a3a40c6d70b2ac49226e764b1307f97a9">trx_before_mutex_exit</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">Please do not use this low-level macro.</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">Use trx_mutex_enter(t) instead.</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment">In rare cases where you need to take two trx-&gt;mutex-es, take the first one</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">using trx_mutex_enter_first_of_two(t1), and the second one with</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">trx_mutex(2)</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01329"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#af3bef87718013d5f34bfa7c9bb16ba4c"> 1329</a></span>&#160;<span class="preprocessor">#define trx_mutex_enter_low(t, first_of_two)       \</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="preprocessor">  do {                                             \</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="preprocessor">    ut_ad(!trx_mutex_own(t));                      \</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="preprocessor">    ut_d(trx_before_mutex_enter(t, first_of_two)); \</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="preprocessor">    mutex_enter(&amp;t-&gt;mutex);                        \</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="preprocessor">  } while (0)</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">/** Acquire the trx-&gt;mutex (and promise not to request any more). */</span></div><div class="line"><a name="l01337"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#aba2a1215a0c143a2e57464019e8d209d"> 1337</a></span>&#160;<span class="preprocessor">#define trx_mutex_enter(t) trx_mutex_enter_low(t, false)</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">/** Acquire the trx-&gt;mutex (and indicate we might request one more). */</span></div><div class="line"><a name="l01340"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a6d1c4c50bae7aad39073b4b6ce2b943b"> 1340</a></span>&#160;<span class="preprocessor">#define trx_mutex_enter_first_of_two(t) trx_mutex_enter_low(t, true)</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">/** Release the trx-&gt;mutex. */</span></div><div class="line"><a name="l01343"></a><span class="lineno"><a class="line" href="trx0trx_8h.html#a97f30d50cfbc0d22b3730e39ad128ed7"> 1343</a></span>&#160;<span class="preprocessor">#define trx_mutex_exit(t)           \</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="preprocessor">  do {                              \</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="preprocessor">    ut_ad(trx_mutex_own(t));        \</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="preprocessor">    ut_d(trx_before_mutex_exit(t)); \</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="preprocessor">    mutex_exit(&amp;t-&gt;mutex);          \</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="preprocessor">  } while (0)</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">/** Track if a transaction is executing inside InnoDB code. It acts</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment">like a gate between the Server and InnoDB.  */</span></div><div class="line"><a name="l01352"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html"> 1352</a></span>&#160;<span class="keyword">class </span><a class="code" href="classTrxInInnoDB.html">TrxInInnoDB</a> {</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">  @param[in,out] trx    Transaction entering InnoDB via the handler</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">  @param[in] disable    true if called from COMMIT/ROLLBACK method */</span></div><div class="line"><a name="l01357"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#af05b1d974b47d5c1641a7fe9467313af"> 1357</a></span>&#160;  <a class="code" href="classTrxInInnoDB.html#af05b1d974b47d5c1641a7fe9467313af">TrxInInnoDB</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keywordtype">bool</span> disable = <span class="keyword">false</span>) : m_trx(trx) {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    enter(trx, disable);</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  }</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment">  Destructor */</span></div><div class="line"><a name="l01363"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a5ae11fcca8880c3d7af61b21df0fb18a"> 1363</a></span>&#160;  <a class="code" href="classTrxInInnoDB.html#a5ae11fcca8880c3d7af61b21df0fb18a">~TrxInInnoDB</a>() { <a class="code" href="lexyy_8cc.html#ab1e07f9aa81ac38a87216b019d3b5a8b">exit</a>(m_trx); }</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">  @return true if the transaction has been marked for asynchronous</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">          rollback */</span></div><div class="line"><a name="l01368"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a84d67a41f3d5d6f43f21759bcfde763b"> 1368</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classTrxInInnoDB.html#a84d67a41f3d5d6f43f21759bcfde763b">is_aborted</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (<a class="code" href="classTrxInInnoDB.html#a84d67a41f3d5d6f43f21759bcfde763b">is_aborted</a>(m_trx)); }</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">  @return true if the transaction can&#39;t be rolled back asynchronously */</span></div><div class="line"><a name="l01372"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a9352fb82b55c847d8721535c4b860018"> 1372</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classTrxInInnoDB.html#a9352fb82b55c847d8721535c4b860018">is_rollback_disabled</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="keywordflow">return</span> ((m_trx-&gt;in_innodb &amp; <a class="code" href="trx0types_8h.html#a671a381e3a8143e9612e31dc898960bc">TRX_FORCE_ROLLBACK_DISABLE</a>) &gt; 0);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  }</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">  @return true if the transaction has been marked for asynchronous</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">          rollback */</span></div><div class="line"><a name="l01379"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a506880deeaef33f256ff7d732c79fed8"> 1379</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classTrxInInnoDB.html#a506880deeaef33f256ff7d732c79fed8">is_aborted</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) {</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="keywordflow">if</span> (trx-&gt;<a class="code" href="structtrx__t.html#a5d0ace463c8eb18ed152f9400395a308">state</a> == <a class="code" href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfeab6d43468942f04bb539f0a0ef3fda5e7">TRX_STATE_NOT_STARTED</a>) {</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    }</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="srv0srv_8h.html#abee3b4363b1c03c5eb8d9b515e80bad2">srv_read_only_mode</a> || trx-&gt;<a class="code" href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">in_depth</a> &gt; 0);</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="srv0srv_8h.html#abee3b4363b1c03c5eb8d9b515e80bad2">srv_read_only_mode</a> || trx-&gt;<a class="code" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">in_innodb</a> &gt; 0);</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="keywordflow">return</span> (trx-&gt;<a class="code" href="structtrx__t.html#ad26749c886fb7a6e27c6d3128455cb22">abort</a> || trx-&gt;<a class="code" href="structtrx__t.html#a5d0ace463c8eb18ed152f9400395a308">state</a> == <a class="code" href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfea715252714bf7cbda62aeeed0f155ba59">TRX_STATE_FORCED_ROLLBACK</a>);</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  }</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">  Start statement requested for transaction.</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">  @param[in, out] trx   Transaction at the start of a SQL statement */</span></div><div class="line"><a name="l01393"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a25769c9f91b640c54126c2420d8fc3c4"> 1393</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classTrxInInnoDB.html#a25769c9f91b640c54126c2420d8fc3c4">begin_stmt</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx) { enter(trx, <span class="keyword">false</span>); }</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">  Note an end statement for transaction</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">  @param[in, out] trx   Transaction at end of a SQL statement */</span></div><div class="line"><a name="l01398"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a3d1e9febe1d1c3def698315a65f2abdf"> 1398</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classTrxInInnoDB.html#a3d1e9febe1d1c3def698315a65f2abdf">end_stmt</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx) { <a class="code" href="lexyy_8cc.html#ab1e07f9aa81ac38a87216b019d3b5a8b">exit</a>(trx); }</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">  @return true if the rollback is being initiated by the thread that</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">          marked the transaction for asynchronous rollback */</span></div><div class="line"><a name="l01403"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a72da4a1e2094bccfdcdfe0bcbad09199"> 1403</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classTrxInInnoDB.html#a72da4a1e2094bccfdcdfe0bcbad09199">is_async_rollback</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) {</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">return</span> (trx-&gt;<a class="code" href="structtrx__t.html#af0676fde714c596cdf94e5d02e0a7fb9">killed_by</a> == <a class="code" href="os0thread_8h.html#ae667eeb3edc0dd162339dd0ea943ce09">os_thread_get_curr_id</a>());</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160; <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">  /** Note that we have crossed into InnoDB code.</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">  @param[in]    trx     transaction</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">  @param[in]    disable true if called from COMMIT/ROLLBACK method */</span></div><div class="line"><a name="l01411"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a4292a9044022a83369c61505c792fe1a"> 1411</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classTrxInInnoDB.html#a4292a9044022a83369c61505c792fe1a">enter</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keywordtype">bool</span> disable) {</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="srv0srv_8h.html#abee3b4363b1c03c5eb8d9b515e80bad2">srv_read_only_mode</a>) {</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    }</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(!is_async_rollback(trx));</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="comment">/* If it hasn&#39;t already been marked for async rollback.</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">    and it will be committed/rolled back. */</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordflow">if</span> (disable) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      <a class="code" href="trx0trx_8h.html#aba2a1215a0c143a2e57464019e8d209d">trx_mutex_enter</a>(trx);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="keywordflow">if</span> (!is_forced_rollback(trx) &amp;&amp; is_started(trx) &amp;&amp;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;          !<a class="code" href="trx0trx_8h.html#a087a90c619c86978766f279a156dae2e">trx_is_autocommit_non_locking</a>(trx)) {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(trx-&gt;<a class="code" href="structtrx__t.html#af0676fde714c596cdf94e5d02e0a7fb9">killed_by</a> == 0);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="comment">/* This transaction has crossed the point of</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">        no return and cannot be rolled back</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">        asynchronously now. It must commit or rollback</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">        synhronously. */</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        trx-&gt;<a class="code" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">in_innodb</a> |= <a class="code" href="trx0types_8h.html#a671a381e3a8143e9612e31dc898960bc">TRX_FORCE_ROLLBACK_DISABLE</a>;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      }</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <a class="code" href="trx0trx_8h.html#a97f30d50cfbc0d22b3730e39ad128ed7">trx_mutex_exit</a>(trx);</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    }</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="comment">/* Avoid excessive mutex acquire/release */</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    ++trx-&gt;<a class="code" href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">in_depth</a>;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="comment">/* If trx-&gt;in_depth is greater than 1 then</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="comment">    transaction is already in InnoDB. */</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">if</span> (trx-&gt;<a class="code" href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">in_depth</a> &gt; 1) {</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <a class="code" href="trx0trx_8h.html#aba2a1215a0c143a2e57464019e8d209d">trx_mutex_enter</a>(trx);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <a class="code" href="namespacenet_1_1impl_1_1socket.html#af0aef40a99065320448f6e90710198cc">wait</a>(trx);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>((trx-&gt;<a class="code" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">in_innodb</a> &amp; <a class="code" href="trx0types_8h.html#a365d8e86502c13b65cd1749fd453f75a">TRX_FORCE_ROLLBACK_MASK</a>) == 0);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    ++trx-&gt;<a class="code" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">in_innodb</a>;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <a class="code" href="trx0trx_8h.html#a97f30d50cfbc0d22b3730e39ad128ed7">trx_mutex_exit</a>(trx);</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  }</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment">  Note that we are exiting InnoDB code */</span></div><div class="line"><a name="l01458"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a909e1bf34371c21294a4d4f419fb60ca"> 1458</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classTrxInInnoDB.html#a909e1bf34371c21294a4d4f419fb60ca">exit</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx) {</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="srv0srv_8h.html#abee3b4363b1c03c5eb8d9b515e80bad2">srv_read_only_mode</a>) {</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    }</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="comment">/* Avoid excessive mutex acquire/release */</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(trx-&gt;<a class="code" href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">in_depth</a> &gt; 0);</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    --trx-&gt;<a class="code" href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">in_depth</a>;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">if</span> (trx-&gt;<a class="code" href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">in_depth</a> &gt; 0) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    }</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <a class="code" href="trx0trx_8h.html#aba2a1215a0c143a2e57464019e8d209d">trx_mutex_enter</a>(trx);</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>((trx-&gt;<a class="code" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">in_innodb</a> &amp; <a class="code" href="trx0types_8h.html#a365d8e86502c13b65cd1749fd453f75a">TRX_FORCE_ROLLBACK_MASK</a>) &gt; 0);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    --trx-&gt;<a class="code" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">in_innodb</a>;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <a class="code" href="trx0trx_8h.html#a97f30d50cfbc0d22b3730e39ad128ed7">trx_mutex_exit</a>(trx);</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  }</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">  @return true if it is a forced rollback, asynchronously */</span></div><div class="line"><a name="l01484"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a630f7ef14772bae3b5af7fac9cd5f533"> 1484</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classTrxInInnoDB.html#a630f7ef14772bae3b5af7fac9cd5f533">is_forced_rollback</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) {</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="trx0trx_8h.html#a2500d5010eab88bcf2f06b519354237f">trx_mutex_own</a>(trx));</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keywordflow">return</span> ((trx-&gt;<a class="code" href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">in_innodb</a> &amp; <a class="code" href="trx0types_8h.html#a885c60219b17a02d06d4ab096803c02a">TRX_FORCE_ROLLBACK</a>)) &gt; 0;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  }</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">  Wait for the asynchronous rollback to complete, if it is in progress */</span></div><div class="line"><a name="l01492"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a4e58684b35f0fbcedfcc0df97861e226"> 1492</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classTrxInInnoDB.html#a4e58684b35f0fbcedfcc0df97861e226">wait</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) {</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="trx0trx_8h.html#a2500d5010eab88bcf2f06b519354237f">trx_mutex_own</a>(trx));</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    ulint loop_count = 0;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="comment">/* start with optimistic sleep time - 20 micro seconds. */</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    ulint sleep_time = 20;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">while</span> (is_forced_rollback(trx)) {</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <span class="comment">/* Wait for the async rollback to complete */</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      <a class="code" href="trx0trx_8h.html#a97f30d50cfbc0d22b3730e39ad128ed7">trx_mutex_exit</a>(trx);</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      loop_count++;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      <span class="comment">/* If the wait is long, don&#39;t hog the cpu. */</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <span class="keywordflow">if</span> (loop_count &lt; 100) {</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        <span class="comment">/* 20 microseconds */</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        sleep_time = 20;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loop_count &lt; 1000) {</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        <span class="comment">/* 1 millisecond */</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        sleep_time = 1000;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <span class="comment">/* 100 milliseconds */</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        sleep_time = 100000;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      }</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <a class="code" href="os0thread_8h.html#a072dbb56553b6a9e1e43ef5d3905241e">os_thread_sleep</a>(sleep_time);</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      <a class="code" href="trx0trx_8h.html#aba2a1215a0c143a2e57464019e8d209d">trx_mutex_enter</a>(trx);</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    }</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  }</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">  @return true if transaction is started */</span></div><div class="line"><a name="l01525"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#a8c66b5ee2b54383e4541f3471ca8e58f"> 1525</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classTrxInInnoDB.html#a8c66b5ee2b54383e4541f3471ca8e58f">is_started</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx) {</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="trx0trx_8h.html#a2500d5010eab88bcf2f06b519354237f">trx_mutex_own</a>(trx));</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="trx0trx_8h.html#a24187b6b4af390120a5c3d681aecc760">trx_is_started</a>(trx));</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  }</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160; <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment">  Transaction instance crossing the handler boundary from the Server. */</span></div><div class="line"><a name="l01534"></a><span class="lineno"><a class="line" href="classTrxInInnoDB.html#ad797833130a56460e837951ba805d2f3"> 1534</a></span>&#160;  <a class="code" href="structtrx__t.html">trx_t</a> *<a class="code" href="classTrxInInnoDB.html#ad797833130a56460e837951ba805d2f3">m_trx</a>;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;};</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">/** Check if transaction is internal XA transaction</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">@param[in]      trx     transaction</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">@return true, iff internal XA transaction. */</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="trx0trx_8h.html#aae1bd920335932721b515f79139404ca">trx_is_mysql_xa</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">/** Update transaction binlog file name and position from session THD.</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">@param[in,out]  trx     current transaction. */</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="keywordtype">void</span> <a class="code" href="trx0trx_8h.html#a65eef27d572e0d6a6d089486c6776811">trx_sys_update_binlog_position</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="preprocessor">#include &quot;trx0trx.ic&quot;</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="trx0trx_8h_html_a2c8fd0a774b3be32177da1c54db92352"><div class="ttname"><a href="trx0trx_8h.html#a2c8fd0a774b3be32177da1c54db92352">trx_assert_started</a></div><div class="ttdeci">ibool trx_assert_started(const trx_t *trx)</div><div class="ttdoc">Asserts that a transaction has been started. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2524</div></div>
<div class="ttc" id="trx0trx_8h_html_a29f1cd3a693f103cc1dae338aa65cf86"><div class="ttname"><a href="trx0trx_8h.html#a29f1cd3a693f103cc1dae338aa65cf86">trx_free_prepared_or_active_recovered</a></div><div class="ttdeci">void trx_free_prepared_or_active_recovered(trx_t *trx)</div><div class="ttdoc">At shutdown, frees a transaction object that represents either: </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:593</div></div>
<div class="ttc" id="classut__allocator_html"><div class="ttname"><a href="classut__allocator.html">ut_allocator</a></div><div class="ttdoc">Allocator class for allocating memory from inside std::* containers. </div><div class="ttdef"><b>Definition:</b> ut0new.h:572</div></div>
<div class="ttc" id="trx0trx_8h_html_a2500d5010eab88bcf2f06b519354237f"><div class="ttname"><a href="trx0trx_8h.html#a2500d5010eab88bcf2f06b519354237f">trx_mutex_own</a></div><div class="ttdeci">#define trx_mutex_own(t)</div><div class="ttdoc">Test if trx-&gt;mutex is owned by the current thread. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1299</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a8c66b5ee2b54383e4541f3471ca8e58f"><div class="ttname"><a href="classTrxInInnoDB.html#a8c66b5ee2b54383e4541f3471ca8e58f">TrxInInnoDB::is_started</a></div><div class="ttdeci">static bool is_started(const trx_t *trx)</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1525</div></div>
<div class="ttc" id="structtrx__lock__t_html_affae4ec9c18be6c1f774472fae0bfbc9"><div class="ttname"><a href="structtrx__lock__t.html#affae4ec9c18be6c1f774472fae0bfbc9">trx_lock_t::wait_thr</a></div><div class="ttdeci">que_thr_t * wait_thr</div><div class="ttdoc">query thread belonging to this trx that is in QUE_THR_LOCK_WAIT state. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:667</div></div>
<div class="ttc" id="trx0trx_8h_html_a2a2d65d23b63d13b2f010a8c8359b250"><div class="ttname"><a href="trx0trx_8h.html#a2a2d65d23b63d13b2f010a8c8359b250">trx_free_for_background</a></div><div class="ttdeci">void trx_free_for_background(trx_t *trx)</div><div class="ttdoc">Free a transaction that was allocated by background or user threads. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:587</div></div>
<div class="ttc" id="ut0vec_8h_html"><div class="ttname"><a href="ut0vec_8h.html">ut0vec.h</a></div><div class="ttdoc">A vector of pointers to data items. </div></div>
<div class="ttc" id="trx0trx_8h_html_ae8d19073df69b437e6fa9396fd6c9806"><div class="ttname"><a href="trx0trx_8h.html#ae8d19073df69b437e6fa9396fd6c9806">trx_allocate_for_mysql</a></div><div class="ttdeci">trx_t * trx_allocate_for_mysql(void)</div><div class="ttdoc">Creates a transaction object for MySQL. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:528</div></div>
<div class="ttc" id="structtrx__t_html_af0676fde714c596cdf94e5d02e0a7fb9"><div class="ttname"><a href="structtrx__t.html#af0676fde714c596cdf94e5d02e0a7fb9">trx_t::killed_by</a></div><div class="ttdeci">os_thread_id_t killed_by</div><div class="ttdoc">The thread ID that wants to kill this transaction asynchronously. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:984</div></div>
<div class="ttc" id="trx0trx_8h_html_a7d3e131a908fd0050ff73bc5b27f7dba"><div class="ttname"><a href="trx0trx_8h.html#a7d3e131a908fd0050ff73bc5b27f7dba">trx_commit_step</a></div><div class="ttdeci">que_thr_t * trx_commit_step(que_thr_t *thr)</div><div class="ttdoc">Performs an execution step for a commit type node in a query graph. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2224</div></div>
<div class="ttc" id="structtrx__lock__t_html_a2045b09acdd16afe124784b7505ee6fd"><div class="ttname"><a href="structtrx__lock__t.html#a2045b09acdd16afe124784b7505ee6fd">trx_lock_t::inherit_all</a></div><div class="ttdeci">std::atomic&lt; bool &gt; inherit_all</div><div class="ttdoc">Used to indicate that every lock of this transaction placed on a record which is being purged should ...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:719</div></div>
<div class="ttc" id="trx0types_8h_html_a044545240fb71e3a64171596e66e0336"><div class="ttname"><a href="trx0types_8h.html#a044545240fb71e3a64171596e66e0336">TrxMutex</a></div><div class="ttdeci">ib_mutex_t TrxMutex</div><div class="ttdef"><b>Definition:</b> trx0types.h:177</div></div>
<div class="ttc" id="trx0trx_8h_html_a8c7f576bf5e13ddc8a29be5b9200c0c4"><div class="ttname"><a href="trx0trx_8h.html#a8c7f576bf5e13ddc8a29be5b9200c0c4">trx_set_detailed_error_from_file</a></div><div class="ttdeci">void trx_set_detailed_error_from_file(trx_t *trx, FILE *file)</div><div class="ttdoc">Set detailed error message for the transaction from a file. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:132</div></div>
<div class="ttc" id="trx0trx_8h_html_a2b7ae91f363c7ac77c2d86bc27eb39f1"><div class="ttname"><a href="trx0trx_8h.html#a2b7ae91f363c7ac77c2d86bc27eb39f1">trx_get_id_for_print</a></div><div class="ttdeci">UNIV_INLINE trx_id_t trx_get_id_for_print(const trx_t *trx)</div><div class="ttdoc">Retreieves the transaction ID. </div></div>
<div class="ttc" id="structtrx__lock__t_html_a3a4d09bc7b1ab30c068be9c870789a1d"><div class="ttname"><a href="structtrx__lock__t.html#a3a4d09bc7b1ab30c068be9c870789a1d">trx_lock_t::trx_locks</a></div><div class="ttdeci">trx_lock_list_t trx_locks</div><div class="ttdoc">Locks requested by the transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:695</div></div>
<div class="ttc" id="log0types_8h_html_aa7401e3081ffb8ee7e8fb182647f475c"><div class="ttname"><a href="log0types_8h.html#aa7401e3081ffb8ee7e8fb182647f475c">lsn_t</a></div><div class="ttdeci">uint64_t lsn_t</div><div class="ttdoc">Type used for all log sequence number storage and arithmetics. </div><div class="ttdef"><b>Definition:</b> log0types.h:60</div></div>
<div class="ttc" id="trx0types_8h_html_a14bf14fe533410dc0d7b3bb9e99afcfe"><div class="ttname"><a href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfe">trx_state_t</a></div><div class="ttdeci">trx_state_t</div><div class="ttdoc">Transaction states (trx_t::state) </div><div class="ttdef"><b>Definition:</b> trx0types.h:86</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a3d1e9febe1d1c3def698315a65f2abdf"><div class="ttname"><a href="classTrxInInnoDB.html#a3d1e9febe1d1c3def698315a65f2abdf">TrxInInnoDB::end_stmt</a></div><div class="ttdeci">static void end_stmt(trx_t *trx)</div><div class="ttdoc">Note an end statement for transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1398</div></div>
<div class="ttc" id="ha__prototypes_8h_html"><div class="ttname"><a href="ha__prototypes_8h.html">ha_prototypes.h</a></div><div class="ttdoc">Prototypes for global functions in ha_innodb.cc that are called by InnoDB C code. ...</div></div>
<div class="ttc" id="trx0xa_8h_html"><div class="ttname"><a href="trx0xa_8h.html">trx0xa.h</a></div></div>
<div class="ttc" id="structtrx__t_html_aea1d5a0e80d35afbdadedd59d9bafe16"><div class="ttname"><a href="structtrx__t.html#aea1d5a0e80d35afbdadedd59d9bafe16">trx_t::sess</a></div><div class="ttdeci">sess_t * sess</div><div class="ttdoc">session of the trx, NULL if none </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1122</div></div>
<div class="ttc" id="structtrx__t_html_ac28ff524b9a24e7c74aafbe3087da78d"><div class="ttname"><a href="structtrx__t.html#ac28ff524b9a24e7c74aafbe3087da78d">trx_t::purge_sys_trx</a></div><div class="ttdeci">bool purge_sys_trx</div><div class="ttdoc">This flag is set for trx_t objects used by the purge sys. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1235</div></div>
<div class="ttc" id="trx0trx_8h_html_a2cb464dfd1e6c2ff6000867e63fee8cc"><div class="ttname"><a href="trx0trx_8h.html#a2cb464dfd1e6c2ff6000867e63fee8cc">trx_allocate_for_background</a></div><div class="ttdeci">trx_t * trx_allocate_for_background(void)</div><div class="ttdoc">Creates a transaction object for background operations by the master thread. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:516</div></div>
<div class="ttc" id="structtrx__lock__t_html_a7ecafab6cff6b97a66367feb5fa0b998"><div class="ttname"><a href="structtrx__lock__t.html#a7ecafab6cff6b97a66367feb5fa0b998">trx_lock_t::rec_cached</a></div><div class="ttdeci">ulint rec_cached</div><div class="ttdoc">Next free record lock in pool. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:676</div></div>
<div class="ttc" id="trx0trx_8h_html_a24187b6b4af390120a5c3d681aecc760"><div class="ttname"><a href="trx0trx_8h.html#a24187b6b4af390120a5c3d681aecc760">trx_is_started</a></div><div class="ttdeci">bool trx_is_started(const trx_t *trx)</div><div class="ttdoc">Check if transaction is started. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1279</div></div>
<div class="ttc" id="structtrx__t_html_ab5c05ba139deae47e8e05e2e0d1ac38c"><div class="ttname"><a href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38c">trx_t::isolation_level_t</a></div><div class="ttdeci">isolation_level_t</div><div class="ttdef"><b>Definition:</b> trx0trx.h:834</div></div>
<div class="ttc" id="trx0trx_8h_html_af9066529c44667bed3ddb904c4adbfdd"><div class="ttname"><a href="trx0trx_8h.html#af9066529c44667bed3ddb904c4adbfdd">trx_set_detailed_error</a></div><div class="ttdeci">void trx_set_detailed_error(trx_t *trx, const char *msg)</div><div class="ttdoc">Set detailed error message for the transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:126</div></div>
<div class="ttc" id="structtrx__lock__t_html_a59226dd4afa12903c6be80f6588cd9ef"><div class="ttname"><a href="structtrx__lock__t.html#a59226dd4afa12903c6be80f6588cd9ef">trx_lock_t::trx_locks_version</a></div><div class="ttdeci">uint64_t trx_locks_version</div><div class="ttdoc">Incremented each time a lock is added or removed from the trx-&gt;lock.trx_locks, so that the thread whi...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:573</div></div>
<div class="ttc" id="trx0trx_8h_html_a9f0ab6e6668f9846426da7c7e2d975c9"><div class="ttname"><a href="trx0trx_8h.html#a9f0ab6e6668f9846426da7c7e2d975c9">trx_start_internal_read_only_low</a></div><div class="ttdeci">void trx_start_internal_read_only_low(trx_t *trx)</div><div class="ttdoc">Starts a read-only transaction for internal processing. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:3146</div></div>
<div class="ttc" id="trx0trx_8h_html_aba5b87828afc483ac0875159cd440598"><div class="ttname"><a href="trx0trx_8h.html#aba5b87828afc483ac0875159cd440598">trx_state_eq</a></div><div class="ttdeci">UNIV_INLINE bool trx_state_eq(const trx_t *trx, trx_state_t state)</div><div class="ttdoc">Determines if a transaction is in the given state. </div></div>
<div class="ttc" id="trx0trx_8h_html_a5d0f7f590f17ab052505bbb43ce0c25b"><div class="ttname"><a href="trx0trx_8h.html#a5d0f7f590f17ab052505bbb43ce0c25b">trx_immutable_id</a></div><div class="ttdeci">UNIV_INLINE uint64_t trx_immutable_id(const trx_t *trx)</div><div class="ttdoc">Provides an id of the transaction which does not change over time. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:426</div></div>
<div class="ttc" id="trx0trx_8h_html_adf5afc626305a6fe095445d741a765ae"><div class="ttname"><a href="trx0trx_8h.html#adf5afc626305a6fe095445d741a765ae">trx_lists_init_at_db_start</a></div><div class="ttdeci">void trx_lists_init_at_db_start(void)</div><div class="ttdoc">Creates trx objects for transactions and initializes the trx list of trx_sys at database start...</div><div class="ttdef"><b>Definition:</b> trx0trx.cc:997</div></div>
<div class="ttc" id="structtrx__t_html_a7fc2b40c5715569716756de6471f2dee"><div class="ttname"><a href="structtrx__t.html#a7fc2b40c5715569716756de6471f2dee">trx_t::pages_undone</a></div><div class="ttdeci">ulint pages_undone</div><div class="ttdoc">number of undo log pages undone since the last undo log truncation </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1162</div></div>
<div class="ttc" id="trx0trx_8h_html_ae2c2545708daee0f7c0f7b88b14be7ada8db8b9302c6ad8af2abba7588ddc65e8"><div class="ttname"><a href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ada8db8b9302c6ad8af2abba7588ddc65e8">TRX_RSEG_TYPE_NOREDO</a></div><div class="ttdoc">non-redo rollback segment. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:830</div></div>
<div class="ttc" id="structtrx__t_html"><div class="ttname"><a href="structtrx__t.html">trx_t</a></div><div class="ttdef"><b>Definition:</b> trx0trx.h:833</div></div>
<div class="ttc" id="trx0trx_8h_html_afe5c6b4af5918cfb0725dbde42c65d3b"><div class="ttname"><a href="trx0trx_8h.html#afe5c6b4af5918cfb0725dbde42c65d3b">trx_mod_tables_t</a></div><div class="ttdeci">std::set&lt; dict_table_t *, std::less&lt; dict_table_t * &gt;, ut_allocator&lt; dict_table_t * &gt; &gt; trx_mod_tables_t</div><div class="ttdoc">Type used to store the list of tables that are modified by a given transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:747</div></div>
<div class="ttc" id="structtrx__t_html_a08f3c6c1bece8285dd86d00c6379c9d0"><div class="ttname"><a href="structtrx__t.html#a08f3c6c1bece8285dd86d00c6379c9d0">trx_t::will_lock</a></div><div class="ttdeci">ib_uint32_t will_lock</div><div class="ttdoc">Will acquire some locks. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1178</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a4e58684b35f0fbcedfcc0df97861e226"><div class="ttname"><a href="classTrxInInnoDB.html#a4e58684b35f0fbcedfcc0df97861e226">TrxInInnoDB::wait</a></div><div class="ttdeci">static void wait(const trx_t *trx)</div><div class="ttdoc">Wait for the asynchronous rollback to complete, if it is in progress. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1492</div></div>
<div class="ttc" id="classReadView_html"><div class="ttname"><a href="classReadView.html">ReadView</a></div><div class="ttdoc">Read view lists the trx ids of those transactions for which a consistent read should not see the modi...</div><div class="ttdef"><b>Definition:</b> read0types.h:47</div></div>
<div class="ttc" id="structst__xarecover__txn_html"><div class="ttname"><a href="structst__xarecover__txn.html">st_xarecover_txn</a></div><div class="ttdoc">Plain structure to store information about XA transaction id and a list of table names involved into ...</div><div class="ttdef"><b>Definition:</b> xa.h:357</div></div>
<div class="ttc" id="structtrx__t_html_a3f3e4d250ee898561beef24a088b2911"><div class="ttname"><a href="structtrx__t.html#a3f3e4d250ee898561beef24a088b2911">trx_t::start_line</a></div><div class="ttdeci">ulint start_line</div><div class="ttdoc">Track where it was started from. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1201</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a506880deeaef33f256ff7d732c79fed8"><div class="ttname"><a href="classTrxInInnoDB.html#a506880deeaef33f256ff7d732c79fed8">TrxInInnoDB::is_aborted</a></div><div class="ttdeci">static bool is_aborted(const trx_t *trx)</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1379</div></div>
<div class="ttc" id="lock0types_8h_html"><div class="ttname"><a href="lock0types_8h.html">lock0types.h</a></div><div class="ttdoc">The transaction lock system global types. </div></div>
<div class="ttc" id="structtrx__t_html_ae500ddb754125146585f483602bd2f9d"><div class="ttname"><a href="structtrx__t.html#ae500ddb754125146585f483602bd2f9d">trx_t::read_view</a></div><div class="ttdeci">ReadView * read_view</div><div class="ttdoc">consistent read view used in the transaction, or NULL if not yet set </div><div class="ttdef"><b>Definition:</b> trx0trx.h:964</div></div>
<div class="ttc" id="os0thread_8h_html_a072dbb56553b6a9e1e43ef5d3905241e"><div class="ttname"><a href="os0thread_8h.html#a072dbb56553b6a9e1e43ef5d3905241e">os_thread_sleep</a></div><div class="ttdeci">#define os_thread_sleep(usecs)</div><div class="ttdoc">The thread sleeps at least the time given in microseconds. </div><div class="ttdef"><b>Definition:</b> os0thread.h:94</div></div>
<div class="ttc" id="structtrx__t_html_ae2412d7b54b8f8c98a0ae6195d37779c"><div class="ttname"><a href="structtrx__t.html#ae2412d7b54b8f8c98a0ae6195d37779c">trx_t::error_state</a></div><div class="ttdeci">dberr_t error_state</div><div class="ttdoc">0 if no error, otherwise error number; NOTE That ONLY the thread doing the transaction is allowed to ...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1111</div></div>
<div class="ttc" id="trx0trx_8h_html_a087a90c619c86978766f279a156dae2e"><div class="ttname"><a href="trx0trx_8h.html#a087a90c619c86978766f279a156dae2e">trx_is_autocommit_non_locking</a></div><div class="ttdeci">#define trx_is_autocommit_non_locking(t)</div><div class="ttdoc">Determine if the transaction is a non-locking autocommit select (implied read-only). </div><div class="ttdef"><b>Definition:</b> trx0trx.h:450</div></div>
<div class="ttc" id="structtrx__lock__t_html_abe07936c64ae62254ce3e9ac845d0a02"><div class="ttname"><a href="structtrx__lock__t.html#abe07936c64ae62254ce3e9ac845d0a02">trx_lock_t::was_chosen_as_deadlock_victim</a></div><div class="ttdeci">bool was_chosen_as_deadlock_victim</div><div class="ttdoc">when the transaction decides to wait for a lock, it sets this to false; if another transaction choose...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:648</div></div>
<div class="ttc" id="structtrx__rsegs__t_html_a0aae8ec577276dafc1b8733e527beea7"><div class="ttname"><a href="structtrx__rsegs__t.html#a0aae8ec577276dafc1b8733e527beea7">trx_rsegs_t::m_noredo</a></div><div class="ttdeci">trx_undo_ptr_t m_noredo</div><div class="ttdoc">undo log ptr holding reference to a rollback segment that resides in temp tablespace used for undo lo...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:824</div></div>
<div class="ttc" id="trx0trx_8h_html_ae0c29148646b50fa199ed713bde256b6"><div class="ttname"><a href="trx0trx_8h.html#ae0c29148646b50fa199ed713bde256b6">trx_commit_complete_for_mysql</a></div><div class="ttdeci">void trx_commit_complete_for_mysql(trx_t *trx)</div><div class="ttdoc">If required, flushes the log to disk if we called trx_commit_for_mysql() with trx-&gt;flush_log_later ==...</div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2325</div></div>
<div class="ttc" id="structfts__trx__t_html"><div class="ttname"><a href="structfts__trx__t.html">fts_trx_t</a></div><div class="ttdoc">Information about changes in a single transaction affecting the FTS system. </div><div class="ttdef"><b>Definition:</b> fts0fts.h:229</div></div>
<div class="ttc" id="trx0types_8h_html_a14bf14fe533410dc0d7b3bb9e99afcfea715252714bf7cbda62aeeed0f155ba59"><div class="ttname"><a href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfea715252714bf7cbda62aeeed0f155ba59">TRX_STATE_FORCED_ROLLBACK</a></div><div class="ttdoc">Same as not started but with additional semantics that it was rolled back asynchronously the last tim...</div><div class="ttdef"><b>Definition:</b> trx0types.h:92</div></div>
<div class="ttc" id="structtrx__t_html_ab5c05ba139deae47e8e05e2e0d1ac38ca7a293644531f3b2913bc427939620d0a"><div class="ttname"><a href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38ca7a293644531f3b2913bc427939620d0a">trx_t::READ_COMMITTED</a></div><div class="ttdoc">somewhat Oracle-like isolation, except that in range UPDATE and DELETE we must block phantom rows wit...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:847</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a4292a9044022a83369c61505c792fe1a"><div class="ttname"><a href="classTrxInInnoDB.html#a4292a9044022a83369c61505c792fe1a">TrxInInnoDB::enter</a></div><div class="ttdeci">static void enter(trx_t *trx, bool disable)</div><div class="ttdoc">Note that we have crossed into InnoDB code. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1411</div></div>
<div class="ttc" id="trx0trx_8h_html_ac4d97ad86d27e5c07b87a6c1b149f4d9"><div class="ttname"><a href="trx0trx_8h.html#ac4d97ad86d27e5c07b87a6c1b149f4d9">trx_print</a></div><div class="ttdeci">void trx_print(FILE *f, const trx_t *trx, ulint max_query_len)</div><div class="ttdoc">Prints info about a transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2508</div></div>
<div class="ttc" id="structtrx__t_html_a15709656eb05fd1d83aba4f7442eca0b"><div class="ttname"><a href="structtrx__t.html#a15709656eb05fd1d83aba4f7442eca0b">trx_t::n_autoinc_rows</a></div><div class="ttdeci">ulint n_autoinc_rows</div><div class="ttdoc">no. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1165</div></div>
<div class="ttc" id="trx0trx_8h_html_abdf39b1615cfa159e1dc50f50d97141c"><div class="ttname"><a href="trx0trx_8h.html#abdf39b1615cfa159e1dc50f50d97141c">trx_assign_read_view</a></div><div class="ttdeci">ReadView * trx_assign_read_view(trx_t *trx)</div><div class="ttdoc">Assigns a read view for a consistent read query. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2154</div></div>
<div class="ttc" id="structtrx__t_html_aedf3ed571c05d89fc0218d03d82abe25"><div class="ttname"><a href="structtrx__t.html#aedf3ed571c05d89fc0218d03d82abe25">trx_t::read_write</a></div><div class="ttdeci">bool read_write</div><div class="ttdoc">if read and write operation </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1228</div></div>
<div class="ttc" id="structtrx__t_html_ac284f3e3e9c3b7210e267c21197cbda6"><div class="ttname"><a href="structtrx__t.html#ac284f3e3e9c3b7210e267c21197cbda6">trx_t::is_read_uncommitted</a></div><div class="ttdeci">bool is_read_uncommitted() const</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1248</div></div>
<div class="ttc" id="trx0trx_8h_html_adcc5876d6636810e0b96bd22ea5a3e6f"><div class="ttname"><a href="trx0trx_8h.html#adcc5876d6636810e0b96bd22ea5a3e6f">trx_set_flush_observer</a></div><div class="ttdeci">void trx_set_flush_observer(trx_t *trx, FlushObserver *observer)</div><div class="ttdoc">Set flush observer for the transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:119</div></div>
<div class="ttc" id="structtrx__rsegs__t_html_a4abdf5295c90071b307d6800c22767c4"><div class="ttname"><a href="structtrx__rsegs__t.html#a4abdf5295c90071b307d6800c22767c4">trx_rsegs_t::m_redo</a></div><div class="ttdeci">trx_undo_ptr_t m_redo</div><div class="ttdoc">undo log ptr holding reference to a rollback segment that resides in system/undo tablespace used for ...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:819</div></div>
<div class="ttc" id="structtrx__t_html_abde7eaeb327d25c61dd2381ad9b24e69"><div class="ttname"><a href="structtrx__t.html#abde7eaeb327d25c61dd2381ad9b24e69">trx_t::error_index</a></div><div class="ttdeci">const dict_index_t * error_index</div><div class="ttdoc">if the error number indicates a duplicate key error, a pointer to the problematic index is stored her...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1116</div></div>
<div class="ttc" id="structtrx__t_html_a5d9eba066c500418ac7196888c77b4e1"><div class="ttname"><a href="structtrx__t.html#a5d9eba066c500418ac7196888c77b4e1">trx_t::is_dd_trx</a></div><div class="ttdeci">bool is_dd_trx</div><div class="ttdoc">True if the transaction is used for doing Non-locking Read-only Read Committed on DD tables...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1242</div></div>
<div class="ttc" id="trx0trx_8h_html_a49e6e5415aa5cddeb201c75974f4f51d"><div class="ttname"><a href="trx0trx_8h.html#a49e6e5415aa5cddeb201c75974f4f51d">trx_kill_blocking</a></div><div class="ttdeci">void trx_kill_blocking(trx_t *trx)</div><div class="ttdoc">If this is a high priority transaction, kill all transactions that are blocking this transaction from...</div><div class="ttdef"><b>Definition:</b> trx0trx.cc:3206</div></div>
<div class="ttc" id="structtrx__lock__t_html_adb0a194559352f5ee17e901cb23545e2"><div class="ttname"><a href="structtrx__lock__t.html#adb0a194559352f5ee17e901cb23545e2">trx_lock_t::autoinc_locks</a></div><div class="ttdeci">ib_vector_t * autoinc_locks</div><div class="ttdoc">AUTOINC locks held by this transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:705</div></div>
<div class="ttc" id="structcommit__node__t_html"><div class="ttname"><a href="structcommit__node__t.html">commit_node_t</a></div><div class="ttdoc">Commit command node in a query graph. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1293</div></div>
<div class="ttc" id="structtrx__undo__ptr__t_html_ab0da0621a5c40ca1d8883352a204ac1c"><div class="ttname"><a href="structtrx__undo__ptr__t.html#ab0da0621a5c40ca1d8883352a204ac1c">trx_undo_ptr_t::rseg</a></div><div class="ttdeci">trx_rseg_t * rseg</div><div class="ttdoc">rollback segment assigned to the transaction, or NULL if not assigned yet </div><div class="ttdef"><b>Definition:</b> trx0trx.h:805</div></div>
<div class="ttc" id="namespaceconsts_html_a2497d532ccb12f859b91cdaba0fb4c9a"><div class="ttname"><a href="namespaceconsts.html#a2497d532ccb12f859b91cdaba0fb4c9a">consts::FILE</a></div><div class="ttdeci">const std::string FILE(&quot;FILE&quot;)</div></div>
<div class="ttc" id="trx0trx_8h_html_a8acaf6c0654f6e9825f06d0abc109d17"><div class="ttname"><a href="trx0trx_8h.html#a8acaf6c0654f6e9825f06d0abc109d17">trx_assign_rseg_temp</a></div><div class="ttdeci">void trx_assign_rseg_temp(trx_t *trx)</div><div class="ttdoc">Assign a temp-tablespace bound rollback-segment to a transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:1189</div></div>
<div class="ttc" id="trx0trx_8h_html_ae2c2545708daee0f7c0f7b88b14be7ada5c185d046ad70533f17062eef4eaa413"><div class="ttname"><a href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ada5c185d046ad70533f17062eef4eaa413">TRX_RSEG_TYPE_NONE</a></div><div class="ttdoc">void rollback segment type. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:828</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a909e1bf34371c21294a4d4f419fb60ca"><div class="ttname"><a href="classTrxInInnoDB.html#a909e1bf34371c21294a4d4f419fb60ca">TrxInInnoDB::exit</a></div><div class="ttdeci">static void exit(trx_t *trx)</div><div class="ttdoc">Note that we are exiting InnoDB code. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1458</div></div>
<div class="ttc" id="structmem__block__info__t_html"><div class="ttname"><a href="structmem__block__info__t.html">mem_block_info_t</a></div><div class="ttdoc">The info structure stored at the beginning of a heap block. </div><div class="ttdef"><b>Definition:</b> mem0mem.h:349</div></div>
<div class="ttc" id="log0log_8h_html"><div class="ttname"><a href="log0log_8h.html">log0log.h</a></div><div class="ttdoc">Redo log constants and functions. </div></div>
<div class="ttc" id="structtrx__t_html_ab5c05ba139deae47e8e05e2e0d1ac38caf03f2a86cf3d23a65c93aff89fd26d36"><div class="ttname"><a href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38caf03f2a86cf3d23a65c93aff89fd26d36">trx_t::READ_UNCOMMITTED</a></div><div class="ttdoc">dirty read: non-locking SELECTs are performed so that we do not look at a possible earlier version of...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:840</div></div>
<div class="ttc" id="trx0trx_8h_html_afd763791d1b59356b2d0f6f4ca90cae4"><div class="ttname"><a href="trx0trx_8h.html#afd763791d1b59356b2d0f6f4ca90cae4">trx_is_strict</a></div><div class="ttdeci">ibool trx_is_strict(trx_t *trx)</div><div class="ttdoc">Determines if the currently running transaction is in strict mode. </div><div class="ttdef"><b>Definition:</b> ha_innodb.cc:2874</div></div>
<div class="ttc" id="trx0types_8h_html_a365d8e86502c13b65cd1749fd453f75a"><div class="ttname"><a href="trx0types_8h.html#a365d8e86502c13b65cd1749fd453f75a">TRX_FORCE_ROLLBACK_MASK</a></div><div class="ttdeci">static const ib_uint32_t TRX_FORCE_ROLLBACK_MASK</div><div class="ttdoc">For masking out the above four flags. </div><div class="ttdef"><b>Definition:</b> trx0types.h:74</div></div>
<div class="ttc" id="trx0trx_8h_html_af273fab04e0e0f86def42b181448203f"><div class="ttname"><a href="trx0trx_8h.html#af273fab04e0e0f86def42b181448203f">trx_commit_or_rollback_prepare</a></div><div class="ttdeci">void trx_commit_or_rollback_prepare(trx_t *trx)</div><div class="ttdoc">Prepares a transaction for commit/rollback. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2170</div></div>
<div class="ttc" id="structtrx__rseg__t_html"><div class="ttname"><a href="structtrx__rseg__t.html">trx_rseg_t</a></div><div class="ttdoc">The rollback segment memory object. </div><div class="ttdef"><b>Definition:</b> trx0types.h:183</div></div>
<div class="ttc" id="structque__fork__t_html"><div class="ttname"><a href="structque__fork__t.html">que_fork_t</a></div><div class="ttdef"><b>Definition:</b> que0que.h:310</div></div>
<div class="ttc" id="trx0trx_8h_html_affaac0949d19f8f98f68fd6cb8ab6429"><div class="ttname"><a href="trx0trx_8h.html#affaac0949d19f8f98f68fd6cb8ab6429">trx_commit_node_create</a></div><div class="ttdeci">commit_node_t * trx_commit_node_create(mem_heap_t *heap)</div><div class="ttdoc">Creates a commit command node struct. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2210</div></div>
<div class="ttc" id="structtrx__savept__t_html"><div class="ttname"><a href="structtrx__savept__t.html">trx_savept_t</a></div><div class="ttdoc">Transaction savepoint. </div><div class="ttdef"><b>Definition:</b> trx0types.h:154</div></div>
<div class="ttc" id="structtrx__t_html_af79f0debdd3a9185d8d6c94d29b279ed"><div class="ttname"><a href="structtrx__t.html#af79f0debdd3a9185d8d6c94d29b279ed">trx_t::mod_tables</a></div><div class="ttdeci">trx_mod_tables_t mod_tables</div><div class="ttdoc">List of tables that were modified by this transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1222</div></div>
<div class="ttc" id="srv0srv_8h_html"><div class="ttname"><a href="srv0srv_8h.html">srv0srv.h</a></div><div class="ttdoc">The server main program. </div></div>
<div class="ttc" id="que0types_8h_html"><div class="ttname"><a href="que0types_8h.html">que0types.h</a></div><div class="ttdoc">Query graph global types. </div></div>
<div class="ttc" id="trx0types_8h_html_a14bf14fe533410dc0d7b3bb9e99afcfeab6d43468942f04bb539f0a0ef3fda5e7"><div class="ttname"><a href="trx0types_8h.html#a14bf14fe533410dc0d7b3bb9e99afcfeab6d43468942f04bb539f0a0ef3fda5e7">TRX_STATE_NOT_STARTED</a></div><div class="ttdef"><b>Definition:</b> trx0types.h:88</div></div>
<div class="ttc" id="fts0fts_8h_html"><div class="ttname"><a href="fts0fts_8h.html">fts0fts.h</a></div><div class="ttdoc">Full text search header file. </div></div>
<div class="ttc" id="classTrxInInnoDB_html_a630f7ef14772bae3b5af7fac9cd5f533"><div class="ttname"><a href="classTrxInInnoDB.html#a630f7ef14772bae3b5af7fac9cd5f533">TrxInInnoDB::is_forced_rollback</a></div><div class="ttdeci">static bool is_forced_rollback(const trx_t *trx)</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1484</div></div>
<div class="ttc" id="structtrx__lock__t_html_a30ee2ac214b98e29698601177dbf3cd6"><div class="ttname"><a href="structtrx__lock__t.html#a30ee2ac214b98e29698601177dbf3cd6">trx_lock_t::blocking_trx</a></div><div class="ttdeci">std::atomic&lt; trx_t * &gt; blocking_trx</div><div class="ttdoc">If this transaction is waiting for a lock, then blocking_trx points to a transaction which holds a co...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:597</div></div>
<div class="ttc" id="structtrx__t_html_a457f9022ae67faf4b8034828367eaa83"><div class="ttname"><a href="structtrx__t.html#a457f9022ae67faf4b8034828367eaa83">trx_t::graph</a></div><div class="ttdeci">que_t * graph</div><div class="ttdoc">query currently run in the session, or NULL if none; NOTE that the query belongs to the session...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1123</div></div>
<div class="ttc" id="trx0trx_8h_html_a1c64d381cc36d6df16ab94be98f23116"><div class="ttname"><a href="trx0trx_8h.html#a1c64d381cc36d6df16ab94be98f23116">trx_dummy_sess</a></div><div class="ttdeci">sess_t * trx_dummy_sess</div><div class="ttdoc">Dummy session used currently in MySQL interface. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:86</div></div>
<div class="ttc" id="lexyy_8cc_html_ab1e07f9aa81ac38a87216b019d3b5a8b"><div class="ttname"><a href="lexyy_8cc.html#ab1e07f9aa81ac38a87216b019d3b5a8b">exit</a></div><div class="ttdeci">#define exit(A)</div><div class="ttdef"><b>Definition:</b> lexyy.cc:917</div></div>
<div class="ttc" id="trx0trx_8h_html_a5d672f17aef4ef582fbd8f80ad5ae756"><div class="ttname"><a href="trx0trx_8h.html#a5d672f17aef4ef582fbd8f80ad5ae756">trx_print_latched</a></div><div class="ttdeci">void trx_print_latched(FILE *f, const trx_t *trx, ulint max_query_len)</div><div class="ttdoc">Prints info about a transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2497</div></div>
<div class="ttc" id="structtrx__lock__t_html_a5cdbd90ac21c4ea933e01e835dfe27a2"><div class="ttname"><a href="structtrx__lock__t.html#a5cdbd90ac21c4ea933e01e835dfe27a2">trx_lock_t::in_rollback</a></div><div class="ttdeci">bool in_rollback</div><div class="ttdoc">When a transaction is forced to rollback due to a deadlock check or by another high priority transact...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:733</div></div>
<div class="ttc" id="trx0trx_8h_html_aaae4a91cb2920a6e0ac1465c3eee7409"><div class="ttname"><a href="trx0trx_8h.html#aaae4a91cb2920a6e0ac1465c3eee7409">trx_commit_low</a></div><div class="ttdeci">void trx_commit_low(trx_t *trx, mtr_t *mtr)</div><div class="ttdoc">Commits a transaction and a mini-transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:1999</div></div>
<div class="ttc" id="trx0trx_8h_html_aae1bd920335932721b515f79139404ca"><div class="ttname"><a href="trx0trx_8h.html#aae1bd920335932721b515f79139404ca">trx_is_mysql_xa</a></div><div class="ttdeci">bool trx_is_mysql_xa(const trx_t *trx)</div><div class="ttdoc">Check if transaction is internal XA transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2781</div></div>
<div class="ttc" id="trx0trx_8h_html_a690d5d04746f73ed3a29199e45fdcf29"><div class="ttname"><a href="trx0trx_8h.html#a690d5d04746f73ed3a29199e45fdcf29">trx_get_dict_operation</a></div><div class="ttdeci">UNIV_INLINE enum trx_dict_op_t trx_get_dict_operation(const trx_t *trx)</div><div class="ttdoc">Determine if a transaction is a dictionary operation. </div></div>
<div class="ttc" id="fts0fts_8h_html_a380910af8d69503a3e3dcbf6d809a3b6"><div class="ttname"><a href="fts0fts_8h.html#a380910af8d69503a3e3dcbf6d809a3b6">doc_id_t</a></div><div class="ttdeci">ib_uint64_t doc_id_t</div><div class="ttdoc">Document id type. </div><div class="ttdef"><b>Definition:</b> fts0fts.h:76</div></div>
<div class="ttc" id="trx0trx_8h_html_a8fb6471220ce01c07a8fae94bf27b989"><div class="ttname"><a href="trx0trx_8h.html#a8fb6471220ce01c07a8fae94bf27b989">trx_can_be_handled_by_current_thread</a></div><div class="ttdeci">bool trx_can_be_handled_by_current_thread(const trx_t *trx)</div><div class="ttdoc">Determines if trx can be handled by current thread, which is when trx-&gt;mysql_thd is nullptr (a &quot;backg...</div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2517</div></div>
<div class="ttc" id="dict0types_8h_html"><div class="ttname"><a href="dict0types_8h.html">dict0types.h</a></div><div class="ttdoc">Data dictionary global types. </div></div>
<div class="ttc" id="trx0trx_8h_html_aeda504c072953ddfe34988fe729ba0c5a58c5533d962091dde4f36df4ef999012"><div class="ttname"><a href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5a58c5533d962091dde4f36df4ef999012">COMMIT_NODE_SEND</a></div><div class="ttdoc">about to send a commit signal to the transaction </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1286</div></div>
<div class="ttc" id="structtrx__lock__t_html_afc47115095f89b26d9b3ed0a024d04d9"><div class="ttname"><a href="structtrx__lock__t.html#afc47115095f89b26d9b3ed0a024d04d9">trx_lock_t::table_cached</a></div><div class="ttdeci">ulint table_cached</div><div class="ttdoc">Next free table lock in pool. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:679</div></div>
<div class="ttc" id="trx0trx_8h_html_a4ddb5503a735f4540830f8fff6ed05d7"><div class="ttname"><a href="trx0trx_8h.html#a4ddb5503a735f4540830f8fff6ed05d7">trx_disconnect_plain</a></div><div class="ttdeci">void trx_disconnect_plain(trx_t *trx)</div><div class="ttdoc">Disconnect a transaction from MySQL. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:657</div></div>
<div class="ttc" id="structtrx__undo__ptr__t_html_aff789791d03c80f21465bf48821caad7"><div class="ttname"><a href="structtrx__undo__ptr__t.html#aff789791d03c80f21465bf48821caad7">trx_undo_ptr_t::is_empty</a></div><div class="ttdeci">bool is_empty()</div><div class="ttdef"><b>Definition:</b> trx0trx.h:798</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a25769c9f91b640c54126c2420d8fc3c4"><div class="ttname"><a href="classTrxInInnoDB.html#a25769c9f91b640c54126c2420d8fc3c4">TrxInInnoDB::begin_stmt</a></div><div class="ttdeci">static void begin_stmt(trx_t *trx)</div><div class="ttdoc">Start statement requested for transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1393</div></div>
<div class="ttc" id="trx0trx_8h_html_a5779006f2811622c6c980e36c7837441"><div class="ttname"><a href="trx0trx_8h.html#a5779006f2811622c6c980e36c7837441">trx_free_resurrected</a></div><div class="ttdeci">void trx_free_resurrected(trx_t *trx)</div><div class="ttdoc">Free and initialize a transaction object instantiated during recovery. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:577</div></div>
<div class="ttc" id="trx0trx_8h_html_a76e191adc5826a5f78886df503183ebe"><div class="ttname"><a href="trx0trx_8h.html#a76e191adc5826a5f78886df503183ebe">trx_mark_sql_stat_end</a></div><div class="ttdeci">void trx_mark_sql_stat_end(trx_t *trx)</div><div class="ttdoc">Marks the latest SQL statement ended. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2343</div></div>
<div class="ttc" id="structtrx__lock__t_html_ae2ab8b4add0aaff028acf918f8334a9e"><div class="ttname"><a href="structtrx__lock__t.html#ae2ab8b4add0aaff028acf918f8334a9e">trx_lock_t::rec_pool</a></div><div class="ttdeci">lock_pool_t rec_pool</div><div class="ttdoc">Pre-allocated record locks. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:670</div></div>
<div class="ttc" id="trx0trx_8h_html_aeda504c072953ddfe34988fe729ba0c5a9e0ee8ee1fef6293a6178e3bd1288d93"><div class="ttname"><a href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5a9e0ee8ee1fef6293a6178e3bd1288d93">COMMIT_NODE_WAIT</a></div><div class="ttdoc">commit signal sent to the transaction, waiting for completion </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1288</div></div>
<div class="ttc" id="structcommit__node__t_html_a81b9e989be432c69cb399afbaf7ba82d"><div class="ttname"><a href="structcommit__node__t.html#a81b9e989be432c69cb399afbaf7ba82d">commit_node_t::common</a></div><div class="ttdeci">que_common_t common</div><div class="ttdoc">node type: QUE_NODE_COMMIT </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1294</div></div>
<div class="ttc" id="structtrx__t_html_a4bb27b88bf50850a7d8da80086fa425b"><div class="ttname"><a href="structtrx__t.html#a4bb27b88bf50850a7d8da80086fa425b">trx_t::fts_next_doc_id</a></div><div class="ttdeci">doc_id_t fts_next_doc_id</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1186</div></div>
<div class="ttc" id="structtrx__t_html_a19f3ba5572d4482d21db02baad2b0d97"><div class="ttname"><a href="structtrx__t.html#a19f3ba5572d4482d21db02baad2b0d97">trx_t::flush_tables</a></div><div class="ttdeci">ib_uint32_t flush_tables</div><div class="ttdoc">if &quot;covering&quot; the FLUSH TABLES&quot;, count of tables being flushed. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1188</div></div>
<div class="ttc" id="db0err_8h_html_a6fdd08971b32ee513b20967238f1654d"><div class="ttname"><a href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a></div><div class="ttdeci">dberr_t</div><div class="ttdef"><b>Definition:</b> db0err.h:38</div></div>
<div class="ttc" id="trx0trx_8h_html_ab53d050821092784b2653e176263c5d2"><div class="ttname"><a href="trx0trx_8h.html#ab53d050821092784b2653e176263c5d2">trx_recover_for_mysql</a></div><div class="ttdeci">int trx_recover_for_mysql(XA_recover_txn *txn_list, ulint len, MEM_ROOT *mem_root)</div><div class="ttdoc">This function is used to find number of prepared transactions and their transaction objects for a rec...</div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2965</div></div>
<div class="ttc" id="structsess__t_html"><div class="ttname"><a href="structsess__t.html">sess_t</a></div><div class="ttdef"><b>Definition:</b> usr0sess.h:53</div></div>
<div class="ttc" id="trx0trx_8h_html_ae2c2545708daee0f7c0f7b88b14be7adac8063fb269c9aa562acaf56267ddc56e"><div class="ttname"><a href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7adac8063fb269c9aa562acaf56267ddc56e">TRX_RSEG_TYPE_REDO</a></div><div class="ttdoc">redo rollback segment. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:829</div></div>
<div class="ttc" id="trx0types_8h_html_a885c60219b17a02d06d4ab096803c02a"><div class="ttname"><a href="trx0types_8h.html#a885c60219b17a02d06d4ab096803c02a">TRX_FORCE_ROLLBACK</a></div><div class="ttdeci">static const ib_uint32_t TRX_FORCE_ROLLBACK</div><div class="ttdoc">Mark the transaction for forced rollback. </div><div class="ttdef"><b>Definition:</b> trx0types.h:71</div></div>
<div class="ttc" id="classFlushObserver_html"><div class="ttname"><a href="classFlushObserver.html">FlushObserver</a></div><div class="ttdoc">We use FlushObserver to track flushing of non-redo logged pages in bulk create index(BtrBulk.cc).Since we disable redo logging during a index build, we need to make sure that all dirty pages modifed by the index build are flushed to disk before any redo logged operations go to the index. </div><div class="ttdef"><b>Definition:</b> buf0flu.h:275</div></div>
<div class="ttc" id="ut0new_8h_html"><div class="ttname"><a href="ut0new_8h.html">ut0new.h</a></div><div class="ttdoc">Instrumented memory allocator. </div></div>
<div class="ttc" id="structtrx__t_html_a0ec41ae60612631ff8224f6e7e6c8c2f"><div class="ttname"><a href="structtrx__t.html#a0ec41ae60612631ff8224f6e7e6c8c2f">trx_t::detailed_error</a></div><div class="ttdeci">char * detailed_error</div><div class="ttdoc">detailed error message for last error, or empty. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1237</div></div>
<div class="ttc" id="structtrx__t_html_a5c2f836e619c3197a2c59a440a624198"><div class="ttname"><a href="structtrx__t.html#a5c2f836e619c3197a2c59a440a624198">trx_t::auto_commit</a></div><div class="ttdeci">bool auto_commit</div><div class="ttdoc">true if it is an autocommit </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1177</div></div>
<div class="ttc" id="structque__thr__t_html"><div class="ttname"><a href="structque__thr__t.html">que_thr_t</a></div><div class="ttdef"><b>Definition:</b> que0que.h:251</div></div>
<div class="ttc" id="structib__vector__t_html"><div class="ttname"><a href="structib__vector__t.html">ib_vector_t</a></div><div class="ttdef"><b>Definition:</b> ut0vec.h:229</div></div>
<div class="ttc" id="structtrx__t_html_ac35e25ceef180540ee22769c1a06c4d1"><div class="ttname"><a href="structtrx__t.html#ac35e25ceef180540ee22769c1a06c4d1">trx_t::read_only</a></div><div class="ttdeci">bool read_only</div><div class="ttdoc">true if transaction is flagged as a READ-ONLY transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1169</div></div>
<div class="ttc" id="structtrx__lock__t_html_a5b5a11c3bcbef8f9f71497710587ba90"><div class="ttname"><a href="structtrx__lock__t.html#a5b5a11c3bcbef8f9f71497710587ba90">trx_lock_t::que_state</a></div><div class="ttdeci">trx_que_t que_state</div><div class="ttdoc">valid when trx-&gt;state == TRX_STATE_ACTIVE: TRX_QUE_RUNNING, TRX_QUE_LOCK_WAIT, ... </div><div class="ttdef"><b>Definition:</b> trx0trx.h:565</div></div>
<div class="ttc" id="structtrx__lock__t_html_a4ab2bc88e411af161ff3c1e447c30ae4"><div class="ttname"><a href="structtrx__lock__t.html#a4ab2bc88e411af161ff3c1e447c30ae4">trx_lock_t::wait_started</a></div><div class="ttdeci">time_t wait_started</div><div class="ttdoc">Lock wait started at this time. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:659</div></div>
<div class="ttc" id="trx0trx_8h_html_af21f360b739c58f875010707f9740b46"><div class="ttname"><a href="trx0trx_8h.html#af21f360b739c58f875010707f9740b46">trx_release_reference</a></div><div class="ttdeci">UNIV_INLINE void trx_release_reference(trx_t *trx)</div><div class="ttdoc">Release the transaction. </div></div>
<div class="ttc" id="trx0trx_8h_html_afda78355fbbfe044da5291535faa95fb"><div class="ttname"><a href="trx0trx_8h.html#afda78355fbbfe044da5291535faa95fb">trx_print_low</a></div><div class="ttdeci">void trx_print_low(FILE *f, const trx_t *trx, ulint max_query_len, ulint n_rec_locks, ulint n_trx_locks, ulint heap_size)</div><div class="ttdoc">Prints info about a transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2373</div></div>
<div class="ttc" id="trx0trx_8h_html_a65eef27d572e0d6a6d089486c6776811"><div class="ttname"><a href="trx0trx_8h.html#a65eef27d572e0d6a6d089486c6776811">trx_sys_update_binlog_position</a></div><div class="ttdeci">void trx_sys_update_binlog_position(trx_t *trx)</div><div class="ttdoc">Update transaction binlog file name and position from session THD. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:3364</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a5ae11fcca8880c3d7af61b21df0fb18a"><div class="ttname"><a href="classTrxInInnoDB.html#a5ae11fcca8880c3d7af61b21df0fb18a">TrxInInnoDB::~TrxInInnoDB</a></div><div class="ttdeci">~TrxInInnoDB()</div><div class="ttdoc">Destructor. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1363</div></div>
<div class="ttc" id="structxid__t_html"><div class="ttname"><a href="structxid__t.html">xid_t</a></div><div class="ttdoc">struct xid_t is binary compatible with the XID structure as in the X/Open CAE Specification, Distributed Transaction Processing: The XA Specification, X/Open Company Ltd., 1991. </div><div class="ttdef"><b>Definition:</b> xa.h:215</div></div>
<div class="ttc" id="test__sql__9__sessions_8cc_html_af6a786aadb2fc26d9c6d8dcb60c181f9"><div class="ttname"><a href="test__sql__9__sessions_8cc.html#af6a786aadb2fc26d9c6d8dcb60c181f9">msg</a></div><div class="ttdeci">char msg[1024]</div><div class="ttdef"><b>Definition:</b> test_sql_9_sessions.cc:281</div></div>
<div class="ttc" id="trx0trx_8h_html_af9bee0e9d7331369cd78cd83247b79b3"><div class="ttname"><a href="trx0trx_8h.html#af9bee0e9d7331369cd78cd83247b79b3">trx_cleanup_at_db_startup</a></div><div class="ttdeci">void trx_cleanup_at_db_startup(trx_t *trx)</div><div class="ttdoc">Cleans up a transaction at database startup. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2114</div></div>
<div class="ttc" id="trx0trx_8h_html_a2897a812badb5f6c9f6ebdc5a0f84ae9"><div class="ttname"><a href="trx0trx_8h.html#a2897a812badb5f6c9f6ebdc5a0f84ae9">trx_set_dict_operation</a></div><div class="ttdeci">UNIV_INLINE void trx_set_dict_operation(trx_t *trx, enum trx_dict_op_t op)</div><div class="ttdoc">Flag a transaction a dictionary operation. </div></div>
<div class="ttc" id="trx0types_8h_html"><div class="ttname"><a href="trx0types_8h.html">trx0types.h</a></div><div class="ttdoc">Transaction system global type definitions. </div></div>
<div class="ttc" id="structtrx__t_html_a128e331c12ccd0ed63f23d8bc7c63db4"><div class="ttname"><a href="structtrx__t.html#a128e331c12ccd0ed63f23d8bc7c63db4">trx_t::allow_semi_consistent</a></div><div class="ttdeci">bool allow_semi_consistent() const</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1265</div></div>
<div class="ttc" id="trx0trx_8h_html_ac39e946db2a5f720fe25d2a5aeae914c"><div class="ttname"><a href="trx0trx_8h.html#ac39e946db2a5f720fe25d2a5aeae914c">trx_reference</a></div><div class="ttdeci">UNIV_INLINE trx_t * trx_reference(trx_t *trx, bool do_ref_count)</div><div class="ttdoc">Increase the reference count. </div></div>
<div class="ttc" id="classTrxInInnoDB_html_af05b1d974b47d5c1641a7fe9467313af"><div class="ttname"><a href="classTrxInInnoDB.html#af05b1d974b47d5c1641a7fe9467313af">TrxInInnoDB::TrxInInnoDB</a></div><div class="ttdeci">TrxInInnoDB(trx_t *trx, bool disable=false)</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1357</div></div>
<div class="ttc" id="structtrx__t_html_ae1c5ba51f5d0506b2d4bab3d3e293e1a"><div class="ttname"><a href="structtrx__t.html#ae1c5ba51f5d0506b2d4bab3d3e293e1a">trx_t::persists_gtid</a></div><div class="ttdeci">bool persists_gtid</div><div class="ttdoc">Transaction persists GTID. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1198</div></div>
<div class="ttc" id="structtrx__undo__ptr__t_html_a72820a898bd5e339ecd05f94156aeed0"><div class="ttname"><a href="structtrx__undo__ptr__t.html#a72820a898bd5e339ecd05f94156aeed0">trx_undo_ptr_t::update_undo</a></div><div class="ttdeci">trx_undo_t * update_undo</div><div class="ttdoc">pointer to the update undo log, or NULL if no update performed yet </div><div class="ttdef"><b>Definition:</b> trx0trx.h:810</div></div>
<div class="ttc" id="structque__common__t_html"><div class="ttname"><a href="structque__common__t.html">que_common_t</a></div><div class="ttdef"><b>Definition:</b> que0types.h:50</div></div>
<div class="ttc" id="trx0trx_8h_html_ac618a169bc66ee27280522b021a2d9ae"><div class="ttname"><a href="trx0trx_8h.html#ac618a169bc66ee27280522b021a2d9ae">trx_get_read_view</a></div><div class="ttdeci">UNIV_INLINE ReadView * trx_get_read_view(trx_t *trx)</div></div>
<div class="ttc" id="structtrx__t_html_a53afd3bacfbb923b9286f7f576ec542e"><div class="ttname"><a href="structtrx__t.html#a53afd3bacfbb923b9286f7f576ec542e">trx_t::flush_observer</a></div><div class="ttdeci">FlushObserver * flush_observer</div><div class="ttdoc">flush observer </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1239</div></div>
<div class="ttc" id="structtrx__t_html_a5d0ace463c8eb18ed152f9400395a308"><div class="ttname"><a href="structtrx__t.html#a5d0ace463c8eb18ed152f9400395a308">trx_t::state</a></div><div class="ttdeci">trx_state_t state</div><div class="ttdoc">State of the trx from the point of view of concurrency control and the valid state transitions...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:955</div></div>
<div class="ttc" id="structtrx__t_html_abce36312c38d56aedb25471e8c8c7b43"><div class="ttname"><a href="structtrx__t.html#abce36312c38d56aedb25471e8c8c7b43">trx_t::version</a></div><div class="ttdeci">ulint version</div><div class="ttdoc">Version of this instance. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1217</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a84d67a41f3d5d6f43f21759bcfde763b"><div class="ttname"><a href="classTrxInInnoDB.html#a84d67a41f3d5d6f43f21759bcfde763b">TrxInInnoDB::is_aborted</a></div><div class="ttdeci">bool is_aborted() const</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1368</div></div>
<div class="ttc" id="client__plugin_8cc_html_a7d0fe2f135db987da18cea87b4778737"><div class="ttname"><a href="client__plugin_8cc.html#a7d0fe2f135db987da18cea87b4778737">mem_root</a></div><div class="ttdeci">static MEM_ROOT mem_root</div><div class="ttdef"><b>Definition:</b> client_plugin.cc:109</div></div>
<div class="ttc" id="mem0mem_8h_html"><div class="ttname"><a href="mem0mem_8h.html">mem0mem.h</a></div><div class="ttdoc">The memory management. </div></div>
<div class="ttc" id="trx0types_8h_html_a34bba6fbd37f499f7874fc416547759f"><div class="ttname"><a href="trx0types_8h.html#a34bba6fbd37f499f7874fc416547759f">trx_que_t</a></div><div class="ttdeci">trx_que_t</div><div class="ttdoc">Transaction execution states when trx-&gt;state == TRX_STATE_ACTIVE. </div><div class="ttdef"><b>Definition:</b> trx0types.h:77</div></div>
<div class="ttc" id="api0api_8h_html_a02e9c11b4a9783f4b0b89fcf060f8f28"><div class="ttname"><a href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a></div><div class="ttdeci">uint32 space_id_t</div><div class="ttdoc">Tablespace identifier. </div><div class="ttdef"><b>Definition:</b> api0api.h:59</div></div>
<div class="ttc" id="trx0trx_8h_html_a62da6d484835d0aab2f3aa1b5c4cfa0d"><div class="ttname"><a href="trx0trx_8h.html#a62da6d484835d0aab2f3aa1b5c4cfa0d">trx_resurrect_locks</a></div><div class="ttdeci">void trx_resurrect_locks()</div><div class="ttdoc">Resurrect table locks for resurrected transactions. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:731</div></div>
<div class="ttc" id="structtrx__t_html_a6a3af5f2bb3c013cf0be87f00acb33c5"><div class="ttname"><a href="structtrx__t.html#a6a3af5f2bb3c013cf0be87f00acb33c5">trx_t::in_mysql_trx_list</a></div><div class="ttdeci">bool in_mysql_trx_list</div><div class="ttdoc">true if in trx_sys-&gt;mysql_trx_list </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1106</div></div>
<div class="ttc" id="trx0trx_8h_html_acb9d9e94366336ff875699f4f9223bb4"><div class="ttname"><a href="trx0trx_8h.html#acb9d9e94366336ff875699f4f9223bb4">trx_start_internal_low</a></div><div class="ttdeci">void trx_start_internal_low(trx_t *trx)</div><div class="ttdoc">Starts a transaction for internal processing. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:3132</div></div>
<div class="ttc" id="trx0trx_8h_html_a97f30d50cfbc0d22b3730e39ad128ed7"><div class="ttname"><a href="trx0trx_8h.html#a97f30d50cfbc0d22b3730e39ad128ed7">trx_mutex_exit</a></div><div class="ttdeci">#define trx_mutex_exit(t)</div><div class="ttdoc">Release the trx-&gt;mutex. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1343</div></div>
<div class="ttc" id="ut0dbg_8h_html_a17113dab7f37e298e889ac8818ab13d0"><div class="ttname"><a href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a></div><div class="ttdeci">#define ut_ad(EXPR)</div><div class="ttdoc">Debug assertion. </div><div class="ttdef"><b>Definition:</b> ut0dbg.h:66</div></div>
<div class="ttc" id="structtrx__t_html_a179d96dd3733702fa0b2b285ef209c4a"><div class="ttname"><a href="structtrx__t.html#a179d96dd3733702fa0b2b285ef209c4a">trx_t::in_innodb</a></div><div class="ttdeci">ib_uint32_t in_innodb</div><div class="ttdoc">if the thread is executing in the InnoDB context count &gt; 0. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:875</div></div>
<div class="ttc" id="trx0trx_8h_html_a4df89e9a279e9b27588c4c7b8d14533e"><div class="ttname"><a href="trx0trx_8h.html#a4df89e9a279e9b27588c4c7b8d14533e">trx_weight_ge</a></div><div class="ttdeci">bool trx_weight_ge(const trx_t *a, const trx_t *b)</div><div class="ttdoc">Compares the &quot;weight&quot; (or size) of two transactions. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2696</div></div>
<div class="ttc" id="structtrx__named__savept__t_html"><div class="ttname"><a href="structtrx__named__savept__t.html">trx_named_savept_t</a></div><div class="ttdoc">A savepoint set with SQL&amp;#39;s &quot;SAVEPOINT savepoint_id&quot; command. </div><div class="ttdef"><b>Definition:</b> trx0roll.h:167</div></div>
<div class="ttc" id="structtrx__t_html_a7da3d2f24253f195c51d92f114925c92"><div class="ttname"><a href="structtrx__t.html#a7da3d2f24253f195c51d92f114925c92">trx_t::skip_lock_inheritance</a></div><div class="ttdeci">bool skip_lock_inheritance</div><div class="ttdef"><b>Definition:</b> trx0trx.h:962</div></div>
<div class="ttc" id="trx0trx_8h_html_a3a40c6d70b2ac49226e764b1307f97a9"><div class="ttname"><a href="trx0trx_8h.html#a3a40c6d70b2ac49226e764b1307f97a9">trx_before_mutex_exit</a></div><div class="ttdeci">void trx_before_mutex_exit(const trx_t *trx)</div><div class="ttdoc">Verifies the invariants and records debug state related to latching rules. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2682</div></div>
<div class="ttc" id="structtrx__t_html_a107344291d4e5ef0d83d8c8febf16c90"><div class="ttname"><a href="structtrx__t.html#a107344291d4e5ef0d83d8c8febf16c90">trx_t::in_depth</a></div><div class="ttdeci">ib_uint32_t in_depth</div><div class="ttdoc">Track nested TrxInInnoDB count. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:872</div></div>
<div class="ttc" id="trx0trx_8h_html_ae5f3f22daed412fac70def43c6560c45"><div class="ttname"><a href="trx0trx_8h.html#ae5f3f22daed412fac70def43c6560c45">trx_disconnect_prepared</a></div><div class="ttdeci">void trx_disconnect_prepared(trx_t *trx)</div><div class="ttdoc">Disconnect a prepared transaction from MySQL. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:663</div></div>
<div class="ttc" id="trx0trx_8h_html_a93995ce4037f0b629f78dee251b141a1"><div class="ttname"><a href="trx0trx_8h.html#a93995ce4037f0b629f78dee251b141a1">trx_get_error_index</a></div><div class="ttdeci">UNIV_INLINE const dict_index_t * trx_get_error_index(const trx_t *trx)</div><div class="ttdoc">Retrieves the error_info field from a trx. </div></div>
<div class="ttc" id="structtrx__lock__t_html_adfe2615dace4086b723bd4646004402c"><div class="ttname"><a href="structtrx__lock__t.html#adfe2615dace4086b723bd4646004402c">trx_lock_t::wait_lock_type</a></div><div class="ttdeci">uint32_t wait_lock_type</div><div class="ttdoc">Stores the type of the most recent lock for which this trx had to wait. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:646</div></div>
<div class="ttc" id="trx0types_8h_html_a91afca43a639c098efe14a9069a1d4ec"><div class="ttname"><a href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a></div><div class="ttdeci">ib_id_t trx_id_t</div><div class="ttdoc">Transaction identifier (DB_TRX_ID, DATA_TRX_ID) </div><div class="ttdef"><b>Definition:</b> trx0types.h:144</div></div>
<div class="ttc" id="trx0trx_8h_html_a45828097bb852e4c45d34165fb115cf9"><div class="ttname"><a href="trx0trx_8h.html#a45828097bb852e4c45d34165fb115cf9">trx_free_for_mysql</a></div><div class="ttdeci">void trx_free_for_mysql(trx_t *trx)</div><div class="ttdoc">Free a transaction object for MySQL. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:669</div></div>
<div class="ttc" id="trx0trx_8h_html_afc0bc1af38fae5aef2a9669887c182f5"><div class="ttname"><a href="trx0trx_8h.html#afc0bc1af38fae5aef2a9669887c182f5">trx_commit_for_mysql</a></div><div class="ttdeci">dberr_t trx_commit_for_mysql(trx_t *trx)</div><div class="ttdoc">Does the transaction commit for MySQL. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2270</div></div>
<div class="ttc" id="innodb__utility_8h_html_af8087cee2d41561b30b9d1903cebfb3d"><div class="ttname"><a href="innodb__utility_8h.html#af8087cee2d41561b30b9d1903cebfb3d">UT_LIST_BASE_NODE_T</a></div><div class="ttdeci">#define UT_LIST_BASE_NODE_T(TYPE)</div><div class="ttdef"><b>Definition:</b> innodb_utility.h:47</div></div>
<div class="ttc" id="structtrx__t_html_ac338a1e2873f7bdd52ac2d9929946ed9"><div class="ttname"><a href="structtrx__t.html#ac338a1e2873f7bdd52ac2d9929946ed9">trx_t::id</a></div><div class="ttdeci">trx_id_t id</div><div class="ttdoc">transaction id </div><div class="ttdef"><b>Definition:</b> trx0trx.h:882</div></div>
<div class="ttc" id="trx0types_8h_html_ac731378a2d6ecb952f6cfe4e093568e8"><div class="ttname"><a href="trx0types_8h.html#ac731378a2d6ecb952f6cfe4e093568e8">UndoMutex</a></div><div class="ttdeci">ib_mutex_t UndoMutex</div><div class="ttdef"><b>Definition:</b> trx0types.h:178</div></div>
<div class="ttc" id="structtrx__undo__ptr__t_html_a530652272d927e8db448caec5578f2a0"><div class="ttname"><a href="structtrx__undo__ptr__t.html#a530652272d927e8db448caec5578f2a0">trx_undo_ptr_t::insert_undo</a></div><div class="ttdeci">trx_undo_t * insert_undo</div><div class="ttdoc">pointer to the insert undo log, or NULL if no inserts performed yet </div><div class="ttdef"><b>Definition:</b> trx0trx.h:808</div></div>
<div class="ttc" id="structtrx__lock__t_html_a282d12e7244c934015d3e515f6cdb0e5"><div class="ttname"><a href="structtrx__lock__t.html#a282d12e7244c934015d3e515f6cdb0e5">trx_lock_t::n_rec_locks</a></div><div class="ttdeci">std::atomic&lt; ulint &gt; n_rec_locks</div><div class="ttdoc">Number of rec locks in this trx. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:710</div></div>
<div class="ttc" id="os0thread_8h_html_ae667eeb3edc0dd162339dd0ea943ce09"><div class="ttname"><a href="os0thread_8h.html#ae667eeb3edc0dd162339dd0ea943ce09">os_thread_get_curr_id</a></div><div class="ttdeci">os_thread_id_t os_thread_get_curr_id()</div><div class="ttdoc">Returns the thread identifier of current thread. </div><div class="ttdef"><b>Definition:</b> os0thread.cc:93</div></div>
<div class="ttc" id="structtrx__t_html_acde29ab21d858c09fd96e3e49e0aa7be"><div class="ttname"><a href="structtrx__t.html#acde29ab21d858c09fd96e3e49e0aa7be">trx_t::in_rw_trx_list</a></div><div class="ttdeci">bool in_rw_trx_list</div><div class="ttdoc">The following two fields are mutually exclusive. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1099</div></div>
<div class="ttc" id="structtrx__t_html_ad26749c886fb7a6e27c6d3128455cb22"><div class="ttname"><a href="structtrx__t.html#ad26749c886fb7a6e27c6d3128455cb22">trx_t::abort</a></div><div class="ttdeci">bool abort</div><div class="ttdoc">if this flag is set then this transaction must abort when it can </div><div class="ttdef"><b>Definition:</b> trx0trx.h:878</div></div>
<div class="ttc" id="trx0types_8h_html_af79319b3cdfff988f01995fa51880599"><div class="ttname"><a href="trx0types_8h.html#af79319b3cdfff988f01995fa51880599">trx_dict_op_t</a></div><div class="ttdeci">trx_dict_op_t</div><div class="ttdoc">Type of data dictionary operation. </div><div class="ttdef"><b>Definition:</b> trx0types.h:103</div></div>
<div class="ttc" id="trx0trx_8h_html_ae2c2545708daee0f7c0f7b88b14be7ad"><div class="ttname"><a href="trx0trx_8h.html#ae2c2545708daee0f7c0f7b88b14be7ad">trx_rseg_type_t</a></div><div class="ttdeci">trx_rseg_type_t</div><div class="ttdef"><b>Definition:</b> trx0trx.h:827</div></div>
<div class="ttc" id="structtrx__t_html_ace35c2c0cd6b1656f1f7a1cb8ac2c436"><div class="ttname"><a href="structtrx__t.html#ace35c2c0cd6b1656f1f7a1cb8ac2c436">trx_t::skip_gap_locks</a></div><div class="ttdeci">bool skip_gap_locks() const</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1252</div></div>
<div class="ttc" id="structtrx__t_html_ab5c05ba139deae47e8e05e2e0d1ac38ca3bb1d2ea4d41428c2f8a2388e8ea0a77"><div class="ttname"><a href="structtrx__t.html#ab5c05ba139deae47e8e05e2e0d1ac38ca3bb1d2ea4d41428c2f8a2388e8ea0a77">trx_t::REPEATABLE_READ</a></div><div class="ttdoc">this is the default; all consistent reads in the same trx read the same snapshot; full next-key locki...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:852</div></div>
<div class="ttc" id="structtrx__undo__t_html"><div class="ttname"><a href="structtrx__undo__t.html">trx_undo_t</a></div><div class="ttdoc">Transaction undo log memory object; this is protected by the undo_mutex in the corresponding transact...</div><div class="ttdef"><b>Definition:</b> trx0undo.h:345</div></div>
<div class="ttc" id="structtrx__t_html_a4dd9f2898a0284cf3a83ba39f0243d0e"><div class="ttname"><a href="structtrx__t.html#a4dd9f2898a0284cf3a83ba39f0243d0e">trx_t::n_ref</a></div><div class="ttdeci">lint n_ref</div><div class="ttdoc">Count of references, protected by trx_t::mutex. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1205</div></div>
<div class="ttc" id="trx0trx_8h_html_aba2a1215a0c143a2e57464019e8d209d"><div class="ttname"><a href="trx0trx_8h.html#aba2a1215a0c143a2e57464019e8d209d">trx_mutex_enter</a></div><div class="ttdeci">#define trx_mutex_enter(t)</div><div class="ttdoc">Acquire the trx-&gt;mutex (and promise not to request any more). </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1337</div></div>
<div class="ttc" id="usr0types_8h_html"><div class="ttname"><a href="usr0types_8h.html">usr0types.h</a></div><div class="ttdoc">Users and sessions global types. </div></div>
<div class="ttc" id="structtrx__rsegs__t_html"><div class="ttname"><a href="structtrx__rsegs__t.html">trx_rsegs_t</a></div><div class="ttdoc">Rollback segments assigned to a transaction for undo logging. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:815</div></div>
<div class="ttc" id="trx0trx_8h_html_a7ca10184fd4a4edd6199c7d4a51b0820"><div class="ttname"><a href="trx0trx_8h.html#a7ca10184fd4a4edd6199c7d4a51b0820">trx_before_mutex_enter</a></div><div class="ttdeci">void trx_before_mutex_enter(const trx_t *trx, bool allow_another)</div><div class="ttdoc">Verifies the invariants and records debug state related to latching rules. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2659</div></div>
<div class="ttc" id="trx0trx_8h_html_a068ef6ef1d38ac54c6e5c8c6ad1294fe"><div class="ttname"><a href="trx0trx_8h.html#a068ef6ef1d38ac54c6e5c8c6ad1294fe">trx_start_if_not_started_low</a></div><div class="ttdeci">void trx_start_if_not_started_low(trx_t *trx, bool read_write)</div><div class="ttdoc">Starts the transaction if it is not yet started. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:3108</div></div>
<div class="ttc" id="os0thread_8h_html_ab8ad022ed5dafb1f9defb66ac1b6a62a"><div class="ttname"><a href="os0thread_8h.html#ab8ad022ed5dafb1f9defb66ac1b6a62a">os_thread_id_t</a></div><div class="ttdeci">std::thread::native_handle_type os_thread_id_t</div><div class="ttdoc">Operating system thread native handle. </div><div class="ttdef"><b>Definition:</b> os0thread.h:64</div></div>
<div class="ttc" id="trx0trx_8h_html_a13e56b49b2943c1b4dcf68f41690202b"><div class="ttname"><a href="trx0trx_8h.html#a13e56b49b2943c1b4dcf68f41690202b">trx_is_rseg_updated</a></div><div class="ttdeci">UNIV_INLINE bool trx_is_rseg_updated(const trx_t *trx)</div><div class="ttdoc">Check if redo/noredo rseg is modified for insert/update. </div></div>
<div class="ttc" id="classTrxInInnoDB_html"><div class="ttname"><a href="classTrxInInnoDB.html">TrxInInnoDB</a></div><div class="ttdoc">Track if a transaction is executing inside InnoDB code. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1352</div></div>
<div class="ttc" id="namespacefile_html"><div class="ttname"><a href="namespacefile.html">file</a></div><div class="ttdef"><b>Definition:</b> os0file.h:85</div></div>
<div class="ttc" id="structtrx__t_html_a48e4b784a6c02168e4d30ae329d4261d"><div class="ttname"><a href="structtrx__t.html#a48e4b784a6c02168e4d30ae329d4261d">trx_t::mutex</a></div><div class="ttdeci">TrxMutex mutex</div><div class="ttdoc">Mutex protecting the fields state and lock (except some fields of lock, which are protected by lock_s...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:861</div></div>
<div class="ttc" id="structtrx__undo__ptr__t_html"><div class="ttname"><a href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a></div><div class="ttdoc">The transaction handle. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:796</div></div>
<div class="ttc" id="trx0trx_8h_html_aceabcaa371d826f2a22aa2565d904602"><div class="ttname"><a href="trx0trx_8h.html#aceabcaa371d826f2a22aa2565d904602">trx_arbitrate</a></div><div class="ttdeci">UNIV_INLINE const trx_t * trx_arbitrate(const trx_t *requestor, const trx_t *holder)</div></div>
<div class="ttc" id="trx0trx_8h_html_a41eb566dad1d8483afc0fb1f6ec09022"><div class="ttname"><a href="trx0trx_8h.html#a41eb566dad1d8483afc0fb1f6ec09022">trx_pool_init</a></div><div class="ttdeci">void trx_pool_init()</div><div class="ttdoc">Create the trx_t pool. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:427</div></div>
<div class="ttc" id="structtrx__lock__t_html_a2e6d8a21a1999c8c7547dfd353a60483"><div class="ttname"><a href="structtrx__lock__t.html#a2e6d8a21a1999c8c7547dfd353a60483">trx_lock_t::start_stmt</a></div><div class="ttdeci">bool start_stmt</div><div class="ttdoc">The transaction called ha_innobase::start_stmt() to lock a table. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:738</div></div>
<div class="ttc" id="trx0trx_8h_html_aeda504c072953ddfe34988fe729ba0c5"><div class="ttname"><a href="trx0trx_8h.html#aeda504c072953ddfe34988fe729ba0c5">commit_node_state</a></div><div class="ttdeci">commit_node_state</div><div class="ttdoc">Commit node states. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1285</div></div>
<div class="ttc" id="namespacenet_1_1impl_1_1socket_html_af0aef40a99065320448f6e90710198cc"><div class="ttname"><a href="namespacenet_1_1impl_1_1socket.html#af0aef40a99065320448f6e90710198cc">net::impl::socket::wait</a></div><div class="ttdeci">stdx::expected&lt; void, error_type &gt; wait(native_handle_type fd, wait_type wt)</div><div class="ttdef"><b>Definition:</b> socket.h:580</div></div>
<div class="ttc" id="structtrx__lock__t_html_a44bc50f6732e67f6bbd1a1c19f03af6c"><div class="ttname"><a href="structtrx__lock__t.html#a44bc50f6732e67f6bbd1a1c19f03af6c">trx_lock_t::wait_lock</a></div><div class="ttdeci">std::atomic&lt; lock_t * &gt; wait_lock</div><div class="ttdoc">The lock request of this transaction is waiting for. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:618</div></div>
<div class="ttc" id="trx0trx_8h_html_a1a144ee93ff1061b38218c3ff33a6112"><div class="ttname"><a href="trx0trx_8h.html#a1a144ee93ff1061b38218c3ff33a6112">trx_is_high_priority</a></div><div class="ttdeci">UNIV_INLINE bool trx_is_high_priority(const trx_t *trx)</div></div>
<div class="ttc" id="structtrx__t_html_aacee494a37d619509b24a4cf07db7656"><div class="ttname"><a href="structtrx__t.html#aacee494a37d619509b24a4cf07db7656">trx_t::start_file</a></div><div class="ttdeci">const char * start_file</div><div class="ttdoc">Filename where it was started. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1202</div></div>
<div class="ttc" id="structMEM__ROOT_html"><div class="ttname"><a href="structMEM__ROOT.html">MEM_ROOT</a></div><div class="ttdoc">The MEM_ROOT is a simple arena, where allocations are carved out of larger blocks. </div><div class="ttdef"><b>Definition:</b> my_alloc.h:77</div></div>
<div class="ttc" id="srv0srv_8h_html_abee3b4363b1c03c5eb8d9b515e80bad2"><div class="ttname"><a href="srv0srv_8h.html#abee3b4363b1c03c5eb8d9b515e80bad2">srv_read_only_mode</a></div><div class="ttdeci">bool srv_read_only_mode</div><div class="ttdoc">Set if InnoDB must operate in read-only mode. </div><div class="ttdef"><b>Definition:</b> srv0srv.cc:187</div></div>
<div class="ttc" id="trx0trx_8h_html_afaaac1afb77620ef89dbd971c181b04b"><div class="ttname"><a href="trx0trx_8h.html#afaaac1afb77620ef89dbd971c181b04b">lock_pool_t</a></div><div class="ttdeci">std::vector&lt; ib_lock_t *, ut_allocator&lt; ib_lock_t * &gt; &gt; lock_pool_t</div><div class="ttdef"><b>Definition:</b> trx0trx.h:538</div></div>
<div class="ttc" id="trx0trx_8h_html_a5292ad6e2ddaf68f9d7c97897828fca5"><div class="ttname"><a href="trx0trx_8h.html#a5292ad6e2ddaf68f9d7c97897828fca5">trx_get_trx_by_xid</a></div><div class="ttdeci">trx_t * trx_get_trx_by_xid(const XID *xid)</div><div class="ttdoc">This function is used to find one X/Open XA distributed transaction which is in the prepared state...</div><div class="ttdef"><b>Definition:</b> trx0trx.cc:3056</div></div>
<div class="ttc" id="structmtr__t_html"><div class="ttname"><a href="structmtr__t.html">mtr_t</a></div><div class="ttdoc">Mini-transaction handle and buffer. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:169</div></div>
<div class="ttc" id="structtrx__lock__t_html_aba8e3a71adc427f9e6b6d48feb999975"><div class="ttname"><a href="structtrx__lock__t.html#aba8e3a71adc427f9e6b6d48feb999975">trx_lock_t::table_locks</a></div><div class="ttdeci">lock_pool_t table_locks</div><div class="ttdoc">All table locks requested by this transaction, including AUTOINC locks. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:699</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a72da4a1e2094bccfdcdfe0bcbad09199"><div class="ttname"><a href="classTrxInInnoDB.html#a72da4a1e2094bccfdcdfe0bcbad09199">TrxInInnoDB::is_async_rollback</a></div><div class="ttdeci">static bool is_async_rollback(const trx_t *trx)</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1403</div></div>
<div class="ttc" id="trx0trx_8h_html_aff869b3dc21337797d3f4e177c30e930"><div class="ttname"><a href="trx0trx_8h.html#aff869b3dc21337797d3f4e177c30e930">trx_start_if_not_started_xa_low</a></div><div class="ttdeci">void trx_start_if_not_started_xa_low(trx_t *trx, bool read_write)</div><div class="ttdoc">Starts the transaction if it is not yet started. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:3077</div></div>
<div class="ttc" id="structtrx__t_html_a382fc29c69cb04b73b4dfc2200237709"><div class="ttname"><a href="structtrx__t.html#a382fc29c69cb04b73b4dfc2200237709">trx_t::fts_trx</a></div><div class="ttdeci">fts_trx_t * fts_trx</div><div class="ttdoc">FTS information, or NULL if transaction hasn&amp;#39;t modified tables with FTS indexes (yet). </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1183</div></div>
<div class="ttc" id="classTrxInInnoDB_html_a9352fb82b55c847d8721535c4b860018"><div class="ttname"><a href="classTrxInInnoDB.html#a9352fb82b55c847d8721535c4b860018">TrxInInnoDB::is_rollback_disabled</a></div><div class="ttdeci">bool is_rollback_disabled() const</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1372</div></div>
<div class="ttc" id="structtrx__lock__t_html"><div class="ttname"><a href="structtrx__lock__t.html">trx_lock_t</a></div><div class="ttdoc">Latching protocol for trx_lock_t::que_state. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:562</div></div>
<div class="ttc" id="trx0types_8h_html_a671a381e3a8143e9612e31dc898960bc"><div class="ttname"><a href="trx0types_8h.html#a671a381e3a8143e9612e31dc898960bc">TRX_FORCE_ROLLBACK_DISABLE</a></div><div class="ttdeci">static const ib_uint32_t TRX_FORCE_ROLLBACK_DISABLE</div><div class="ttdoc">If this flag is set then the transaction cannot be rolled back asynchronously. </div><div class="ttdef"><b>Definition:</b> trx0types.h:63</div></div>
<div class="ttc" id="trx0trx_8h_html_a7ad2939baf98996b4536611285e30916"><div class="ttname"><a href="trx0trx_8h.html#a7ad2939baf98996b4536611285e30916">trx_commit</a></div><div class="ttdeci">void trx_commit(trx_t *trx)</div><div class="ttdoc">Commits a transaction. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2089</div></div>
<div class="ttc" id="innodb__utility_8h_html_a496a8f8646bff5c74c18ee0c04134b6d"><div class="ttname"><a href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a></div><div class="ttdeci">#define UT_LIST_NODE_T(TYPE)</div><div class="ttdef"><b>Definition:</b> innodb_utility.h:40</div></div>
<div class="ttc" id="structtrx__t_html_a379cab489fb30c071cdba5e62730ca10"><div class="ttname"><a href="structtrx__t.html#a379cab489fb30c071cdba5e62730ca10">trx_t::xid</a></div><div class="ttdeci">XID * xid</div><div class="ttdoc">X/Open XA transaction identification to identify a transaction branch. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1219</div></div>
<div class="ttc" id="structtrx__undo__ptr__t_html_a522c5bd7a276be36b1c5e36299c4d4c7"><div class="ttname"><a href="structtrx__undo__ptr__t.html#a522c5bd7a276be36b1c5e36299c4d4c7">trx_undo_ptr_t::is_insert_only</a></div><div class="ttdeci">bool is_insert_only()</div><div class="ttdef"><b>Definition:</b> trx0trx.h:801</div></div>
<div class="ttc" id="structtrx__lock__t_html_a2b3a26f3c5dc889837e30b8bccd2f572"><div class="ttname"><a href="structtrx__lock__t.html#a2b3a26f3c5dc889837e30b8bccd2f572">trx_lock_t::lock_heap</a></div><div class="ttdeci">mem_heap_t * lock_heap</div><div class="ttdoc">Memory heap for trx_locks. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:682</div></div>
<div class="ttc" id="trx0trx_8h_html_a7e980f48dd611cefdaf1842c0c64c094"><div class="ttname"><a href="trx0trx_8h.html#a7e980f48dd611cefdaf1842c0c64c094">trx_set_rw_mode</a></div><div class="ttdeci">void trx_set_rw_mode(trx_t *trx)</div><div class="ttdoc">Set the transaction as a read-write transaction if it is not already tagged as such. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:3163</div></div>
<div class="ttc" id="trx0types_8h_html_a4661d2883c1cd5d8f1cfbd63b553f1bc"><div class="ttname"><a href="trx0types_8h.html#a4661d2883c1cd5d8f1cfbd63b553f1bc">undo_no_t</a></div><div class="ttdeci">ib_id_t undo_no_t</div><div class="ttdoc">Undo number. </div><div class="ttdef"><b>Definition:</b> trx0types.h:148</div></div>
<div class="ttc" id="trx0trx_8h_html_afd3d96e663aa75dd8974743e0e24cd10"><div class="ttname"><a href="trx0trx_8h.html#afd3d96e663aa75dd8974743e0e24cd10">trx_prepare_for_mysql</a></div><div class="ttdeci">dberr_t trx_prepare_for_mysql(trx_t *trx)</div><div class="ttdoc">Does the transaction prepare for MySQL. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:2882</div></div>
<div class="ttc" id="structtrx__t_html_aedd7de301a2ebe1aca6e724379786cd6"><div class="ttname"><a href="structtrx__t.html#aedd7de301a2ebe1aca6e724379786cd6">trx_t::in_rollback</a></div><div class="ttdeci">bool in_rollback</div><div class="ttdoc">true when the transaction is executing a partial or full rollback </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1159</div></div>
<div class="ttc" id="structtrx__t_html_afaad1dded74040c39906bc5421d15320"><div class="ttname"><a href="structtrx__t.html#afaad1dded74040c39906bc5421d15320">trx_t::error_key_num</a></div><div class="ttdeci">ulint error_key_num</div><div class="ttdoc">if the index creation fails to a duplicate key error, a mysql key number of that index is stored here...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1119</div></div>
<div class="ttc" id="structtrx__t_html_ace2cb07011f4c03e0b72fa5290376620"><div class="ttname"><a href="structtrx__t.html#ace2cb07011f4c03e0b72fa5290376620">trx_t::api_trx</a></div><div class="ttdeci">bool api_trx</div><div class="ttdoc">trx started by InnoDB API </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1226</div></div>
<div class="ttc" id="structtrx__t_html_ae402b5cd189094a817150f921246ad13"><div class="ttname"><a href="structtrx__t.html#ae402b5cd189094a817150f921246ad13">trx_t::no</a></div><div class="ttdeci">trx_id_t no</div><div class="ttdoc">transaction serialization number: max trx id shortly before the transaction is moved to COMMITTED_IN_...</div><div class="ttdef"><b>Definition:</b> trx0trx.h:884</div></div>
<div class="ttc" id="trx0trx_8h_html_abddd49c761d973bbf99a159d2261fc9d"><div class="ttname"><a href="trx0trx_8h.html#abddd49c761d973bbf99a159d2261fc9d">trx_pool_close</a></div><div class="ttdeci">void trx_pool_close()</div><div class="ttdoc">Destroy the trx_t pool. </div><div class="ttdef"><b>Definition:</b> trx0trx.cc:434</div></div>
<div class="ttc" id="structtrx__lock__t_html_a8b7f840c1deb4b3322a24bff1a9d11b8"><div class="ttname"><a href="structtrx__lock__t.html#a8b7f840c1deb4b3322a24bff1a9d11b8">trx_lock_t::n_active_thrs</a></div><div class="ttdeci">ulint n_active_thrs</div><div class="ttdoc">number of active query threads </div><div class="ttdef"><b>Definition:</b> trx0trx.h:563</div></div>
<div class="ttc" id="trx0trx_8h_html_a1a5ce0995025643b07a6bd0691c3a92d"><div class="ttname"><a href="trx0trx_8h.html#a1a5ce0995025643b07a6bd0691c3a92d">trx_is_interrupted</a></div><div class="ttdeci">ibool trx_is_interrupted(const trx_t *trx)</div><div class="ttdoc">Determines if the currently running transaction has been interrupted. </div><div class="ttdef"><b>Definition:</b> ha_innodb.cc:2867</div></div>
<div class="ttc" id="structtrx__lock__t_html_a78ad4c453b000f28a03f561e5d531b14"><div class="ttname"><a href="structtrx__lock__t.html#a78ad4c453b000f28a03f561e5d531b14">trx_lock_t::table_pool</a></div><div class="ttdeci">lock_pool_t table_pool</div><div class="ttdoc">Pre-allocated table locks. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:673</div></div>
<div class="ttc" id="structtrx__lock__t_html_a8ef0c5b015cbdab070f3ecd71f4a2ad3"><div class="ttname"><a href="structtrx__lock__t.html#a8ef0c5b015cbdab070f3ecd71f4a2ad3">trx_lock_t::schedule_weight</a></div><div class="ttdeci">std::atomic&lt; trx_schedule_weight_t &gt; schedule_weight</div><div class="ttdoc">Weight of the waiting transaction used for scheduling. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:727</div></div>
<div class="ttc" id="structtrx__t_html_a715abb1adae35ae188028cd9d4453157"><div class="ttname"><a href="structtrx__t.html#a715abb1adae35ae188028cd9d4453157">trx_t::api_auto_commit</a></div><div class="ttdeci">bool api_auto_commit</div><div class="ttdoc">automatic commit </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1227</div></div>
<div class="ttc" id="classTHD_html"><div class="ttname"><a href="classTHD.html">THD</a></div><div class="ttdoc">For each client connection we create a separate thread with THD serving as a thread/connection descri...</div><div class="ttdef"><b>Definition:</b> sql_class.h:803</div></div>
<div class="ttc" id="classTrxInInnoDB_html_ad797833130a56460e837951ba805d2f3"><div class="ttname"><a href="classTrxInInnoDB.html#ad797833130a56460e837951ba805d2f3">TrxInInnoDB::m_trx</a></div><div class="ttdeci">trx_t * m_trx</div><div class="ttdoc">Transaction instance crossing the handler boundary from the Server. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:1534</div></div>
<div class="ttc" id="trx0trx_8h_html_a70150f2448c48ddb2ace0e7335e61b05"><div class="ttname"><a href="trx0trx_8h.html#a70150f2448c48ddb2ace0e7335e61b05">trx_get_que_state_str</a></div><div class="ttdeci">UNIV_INLINE const char * trx_get_que_state_str(const trx_t *trx)</div><div class="ttdoc">Retrieves transaction&amp;#39;s que state in a human readable string. </div></div>
<div class="ttc" id="structtrx__t_html_a14010a79d91496eef11ef92a15a21bef"><div class="ttname"><a href="structtrx__t.html#a14010a79d91496eef11ef92a15a21bef">trx_t::magic_n</a></div><div class="ttdeci">ulint magic_n</div><div class="ttdef"><b>Definition:</b> trx0trx.h:1246</div></div>
<div class="ttc" id="structdict__index__t_html"><div class="ttname"><a href="structdict__index__t.html">dict_index_t</a></div><div class="ttdoc">Data structure for an index. </div><div class="ttdef"><b>Definition:</b> dict0mem.h:886</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_70f20ecf11358dff00a0daf546d3147e.html">storage</a></li><li class="navelem"><a class="el" href="dir_3fec0aa9607ea05e0bb1c96aee1a8c4e.html">innobase</a></li><li class="navelem"><a class="el" href="dir_9b7ed1f29269ffabdc4c5f5522a0db25.html">include</a></li><li class="navelem"><a class="el" href="trx0trx_8h.html">trx0trx.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
