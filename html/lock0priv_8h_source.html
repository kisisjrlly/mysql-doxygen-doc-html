<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: storage/innobase/include/lock0priv.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lock0priv_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">lock0priv.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lock0priv_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">Copyright (c) 2007, 2020, Oracle and/or its affiliates. All Rights Reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">This program is free software; you can redistribute it and/or modify it under</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">the terms of the GNU General Public License, version 2.0, as published by the</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">Free Software Foundation.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">This program is also distributed with certain software (including but not</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">limited to OpenSSL) that is licensed under separate terms, as designated in a</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">particular file or component or in included license documentation. The authors</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">of MySQL hereby grant you an additional permission to link the program and</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">your derivative works with the separately licensed software that they have</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">included with MySQL.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License, version 2.0,</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">for more details.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">You should have received a copy of the GNU General Public License along with</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">this program; if not, write to the Free Software Foundation, Inc.,</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">*****************************************************************************/</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/** @file include/lock0priv.h</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> Lock module internal structures and methods.</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> Created July 12, 2007 Vasil Dimov</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *******************************************************/</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#ifndef lock0priv_h</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#define lock0priv_h</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#ifndef LOCK_MODULE_IMPLEMENTATION</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/* If you need to access members of the structures defined in this</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">file, please write appropriate functions that retrieve them and put</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">those functions in lock/ */</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#error Do not include lock0priv.h outside of the lock/ module</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dict0types_8h.html">dict0types.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash0hash_8h.html">hash0hash.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trx0types_8h.html">trx0types.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;univ.i&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">/** A table lock */</span></div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="structlock__table__t.html">   51</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlock__table__t.html">lock_table_t</a> {</div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="structlock__table__t.html#a39eaa0522606a96e01548edd7092b6fc">   52</a></span>&#160;  <a class="code" href="structdict__table__t.html">dict_table_t</a> *<a class="code" href="structlock__table__t.html#a39eaa0522606a96e01548edd7092b6fc">table</a>; <span class="comment">/*!&lt; database table in dictionary</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">                       cache */</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a>(<a class="code" href="structlock__t.html">lock_t</a>)</div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="structlock__table__t.html#a95d90c707ee89833e0f76a3d94176599">   55</a></span>&#160;  <a class="code" href="structlock__table__t.html#a95d90c707ee89833e0f76a3d94176599">locks</a>; <span class="comment">/*!&lt; list of locks on the same</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">         table */</span><span class="comment"></span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">  /** Print the table lock into the given output stream</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">  @param[in,out]        out     the output stream</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">  @return the given output stream. */</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="namespacestd.html">std</a>::ostream &amp;<a class="code" href="structlock__table__t.html#a31babcbe7548a099af93a10fafc98313">print</a>(<a class="code" href="namespacestd.html">std</a>::ostream &amp;out) const;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;};</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">/** Print the table lock into the given output stream</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">@param[in,out]  out     the output stream</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">@return the given output stream. */</span></div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="structlock__table__t.html#a31babcbe7548a099af93a10fafc98313">   66</a></span>&#160;inline <a class="code" href="namespacestd.html">std</a>::ostream &amp;<a class="code" href="structlock__table__t.html">lock_table_t</a>::<a class="code" href="structlock__table__t.html#a31babcbe7548a099af93a10fafc98313">print</a>(<a class="code" href="namespacestd.html">std</a>::ostream &amp;out)<span class="keyword"> const </span>{</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  out &lt;&lt; <span class="stringliteral">&quot;[lock_table_t: name=&quot;</span> &lt;&lt; table-&gt;<a class="code" href="structdict__table__t.html#ad1271c5134aeb93444303e935dde5c25">name</a> &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">return</span> (out);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">/** The global output operator is overloaded to conveniently</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">print the lock_table_t object into the given output stream.</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">@param[in,out]  out     the output stream</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">@param[in]      lock    the table lock</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">@return the given output stream */</span></div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#a49bacfaaac1b0e5fcfd292189d099dfe">   76</a></span>&#160;<span class="keyword">inline</span> std::ostream &amp;<a class="code" href="lock0priv_8h.html#a49bacfaaac1b0e5fcfd292189d099dfe">operator&lt;&lt;</a>(std::ostream &amp;out, <span class="keyword">const</span> <a class="code" href="structlock__table__t.html">lock_table_t</a> &amp;lock) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">return</span> (lock.<a class="code" href="structlock__table__t.html#a31babcbe7548a099af93a10fafc98313">print</a>(out));</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/** Record lock for a page */</span></div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="structlock__rec__t.html">   81</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlock__rec__t.html">lock_rec_t</a> {<span class="comment"></span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  /** The id of the page on which records referenced by this lock&#39;s bitmap are</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">  located. */</span></div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="structlock__rec__t.html#a70106ad997616c2fcd677498c1a9ed71">   84</a></span>&#160;  <a class="code" href="classpage__id__t.html">page_id_t</a> <a class="code" href="structlock__rec__t.html#a70106ad997616c2fcd677498c1a9ed71">page_id</a>;<span class="comment"></span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">  /** number of bits in the lock bitmap;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">  NOTE: the lock bitmap is placed immediately after the lock struct */</span></div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="structlock__rec__t.html#a5e443a075d6e67fdfa271e8922b6c2e8">   87</a></span>&#160;  uint32_t <a class="code" href="structlock__rec__t.html#a5e443a075d6e67fdfa271e8922b6c2e8">n_bits</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">  /** Print the record lock into the given output stream</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">  @param[in,out]        out     the output stream</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">  @return the given output stream. */</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  std::ostream &amp;<a class="code" href="structlock__table__t.html#a31babcbe7548a099af93a10fafc98313">print</a>(std::ostream &amp;out) <span class="keyword">const</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;};</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">/** Print the record lock into the given output stream</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">@param[in,out]  out     the output stream</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">@return the given output stream. */</span></div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="structlock__rec__t.html#a2329cbb514cd7eaa7ed432d6d6f522f1">   98</a></span>&#160;<span class="keyword">inline</span> std::ostream &amp;<a class="code" href="structlock__rec__t.html#a2329cbb514cd7eaa7ed432d6d6f522f1">lock_rec_t::print</a>(std::ostream &amp;out)<span class="keyword"> const </span>{</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordflow">return</span> out &lt;&lt; <span class="stringliteral">&quot;[lock_rec_t: page_id=&quot;</span> &lt;&lt; page_id &lt;&lt; <span class="stringliteral">&quot;, n_bits=&quot;</span> &lt;&lt; n_bits</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#a43c26a6d0cf38a657111e5cecd7aa194">  103</a></span>&#160;<span class="keyword">inline</span> std::ostream &amp;<a class="code" href="lock0priv_8h.html#a49bacfaaac1b0e5fcfd292189d099dfe">operator&lt;&lt;</a>(std::ostream &amp;out, <span class="keyword">const</span> <a class="code" href="structlock__rec__t.html">lock_rec_t</a> &amp;lock) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">return</span> (lock.<a class="code" href="structlock__rec__t.html#a2329cbb514cd7eaa7ed432d6d6f522f1">print</a>(out));</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">Checks if the `mode` is LOCK_S or LOCK_X, which means the lock is a</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">Next Key Lock, a.k.a. LOCK_ORDINARY, as opposed to Predicate Lock,</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">GAP lock, Insert Intention or Record Lock.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">@param  mode  A mode and flags, of a non-waiting lock.</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">@return true iff the only bits set in `mode` are LOCK_S or LOCK_X */</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#adc4d50e24df554a860fdc92e730199e0">  114</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="lock0priv_8h.html#adc4d50e24df554a860fdc92e730199e0">lock_mode_is_next_key_lock</a>(ulint <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>) {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  static_assert(<a class="code" href="lock0lock_8h.html#a95f8dd3d016d01aaa314160f0db74e75">LOCK_ORDINARY</a> == 0, <span class="stringliteral">&quot;LOCK_ORDINARY must be 0 (no flags)&quot;</span>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>((mode &amp; <a class="code" href="lock0lock_8h.html#a92ad796dd0adc2da08468a220376fe76">LOCK_WAIT</a>) == 0);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>((mode &amp; <a class="code" href="lock0lock_8h.html#a51876da8368dde6b362ce3c465dcc9eb">LOCK_TYPE_MASK</a>) == 0);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(((mode &amp; ~(<a class="code" href="lock0lock_8h.html#aea25ac33bd6692ef77c95c6a7da765a8">LOCK_MODE_MASK</a>)) == <a class="code" href="lock0lock_8h.html#a95f8dd3d016d01aaa314160f0db74e75">LOCK_ORDINARY</a>) ==</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        (mode == <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013a7c98d16ae81460b73cc836948b622480">LOCK_S</a> || mode == <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013aa7ba6be447ffbfa3ac8e35268f622de6">LOCK_X</a>));</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">return</span> (mode &amp; ~(<a class="code" href="lock0lock_8h.html#aea25ac33bd6692ef77c95c6a7da765a8">LOCK_MODE_MASK</a>)) == <a class="code" href="lock0lock_8h.html#a95f8dd3d016d01aaa314160f0db74e75">LOCK_ORDINARY</a>;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">/** Gets the nth bit of a record lock.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">@param[in]      lock    record lock</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">@param[in]      i       index of the bit</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">@return true if bit set also if i == ULINT_UNDEFINED return false */</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="lock0priv_8h.html#a934e63f43c0caa00d7e0ba13fd9525cc">lock_rec_get_nth_bit</a>(<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock, ulint i);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">/** Lock struct; protected by lock_sys latches */</span></div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="structlock__t.html">  131</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlock__t.html">lock_t</a> {<span class="comment"></span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">  /** transaction owning the lock */</span></div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="structlock__t.html#aadc39cc7e63a1dcbbf11c4294005aae2">  133</a></span>&#160;  <a class="code" href="structtrx__t.html">trx_t</a> *<a class="code" href="structlock__t.html#aadc39cc7e63a1dcbbf11c4294005aae2">trx</a>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">  /** list of the locks of the transaction */</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a>(<a class="code" href="structlock__t.html">lock_t</a>) trx_locks;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">  /** Index for a record lock */</span></div><div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="structlock__t.html#a037485c241d93247f161718d2039031b">  139</a></span>&#160;  <a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="structlock__t.html#a037485c241d93247f161718d2039031b">index</a>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">  /** Hash chain node for a record lock. The link node in a singly</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">  linked list, used by the hash table. */</span></div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="structlock__t.html#a91d43e91ee25a5473a395dd26cf0640b">  143</a></span>&#160;  <a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="structlock__t.html#a91d43e91ee25a5473a395dd26cf0640b">hash</a>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keyword">union </span>{<span class="comment"></span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">    /** Table lock */</span></div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="structlock__t.html#a07680fbb48d79c8f1c646d0687e234fb">  147</a></span>&#160;    <a class="code" href="structlock__table__t.html">lock_table_t</a> <a class="code" href="structlock__t.html#a07680fbb48d79c8f1c646d0687e234fb">tab_lock</a>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">    /** Record lock */</span></div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="structlock__t.html#a2add4e854ffc93b0f62534962ea7ec03">  150</a></span>&#160;    <a class="code" href="structlock__rec__t.html">lock_rec_t</a> <a class="code" href="structlock__t.html#a2add4e854ffc93b0f62534962ea7ec03">rec_lock</a>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  };</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#ifdef HAVE_PSI_THREAD_INTERFACE</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#ifdef HAVE_PSI_DATA_LOCK_INTERFACE</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">  /** Performance schema thread that created the lock. */</span></div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="structlock__t.html#a72319e7f04eb4057d5b15653ad9a6e24">  156</a></span>&#160;  <a class="code" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a> <a class="code" href="structlock__t.html#a72319e7f04eb4057d5b15653ad9a6e24">m_psi_internal_thread_id</a>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">  /** Performance schema event that created the lock. */</span></div><div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="structlock__t.html#aacb3ed355f862f41b14e04fabce94cac">  159</a></span>&#160;  <a class="code" href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a> <a class="code" href="structlock__t.html#aacb3ed355f862f41b14e04fabce94cac">m_psi_event_id</a>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_PSI_DATA_LOCK_INTERFACE */</span><span class="preprocessor"></span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_PSI_THREAD_INTERFACE */</span><span class="preprocessor"></span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">  /** The lock type and mode bit flags.</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">  LOCK_GAP or LOCK_REC_NOT_GAP, LOCK_INSERT_INTENTION, wait flag, ORed */</span></div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="structlock__t.html#aad4031cec84ea42e3fc05253d65ad956">  165</a></span>&#160;  uint32_t <a class="code" href="structlock__t.html#aad4031cec84ea42e3fc05253d65ad956">type_mode</a>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="preprocessor">#if defined(UNIV_DEBUG)</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">  /** Timestamp when it was created. */</span></div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="structlock__t.html#acd4e41c6a39521cb2be1ac48a89247ca">  169</a></span>&#160;  uint64_t <a class="code" href="structlock__t.html#acd4e41c6a39521cb2be1ac48a89247ca">m_seq</a>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">  /** Unlock the GAP Lock part of this Next Key Lock */</span></div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="structlock__t.html#afdd0a4b2080eceaa63acfe600a98f547">  173</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structlock__t.html#afdd0a4b2080eceaa63acfe600a98f547">unlock_gap_lock</a>() {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(!is_gap());</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(!is_insert_intention());</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(is_next_key_lock());</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    type_mode |= <a class="code" href="lock0lock_8h.html#a5ec9b0cce21ee17de083d3bb96b1bec6">LOCK_REC_NOT_GAP</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">  /** Determine if the lock object is a record lock.</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">  @return true if record lock, false otherwise. */</span></div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="structlock__t.html#a7651674780568aa384de60523c1d3d0d">  183</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structlock__t.html#a7651674780568aa384de60523c1d3d0d">is_record_lock</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (<a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a>() == <a class="code" href="lock0lock_8h.html#a145ae646d1def688ee264b9d98c2e981">LOCK_REC</a>); }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">  /** Determine if it is predicate lock.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">  @return true if predicate lock, false otherwise. */</span></div><div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="structlock__t.html#ad82263cb7a15ff2c77324c5a745c3562">  187</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structlock__t.html#ad82263cb7a15ff2c77324c5a745c3562">is_predicate</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">return</span> (type_mode &amp; (<a class="code" href="lock0lock_8h.html#a7e59e399364d823b33bc010e93e9c278">LOCK_PREDICATE</a> | <a class="code" href="lock0lock_8h.html#a7fe3f32b4e6bb44b08818eea5638e94b">LOCK_PRDT_PAGE</a>));</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">  /** @return true if the lock wait flag is set */</span></div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="structlock__t.html#a8e36c922822944263618cdb99c34508d">  192</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structlock__t.html#a8e36c922822944263618cdb99c34508d">is_waiting</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (type_mode &amp; <a class="code" href="lock0lock_8h.html#a92ad796dd0adc2da08468a220376fe76">LOCK_WAIT</a>); }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">  /** @return true if the gap lock bit is set */</span></div><div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="structlock__t.html#a4e3a80f6869f7400f9b998faa3b4e90a">  195</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structlock__t.html#a4e3a80f6869f7400f9b998faa3b4e90a">is_gap</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (type_mode &amp; <a class="code" href="lock0lock_8h.html#a8631af3f85d4c19484f6de819b2b2a37">LOCK_GAP</a>); }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">  /** @return true if the not gap lock bit is set */</span></div><div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="structlock__t.html#a005ccf80549a8d258847a286b4b3c731">  198</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structlock__t.html#a005ccf80549a8d258847a286b4b3c731">is_record_not_gap</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (type_mode &amp; <a class="code" href="lock0lock_8h.html#a5ec9b0cce21ee17de083d3bb96b1bec6">LOCK_REC_NOT_GAP</a>); }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">  /** @return true iff the lock is a Next Key Lock */</span></div><div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="structlock__t.html#ad4ced5d01fac5bfcb5ba61ae610a76a2">  201</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structlock__t.html#ad4ced5d01fac5bfcb5ba61ae610a76a2">is_next_key_lock</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">return</span> is_record_lock() &amp;&amp;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;           <a class="code" href="lock0priv_8h.html#adc4d50e24df554a860fdc92e730199e0">lock_mode_is_next_key_lock</a>(type_mode &amp; ~(<a class="code" href="lock0lock_8h.html#a92ad796dd0adc2da08468a220376fe76">LOCK_WAIT</a> | <a class="code" href="lock0lock_8h.html#a145ae646d1def688ee264b9d98c2e981">LOCK_REC</a>));</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">  /** @return true if the insert intention bit is set */</span></div><div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="structlock__t.html#a72f274a65709f2081c6ba106aaa17698">  207</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structlock__t.html#a72f274a65709f2081c6ba106aaa17698">is_insert_intention</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">return</span> (type_mode &amp; <a class="code" href="lock0lock_8h.html#a7a448126f7465de2aa940d1751dd8b7e">LOCK_INSERT_INTENTION</a>);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">  /** @return true iff this lock is (at least) on supremum pseudo-record */</span></div><div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="structlock__t.html#a46622ae01b70efd3cb250e57eef23460">  212</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structlock__t.html#a46622ae01b70efd3cb250e57eef23460">includes_supremum</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="lock0priv_8h.html#a934e63f43c0caa00d7e0ba13fd9525cc">lock_rec_get_nth_bit</a>(<span class="keyword">this</span>, <a class="code" href="page0types_8h.html#a5d783fe226bc984a8ec24ff5abf8c966">PAGE_HEAP_NO_SUPREMUM</a>));</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">  /** @return the lock mode */</span></div><div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="structlock__t.html#adda86279aa635faf45657c4912f9bef3">  217</a></span>&#160;  uint32_t <a class="code" href="structlock__t.html#adda86279aa635faf45657c4912f9bef3">type</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (type_mode &amp; <a class="code" href="lock0lock_8h.html#a51876da8368dde6b362ce3c465dcc9eb">LOCK_TYPE_MASK</a>); }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">  /** @return the precise lock mode */</span></div><div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="structlock__t.html#a152571ef548a0c4cc2bd927e546f2ec8">  220</a></span>&#160;  <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013">lock_mode</a> <a class="code" href="structlock__t.html#a152571ef548a0c4cc2bd927e546f2ec8">mode</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">return</span> (static_cast&lt;lock_mode&gt;(type_mode &amp; <a class="code" href="lock0lock_8h.html#aea25ac33bd6692ef77c95c6a7da765a8">LOCK_MODE_MASK</a>));</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">  /** Get lock hash table</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">  @return lock hash table */</span></div><div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="structlock__t.html#acdde34489d4248e3752ffca049f3041f">  226</a></span>&#160;  <a class="code" href="structhash__table__t.html">hash_table_t</a> *<a class="code" href="structlock__t.html#acdde34489d4248e3752ffca049f3041f">hash_table</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (<a class="code" href="lock0lock_8h.html#a7fec2aa31cc581d490329f5be3e11088">lock_hash_get</a>(type_mode)); }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">  /** @return the transaction&#39;s query thread state. */</span></div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="structlock__t.html#a772216ac59b70b716ad4090158e8631b">  229</a></span>&#160;  <a class="code" href="trx0types_8h.html#a34bba6fbd37f499f7874fc416547759f">trx_que_t</a> <a class="code" href="structlock__t.html#a772216ac59b70b716ad4090158e8631b">trx_que_state</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (trx-&gt;<a class="code" href="structtrx__t.html#af30d46c475f9c53eb258989c6acdfef6">lock</a>.<a class="code" href="structtrx__lock__t.html#a5b5a11c3bcbef8f9f71497710587ba90">que_state</a>); }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">  /** Print the lock object into the given output stream.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">  @param[in,out]        out     the output stream</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">  @return the given output stream. */</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  std::ostream &amp;<a class="code" href="structlock__table__t.html#a31babcbe7548a099af93a10fafc98313">print</a>(std::ostream &amp;out) <span class="keyword">const</span>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">  /** Convert the member &#39;type_mode&#39; into a human readable string.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">  @return human readable string */</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  std::string type_mode_string() <span class="keyword">const</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">/* @return the string/text representation of the record type. */</span></div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="structlock__t.html#ae72488b9bd2a94fde11301ac59cec2bd">  241</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structlock__t.html#ae72488b9bd2a94fde11301ac59cec2bd">type_string</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">switch</span> (type_mode &amp; <a class="code" href="lock0lock_8h.html#a51876da8368dde6b362ce3c465dcc9eb">LOCK_TYPE_MASK</a>) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="lock0lock_8h.html#a145ae646d1def688ee264b9d98c2e981">LOCK_REC</a>:</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">return</span> (<span class="stringliteral">&quot;LOCK_REC&quot;</span>);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="lock0lock_8h.html#a3f5d26fd94580daba78f376b8ca887dd">LOCK_TABLE</a>:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">return</span> (<span class="stringliteral">&quot;LOCK_TABLE&quot;</span>);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="ut0dbg_8h.html#a14595937e3433e1d84a3e5bca4958a96">ut_error</a>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;};</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">/** Convert the member &#39;type_mode&#39; into a human readable string.</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">@return human readable string */</span></div><div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="structlock__t.html#a07531cd6476b35f663185af78d7b554a">  255</a></span>&#160;<span class="keyword">inline</span> std::string <a class="code" href="structlock__t.html#a07531cd6476b35f663185af78d7b554a">lock_t::type_mode_string</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <a class="code" href="namespaceut.html#aa3064bc8c3aa6595f1052c2c86e52725">std::ostringstream</a> sout;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  sout &lt;&lt; type_string();</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  sout &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="lock0types_8h.html#a739513c415f3f3a100be2c1dbb59eb33">lock_mode_string</a>(<a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>());</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">if</span> (is_record_not_gap()) {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    sout &lt;&lt; <span class="stringliteral">&quot; | LOCK_REC_NOT_GAP&quot;</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">if</span> (is_waiting()) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    sout &lt;&lt; <span class="stringliteral">&quot; | LOCK_WAIT&quot;</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">if</span> (is_gap()) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    sout &lt;&lt; <span class="stringliteral">&quot; | LOCK_GAP&quot;</span>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">if</span> (is_insert_intention()) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    sout &lt;&lt; <span class="stringliteral">&quot; | LOCK_INSERT_INTENTION&quot;</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">return</span> (sout.str());</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="structlock__t.html#a88154972614cee76e78e04a3218a13c2">  278</a></span>&#160;<span class="keyword">inline</span> std::ostream &amp;<a class="code" href="structlock__t.html#a88154972614cee76e78e04a3218a13c2">lock_t::print</a>(std::ostream &amp;out)<span class="keyword"> const </span>{</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  out &lt;&lt; <span class="stringliteral">&quot;[lock_t: type_mode=&quot;</span> &lt;&lt; type_mode &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; type_mode_string() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">if</span> (is_record_lock()) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    out &lt;&lt; rec_lock;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    out &lt;&lt; tab_lock;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  out &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordflow">return</span> (out);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;}</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#abea89ba03d27c046e1e35f1fcce5b54d">  291</a></span>&#160;<span class="keyword">inline</span> std::ostream &amp;<a class="code" href="lock0priv_8h.html#a49bacfaaac1b0e5fcfd292189d099dfe">operator&lt;&lt;</a>(std::ostream &amp;out, <span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> &amp;lock) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">return</span> (lock.<a class="code" href="structlock__t.html#a88154972614cee76e78e04a3218a13c2">print</a>(out));</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;}</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keyword">extern</span> ibool <a class="code" href="lock0priv_8h.html#ad6facaed4aa238ad53ce0f202bcadc54">lock_print_waits</a>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">/* Safety margin when creating a new record lock: this many extra records</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">can be inserted to the page without need to create a lock with a bigger</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">bitmap */</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#a592267d6eb97966dc430aae3827f40c6">  303</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> ulint <a class="code" href="lock0priv_8h.html#a592267d6eb97966dc430aae3827f40c6">LOCK_PAGE_BITMAP_MARGIN</a> = 64;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">/* An explicit record lock affects both the record and the gap before it.</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">An implicit x-lock does not affect the gap, it only locks the index</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">record from read or update.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">If a transaction has modified or inserted an index record, then</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">it owns an implicit x-lock on the record. On a secondary index record,</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">a transaction has an implicit x-lock also if it has modified the</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">clustered index record, the max trx id of the page where the secondary</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">index record resides is &gt;= trx id of the transaction (or database recovery</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">is running), and there are no explicit non-gap lock requests on the</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">secondary index record.</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">This complicated definition for a secondary index comes from the</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">implementation: we want to be able to determine if a secondary index</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">record has an implicit x-lock, just by looking at the present clustered</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">index record, not at the historical versions of the record. The</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">complicated definition can be explained to the user so that there is</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">nondeterminism in the access path when a query is answered: we may,</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">or may not, access the clustered index record and thus may, or may not,</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">bump into an x-lock set there.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">Different transaction can have conflicting locks set on the gap at the</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">same time. The locks on the gap are purely inhibitive: an insert cannot</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">be made, or a select cursor may have to wait if a different transaction</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">has a conflicting lock on the gap. An x-lock on the gap does not give</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">the right to insert into the gap.</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">An explicit lock can be placed on a user record or the supremum record of</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">a page. The locks on the supremum record are always thought to be of the gap</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">type, though the gap bit is not set. When we perform an update of a record</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">where the size of the record changes, we may temporarily store its explicit</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">locks on the infimum record of the page, though the infimum otherwise never</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">carries locks.</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">A waiting record lock can also be of the gap type. A waiting lock request</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">can be granted when there is no conflicting mode lock request by another</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">transaction ahead of it in the explicit lock queue.</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">In version 4.0.5 we added yet another explicit lock type: LOCK_REC_NOT_GAP.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">It only locks the record it is placed on, not the gap before the record.</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">This lock type is necessary to emulate an Oracle-like READ COMMITTED isolation</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">level.</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">-------------------------------------------------------------------------</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">RULE 1: If there is an implicit x-lock on a record, and there are non-gap</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">-------</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">lock requests waiting in the queue, then the transaction holding the implicit</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">x-lock also has an explicit non-gap record x-lock. Therefore, as locks are</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">released, we can grant locks to waiting lock requests purely by looking at</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">the explicit lock requests in the queue.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">RULE 3: Different transactions cannot have conflicting granted non-gap locks</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">-------</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">on a record at the same time. However, they can have conflicting granted gap</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">locks.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">RULE 4: If a there is a waiting lock request in a queue, no lock request,</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">-------</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">gap or not, can be inserted ahead of it in the queue. In record deletes</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">and page splits new gap type locks can be created by the database manager</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">for a transaction, and without rule 4, the waits-for graph of transactions</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">might become cyclic without the database noticing it, as the deadlock check</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">is only performed when a transaction itself requests a lock!</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">-------------------------------------------------------------------------</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">An insert is allowed to a gap if there are no explicit lock requests by</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">other transactions on the next record. It does not matter if these lock</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">requests are granted or waiting, gap bit set or not, with the exception</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">that a gap type request set by another transaction to wait for</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">its turn to do an insert is ignored. On the other hand, an</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">implicit x-lock by another transaction does not prevent an insert, which</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">allows for more concurrency when using an Oracle-style sequence number</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">generator for the primary key with many transactions doing inserts</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">concurrently.</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">A modify of a record is allowed if the transaction has an x-lock on the</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">record, or if other transactions do not have any non-gap lock requests on the</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">record.</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">A read of a single user record with a cursor is allowed if the transaction</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">has a non-gap explicit, or an implicit lock on the record, or if the other</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">transactions have no x-lock requests on the record. At a page supremum a</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">read is always allowed.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">In summary, an implicit lock is seen as a granted x-lock only on the</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">record, not on the gap. An explicit lock with no gap bit set is a lock</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">both on the record and the gap. If the gap bit is set, the lock is only</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">on the gap. Different transaction cannot own conflicting locks on the</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">record at the same time, but they may own conflicting locks on the gap.</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">Granted locks on a record give an access right to the record, but gap type</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">locks just inhibit operations.</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">NOTE: Finding out if some transaction has an implicit x-lock on a secondary</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">index record can be cumbersome. We may have to look at previous versions of</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">the corresponding clustered index record to find out if a delete marked</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">secondary index record was delete marked by an active transaction, not by</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">a committed one.</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">FACT A: If a transaction has inserted a row, it can delete it any time</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">without need to wait for locks.</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">PROOF: The transaction has an implicit x-lock on every index record inserted</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">for the row, and can thus modify each record without the need to wait. Q.E.D.</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">FACT B: If a transaction has read some result set with a cursor, it can read</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">it again, and retrieves the same result set, if it has not modified the</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">result set in the meantime. Hence, there is no phantom problem. If the</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">biggest record, in the alphabetical order, touched by the cursor is removed,</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">a lock wait may occur, otherwise not.</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">PROOF: When a read cursor proceeds, it sets an s-lock on each user record</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">it passes, and a gap type s-lock on each page supremum. The cursor must</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">wait until it has these locks granted. Then no other transaction can</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">have a granted x-lock on any of the user records, and therefore cannot</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">modify the user records. Neither can any other transaction insert into</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">the gaps which were passed over by the cursor. Page splits and merges,</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">and removal of obsolete versions of records do not affect this, because</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">when a user record or a page supremum is removed, the next record inherits</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">its locks as gap type locks, and therefore blocks inserts to the same gap.</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">Also, if a page supremum is inserted, it inherits its locks from the successor</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">record. When the cursor is positioned again at the start of the result set,</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">the records it will touch on its course are either records it touched</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">during the last pass or new inserted page supremums. It can immediately</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">access all these records, and when it arrives at the biggest record, it</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">notices that the result set is complete. If the biggest record was removed,</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">lock wait can occur because the next record only inherits a gap type lock,</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">and a wait may be needed. Q.E.D. */</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">/* If an index record should be changed or a new inserted, we must check</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">the lock on the record or the next. When a read cursor starts reading,</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">we will set a record level s-lock on each record it passes, except on the</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">initial record on which the cursor is positioned before we start to fetch</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">records. Our index tree search has the convention that the B-tree</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">cursor is positioned BEFORE the first possibly matching record in</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">the search. Optimizations are possible here: if the record is searched</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">on an equality condition to a unique key, we could actually set a special</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">lock on the record, a lock which would not prevent any insert before</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">this record. In the next key locking an x-lock set on a record also</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">prevents inserts just before that record.</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">        There are special infimum and supremum records on each page.</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">A supremum record can be locked by a read cursor. This records cannot be</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">updated but the lock prevents insert of a user record to the end of</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">the page.</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">        Next key locks will prevent the phantom problem where new rows</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">could appear to SELECT result sets after the select operation has been</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">performed. Prevention of phantoms ensures the serilizability of</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">transactions.</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">        What should we check if an insert of a new record is wanted?</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">Only the lock on the next record on the same page, because also the</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">supremum record can carry a lock. An s-lock prevents insertion, but</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">what about an x-lock? If it was set by a searched update, then there</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">is implicitly an s-lock, too, and the insert should be prevented.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">What if our transaction owns an x-lock to the next record, but there is</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">a waiting s-lock request on the next record? If this s-lock was placed</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">by a read cursor moving in the ascending order in the index, we cannot</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">do the insert immediately, because when we finally commit our transaction,</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">the read cursor should see also the new inserted record. So we should</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">move the read cursor backward from the next record for it to pass over</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">the new inserted record. This move backward may be too cumbersome to</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">implement. If we in this situation just enqueue a second x-lock request</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">for our transaction on the next record, then the deadlock mechanism</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">notices a deadlock between our transaction and the s-lock request</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">transaction. This seems to be an ok solution.</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">        We could have the convention that granted explicit record locks,</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">lock the corresponding records from changing, and also lock the gaps</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">before them from inserting. A waiting explicit lock request locks the gap</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">before from inserting. Implicit record x-locks, which we derive from the</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">transaction id in the clustered index record, only lock the record itself</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">from modification, not the gap before it from inserting.</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">        How should we store update locks? If the search is done by a unique</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">key, we could just modify the record trx id. Otherwise, we could put a record</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">x-lock on the record. If the update changes ordering fields of the</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">clustered index record, the inserted new record needs no record lock in</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">lock table, the trx id is enough. The same holds for a secondary index</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">record. Searched delete is similar to update.</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">PROBLEM:</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">What about waiting lock requests? If a transaction is waiting to make an</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">update to a record which another modified, how does the other transaction</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">know to send the end-lock-wait signal to the waiting transaction? If we have</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">the convention that a transaction may wait for just one lock at a time, how</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">do we preserve it if lock wait ends?</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">PROBLEM:</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">Checking the trx id label of a secondary index record. In the case of a</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">modification, not an insert, is this necessary? A secondary index record</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">is modified only by setting or resetting its deleted flag. A secondary index</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">record contains fields to uniquely determine the corresponding clustered</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">index record. A secondary index record is therefore only modified if we</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">also modify the clustered index record, and the trx id checking is done</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">on the clustered index record, before we come to modify the secondary index</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">record. So, in the case of delete marking or unmarking a secondary index</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">record, we do not have to care about trx ids, only the locks in the lock</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">table must be checked. In the case of a select from a secondary index, the</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">trx id is relevant, and in this case we may have to search the clustered</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">index record.</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">PROBLEM: How to update record locks when page is split or merged, or</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">--------------------------------------------------------------------</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">a record is deleted or updated?</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">If the size of fields in a record changes, we perform the update by</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">a delete followed by an insert. How can we retain the locks set or</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">waiting on the record? Because a record lock is indexed in the bitmap</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">by the heap number of the record, when we remove the record from the</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">record list, it is possible still to keep the lock bits. If the page</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">is reorganized, we could make a table of old and new heap numbers,</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">and permute the bitmaps in the locks accordingly. We can add to the</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">table a row telling where the updated record ended. If the update does</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">not require a reorganization of the page, we can simply move the lock</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">bits for the updated record to the position determined by its new heap</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">number (we may have to allocate a new lock, if we run out of the bitmap</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">in the old one).</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">        A more complicated case is the one where the reinsertion of the</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">updated record is done pessimistically, because the structure of the</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">tree may change.</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">PROBLEM: If a supremum record is removed in a page merge, or a record</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">---------------------------------------------------------------------</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">removed in a purge, what to do to the waiting lock requests? In a split to</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">the right, we just move the lock requests to the new supremum. If a record</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">is removed, we could move the waiting lock request to its inheritor, the</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">next record in the index. But, the next record may already have lock</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">requests on its own queue. A new deadlock check should be made then. Maybe</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">it is easier just to release the waiting transactions. They can then enqueue</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">new lock requests on appropriate records.</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">PROBLEM: When a record is inserted, what locks should it inherit from the</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">-------------------------------------------------------------------------</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">upper neighbor? An insert of a new supremum record in a page split is</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">always possible, but an insert of a new user record requires that the upper</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">neighbor does not have any lock requests by other transactions, granted or</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">waiting, in its lock queue. Solution: We can copy the locks as gap type</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">locks, so that also the waiting locks are transformed to granted gap type</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">locks on the inserted record. */</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">/* LOCK COMPATIBILITY MATRIX</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"> *    IS IX S  X  AI</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment"> * IS +  +  +  -  +</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"> * IX +  +  -  -  +</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment"> * S  +  -  +  -  -</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment"> * X  -  -  -  -  -</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment"> * AI +  +  -  -  -</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment"> * Note that for rows, InnoDB only acquires S or X locks.</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"> * For tables, InnoDB normally acquires IS or IX locks.</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment"> * S or X table locks are only acquired for LOCK TABLES.</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"> * Auto-increment (AI) locks are needed because of</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment"> * statement-level MySQL binlog.</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment"> * See also lock_mode_compatible().</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#a3579e0d5ddc973a66fae09c8990e05ea">  554</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> <a class="code" href="lock0priv_8h.html#a3579e0d5ddc973a66fae09c8990e05ea">lock_compatibility_matrix</a>[5][5] = {<span class="comment"></span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">    /**         IS     IX       S     X       AI */</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">/* IS */</span> {<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, TRUE},</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">/* IX */</span> {<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, TRUE},</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">/* S  */</span> {<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, FALSE},</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">/* X  */</span> {<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, FALSE},</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">/* AI */</span> {<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, FALSE}};</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">/* STRONGER-OR-EQUAL RELATION (mode1=row, mode2=column)</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment"> *    IS IX S  X  AI</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"> * IS +  -  -  -  -</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment"> * IX +  +  -  -  -</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment"> * S  +  -  +  -  -</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment"> * X  +  +  +  +  +</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment"> * AI -  -  -  -  +</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment"> * See lock_mode_stronger_or_eq().</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00571"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#a1c37e6a5830ee34d6670d87ccc14128f">  571</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> <a class="code" href="lock0priv_8h.html#a1c37e6a5830ee34d6670d87ccc14128f">lock_strength_matrix</a>[5][5] = {<span class="comment"></span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">    /**         IS     IX       S     X       AI */</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="comment">/* IS */</span> {<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, FALSE},</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">/* IX */</span> {<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, FALSE},</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">/* S  */</span> {<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, FALSE},</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">/* X  */</span> {<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, TRUE},</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">/* AI */</span> {<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, TRUE}};</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">/** Maximum depth of the DFS stack. */</span></div><div class="line"><a name="l00580"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#a4623ba68acd8e00ad5d81a0121f8e891">  580</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> ulint <a class="code" href="lock0priv_8h.html#a4623ba68acd8e00ad5d81a0121f8e891">MAX_STACK_SIZE</a> = 4096;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#aa6e552c5c76599d5235fb2d36fbf87e3">  582</a></span>&#160;<span class="preprocessor">#define PRDT_HEAPNO PAGE_HEAP_NO_INFIMUM</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">/** Record locking request status */</span></div><div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5b">  584</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5b">lock_rec_req_status</a> {<span class="comment"></span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">  /** Failed to acquire a lock */</span></div><div class="line"><a name="l00586"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5ba12a47b5e4d2d01853958ecbc0513bb31">  586</a></span>&#160;  <a class="code" href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5ba12a47b5e4d2d01853958ecbc0513bb31">LOCK_REC_FAIL</a>,<span class="comment"></span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">  /** Succeeded in acquiring a lock (implicit or already acquired) */</span></div><div class="line"><a name="l00588"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5ba4f02aa53c8580c293151a57282bdbdd6">  588</a></span>&#160;  <a class="code" href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5ba4f02aa53c8580c293151a57282bdbdd6">LOCK_REC_SUCCESS</a>,<span class="comment"></span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">  /** Explicitly created a new lock */</span></div><div class="line"><a name="l00590"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5bab91e6212faed445182df02ef9497f066">  590</a></span>&#160;  <a class="code" href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5bab91e6212faed445182df02ef9497f066">LOCK_REC_SUCCESS_CREATED</a></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;};</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">Record lock ID */</span></div><div class="line"><a name="l00595"></a><span class="lineno"><a class="line" href="structRecID.html">  595</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structRecID.html">RecID</a> {<span class="comment"></span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">  /** Constructor</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">  @param[in]    lock            Record lock</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">  @param[in]    heap_no         Heap number in the page */</span></div><div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="structRecID.html#af061183e2f5aebbf66bf030ccbda5ba9">  599</a></span>&#160;  <a class="code" href="structRecID.html#af061183e2f5aebbf66bf030ccbda5ba9">RecID</a>(<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock, ulint heap_no)</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      : <a class="code" href="structRecID.html">RecID</a>(lock-&gt;rec_lock.page_id, heap_no) {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(lock-&gt;<a class="code" href="structlock__t.html#a7651674780568aa384de60523c1d3d0d">is_record_lock</a>());</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">  /** Constructor</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">  @param[in]    page_id         Tablespace ID and page number within space</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">  @param[in]    heap_no         Heap number in the page */</span></div><div class="line"><a name="l00607"></a><span class="lineno"><a class="line" href="structRecID.html#a545850b9ee2e42a9b12b567cd7c483c5">  607</a></span>&#160;  <a class="code" href="structRecID.html#a545850b9ee2e42a9b12b567cd7c483c5">RecID</a>(<a class="code" href="classpage__id__t.html">page_id_t</a> page_id, uint32_t heap_no)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      : m_page_id(page_id), m_heap_no(heap_no), m_fold(<a class="code" href="lock0lock_8h.html#a1206e21ae1b1abe21e29acec6af79a8c">lock_rec_fold</a>(page_id)) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_page_id.space() &lt; <a class="code" href="lexyy_8cc.html#ab5eb23180f7cc12b7d6c04a8ec067fdd">UINT32_MAX</a>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_page_id.page_no() &lt; <a class="code" href="lexyy_8cc.html#ab5eb23180f7cc12b7d6c04a8ec067fdd">UINT32_MAX</a>);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_heap_no &lt; <a class="code" href="lexyy_8cc.html#ab5eb23180f7cc12b7d6c04a8ec067fdd">UINT32_MAX</a>);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">  /** Constructor</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">  @param[in]    block           Block in a tablespace</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">  @param[in]    heap_no         Heap number in the block */</span></div><div class="line"><a name="l00617"></a><span class="lineno"><a class="line" href="structRecID.html#a62a97e4030d78e4cc2cfcdf1cb100a20">  617</a></span>&#160;  <a class="code" href="structRecID.html#a62a97e4030d78e4cc2cfcdf1cb100a20">RecID</a>(<span class="keyword">const</span> <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block, ulint heap_no)</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      : <a class="code" href="structRecID.html">RecID</a>(block-&gt;get_page_id(), heap_no) {}</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">  @return the &quot;folded&quot; value of {space, page_no} */</span></div><div class="line"><a name="l00622"></a><span class="lineno"><a class="line" href="structRecID.html#a16ca3f38bd21bcc63346e4b08674305b">  622</a></span>&#160;  ulint <a class="code" href="structRecID.html#a16ca3f38bd21bcc63346e4b08674305b">fold</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (m_fold); }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">  /** @return true if it&#39;s the supremum record */</span></div><div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="structRecID.html#a3bc9ed3a564ef26d85882d806865ab15">  625</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structRecID.html#a3bc9ed3a564ef26d85882d806865ab15">is_supremum</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (m_heap_no == <a class="code" href="page0types_8h.html#a5d783fe226bc984a8ec24ff5abf8c966">PAGE_HEAP_NO_SUPREMUM</a>); }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="comment">/* Check if the rec id matches the lock instance.</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">  @param[i]     lock            Lock to compare with</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">  @return true if &lt;space, page_no, heap_no&gt; matches the lock. */</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> matches(<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock) <span class="keyword">const</span>;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="structRecID.html#ae7b1b4de5bc3cdf42b758e4379007b00">  632</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classpage__id__t.html">page_id_t</a> &amp;<a class="code" href="structRecID.html#ae7b1b4de5bc3cdf42b758e4379007b00">get_page_id</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_page_id; }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">  /** Tablespace ID and page number within space  */</span></div><div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="structRecID.html#ae03e4bb0ef42ca8232bdfcff51f1c08e">  635</a></span>&#160;  <a class="code" href="classpage__id__t.html">page_id_t</a> <a class="code" href="structRecID.html#ae03e4bb0ef42ca8232bdfcff51f1c08e">m_page_id</a>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">  Heap number within the page */</span></div><div class="line"><a name="l00639"></a><span class="lineno"><a class="line" href="structRecID.html#a819cef67dd372607426c89e7b9e55268">  639</a></span>&#160;  uint32_t <a class="code" href="structRecID.html#a819cef67dd372607426c89e7b9e55268">m_heap_no</a>;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">  Hashed key value */</span></div><div class="line"><a name="l00643"></a><span class="lineno"><a class="line" href="structRecID.html#a93ae69bc876d2b3f739b59fadfd0b804">  643</a></span>&#160;  ulint <a class="code" href="structRecID.html#a93ae69bc876d2b3f739b59fadfd0b804">m_fold</a>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;};</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">Create record locks */</span></div><div class="line"><a name="l00648"></a><span class="lineno"><a class="line" href="classRecLock.html">  648</a></span>&#160;<span class="keyword">class </span><a class="code" href="classRecLock.html">RecLock</a> {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">  @param[in,out] thr    Transaction query thread requesting the record</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">                          lock</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">  @param[in] index      Index on which record lock requested</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">  @param[in] rec_id     Record lock tuple {space, page_no, heap_no}</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">  @param[in] mode               The lock mode */</span></div><div class="line"><a name="l00656"></a><span class="lineno"><a class="line" href="classRecLock.html#a5bac461b3f22b08a7639d8a7b44870df">  656</a></span>&#160;  <a class="code" href="classRecLock.html#a5bac461b3f22b08a7639d8a7b44870df">RecLock</a>(<a class="code" href="structque__thr__t.html">que_thr_t</a> *thr, <a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a>, <span class="keyword">const</span> <a class="code" href="structRecID.html">RecID</a> &amp;rec_id, ulint <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>)</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      : m_thr(thr),</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        m_trx(<a class="code" href="que0que_8h.html#a8a52bb487c54522cbb437ee19563c990">thr_get_trx</a>(thr)),</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        m_mode(mode),</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        m_index(index),</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        m_rec_id(rec_id) {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(is_predicate_lock(m_mode));</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <a class="code" href="audit__api__message__emit_8cc.html#a9ab62ce08f07c43d34e2d46dcc0f5f68">init</a>(<span class="keyword">nullptr</span>);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">  @param[in,out] thr    Transaction query thread requesting the record</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">                          lock</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">  @param[in] index      Index on which record lock requested</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">  @param[in] block      Buffer page containing record</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">  @param[in] heap_no    Heap number within the block</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">  @param[in] mode               The lock mode</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">  @param[in] prdt               The predicate for the rtree lock */</span></div><div class="line"><a name="l00675"></a><span class="lineno"><a class="line" href="classRecLock.html#a770d6f1e90863d37d5d79a00076be4d7">  675</a></span>&#160;  <a class="code" href="classRecLock.html#a770d6f1e90863d37d5d79a00076be4d7">RecLock</a>(<a class="code" href="structque__thr__t.html">que_thr_t</a> *thr, <a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a>, <span class="keyword">const</span> <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block,</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;          ulint heap_no, ulint <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>, <a class="code" href="structlock__prdt.html">lock_prdt_t</a> *prdt = <span class="keyword">nullptr</span>)</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      : m_thr(thr),</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        m_trx(<a class="code" href="que0que_8h.html#a8a52bb487c54522cbb437ee19563c990">thr_get_trx</a>(thr)),</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        m_mode(mode),</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        m_index(index),</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        m_rec_id(block, heap_no) {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <a class="code" href="btr0btr_8h.html#a2e7b9b7db7f01f12accffb27b543d03d">btr_assert_not_corrupted</a>(block, index);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <a class="code" href="audit__api__message__emit_8cc.html#a9ab62ce08f07c43d34e2d46dcc0f5f68">init</a>(block-&gt;<a class="code" href="structbuf__block__t.html#a8ef8d133a86de0277832fc291bb7f081">frame</a>);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">  @param[in] index      Index on which record lock requested</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">  @param[in] rec_id     Record lock tuple {space, page_no, heap_no}</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">  @param[in] mode               The lock mode */</span></div><div class="line"><a name="l00691"></a><span class="lineno"><a class="line" href="classRecLock.html#af2d6f78ca98e9cc56ce3f8b2e3805ff2">  691</a></span>&#160;  <a class="code" href="classRecLock.html#af2d6f78ca98e9cc56ce3f8b2e3805ff2">RecLock</a>(<a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a>, <span class="keyword">const</span> <a class="code" href="structRecID.html">RecID</a> &amp;rec_id, ulint <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      : m_thr(), m_trx(), m_mode(mode), m_index(index), m_rec_id(rec_id) {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(is_predicate_lock(m_mode));</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <a class="code" href="audit__api__message__emit_8cc.html#a9ab62ce08f07c43d34e2d46dcc0f5f68">init</a>(<span class="keyword">nullptr</span>);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">  @param[in] index      Index on which record lock requested</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">  @param[in] block      Buffer page containing record</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">  @param[in] heap_no    Heap number withing block</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">  @param[in] mode               The lock mode */</span></div><div class="line"><a name="l00703"></a><span class="lineno"><a class="line" href="classRecLock.html#a13b368d05d8712f18719aebdf2aff9fc">  703</a></span>&#160;  <a class="code" href="classRecLock.html#a13b368d05d8712f18719aebdf2aff9fc">RecLock</a>(<a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a>, <span class="keyword">const</span> <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block, ulint heap_no,</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          ulint <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>)</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      : m_thr(),</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        m_trx(),</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        m_mode(mode),</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        m_index(index),</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        m_rec_id(block, heap_no) {</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <a class="code" href="btr0btr_8h.html#a2e7b9b7db7f01f12accffb27b543d03d">btr_assert_not_corrupted</a>(block, index);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <a class="code" href="audit__api__message__emit_8cc.html#a9ab62ce08f07c43d34e2d46dcc0f5f68">init</a>(block-&gt;<a class="code" href="structbuf__block__t.html#a8ef8d133a86de0277832fc291bb7f081">frame</a>);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  }</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">  Enqueue a lock wait for a transaction. If it is a high priority transaction</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">  (cannot rollback) then try to jump ahead in the record lock wait queue. Also</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">  check if async rollback was request for our trx.</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">  @param[in, out] wait_for      The lock that the the joining transaction is</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">                                waiting for</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">  @param[in] prdt               Predicate [optional]</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">  @return DB_LOCK_WAIT, DB_DEADLOCK, or DB_SUCCESS_LOCKED_REC</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">  @retval DB_DEADLOCK means that async rollback was requested for our trx</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">  @retval DB_SUCCESS_LOCKED_REC means that we are High Priority transaction and</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">                                we&#39;ve managed to jump in front of other waiting</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">                                transactions and got the lock granted, so there</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">                                is no need to wait. */</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <a class="code" href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a> add_to_waitq(<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *wait_for,</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                       <span class="keyword">const</span> <a class="code" href="structlock__prdt.html">lock_prdt_t</a> *prdt = <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">  Create a lock for a transaction and initialise it.</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">  @param[in, out] trx           Transaction requesting the new lock</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">  @param[in] prdt                       Predicate lock (optional)</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">  @return new lock instance */</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="namespacedblwr_1_1v1.html#a2213362152a12bb25be6185d420285b6">create</a>(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keyword">const</span> <a class="code" href="structlock__prdt.html">lock_prdt_t</a> *prdt = <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">  Create the lock instance</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">  @param[in, out] trx   The transaction requesting the lock</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">  @param[in, out] index Index on which record lock is required</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">  @param[in] mode               The lock mode desired</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">  @param[in] rec_id     The record id</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">  @param[in] size               Size of the lock + bitmap requested</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">  @return a record lock instance */</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="keyword">static</span> <a class="code" href="structlock__t.html">lock_t</a> *lock_alloc(<a class="code" href="structtrx__t.html">trx_t</a> *trx, <a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a>, ulint <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>,</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                            <span class="keyword">const</span> <a class="code" href="structRecID.html">RecID</a> &amp;rec_id, ulint size);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">  @return the record lock size in bytes */</span></div><div class="line"><a name="l00752"></a><span class="lineno"><a class="line" href="classRecLock.html#a733977eec57ccb44d5d82bc0d305c67e">  752</a></span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="classRecLock.html#a733977eec57ccb44d5d82bc0d305c67e">lock_size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (m_size); }</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">  Do some checks and prepare for creating a new record lock */</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="xcom__base_8cc.html#ae59cfd3ffb63867637cd9aca530ec6fb">prepare</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">  Setup the requesting transaction state for lock grant</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">  @param[in,out] lock   Lock for which to change state */</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordtype">void</span> set_wait_state(<a class="code" href="structlock__t.html">lock_t</a> *lock);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">  Add the lock to the record lock hash and the transaction&#39;s lock list</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">  @param[in,out] lock   Newly created record lock to add to the</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">                          rec hash and the transaction lock list */</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordtype">void</span> lock_add(<a class="code" href="structlock__t.html">lock_t</a> *lock);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">  Setup the context from the requirements */</span></div><div class="line"><a name="l00771"></a><span class="lineno"><a class="line" href="classRecLock.html#add38f51d08bba89723155e448c4dc8cf">  771</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classRecLock.html#add38f51d08bba89723155e448c4dc8cf">init</a>(<span class="keyword">const</span> <a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *<a class="code" href="ctype-mb_8cc.html#adf406aa6822ceac22d62ef63cc2879c0">page</a>) {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="namespacelocksys.html#a2f6f08b62f3525ce41e225523a004f5b">locksys::owns_page_shard</a>(m_rec_id.get_page_id()));</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(!<a class="code" href="srv0srv_8h.html#abee3b4363b1c03c5eb8d9b515e80bad2">srv_read_only_mode</a>);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_index-&gt;is_clustered() || !<a class="code" href="dict0dict_8h.html#afcbc5eab483c1f89ffe2208855f3f9b7">dict_index_is_online_ddl</a>(m_index));</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_thr == <span class="keyword">nullptr</span> || m_trx == <a class="code" href="que0que_8h.html#a8a52bb487c54522cbb437ee19563c990">thr_get_trx</a>(m_thr));</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    m_size = is_predicate_lock(m_mode) ? lock_size(m_mode) : lock_size(page);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">    /** If rec is the supremum record, then we reset the</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">    gap and LOCK_REC_NOT_GAP bits, as all locks on the</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">    supremum are automatically of the gap type */</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">if</span> (m_rec_id.m_heap_no == <a class="code" href="page0types_8h.html#a5d783fe226bc984a8ec24ff5abf8c966">PAGE_HEAP_NO_SUPREMUM</a>) {</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(!(m_mode &amp; <a class="code" href="lock0lock_8h.html#a5ec9b0cce21ee17de083d3bb96b1bec6">LOCK_REC_NOT_GAP</a>));</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      m_mode &amp;= ~(<a class="code" href="lock0lock_8h.html#a8631af3f85d4c19484f6de819b2b2a37">LOCK_GAP</a> | <a class="code" href="lock0lock_8h.html#a5ec9b0cce21ee17de083d3bb96b1bec6">LOCK_REC_NOT_GAP</a>);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  }</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">  Calculate the record lock physical size required for a predicate lock.</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">  @param[in] mode For predicate locks the lock mode</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">  @return the size of the lock data structure required in bytes */</span></div><div class="line"><a name="l00794"></a><span class="lineno"><a class="line" href="classRecLock.html#ab8ec3eb2d231c05bb31a6637b5fc0a82">  794</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="classRecLock.html#ab8ec3eb2d231c05bb31a6637b5fc0a82">lock_size</a>(ulint mode) {</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(is_predicate_lock(mode));</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">/* The lock is always on PAGE_HEAP_NO_INFIMUM(0),</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">    so we only need 1 bit (which is rounded up to 1</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">    byte) for lock bit setting */</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="keywordtype">size_t</span> n_bytes;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">if</span> (mode &amp; <a class="code" href="lock0lock_8h.html#a7e59e399364d823b33bc010e93e9c278">LOCK_PREDICATE</a>) {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keyword">const</span> ulint align = UNIV_WORD_SIZE - 1;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      <span class="comment">/* We will attach the predicate structure</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">      after lock. Make sure the memory is</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">      aligned on 8 bytes, the mem_heap_alloc</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">      will align it with MEM_SPACE_NEEDED</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment">      anyway. */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      n_bytes = (1 + <span class="keyword">sizeof</span>(<a class="code" href="lock0prdt_8h.html#ae6ee8eb7348a3ee9c118a2816ce7f969">lock_prdt_t</a>) + align) &amp; ~align;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      <span class="comment">/* This should hold now */</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(n_bytes == <span class="keyword">sizeof</span>(<a class="code" href="structlock__prdt.html">lock_prdt_t</a>) + UNIV_WORD_SIZE);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      n_bytes = 1;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">return</span> (n_bytes);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">  Calculate the record lock physical size required, non-predicate lock.</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">  @param[in] page               For non-predicate locks the buffer page</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">  @return the size of the lock data structure required in bytes */</span></div><div class="line"><a name="l00829"></a><span class="lineno"><a class="line" href="classRecLock.html#a7ae916345da4c9fa6563110903835a10">  829</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="classRecLock.html#a7ae916345da4c9fa6563110903835a10">lock_size</a>(<span class="keyword">const</span> <a class="code" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *<a class="code" href="ctype-mb_8cc.html#adf406aa6822ceac22d62ef63cc2879c0">page</a>) {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    ulint n_recs = <a class="code" href="page0page_8h.html#a57eb1546633fef3f6135cffa4a77cf87">page_dir_get_n_heap</a>(page);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="comment">/* Make lock bitmap bigger by a safety margin */</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">return</span> (1 + ((n_recs + LOCK_PAGE_BITMAP_MARGIN) / 8));</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">  @return true if the requested lock mode is for a predicate</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">          or page lock */</span></div><div class="line"><a name="l00840"></a><span class="lineno"><a class="line" href="classRecLock.html#a5e285214ed0893dcdae8c65a313003ad">  840</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classRecLock.html#a5e285214ed0893dcdae8c65a313003ad">is_predicate_lock</a>(ulint mode) {</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">return</span> (mode &amp; (<a class="code" href="lock0lock_8h.html#a7e59e399364d823b33bc010e93e9c278">LOCK_PREDICATE</a> | <a class="code" href="lock0lock_8h.html#a7fe3f32b4e6bb44b08818eea5638e94b">LOCK_PRDT_PAGE</a>));</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  }</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">  /** The query thread of the transaction */</span></div><div class="line"><a name="l00846"></a><span class="lineno"><a class="line" href="classRecLock.html#ae38dbfed90de96e512902640a76a2942">  846</a></span>&#160;  <a class="code" href="structque__thr__t.html">que_thr_t</a> *<a class="code" href="classRecLock.html#ae38dbfed90de96e512902640a76a2942">m_thr</a>;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">  Transaction requesting the record lock */</span></div><div class="line"><a name="l00850"></a><span class="lineno"><a class="line" href="classRecLock.html#ad977aa957a3c0be118e9e56bc0a783d3">  850</a></span>&#160;  <a class="code" href="structtrx__t.html">trx_t</a> *<a class="code" href="classRecLock.html#ad977aa957a3c0be118e9e56bc0a783d3">m_trx</a>;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">  Lock mode requested */</span></div><div class="line"><a name="l00854"></a><span class="lineno"><a class="line" href="classRecLock.html#a080573c20a0b8f5a7405fd1fa1bf226d">  854</a></span>&#160;  ulint <a class="code" href="classRecLock.html#a080573c20a0b8f5a7405fd1fa1bf226d">m_mode</a>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">  Size of the record lock in bytes */</span></div><div class="line"><a name="l00858"></a><span class="lineno"><a class="line" href="classRecLock.html#acfeab4b65de9b504e1f66d95b5fcb582">  858</a></span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="classRecLock.html#acfeab4b65de9b504e1f66d95b5fcb582">m_size</a>;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">  Index on which the record lock is required */</span></div><div class="line"><a name="l00862"></a><span class="lineno"><a class="line" href="classRecLock.html#af263967471da92c816a2ea281dd827f5">  862</a></span>&#160;  <a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="classRecLock.html#af263967471da92c816a2ea281dd827f5">m_index</a>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">  The record lock tuple {space, page_no, heap_no} */</span></div><div class="line"><a name="l00866"></a><span class="lineno"><a class="line" href="classRecLock.html#a15f65ec0eb059de8f610608f8f2ce129">  866</a></span>&#160;  <a class="code" href="structRecID.html">RecID</a> <a class="code" href="classRecLock.html#a15f65ec0eb059de8f610608f8f2ce129">m_rec_id</a>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;};</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">/** The count of the types of locks. */</span></div><div class="line"><a name="l00871"></a><span class="lineno"><a class="line" href="lock0priv_8h.html#a3508c405f6cb243c87e446622afdcf11">  871</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> ulint <a class="code" href="lock0priv_8h.html#a3508c405f6cb243c87e446622afdcf11">lock_types</a> = UT_ARR_SIZE(lock_compatibility_matrix);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">/** Gets the type of a lock.</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment"> @return LOCK_TABLE or LOCK_REC */</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;uint32_t <a class="code" href="lock0priv_8h.html#ae7598ff3072373dabc18c756632ece1f">lock_get_type_low</a>(<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock); <span class="comment">/*!&lt; in: lock */</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">/** Gets the previous record lock set on a record.</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment"> @return previous lock on the same record, NULL if none exists */</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="lock0priv_8h.html#a9398c6b6d42fd740b9fa25ae4be1f660">lock_rec_get_prev</a>(</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *in_lock, <span class="comment">/*!&lt; in: record lock */</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    ulint heap_no);        <span class="comment">/*!&lt; in: heap number of the record */</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">/** Cancels a waiting lock request and releases possible other transactions</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">waiting behind it.</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">@param[in,out]  lock            Waiting lock request */</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="keywordtype">void</span> <a class="code" href="lock0priv_8h.html#aca77337242c4af78b916e503a81b57e2">lock_cancel_waiting_and_release</a>(<a class="code" href="structlock__t.html">lock_t</a> *lock);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">/** This function is a wrapper around several functions which need to be called</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">in particular order to wake up a transaction waiting for a lock.</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">You should not call lock_wait_release_thread_if_suspended(thr) directly,</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">but rather use this wrapper, as this makes it much easier to reason about all</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">possible states in which lock, trx, and thr can be.</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">It makes sure that trx is woken up exactly once, and only if it already went to</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">sleep.</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">@param[in, out]   lock    The lock for which lock-&gt;trx is waiting */</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="keywordtype">void</span> <a class="code" href="lock0priv_8h.html#a28ad945a2410b29af7752e94ffa30ae6">lock_reset_wait_and_release_thread_if_suspended</a>(<a class="code" href="structlock__t.html">lock_t</a> *lock);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">/** Checks if some transaction has an implicit x-lock on a record in a clustered</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment"> index.</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment"> @return transaction id of the transaction which has the x-lock, or 0 */</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<a class="code" href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a> <a class="code" href="lock0priv_8h.html#a34549675db50fa2140bd18244c046f8d">lock_clust_rec_some_has_impl</a>(</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keyword">const</span> <a class="code" href="rem0types_8h.html#a92caeffe2dc2fbe825a54aef9a163435">rec_t</a> *rec,          <span class="comment">/*!&lt; in: user record */</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keyword">const</span> <a class="code" href="structdict__index__t.html">dict_index_t</a> *<a class="code" href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a>, <span class="comment">/*!&lt; in: clustered index */</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keyword">const</span> ulint *offsets)      <span class="comment">/*!&lt; in: rec_get_offsets(rec, index) */</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">/** Gets the first or next record lock on a page.</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment"> @return next lock, NULL if none exists */</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="lock0priv_8h.html#a6c0d0d9c1d6281cbe1a248f29d9e6dd7">lock_rec_get_next_on_page_const</a>(</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock); <span class="comment">/*!&lt; in: a record lock */</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">/** Gets the number of bits in a record lock bitmap.</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment"> @return number of bits */</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;ulint <a class="code" href="lock0priv_8h.html#a3bb79a43f5b92cea073f2cde49949308">lock_rec_get_n_bits</a>(<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock); <span class="comment">/*!&lt; in: record lock */</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">/** Sets the nth bit of a record lock to TRUE.</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">@param[in]      lock    record lock</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">@param[in]      i       index of the bit */</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="keywordtype">void</span> <a class="code" href="lock0priv_8h.html#ae0cb59e5d76d0647bfbc4096682228f3">lock_rec_set_nth_bit</a>(<a class="code" href="structlock__t.html">lock_t</a> *lock, ulint i);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">/** Gets the first or next record lock on a page.</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment"> @return next lock, NULL if none exists */</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="lock0priv_8h.html#ad0e694a3a47a498c55bd09c5127b162a">lock_rec_get_next_on_page</a>(<a class="code" href="structlock__t.html">lock_t</a> *lock); <span class="comment">/*!&lt; in: a record lock */</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">/** Gets the first record lock on a page, where the page is identified by its</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">file address.</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">@param[in]      lock_hash       lock hash table</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">@param[in]      page_id         specifies space id and page number of the page</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">@return first lock, NULL if none exists */</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="lock0priv_8h.html#a61561eadb600f37c0dc22bd4effad91b">lock_rec_get_first_on_page_addr</a>(<a class="code" href="structhash__table__t.html">hash_table_t</a> *lock_hash,</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                                        <span class="keyword">const</span> <a class="code" href="classpage__id__t.html">page_id_t</a> &amp;page_id);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">/** Gets the first record lock on a page, where the page is identified by a</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">pointer to it.</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">@param[in]      lock_hash       lock hash table</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">@param[in]      block           buffer block</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">@return first lock, NULL if none exists */</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="lock0priv_8h.html#a77353055fb4e9cff71124da74ecd85f4">lock_rec_get_first_on_page</a>(<a class="code" href="structhash__table__t.html">hash_table_t</a> *lock_hash,</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">/** Gets the next explicit lock request on a record.</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">@param[in]      heap_no heap number of the record</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">@param[in]      lock    lock</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">@return next lock, NULL if none exists or if heap_no == ULINT_UNDEFINED */</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="lock0priv_8h.html#a81f2ac5cbb634ee6ef9663ba8bf4bbab">lock_rec_get_next</a>(ulint heap_no, <a class="code" href="structlock__t.html">lock_t</a> *lock);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">/** Gets the next explicit lock request on a record.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">@param[in]      heap_no heap number of the record</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">@param[in]      lock    lock</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">@return next lock, NULL if none exists or if heap_no == ULINT_UNDEFINED */</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="lock0priv_8h.html#a9cf1fd0b7f60894fecee9005803e62fa">lock_rec_get_next_const</a>(ulint heap_no, <span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">/** Gets the first explicit lock request on a record.</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">@param[in]      hash    hash chain the lock on</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">@param[in]      block   block containing the record</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">@param[in]      heap_no heap number of the record</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">@return first lock, NULL if none exists */</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="lock0priv_8h.html#a340a22e43fd6b50411f084c5d4e9972d">lock_rec_get_first</a>(<a class="code" href="structhash__table__t.html">hash_table_t</a> *<a class="code" href="hash_8c.html#a1c12edaae63f2e86a5b276a18475f863">hash</a>, <span class="keyword">const</span> <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block,</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                           ulint heap_no);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">/** Gets the mode of a lock.</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment"> @return mode */</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="keyword">enum</span> <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013">lock_mode</a> <a class="code" href="lock0priv_8h.html#ae4ba4d837532fb8eaf414d1cbaaf6d90">lock_get_mode</a>(<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock); <span class="comment">/*!&lt; in: lock */</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">/** Calculates if lock mode 1 is compatible with lock mode 2.</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">@param[in]      mode1   lock mode</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">@param[in]      mode2   lock mode</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">@return nonzero if mode1 compatible with mode2 */</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;ulint <a class="code" href="lock0priv_8h.html#a07853bb83e125e4902a66d61cf24a658">lock_mode_compatible</a>(<span class="keyword">enum</span> <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013">lock_mode</a> mode1, <span class="keyword">enum</span> <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013">lock_mode</a> mode2);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">/** Calculates if lock mode 1 is stronger or equal to lock mode 2.</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">@param[in]      mode1   lock mode 1</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">@param[in]      mode2   lock mode 2</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">@return true iff mode1 stronger or equal to mode2 */</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="lock0priv_8h.html#a45a7b299a52356a1078b1ef78771e506">lock_mode_stronger_or_eq</a>(<span class="keyword">enum</span> <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013">lock_mode</a> mode1, <span class="keyword">enum</span> <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013">lock_mode</a> mode2);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">/** Gets the wait flag of a lock.</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment"> @return LOCK_WAIT if waiting, 0 if not */</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;UNIV_INLINE</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;ulint <a class="code" href="lock0priv_8h.html#ac39e45b1c0a23547fa21a02c765bcd29">lock_get_wait</a>(<span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *lock); <span class="comment">/*!&lt; in: lock */</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">/** Checks if a transaction has the specified table lock, or stronger. This</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">function should only be called by the thread that owns the transaction.</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">This function acquires trx-&gt;mutex which protects trx-&gt;lock.table_locks, but you</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">should understand that this only makes it easier to argue against races at the</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">level of access to the data structure, yet does not buy us any protection at</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">the higher level of making actual decisions based on the result of this call -</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">it may happen that another thread is performing lock_trx_table_locks_remove(),</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">and even though lock_table_has returned true to the caller, the lock is no</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">longer in possession of trx once the caller gets to evaluate if/else condition</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">based on the result.</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">Therefore it is up to caller to make sure that the context of the call to this</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">function and making any decisions based on the result is protected from any</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">concurrent modifications. This in turn makes the whole trx_mutex_enter/exit</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">a bit redundant, but it does not affect performance yet makes the reasoning</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">about data structure a bit easier and protects trx-&gt;lock.table_locks data</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">structure from corruption in case our high level reasoning about absence of</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">parallel modifications turns out wrong.</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">@param[in]      trx     transaction</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">@param[in]      table   table</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">@param[in]      mode    lock mode</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">@return lock or NULL */</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;UNIV_INLINE</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="lock0priv_8h.html#aab51f58f1d7c2158a0c2eca6014ff26d">lock_table_has</a>(<span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *trx, <span class="keyword">const</span> <a class="code" href="structdict__table__t.html">dict_table_t</a> *table,</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                    <span class="keyword">enum</span> <a class="code" href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013">lock_mode</a> <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">/** Handles writing the information about found deadlock to the log files</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">and caches it for future lock_latest_err_file() calls (for example used by</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">SHOW ENGINE INNODB STATUS)</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">@param[in] trxs_on_cycle  trxs causing deadlock, i-th waits for i+1-th</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">@param[in] victim_trx     the trx from trx_on_cycle which will be rolled back */</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="keywordtype">void</span> <a class="code" href="lock0priv_8h.html#a1f9b9cd959650891d83421c521909b88">lock_notify_about_deadlock</a>(<span class="keyword">const</span> <a class="code" href="namespaceut.html#aa7abb0ab07329e68a6ec29d191da1e58">ut::vector&lt;const trx_t *&gt;</a> &amp;trxs_on_cycle,</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                                <span class="keyword">const</span> <a class="code" href="structtrx__t.html">trx_t</a> *victim_trx);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="preprocessor">#include &quot;lock0priv.ic&quot;</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">/** Iterate over record locks matching &lt;space, page_no, heap_no&gt; */</span></div><div class="line"><a name="l01033"></a><span class="lineno"><a class="line" href="structLock__iter.html"> 1033</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structLock__iter.html">Lock_iter</a> {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="comment">/* First is the previous lock, and second is the current lock. */</span><span class="comment"></span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">  /** Gets the next record lock on a page.</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">  @param[in]    rec_id          The record ID</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">  @param[in]    lock            The current lock</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">  @return matching lock or nullptr if end of list */</span></div><div class="line"><a name="l01039"></a><span class="lineno"><a class="line" href="structLock__iter.html#ae4cc30d144818c126133a0d99ee4d5a1"> 1039</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="structLock__iter.html#ae4cc30d144818c126133a0d99ee4d5a1">advance</a>(<span class="keyword">const</span> <a class="code" href="structRecID.html">RecID</a> &amp;rec_id, <a class="code" href="structlock__t.html">lock_t</a> *lock) {</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="namespacelocksys.html#a2f6f08b62f3525ce41e225523a004f5b">locksys::owns_page_shard</a>(rec_id.<a class="code" href="structRecID.html#ae7b1b4de5bc3cdf42b758e4379007b00">get_page_id</a>()));</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(lock-&gt;<a class="code" href="structlock__t.html#a7651674780568aa384de60523c1d3d0d">is_record_lock</a>());</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">while</span> ((lock = static_cast&lt;lock_t *&gt;(lock-&gt;<a class="code" href="structlock__t.html#a91d43e91ee25a5473a395dd26cf0640b">hash</a>)) != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(lock-&gt;<a class="code" href="structlock__t.html#a7651674780568aa384de60523c1d3d0d">is_record_lock</a>());</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordflow">if</span> (rec_id.<a class="code" href="structRecID.html#aa5b48ad9e40e2270ee82ad1aebaa66f1">matches</a>(lock)) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keywordflow">return</span> (lock);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    }</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(lock == <span class="keyword">nullptr</span>);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">return</span> (<span class="keyword">nullptr</span>);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  }</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">  /** Gets the first explicit lock request on a record.</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">  @param[in]    list            Record hash</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">  @param[in]    rec_id          Record ID</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">  @return       first lock, nullptr if none exists */</span></div><div class="line"><a name="l01059"></a><span class="lineno"><a class="line" href="structLock__iter.html#a2515eef494f677084780d09eb83534f8"> 1059</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="structLock__iter.html#a2515eef494f677084780d09eb83534f8">first</a>(<a class="code" href="structhash__cell__t.html">hash_cell_t</a> *<a class="code" href="test__udf__registration_8cc.html#a96e3cff2f3e1d8eda47115215d03ff32">list</a>, <span class="keyword">const</span> <a class="code" href="structRecID.html">RecID</a> &amp;rec_id) {</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="namespacelocksys.html#a2f6f08b62f3525ce41e225523a004f5b">locksys::owns_page_shard</a>(rec_id.<a class="code" href="structRecID.html#ae7b1b4de5bc3cdf42b758e4379007b00">get_page_id</a>()));</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="keyword">auto</span> lock = <span class="keyword">static_cast&lt;</span><a class="code" href="structlock__t.html">lock_t</a> *<span class="keyword">&gt;</span>(list-&gt;<a class="code" href="structhash__cell__t.html#a4e97a7505b1d16d76853a590beea48b2">node</a>);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(lock == <span class="keyword">nullptr</span> || lock-&gt;<a class="code" href="structlock__t.html#a7651674780568aa384de60523c1d3d0d">is_record_lock</a>());</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">if</span> (lock != <span class="keyword">nullptr</span> &amp;&amp; !rec_id.<a class="code" href="structRecID.html#aa5b48ad9e40e2270ee82ad1aebaa66f1">matches</a>(lock)) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      lock = advance(rec_id, lock);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">return</span> (lock);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">  /** Iterate over all the locks on a specific row</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">  @param[in]    rec_id          Iterate over locks on this row</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">  @param[in]    f               Function to call for each entry</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">  @param[in]    hash_table      The hash table to iterate over</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">  @return lock where the callback returned false */</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div><div class="line"><a name="l01079"></a><span class="lineno"><a class="line" href="structLock__iter.html#ab365b6a414d6110deadd80f406825f33"> 1079</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlock__t.html">lock_t</a> *<a class="code" href="structLock__iter.html#ab365b6a414d6110deadd80f406825f33">for_each</a>(<span class="keyword">const</span> <a class="code" href="structRecID.html">RecID</a> &amp;rec_id, F &amp;&amp;f,</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                                <a class="code" href="structhash__table__t.html">hash_table_t</a> *hash_table = <a class="code" href="lock0lock_8h.html#ac5399aad1a992cb27e897fc806570ba0">lock_sys</a>-&gt;<a class="code" href="structlock__sys__t.html#a110f80e7630f795cb1ab24d3b3ddda29">rec_hash</a>) {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="namespacelocksys.html#a2f6f08b62f3525ce41e225523a004f5b">locksys::owns_page_shard</a>(rec_id.<a class="code" href="structRecID.html#ae7b1b4de5bc3cdf42b758e4379007b00">get_page_id</a>()));</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keyword">auto</span> <a class="code" href="test__udf__registration_8cc.html#a96e3cff2f3e1d8eda47115215d03ff32">list</a> = <a class="code" href="innodb__utility_8h.html#a1224310bbda440a206a480cbeeae7ca3">hash_get_nth_cell</a>(hash_table,</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                                  <a class="code" href="innodb__utility_8h.html#a322ea71f3d3155392d56dc526c957375">hash_calc_hash</a>(rec_id.<a class="code" href="structRecID.html#a93ae69bc876d2b3f739b59fadfd0b804">m_fold</a>, hash_table));</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> lock = first(<a class="code" href="test__udf__registration_8cc.html#a96e3cff2f3e1d8eda47115215d03ff32">list</a>, rec_id); lock != <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;         lock = advance(rec_id, lock)) {</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(lock-&gt;<a class="code" href="structlock__t.html#a7651674780568aa384de60523c1d3d0d">is_record_lock</a>());</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="keywordflow">if</span> (!std::forward&lt;F&gt;(f)(lock)) {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordflow">return</span> (lock);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      }</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    }</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordflow">return</span> (<span class="keyword">nullptr</span>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  }</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;};</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacelocksys.html">locksys</a> {</div><div class="line"><a name="l01100"></a><span class="lineno"><a class="line" href="classlocksys_1_1Unsafe__global__latch__manipulator.html"> 1100</a></span>&#160;<span class="keyword">class </span><a class="code" href="classlocksys_1_1Unsafe__global__latch__manipulator.html">Unsafe_global_latch_manipulator</a> {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01102"></a><span class="lineno"><a class="line" href="classlocksys_1_1Unsafe__global__latch__manipulator.html#a5471fb50d47d26310f8b02dd88f4026b"> 1102</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classlocksys_1_1Unsafe__global__latch__manipulator.html#a5471fb50d47d26310f8b02dd88f4026b">exclusive_unlatch</a>() { <a class="code" href="lock0lock_8h.html#ac5399aad1a992cb27e897fc806570ba0">lock_sys</a>-&gt;<a class="code" href="structlock__sys__t.html#a0a912ac77e422250e7ea74e78a314af6">latches</a>.<a class="code" href="classlocksys_1_1Latches.html#a8cdc487610b269186e5ab794fde6b86b">global_latch</a>.<a class="code" href="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock.html#af41378acec4477b5be59edaa700a1cec">x_unlock</a>(); }</div><div class="line"><a name="l01103"></a><span class="lineno"><a class="line" href="classlocksys_1_1Unsafe__global__latch__manipulator.html#aaccd7e84b404663f5c94b14f119b0d52"> 1103</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classlocksys_1_1Unsafe__global__latch__manipulator.html#aaccd7e84b404663f5c94b14f119b0d52">exclusive_latch</a>() { <a class="code" href="lock0lock_8h.html#ac5399aad1a992cb27e897fc806570ba0">lock_sys</a>-&gt;<a class="code" href="structlock__sys__t.html#a0a912ac77e422250e7ea74e78a314af6">latches</a>.<a class="code" href="classlocksys_1_1Latches.html#a8cdc487610b269186e5ab794fde6b86b">global_latch</a>.<a class="code" href="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock.html#a63448625fd2b1f086fe4a72470cf7cd3">x_lock</a>(); }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;};</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;}  <span class="comment">// namespace locksys</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* lock0priv_h */</span><span class="preprocessor"></span></div><div class="ttc" id="my__inttypes_8h_html_a22152088aba12c47e916b7f0ffee0f51"><div class="ttname"><a href="my__inttypes_8h.html#a22152088aba12c47e916b7f0ffee0f51">ulonglong</a></div><div class="ttdeci">unsigned long long int ulonglong</div><div class="ttdef"><b>Definition:</b> my_inttypes.h:55</div></div>
<div class="ttc" id="structlock__rec__t_html_a5e443a075d6e67fdfa271e8922b6c2e8"><div class="ttname"><a href="structlock__rec__t.html#a5e443a075d6e67fdfa271e8922b6c2e8">lock_rec_t::n_bits</a></div><div class="ttdeci">uint32_t n_bits</div><div class="ttdoc">number of bits in the lock bitmap; NOTE: the lock bitmap is placed immediately after the lock struct ...</div><div class="ttdef"><b>Definition:</b> lock0priv.h:87</div></div>
<div class="ttc" id="structRecID_html_af061183e2f5aebbf66bf030ccbda5ba9"><div class="ttname"><a href="structRecID.html#af061183e2f5aebbf66bf030ccbda5ba9">RecID::RecID</a></div><div class="ttdeci">RecID(const lock_t *lock, ulint heap_no)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:599</div></div>
<div class="ttc" id="classRecLock_html_a15f65ec0eb059de8f610608f8f2ce129"><div class="ttname"><a href="classRecLock.html#a15f65ec0eb059de8f610608f8f2ce129">RecLock::m_rec_id</a></div><div class="ttdeci">RecID m_rec_id</div><div class="ttdoc">The record lock tuple {space, page_no, heap_no}. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:866</div></div>
<div class="ttc" id="lock0priv_8h_html_a4623ba68acd8e00ad5d81a0121f8e891"><div class="ttname"><a href="lock0priv_8h.html#a4623ba68acd8e00ad5d81a0121f8e891">MAX_STACK_SIZE</a></div><div class="ttdeci">static const ulint MAX_STACK_SIZE</div><div class="ttdoc">Maximum depth of the DFS stack. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:580</div></div>
<div class="ttc" id="structlock__t_html_a07531cd6476b35f663185af78d7b554a"><div class="ttname"><a href="structlock__t.html#a07531cd6476b35f663185af78d7b554a">lock_t::type_mode_string</a></div><div class="ttdeci">std::string type_mode_string() const</div><div class="ttdoc">Convert the member &amp;#39;type_mode&amp;#39; into a human readable string. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:255</div></div>
<div class="ttc" id="structRecID_html_a16ca3f38bd21bcc63346e4b08674305b"><div class="ttname"><a href="structRecID.html#a16ca3f38bd21bcc63346e4b08674305b">RecID::fold</a></div><div class="ttdeci">ulint fold() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:622</div></div>
<div class="ttc" id="lock0priv_8h_html_ad6facaed4aa238ad53ce0f202bcadc54"><div class="ttname"><a href="lock0priv_8h.html#ad6facaed4aa238ad53ce0f202bcadc54">lock_print_waits</a></div><div class="ttdeci">ibool lock_print_waits</div></div>
<div class="ttc" id="classRecLock_html_a5e285214ed0893dcdae8c65a313003ad"><div class="ttname"><a href="classRecLock.html#a5e285214ed0893dcdae8c65a313003ad">RecLock::is_predicate_lock</a></div><div class="ttdeci">static bool is_predicate_lock(ulint mode)</div><div class="ttdef"><b>Definition:</b> lock0priv.h:840</div></div>
<div class="ttc" id="structRecID_html"><div class="ttname"><a href="structRecID.html">RecID</a></div><div class="ttdoc">Record lock ID. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:595</div></div>
<div class="ttc" id="lock0priv_8h_html_a28ad945a2410b29af7752e94ffa30ae6"><div class="ttname"><a href="lock0priv_8h.html#a28ad945a2410b29af7752e94ffa30ae6">lock_reset_wait_and_release_thread_if_suspended</a></div><div class="ttdeci">void lock_reset_wait_and_release_thread_if_suspended(lock_t *lock)</div><div class="ttdoc">This function is a wrapper around several functions which need to be called in particular order to wa...</div><div class="ttdef"><b>Definition:</b> lock0wait.cc:428</div></div>
<div class="ttc" id="lock0priv_8h_html_ac39e45b1c0a23547fa21a02c765bcd29"><div class="ttname"><a href="lock0priv_8h.html#ac39e45b1c0a23547fa21a02c765bcd29">lock_get_wait</a></div><div class="ttdeci">UNIV_INLINE ulint lock_get_wait(const lock_t *lock)</div><div class="ttdoc">Gets the wait flag of a lock. </div></div>
<div class="ttc" id="classRecLock_html_a13b368d05d8712f18719aebdf2aff9fc"><div class="ttname"><a href="classRecLock.html#a13b368d05d8712f18719aebdf2aff9fc">RecLock::RecLock</a></div><div class="ttdeci">RecLock(dict_index_t *index, const buf_block_t *block, ulint heap_no, ulint mode)</div><div class="ttdef"><b>Definition:</b> lock0priv.h:703</div></div>
<div class="ttc" id="classRecLock_html_ad977aa957a3c0be118e9e56bc0a783d3"><div class="ttname"><a href="classRecLock.html#ad977aa957a3c0be118e9e56bc0a783d3">RecLock::m_trx</a></div><div class="ttdeci">trx_t * m_trx</div><div class="ttdoc">Transaction requesting the record lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:850</div></div>
<div class="ttc" id="classRecLock_html_a7ae916345da4c9fa6563110903835a10"><div class="ttname"><a href="classRecLock.html#a7ae916345da4c9fa6563110903835a10">RecLock::lock_size</a></div><div class="ttdeci">static size_t lock_size(const page_t *page)</div><div class="ttdoc">Calculate the record lock physical size required, non-predicate lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:829</div></div>
<div class="ttc" id="namespaceut_html_aa7abb0ab07329e68a6ec29d191da1e58"><div class="ttname"><a href="namespaceut.html#aa7abb0ab07329e68a6ec29d191da1e58">ut::vector</a></div><div class="ttdeci">std::vector&lt; T, ut_allocator&lt; T &gt; &gt; vector</div><div class="ttdoc">Specialization of vector which uses ut_allocator. </div><div class="ttdef"><b>Definition:</b> ut0new.h:1306</div></div>
<div class="ttc" id="page0types_8h_html_a5d783fe226bc984a8ec24ff5abf8c966"><div class="ttname"><a href="page0types_8h.html#a5d783fe226bc984a8ec24ff5abf8c966">PAGE_HEAP_NO_SUPREMUM</a></div><div class="ttdeci">constexpr ulint PAGE_HEAP_NO_SUPREMUM</div><div class="ttdoc">Page supremum. </div><div class="ttdef"><b>Definition:</b> page0types.h:132</div></div>
<div class="ttc" id="structlock__rec__t_html_a70106ad997616c2fcd677498c1a9ed71"><div class="ttname"><a href="structlock__rec__t.html#a70106ad997616c2fcd677498c1a9ed71">lock_rec_t::page_id</a></div><div class="ttdeci">page_id_t page_id</div><div class="ttdoc">The id of the page on which records referenced by this lock&amp;#39;s bitmap are located. ...</div><div class="ttdef"><b>Definition:</b> lock0priv.h:84</div></div>
<div class="ttc" id="lock0lock_8h_html_a7fe3f32b4e6bb44b08818eea5638e94b"><div class="ttname"><a href="lock0lock_8h.html#a7fe3f32b4e6bb44b08818eea5638e94b">LOCK_PRDT_PAGE</a></div><div class="ttdeci">#define LOCK_PRDT_PAGE</div><div class="ttdoc">Page lock. </div><div class="ttdef"><b>Definition:</b> lock0lock.h:946</div></div>
<div class="ttc" id="lock0lock_8h_html_aea25ac33bd6692ef77c95c6a7da765a8"><div class="ttname"><a href="lock0lock_8h.html#aea25ac33bd6692ef77c95c6a7da765a8">LOCK_MODE_MASK</a></div><div class="ttdeci">#define LOCK_MODE_MASK</div><div class="ttdoc">Lock modes and types. </div><div class="ttdef"><b>Definition:</b> lock0lock.h:869</div></div>
<div class="ttc" id="structtrx__t_html"><div class="ttname"><a href="structtrx__t.html">trx_t</a></div><div class="ttdef"><b>Definition:</b> trx0trx.h:833</div></div>
<div class="ttc" id="structlock__t_html"><div class="ttname"><a href="structlock__t.html">lock_t</a></div><div class="ttdoc">Lock struct; protected by lock_sys latches. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:131</div></div>
<div class="ttc" id="structlock__t_html_aad4031cec84ea42e3fc05253d65ad956"><div class="ttname"><a href="structlock__t.html#aad4031cec84ea42e3fc05253d65ad956">lock_t::type_mode</a></div><div class="ttdeci">uint32_t type_mode</div><div class="ttdoc">The lock type and mode bit flags. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:165</div></div>
<div class="ttc" id="structbuf__block__t_html"><div class="ttname"><a href="structbuf__block__t.html">buf_block_t</a></div><div class="ttdoc">The buffer control block structure. </div><div class="ttdef"><b>Definition:</b> buf0buf.h:1324</div></div>
<div class="ttc" id="classpage__id__t_html"><div class="ttname"><a href="classpage__id__t.html">page_id_t</a></div><div class="ttdoc">Page identifier. </div><div class="ttdef"><b>Definition:</b> buf0types.h:158</div></div>
<div class="ttc" id="classRecLock_html_ab8ec3eb2d231c05bb31a6637b5fc0a82"><div class="ttname"><a href="classRecLock.html#ab8ec3eb2d231c05bb31a6637b5fc0a82">RecLock::lock_size</a></div><div class="ttdeci">static size_t lock_size(ulint mode)</div><div class="ttdoc">Calculate the record lock physical size required for a predicate lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:794</div></div>
<div class="ttc" id="lock0priv_8h_html_a592267d6eb97966dc430aae3827f40c6"><div class="ttname"><a href="lock0priv_8h.html#a592267d6eb97966dc430aae3827f40c6">LOCK_PAGE_BITMAP_MARGIN</a></div><div class="ttdeci">static const ulint LOCK_PAGE_BITMAP_MARGIN</div><div class="ttdef"><b>Definition:</b> lock0priv.h:303</div></div>
<div class="ttc" id="structlock__t_html_a72319e7f04eb4057d5b15653ad9a6e24"><div class="ttname"><a href="structlock__t.html#a72319e7f04eb4057d5b15653ad9a6e24">lock_t::m_psi_internal_thread_id</a></div><div class="ttdeci">ulonglong m_psi_internal_thread_id</div><div class="ttdoc">Performance schema thread that created the lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:156</div></div>
<div class="ttc" id="lock0priv_8h_html_aca77337242c4af78b916e503a81b57e2"><div class="ttname"><a href="lock0priv_8h.html#aca77337242c4af78b916e503a81b57e2">lock_cancel_waiting_and_release</a></div><div class="ttdeci">void lock_cancel_waiting_and_release(lock_t *lock)</div><div class="ttdoc">Cancels a waiting lock request and releases possible other transactions waiting behind it...</div><div class="ttdef"><b>Definition:</b> lock0lock.cc:6028</div></div>
<div class="ttc" id="lock0priv_8h_html_a1c37e6a5830ee34d6670d87ccc14128f"><div class="ttname"><a href="lock0priv_8h.html#a1c37e6a5830ee34d6670d87ccc14128f">lock_strength_matrix</a></div><div class="ttdeci">static const byte lock_strength_matrix[5][5]</div><div class="ttdef"><b>Definition:</b> lock0priv.h:571</div></div>
<div class="ttc" id="classlocksys_1_1Unsafe__global__latch__manipulator_html_a5471fb50d47d26310f8b02dd88f4026b"><div class="ttname"><a href="classlocksys_1_1Unsafe__global__latch__manipulator.html#a5471fb50d47d26310f8b02dd88f4026b">locksys::Unsafe_global_latch_manipulator::exclusive_unlatch</a></div><div class="ttdeci">static void exclusive_unlatch()</div><div class="ttdef"><b>Definition:</b> lock0priv.h:1102</div></div>
<div class="ttc" id="structlock__t_html_a2add4e854ffc93b0f62534962ea7ec03"><div class="ttname"><a href="structlock__t.html#a2add4e854ffc93b0f62534962ea7ec03">lock_t::rec_lock</a></div><div class="ttdeci">lock_rec_t rec_lock</div><div class="ttdoc">Record lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:150</div></div>
<div class="ttc" id="lock0priv_8h_html_ad0e694a3a47a498c55bd09c5127b162a"><div class="ttname"><a href="lock0priv_8h.html#ad0e694a3a47a498c55bd09c5127b162a">lock_rec_get_next_on_page</a></div><div class="ttdeci">UNIV_INLINE lock_t * lock_rec_get_next_on_page(lock_t *lock)</div><div class="ttdoc">Gets the first or next record lock on a page. </div></div>
<div class="ttc" id="lock0priv_8h_html_adc4d50e24df554a860fdc92e730199e0"><div class="ttname"><a href="lock0priv_8h.html#adc4d50e24df554a860fdc92e730199e0">lock_mode_is_next_key_lock</a></div><div class="ttdeci">UNIV_INLINE bool lock_mode_is_next_key_lock(ulint mode)</div><div class="ttdoc">Checks if the mode is LOCK_S or LOCK_X, which means the lock is a Next Key Lock, a.k.a. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:114</div></div>
<div class="ttc" id="namespacestdx_1_1io_html_a2c9b563b772005f7960909d0d12186f5"><div class="ttname"><a href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">stdx::io::mode</a></div><div class="ttdeci">mode</div><div class="ttdef"><b>Definition:</b> file_handle.h:59</div></div>
<div class="ttc" id="structRecID_html_a93ae69bc876d2b3f739b59fadfd0b804"><div class="ttname"><a href="structRecID.html#a93ae69bc876d2b3f739b59fadfd0b804">RecID::m_fold</a></div><div class="ttdeci">ulint m_fold</div><div class="ttdoc">Hashed key value. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:643</div></div>
<div class="ttc" id="structlock__table__t_html_a95d90c707ee89833e0f76a3d94176599"><div class="ttname"><a href="structlock__table__t.html#a95d90c707ee89833e0f76a3d94176599">lock_table_t::locks</a></div><div class="ttdeci">locks</div><div class="ttdoc">list of locks on the same table </div><div class="ttdef"><b>Definition:</b> lock0priv.h:55</div></div>
<div class="ttc" id="classlocksys_1_1Unsafe__global__latch__manipulator_html_aaccd7e84b404663f5c94b14f119b0d52"><div class="ttname"><a href="classlocksys_1_1Unsafe__global__latch__manipulator.html#aaccd7e84b404663f5c94b14f119b0d52">locksys::Unsafe_global_latch_manipulator::exclusive_latch</a></div><div class="ttdeci">static void exclusive_latch()</div><div class="ttdef"><b>Definition:</b> lock0priv.h:1103</div></div>
<div class="ttc" id="structRecID_html_a3bc9ed3a564ef26d85882d806865ab15"><div class="ttname"><a href="structRecID.html#a3bc9ed3a564ef26d85882d806865ab15">RecID::is_supremum</a></div><div class="ttdeci">bool is_supremum() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:625</div></div>
<div class="ttc" id="structdict__table__t_html"><div class="ttname"><a href="structdict__table__t.html">dict_table_t</a></div><div class="ttdoc">Data structure for a database table. </div><div class="ttdef"><b>Definition:</b> dict0mem.h:1532</div></div>
<div class="ttc" id="page0page_8h_html_a57eb1546633fef3f6135cffa4a77cf87"><div class="ttname"><a href="page0page_8h.html#a57eb1546633fef3f6135cffa4a77cf87">page_dir_get_n_heap</a></div><div class="ttdeci">UNIV_INLINE ulint page_dir_get_n_heap(const page_t *page)</div><div class="ttdoc">Gets the number of records in the heap. </div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> varlen_sort.h:182</div></div>
<div class="ttc" id="lock0priv_8h_html_aaa98e1bd917f95280993475788ea6c5ba12a47b5e4d2d01853958ecbc0513bb31"><div class="ttname"><a href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5ba12a47b5e4d2d01853958ecbc0513bb31">LOCK_REC_FAIL</a></div><div class="ttdoc">Failed to acquire a lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:586</div></div>
<div class="ttc" id="structlock__t_html_a152571ef548a0c4cc2bd927e546f2ec8"><div class="ttname"><a href="structlock__t.html#a152571ef548a0c4cc2bd927e546f2ec8">lock_t::mode</a></div><div class="ttdeci">lock_mode mode() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:220</div></div>
<div class="ttc" id="test__udf__registration_8cc_html_a96e3cff2f3e1d8eda47115215d03ff32"><div class="ttname"><a href="test__udf__registration_8cc.html#a96e3cff2f3e1d8eda47115215d03ff32">list</a></div><div class="ttdeci">class udf_list * list</div></div>
<div class="ttc" id="structRecID_html_a62a97e4030d78e4cc2cfcdf1cb100a20"><div class="ttname"><a href="structRecID.html#a62a97e4030d78e4cc2cfcdf1cb100a20">RecID::RecID</a></div><div class="ttdeci">RecID(const buf_block_t *block, ulint heap_no)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:617</div></div>
<div class="ttc" id="lock0priv_8h_html_a81f2ac5cbb634ee6ef9663ba8bf4bbab"><div class="ttname"><a href="lock0priv_8h.html#a81f2ac5cbb634ee6ef9663ba8bf4bbab">lock_rec_get_next</a></div><div class="ttdeci">UNIV_INLINE lock_t * lock_rec_get_next(ulint heap_no, lock_t *lock)</div><div class="ttdoc">Gets the next explicit lock request on a record. </div></div>
<div class="ttc" id="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock_html_a63448625fd2b1f086fe4a72470cf7cd3"><div class="ttname"><a href="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock.html#a63448625fd2b1f086fe4a72470cf7cd3">locksys::Latches::Unique_sharded_rw_lock::x_lock</a></div><div class="ttdeci">void x_lock()</div><div class="ttdef"><b>Definition:</b> lock0latches.h:129</div></div>
<div class="ttc" id="structlock__sys__t_html_a110f80e7630f795cb1ab24d3b3ddda29"><div class="ttname"><a href="structlock__sys__t.html#a110f80e7630f795cb1ab24d3b3ddda29">lock_sys_t::rec_hash</a></div><div class="ttdeci">hash_table_t * rec_hash</div><div class="ttdoc">The hash table of the record (LOCK_REC) locks, except for predicate (LOCK_PREDICATE) and predicate pa...</div><div class="ttdef"><b>Definition:</b> lock0lock.h:975</div></div>
<div class="ttc" id="structlock__t_html_a4e3a80f6869f7400f9b998faa3b4e90a"><div class="ttname"><a href="structlock__t.html#a4e3a80f6869f7400f9b998faa3b4e90a">lock_t::is_gap</a></div><div class="ttdeci">bool is_gap() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:195</div></div>
<div class="ttc" id="lock0lock_8h_html_a7fec2aa31cc581d490329f5be3e11088"><div class="ttname"><a href="lock0lock_8h.html#a7fec2aa31cc581d490329f5be3e11088">lock_hash_get</a></div><div class="ttdeci">UNIV_INLINE hash_table_t * lock_hash_get(ulint mode)</div><div class="ttdoc">Get the lock hash table. </div></div>
<div class="ttc" id="structLock__iter_html"><div class="ttname"><a href="structLock__iter.html">Lock_iter</a></div><div class="ttdoc">Iterate over record locks matching &lt;space, page_no, heap_no&gt; </div><div class="ttdef"><b>Definition:</b> lock0priv.h:1033</div></div>
<div class="ttc" id="structRecID_html_a819cef67dd372607426c89e7b9e55268"><div class="ttname"><a href="structRecID.html#a819cef67dd372607426c89e7b9e55268">RecID::m_heap_no</a></div><div class="ttdeci">uint32_t m_heap_no</div><div class="ttdoc">Heap number within the page. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:639</div></div>
<div class="ttc" id="classRecLock_html_a080573c20a0b8f5a7405fd1fa1bf226d"><div class="ttname"><a href="classRecLock.html#a080573c20a0b8f5a7405fd1fa1bf226d">RecLock::m_mode</a></div><div class="ttdeci">ulint m_mode</div><div class="ttdoc">Lock mode requested. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:854</div></div>
<div class="ttc" id="structlock__t_html_a91d43e91ee25a5473a395dd26cf0640b"><div class="ttname"><a href="structlock__t.html#a91d43e91ee25a5473a395dd26cf0640b">lock_t::hash</a></div><div class="ttdeci">lock_t * hash</div><div class="ttdoc">Hash chain node for a record lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:143</div></div>
<div class="ttc" id="lock0lock_8h_html_a95f8dd3d016d01aaa314160f0db74e75"><div class="ttname"><a href="lock0lock_8h.html#a95f8dd3d016d01aaa314160f0db74e75">LOCK_ORDINARY</a></div><div class="ttdeci">#define LOCK_ORDINARY</div><div class="ttdoc">this flag denotes an ordinary \ next-key lock in contrast to LOCK_GAP \ or LOCK_REC_NOT_GAP ...</div><div class="ttdef"><b>Definition:</b> lock0lock.h:893</div></div>
<div class="ttc" id="lock0priv_8h_html_a07853bb83e125e4902a66d61cf24a658"><div class="ttname"><a href="lock0priv_8h.html#a07853bb83e125e4902a66d61cf24a658">lock_mode_compatible</a></div><div class="ttdeci">UNIV_INLINE ulint lock_mode_compatible(enum lock_mode mode1, enum lock_mode mode2)</div><div class="ttdoc">Calculates if lock mode 1 is compatible with lock mode 2. </div></div>
<div class="ttc" id="audit__api__message__emit_8cc_html_a9ab62ce08f07c43d34e2d46dcc0f5f68"><div class="ttname"><a href="audit__api__message__emit_8cc.html#a9ab62ce08f07c43d34e2d46dcc0f5f68">init</a></div><div class="ttdeci">static mysql_service_status_t init()</div><div class="ttdoc">Component initialization. </div><div class="ttdef"><b>Definition:</b> audit_api_message_emit.cc:570</div></div>
<div class="ttc" id="structlock__t_html_aadc39cc7e63a1dcbbf11c4294005aae2"><div class="ttname"><a href="structlock__t.html#aadc39cc7e63a1dcbbf11c4294005aae2">lock_t::trx</a></div><div class="ttdeci">trx_t * trx</div><div class="ttdoc">transaction owning the lock </div><div class="ttdef"><b>Definition:</b> lock0priv.h:133</div></div>
<div class="ttc" id="classRecLock_html_ae38dbfed90de96e512902640a76a2942"><div class="ttname"><a href="classRecLock.html#ae38dbfed90de96e512902640a76a2942">RecLock::m_thr</a></div><div class="ttdeci">que_thr_t * m_thr</div><div class="ttdoc">The query thread of the transaction. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:846</div></div>
<div class="ttc" id="namespacelocksys_html_a2f6f08b62f3525ce41e225523a004f5b"><div class="ttname"><a href="namespacelocksys.html#a2f6f08b62f3525ce41e225523a004f5b">locksys::owns_page_shard</a></div><div class="ttdeci">bool owns_page_shard(const page_id_t &amp;page_id)</div><div class="ttdoc">Tests if given page shard can be safely accessed by the current thread. </div><div class="ttdef"><b>Definition:</b> lock0lock.cc:166</div></div>
<div class="ttc" id="lock0types_8h_html_a739513c415f3f3a100be2c1dbb59eb33"><div class="ttname"><a href="lock0types_8h.html#a739513c415f3f3a100be2c1dbb59eb33">lock_mode_string</a></div><div class="ttdeci">const char * lock_mode_string(enum lock_mode mode)</div><div class="ttdoc">Convert the given enum value into string. </div><div class="ttdef"><b>Definition:</b> lock0types.h:66</div></div>
<div class="ttc" id="lock0priv_8h_html_a934e63f43c0caa00d7e0ba13fd9525cc"><div class="ttname"><a href="lock0priv_8h.html#a934e63f43c0caa00d7e0ba13fd9525cc">lock_rec_get_nth_bit</a></div><div class="ttdeci">UNIV_INLINE bool lock_rec_get_nth_bit(const lock_t *lock, ulint i)</div><div class="ttdoc">Gets the nth bit of a record lock. </div></div>
<div class="ttc" id="structdict__table__t_html_ad1271c5134aeb93444303e935dde5c25"><div class="ttname"><a href="structdict__table__t.html#ad1271c5134aeb93444303e935dde5c25">dict_table_t::name</a></div><div class="ttdeci">table_name_t name</div><div class="ttdoc">Table name. </div><div class="ttdef"><b>Definition:</b> dict0mem.h:1586</div></div>
<div class="ttc" id="types_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> types.h:46</div></div>
<div class="ttc" id="lock0priv_8h_html_a6c0d0d9c1d6281cbe1a248f29d9e6dd7"><div class="ttname"><a href="lock0priv_8h.html#a6c0d0d9c1d6281cbe1a248f29d9e6dd7">lock_rec_get_next_on_page_const</a></div><div class="ttdeci">UNIV_INLINE const lock_t * lock_rec_get_next_on_page_const(const lock_t *lock)</div><div class="ttdoc">Gets the first or next record lock on a page. </div></div>
<div class="ttc" id="structlock__t_html_ad4ced5d01fac5bfcb5ba61ae610a76a2"><div class="ttname"><a href="structlock__t.html#ad4ced5d01fac5bfcb5ba61ae610a76a2">lock_t::is_next_key_lock</a></div><div class="ttdeci">bool is_next_key_lock() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:201</div></div>
<div class="ttc" id="lock0priv_8h_html_a3bb79a43f5b92cea073f2cde49949308"><div class="ttname"><a href="lock0priv_8h.html#a3bb79a43f5b92cea073f2cde49949308">lock_rec_get_n_bits</a></div><div class="ttdeci">UNIV_INLINE ulint lock_rec_get_n_bits(const lock_t *lock)</div><div class="ttdoc">Gets the number of bits in a record lock bitmap. </div></div>
<div class="ttc" id="structlock__t_html_a037485c241d93247f161718d2039031b"><div class="ttname"><a href="structlock__t.html#a037485c241d93247f161718d2039031b">lock_t::index</a></div><div class="ttdeci">dict_index_t * index</div><div class="ttdoc">Index for a record lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:139</div></div>
<div class="ttc" id="lock0lock_8h_html_ac5399aad1a992cb27e897fc806570ba0"><div class="ttname"><a href="lock0lock_8h.html#ac5399aad1a992cb27e897fc806570ba0">lock_sys</a></div><div class="ttdeci">lock_sys_t * lock_sys</div><div class="ttdoc">The lock system. </div><div class="ttdef"><b>Definition:</b> lock0lock.cc:191</div></div>
<div class="ttc" id="structhash__table__t_html"><div class="ttname"><a href="structhash__table__t.html">hash_table_t</a></div><div class="ttdef"><b>Definition:</b> hash0hash.h:405</div></div>
<div class="ttc" id="lock0types_8h_html_acff05fa7dd69832a04f93b92db1e0013aa7ba6be447ffbfa3ac8e35268f622de6"><div class="ttname"><a href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013aa7ba6be447ffbfa3ac8e35268f622de6">LOCK_X</a></div><div class="ttdef"><b>Definition:</b> lock0types.h:55</div></div>
<div class="ttc" id="structlock__table__t_html_a39eaa0522606a96e01548edd7092b6fc"><div class="ttname"><a href="structlock__table__t.html#a39eaa0522606a96e01548edd7092b6fc">lock_table_t::table</a></div><div class="ttdeci">dict_table_t * table</div><div class="ttdoc">database table in dictionary cache </div><div class="ttdef"><b>Definition:</b> lock0priv.h:52</div></div>
<div class="ttc" id="structRecID_html_ae7b1b4de5bc3cdf42b758e4379007b00"><div class="ttname"><a href="structRecID.html#ae7b1b4de5bc3cdf42b758e4379007b00">RecID::get_page_id</a></div><div class="ttdeci">const page_id_t &amp; get_page_id() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:632</div></div>
<div class="ttc" id="lock0priv_8h_html_a34549675db50fa2140bd18244c046f8d"><div class="ttname"><a href="lock0priv_8h.html#a34549675db50fa2140bd18244c046f8d">lock_clust_rec_some_has_impl</a></div><div class="ttdeci">UNIV_INLINE trx_id_t lock_clust_rec_some_has_impl(const rec_t *rec, const dict_index_t *index, const ulint *offsets)</div><div class="ttdoc">Checks if some transaction has an implicit x-lock on a record in a clustered index. </div></div>
<div class="ttc" id="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock_html_af41378acec4477b5be59edaa700a1cec"><div class="ttname"><a href="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock.html#af41378acec4477b5be59edaa700a1cec">locksys::Latches::Unique_sharded_rw_lock::x_unlock</a></div><div class="ttdeci">void x_unlock()</div><div class="ttdef"><b>Definition:</b> lock0latches.h:130</div></div>
<div class="ttc" id="ctype-mb_8cc_html_adf406aa6822ceac22d62ef63cc2879c0"><div class="ttname"><a href="ctype-mb_8cc.html#adf406aa6822ceac22d62ef63cc2879c0">page</a></div><div class="ttdeci">int page</div><div class="ttdef"><b>Definition:</b> ctype-mb.cc:1234</div></div>
<div class="ttc" id="mysql_8cc_html_adfa69ae672499b1037123a1f17c5552b"><div class="ttname"><a href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a></div><div class="ttdeci">char * index(const char *, int c)</div><div class="ttdef"><b>Definition:</b> mysql.cc:2928</div></div>
<div class="ttc" id="lock0priv_8h_html_aaa98e1bd917f95280993475788ea6c5b"><div class="ttname"><a href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5b">lock_rec_req_status</a></div><div class="ttdeci">lock_rec_req_status</div><div class="ttdoc">Record locking request status. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:584</div></div>
<div class="ttc" id="dict0types_8h_html"><div class="ttname"><a href="dict0types_8h.html">dict0types.h</a></div><div class="ttdoc">Data dictionary global types. </div></div>
<div class="ttc" id="classRecLock_html_a770d6f1e90863d37d5d79a00076be4d7"><div class="ttname"><a href="classRecLock.html#a770d6f1e90863d37d5d79a00076be4d7">RecLock::RecLock</a></div><div class="ttdeci">RecLock(que_thr_t *thr, dict_index_t *index, const buf_block_t *block, ulint heap_no, ulint mode, lock_prdt_t *prdt=nullptr)</div><div class="ttdef"><b>Definition:</b> lock0priv.h:675</div></div>
<div class="ttc" id="rem0types_8h_html_a92caeffe2dc2fbe825a54aef9a163435"><div class="ttname"><a href="rem0types_8h.html#a92caeffe2dc2fbe825a54aef9a163435">rec_t</a></div><div class="ttdeci">byte rec_t</div><div class="ttdef"><b>Definition:</b> rem0types.h:39</div></div>
<div class="ttc" id="lexyy_8cc_html_ab5eb23180f7cc12b7d6c04a8ec067fdd"><div class="ttname"><a href="lexyy_8cc.html#ab5eb23180f7cc12b7d6c04a8ec067fdd">UINT32_MAX</a></div><div class="ttdeci">#define UINT32_MAX</div><div class="ttdef"><b>Definition:</b> lexyy.cc:86</div></div>
<div class="ttc" id="structhash__cell__t_html"><div class="ttname"><a href="structhash__cell__t.html">hash_cell_t</a></div><div class="ttdef"><b>Definition:</b> hash0hash.h:400</div></div>
<div class="ttc" id="structlock__rec__t_html_a2329cbb514cd7eaa7ed432d6d6f522f1"><div class="ttname"><a href="structlock__rec__t.html#a2329cbb514cd7eaa7ed432d6d6f522f1">lock_rec_t::print</a></div><div class="ttdeci">std::ostream &amp; print(std::ostream &amp;out) const</div><div class="ttdoc">Print the record lock into the given output stream. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:98</div></div>
<div class="ttc" id="structlock__table__t_html_a31babcbe7548a099af93a10fafc98313"><div class="ttname"><a href="structlock__table__t.html#a31babcbe7548a099af93a10fafc98313">lock_table_t::print</a></div><div class="ttdeci">std::ostream &amp; print(std::ostream &amp;out) const</div><div class="ttdoc">Print the table lock into the given output stream. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:66</div></div>
<div class="ttc" id="namespacelocksys_html"><div class="ttname"><a href="namespacelocksys.html">locksys</a></div><div class="ttdef"><b>Definition:</b> lock0guards.h:33</div></div>
<div class="ttc" id="lock0priv_8h_html_a340a22e43fd6b50411f084c5d4e9972d"><div class="ttname"><a href="lock0priv_8h.html#a340a22e43fd6b50411f084c5d4e9972d">lock_rec_get_first</a></div><div class="ttdeci">UNIV_INLINE lock_t * lock_rec_get_first(hash_table_t *hash, const buf_block_t *block, ulint heap_no)</div><div class="ttdoc">Gets the first explicit lock request on a record. </div></div>
<div class="ttc" id="db0err_8h_html_a6fdd08971b32ee513b20967238f1654d"><div class="ttname"><a href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a></div><div class="ttdeci">dberr_t</div><div class="ttdef"><b>Definition:</b> db0err.h:38</div></div>
<div class="ttc" id="structlock__t_html_a72f274a65709f2081c6ba106aaa17698"><div class="ttname"><a href="structlock__t.html#a72f274a65709f2081c6ba106aaa17698">lock_t::is_insert_intention</a></div><div class="ttdeci">bool is_insert_intention() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:207</div></div>
<div class="ttc" id="namespacedblwr_1_1v1_html_a2213362152a12bb25be6185d420285b6"><div class="ttname"><a href="namespacedblwr_1_1v1.html#a2213362152a12bb25be6185d420285b6">dblwr::v1::create</a></div><div class="ttdeci">dberr_t create() noexcept</div><div class="ttdoc">Create the dblwr data structures in the system tablespace. </div><div class="ttdef"><b>Definition:</b> buf0dblwr.cc:1834</div></div>
<div class="ttc" id="btr0btr_8h_html_a2e7b9b7db7f01f12accffb27b543d03d"><div class="ttname"><a href="btr0btr_8h.html#a2e7b9b7db7f01f12accffb27b543d03d">btr_assert_not_corrupted</a></div><div class="ttdeci">#define btr_assert_not_corrupted(block, index)</div><div class="ttdoc">Assert that a B-tree page is not corrupted. </div><div class="ttdef"><b>Definition:</b> btr0btr.h:149</div></div>
<div class="ttc" id="innodb__utility_8h_html_a322ea71f3d3155392d56dc526c957375"><div class="ttname"><a href="innodb__utility_8h.html#a322ea71f3d3155392d56dc526c957375">hash_calc_hash</a></div><div class="ttdeci">ib_ulint_t hash_calc_hash(ib_ulint_t fold, hash_table_t *table)</div><div class="ttdoc">Calculates the hash value from a folded value. </div><div class="ttdef"><b>Definition:</b> innodb_utility.cc:177</div></div>
<div class="ttc" id="structlock__table__t_html"><div class="ttname"><a href="structlock__table__t.html">lock_table_t</a></div><div class="ttdoc">A table lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:51</div></div>
<div class="ttc" id="structlock__t_html_adda86279aa635faf45657c4912f9bef3"><div class="ttname"><a href="structlock__t.html#adda86279aa635faf45657c4912f9bef3">lock_t::type</a></div><div class="ttdeci">uint32_t type() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:217</div></div>
<div class="ttc" id="lock0priv_8h_html_aaa98e1bd917f95280993475788ea6c5bab91e6212faed445182df02ef9497f066"><div class="ttname"><a href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5bab91e6212faed445182df02ef9497f066">LOCK_REC_SUCCESS_CREATED</a></div><div class="ttdoc">Explicitly created a new lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:590</div></div>
<div class="ttc" id="structque__thr__t_html"><div class="ttname"><a href="structque__thr__t.html">que_thr_t</a></div><div class="ttdef"><b>Definition:</b> que0que.h:251</div></div>
<div class="ttc" id="lock0priv_8h_html_aaa98e1bd917f95280993475788ea6c5ba4f02aa53c8580c293151a57282bdbdd6"><div class="ttname"><a href="lock0priv_8h.html#aaa98e1bd917f95280993475788ea6c5ba4f02aa53c8580c293151a57282bdbdd6">LOCK_REC_SUCCESS</a></div><div class="ttdoc">Succeeded in acquiring a lock (implicit or already acquired) </div><div class="ttdef"><b>Definition:</b> lock0priv.h:588</div></div>
<div class="ttc" id="structlock__t_html_aacb3ed355f862f41b14e04fabce94cac"><div class="ttname"><a href="structlock__t.html#aacb3ed355f862f41b14e04fabce94cac">lock_t::m_psi_event_id</a></div><div class="ttdeci">ulonglong m_psi_event_id</div><div class="ttdoc">Performance schema event that created the lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:159</div></div>
<div class="ttc" id="structtrx__lock__t_html_a5b5a11c3bcbef8f9f71497710587ba90"><div class="ttname"><a href="structtrx__lock__t.html#a5b5a11c3bcbef8f9f71497710587ba90">trx_lock_t::que_state</a></div><div class="ttdeci">trx_que_t que_state</div><div class="ttdoc">valid when trx-&gt;state == TRX_STATE_ACTIVE: TRX_QUE_RUNNING, TRX_QUE_LOCK_WAIT, ... </div><div class="ttdef"><b>Definition:</b> trx0trx.h:565</div></div>
<div class="ttc" id="classRecLock_html_af263967471da92c816a2ea281dd827f5"><div class="ttname"><a href="classRecLock.html#af263967471da92c816a2ea281dd827f5">RecLock::m_index</a></div><div class="ttdeci">dict_index_t * m_index</div><div class="ttdoc">Index on which the record lock is required. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:862</div></div>
<div class="ttc" id="structLock__iter_html_ae4cc30d144818c126133a0d99ee4d5a1"><div class="ttname"><a href="structLock__iter.html#ae4cc30d144818c126133a0d99ee4d5a1">Lock_iter::advance</a></div><div class="ttdeci">static lock_t * advance(const RecID &amp;rec_id, lock_t *lock)</div><div class="ttdoc">Gets the next record lock on a page. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:1039</div></div>
<div class="ttc" id="structlock__t_html_a8e36c922822944263618cdb99c34508d"><div class="ttname"><a href="structlock__t.html#a8e36c922822944263618cdb99c34508d">lock_t::is_waiting</a></div><div class="ttdeci">bool is_waiting() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:192</div></div>
<div class="ttc" id="lock0lock_8h_html_a8631af3f85d4c19484f6de819b2b2a37"><div class="ttname"><a href="lock0lock_8h.html#a8631af3f85d4c19484f6de819b2b2a37">LOCK_GAP</a></div><div class="ttdeci">#define LOCK_GAP</div><div class="ttdoc">when this bit is set, it means that the \ lock holds only on the gap before the record; \ for instanc...</div><div class="ttdef"><b>Definition:</b> lock0lock.h:899</div></div>
<div class="ttc" id="classlocksys_1_1Unsafe__global__latch__manipulator_html"><div class="ttname"><a href="classlocksys_1_1Unsafe__global__latch__manipulator.html">locksys::Unsafe_global_latch_manipulator</a></div><div class="ttdef"><b>Definition:</b> lock0priv.h:1100</div></div>
<div class="ttc" id="structRecID_html_aa5b48ad9e40e2270ee82ad1aebaa66f1"><div class="ttname"><a href="structRecID.html#aa5b48ad9e40e2270ee82ad1aebaa66f1">RecID::matches</a></div><div class="ttdeci">bool matches(const lock_t *lock) const</div></div>
<div class="ttc" id="classRecLock_html_af2d6f78ca98e9cc56ce3f8b2e3805ff2"><div class="ttname"><a href="classRecLock.html#af2d6f78ca98e9cc56ce3f8b2e3805ff2">RecLock::RecLock</a></div><div class="ttdeci">RecLock(dict_index_t *index, const RecID &amp;rec_id, ulint mode)</div><div class="ttdef"><b>Definition:</b> lock0priv.h:691</div></div>
<div class="ttc" id="structRecID_html_a545850b9ee2e42a9b12b567cd7c483c5"><div class="ttname"><a href="structRecID.html#a545850b9ee2e42a9b12b567cd7c483c5">RecID::RecID</a></div><div class="ttdeci">RecID(page_id_t page_id, uint32_t heap_no)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:607</div></div>
<div class="ttc" id="structlock__t_html_ad82263cb7a15ff2c77324c5a745c3562"><div class="ttname"><a href="structlock__t.html#ad82263cb7a15ff2c77324c5a745c3562">lock_t::is_predicate</a></div><div class="ttdeci">bool is_predicate() const</div><div class="ttdoc">Determine if it is predicate lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:187</div></div>
<div class="ttc" id="lock0lock_8h_html_a5ec9b0cce21ee17de083d3bb96b1bec6"><div class="ttname"><a href="lock0lock_8h.html#a5ec9b0cce21ee17de083d3bb96b1bec6">LOCK_REC_NOT_GAP</a></div><div class="ttdeci">#define LOCK_REC_NOT_GAP</div><div class="ttdoc">this bit means that the lock is only on \ the index record and does NOT block inserts \ to the gap be...</div><div class="ttdef"><b>Definition:</b> lock0lock.h:913</div></div>
<div class="ttc" id="namespacebinary__log_1_1transaction_1_1compression_html_a22a3b5d8096f4c73ced74c0b668df0be"><div class="ttname"><a href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">binary_log::transaction::compression::type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> base.h:36</div></div>
<div class="ttc" id="trx0types_8h_html"><div class="ttname"><a href="trx0types_8h.html">trx0types.h</a></div><div class="ttdoc">Transaction system global type definitions. </div></div>
<div class="ttc" id="structlock__sys__t_html_a0a912ac77e422250e7ea74e78a314af6"><div class="ttname"><a href="structlock__sys__t.html#a0a912ac77e422250e7ea74e78a314af6">lock_sys_t::latches</a></div><div class="ttdeci">locksys::Latches latches</div><div class="ttdoc">The latches protecting queues of record and table locks. </div><div class="ttdef"><b>Definition:</b> lock0lock.h:971</div></div>
<div class="ttc" id="dict0dict_8h_html_afcbc5eab483c1f89ffe2208855f3f9b7"><div class="ttname"><a href="dict0dict_8h.html#afcbc5eab483c1f89ffe2208855f3f9b7">dict_index_is_online_ddl</a></div><div class="ttdeci">UNIV_INLINE bool dict_index_is_online_ddl(const dict_index_t *index)</div><div class="ttdoc">Determines if a secondary index is being or has been created online, or if the table is being rebuilt...</div></div>
<div class="ttc" id="classlocksys_1_1Latches_html_a8cdc487610b269186e5ab794fde6b86b"><div class="ttname"><a href="classlocksys_1_1Latches.html#a8cdc487610b269186e5ab794fde6b86b">locksys::Latches::global_latch</a></div><div class="ttdeci">Unique_sharded_rw_lock global_latch</div><div class="ttdef"><b>Definition:</b> lock0latches.h:235</div></div>
<div class="ttc" id="structlock__t_html_a88154972614cee76e78e04a3218a13c2"><div class="ttname"><a href="structlock__t.html#a88154972614cee76e78e04a3218a13c2">lock_t::print</a></div><div class="ttdeci">std::ostream &amp; print(std::ostream &amp;out) const</div><div class="ttdoc">Print the lock object into the given output stream. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:278</div></div>
<div class="ttc" id="lock0priv_8h_html_a61561eadb600f37c0dc22bd4effad91b"><div class="ttname"><a href="lock0priv_8h.html#a61561eadb600f37c0dc22bd4effad91b">lock_rec_get_first_on_page_addr</a></div><div class="ttdeci">UNIV_INLINE lock_t * lock_rec_get_first_on_page_addr(hash_table_t *lock_hash, const page_id_t &amp;page_id)</div><div class="ttdoc">Gets the first record lock on a page, where the page is identified by its file address. </div></div>
<div class="ttc" id="structlock__t_html_a07680fbb48d79c8f1c646d0687e234fb"><div class="ttname"><a href="structlock__t.html#a07680fbb48d79c8f1c646d0687e234fb">lock_t::tab_lock</a></div><div class="ttdeci">lock_table_t tab_lock</div><div class="ttdoc">Table lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:147</div></div>
<div class="ttc" id="structtrx__t_html_af30d46c475f9c53eb258989c6acdfef6"><div class="ttname"><a href="structtrx__t.html#af30d46c475f9c53eb258989c6acdfef6">trx_t::lock</a></div><div class="ttdeci">trx_lock_t lock</div><div class="ttdoc">Information about the transaction locks and state. </div><div class="ttdef"><b>Definition:</b> trx0trx.h:977</div></div>
<div class="ttc" id="lock0lock_8h_html_a1206e21ae1b1abe21e29acec6af79a8c"><div class="ttname"><a href="lock0lock_8h.html#a1206e21ae1b1abe21e29acec6af79a8c">lock_rec_fold</a></div><div class="ttdeci">UNIV_INLINE ulint lock_rec_fold(const page_id_t page_id)</div><div class="ttdoc">Calculates the fold value of a page file address: used in inserting or searching for a lock in the ha...</div></div>
<div class="ttc" id="hash_8c_html_a1c12edaae63f2e86a5b276a18475f863"><div class="ttname"><a href="hash_8c.html#a1c12edaae63f2e86a5b276a18475f863">hash</a></div><div class="ttdeci">uint32_t hash(const void *key, size_t length, const uint32_t initval)</div><div class="ttdef"><b>Definition:</b> hash.c:121</div></div>
<div class="ttc" id="trx0types_8h_html_a34bba6fbd37f499f7874fc416547759f"><div class="ttname"><a href="trx0types_8h.html#a34bba6fbd37f499f7874fc416547759f">trx_que_t</a></div><div class="ttdeci">trx_que_t</div><div class="ttdoc">Transaction execution states when trx-&gt;state == TRX_STATE_ACTIVE. </div><div class="ttdef"><b>Definition:</b> trx0types.h:77</div></div>
<div class="ttc" id="structbuf__block__t_html_a8ef8d133a86de0277832fc291bb7f081"><div class="ttname"><a href="structbuf__block__t.html#a8ef8d133a86de0277832fc291bb7f081">buf_block_t::frame</a></div><div class="ttdeci">byte * frame</div><div class="ttdoc">pointer to buffer frame which is of size UNIV_PAGE_SIZE, and aligned to an address divisible by UNIV_...</div><div class="ttdef"><b>Definition:</b> buf0buf.h:1334</div></div>
<div class="ttc" id="classRecLock_html_a733977eec57ccb44d5d82bc0d305c67e"><div class="ttname"><a href="classRecLock.html#a733977eec57ccb44d5d82bc0d305c67e">RecLock::lock_size</a></div><div class="ttdeci">size_t lock_size() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:752</div></div>
<div class="ttc" id="structlock__prdt_html"><div class="ttname"><a href="structlock__prdt.html">lock_prdt</a></div><div class="ttdef"><b>Definition:</b> lock0prdt.h:39</div></div>
<div class="ttc" id="ut0dbg_8h_html_a17113dab7f37e298e889ac8818ab13d0"><div class="ttname"><a href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a></div><div class="ttdeci">#define ut_ad(EXPR)</div><div class="ttdoc">Debug assertion. </div><div class="ttdef"><b>Definition:</b> ut0dbg.h:66</div></div>
<div class="ttc" id="lock0priv_8h_html_a45a7b299a52356a1078b1ef78771e506"><div class="ttname"><a href="lock0priv_8h.html#a45a7b299a52356a1078b1ef78771e506">lock_mode_stronger_or_eq</a></div><div class="ttdeci">UNIV_INLINE bool lock_mode_stronger_or_eq(enum lock_mode mode1, enum lock_mode mode2)</div><div class="ttdoc">Calculates if lock mode 1 is stronger or equal to lock mode 2. </div></div>
<div class="ttc" id="types_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> types.h:50</div></div>
<div class="ttc" id="lock0priv_8h_html_a3508c405f6cb243c87e446622afdcf11"><div class="ttname"><a href="lock0priv_8h.html#a3508c405f6cb243c87e446622afdcf11">lock_types</a></div><div class="ttdeci">static const ulint lock_types</div><div class="ttdoc">The count of the types of locks. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:871</div></div>
<div class="ttc" id="trx0types_8h_html_a91afca43a639c098efe14a9069a1d4ec"><div class="ttname"><a href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a></div><div class="ttdeci">ib_id_t trx_id_t</div><div class="ttdoc">Transaction identifier (DB_TRX_ID, DATA_TRX_ID) </div><div class="ttdef"><b>Definition:</b> trx0types.h:144</div></div>
<div class="ttc" id="structlock__t_html_a005ccf80549a8d258847a286b4b3c731"><div class="ttname"><a href="structlock__t.html#a005ccf80549a8d258847a286b4b3c731">lock_t::is_record_not_gap</a></div><div class="ttdeci">bool is_record_not_gap() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:198</div></div>
<div class="ttc" id="ut0dbg_8h_html_a14595937e3433e1d84a3e5bca4958a96"><div class="ttname"><a href="ut0dbg_8h.html#a14595937e3433e1d84a3e5bca4958a96">ut_error</a></div><div class="ttdeci">#define ut_error</div><div class="ttdoc">Abort execution. </div><div class="ttdef"><b>Definition:</b> ut0dbg.h:62</div></div>
<div class="ttc" id="structLock__iter_html_ab365b6a414d6110deadd80f406825f33"><div class="ttname"><a href="structLock__iter.html#ab365b6a414d6110deadd80f406825f33">Lock_iter::for_each</a></div><div class="ttdeci">static const lock_t * for_each(const RecID &amp;rec_id, F &amp;&amp;f, hash_table_t *hash_table=lock_sys-&gt;rec_hash)</div><div class="ttdoc">Iterate over all the locks on a specific row. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:1079</div></div>
<div class="ttc" id="structhash__cell__t_html_a4e97a7505b1d16d76853a590beea48b2"><div class="ttname"><a href="structhash__cell__t.html#a4e97a7505b1d16d76853a590beea48b2">hash_cell_t::node</a></div><div class="ttdeci">void * node</div><div class="ttdoc">hash chain node, NULL if none </div><div class="ttdef"><b>Definition:</b> hash0hash.h:401</div></div>
<div class="ttc" id="lock0lock_8h_html_a7a448126f7465de2aa940d1751dd8b7e"><div class="ttname"><a href="lock0lock_8h.html#a7a448126f7465de2aa940d1751dd8b7e">LOCK_INSERT_INTENTION</a></div><div class="ttdeci">#define LOCK_INSERT_INTENTION</div><div class="ttdoc">this bit is set when we place a waiting \ gap type record lock request in order to let \ an insert of...</div><div class="ttdef"><b>Definition:</b> lock0lock.h:929</div></div>
<div class="ttc" id="structlock__t_html_a7651674780568aa384de60523c1d3d0d"><div class="ttname"><a href="structlock__t.html#a7651674780568aa384de60523c1d3d0d">lock_t::is_record_lock</a></div><div class="ttdeci">bool is_record_lock() const</div><div class="ttdoc">Determine if the lock object is a record lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:183</div></div>
<div class="ttc" id="classRecLock_html_acfeab4b65de9b504e1f66d95b5fcb582"><div class="ttname"><a href="classRecLock.html#acfeab4b65de9b504e1f66d95b5fcb582">RecLock::m_size</a></div><div class="ttdeci">size_t m_size</div><div class="ttdoc">Size of the record lock in bytes. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:858</div></div>
<div class="ttc" id="lock0priv_8h_html_aab51f58f1d7c2158a0c2eca6014ff26d"><div class="ttname"><a href="lock0priv_8h.html#aab51f58f1d7c2158a0c2eca6014ff26d">lock_table_has</a></div><div class="ttdeci">UNIV_INLINE bool lock_table_has(const trx_t *trx, const dict_table_t *table, enum lock_mode mode)</div><div class="ttdoc">Checks if a transaction has the specified table lock, or stronger. </div></div>
<div class="ttc" id="structLock__iter_html_a2515eef494f677084780d09eb83534f8"><div class="ttname"><a href="structLock__iter.html#a2515eef494f677084780d09eb83534f8">Lock_iter::first</a></div><div class="ttdeci">static lock_t * first(hash_cell_t *list, const RecID &amp;rec_id)</div><div class="ttdoc">Gets the first explicit lock request on a record. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:1059</div></div>
<div class="ttc" id="lock0priv_8h_html_ae7598ff3072373dabc18c756632ece1f"><div class="ttname"><a href="lock0priv_8h.html#ae7598ff3072373dabc18c756632ece1f">lock_get_type_low</a></div><div class="ttdeci">UNIV_INLINE uint32_t lock_get_type_low(const lock_t *lock)</div><div class="ttdoc">Gets the type of a lock. </div></div>
<div class="ttc" id="lock0priv_8h_html_a9cf1fd0b7f60894fecee9005803e62fa"><div class="ttname"><a href="lock0priv_8h.html#a9cf1fd0b7f60894fecee9005803e62fa">lock_rec_get_next_const</a></div><div class="ttdeci">UNIV_INLINE const lock_t * lock_rec_get_next_const(ulint heap_no, const lock_t *lock)</div><div class="ttdoc">Gets the next explicit lock request on a record. </div></div>
<div class="ttc" id="structlock__t_html_acd4e41c6a39521cb2be1ac48a89247ca"><div class="ttname"><a href="structlock__t.html#acd4e41c6a39521cb2be1ac48a89247ca">lock_t::m_seq</a></div><div class="ttdeci">uint64_t m_seq</div><div class="ttdoc">Timestamp when it was created. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:169</div></div>
<div class="ttc" id="lock0lock_8h_html_a3f5d26fd94580daba78f376b8ca887dd"><div class="ttname"><a href="lock0lock_8h.html#a3f5d26fd94580daba78f376b8ca887dd">LOCK_TABLE</a></div><div class="ttdeci">#define LOCK_TABLE</div><div class="ttdoc">Lock types. </div><div class="ttdef"><b>Definition:</b> lock0lock.h:874</div></div>
<div class="ttc" id="classRecLock_html_add38f51d08bba89723155e448c4dc8cf"><div class="ttname"><a href="classRecLock.html#add38f51d08bba89723155e448c4dc8cf">RecLock::init</a></div><div class="ttdeci">void init(const page_t *page)</div><div class="ttdoc">Setup the context from the requirements. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:771</div></div>
<div class="ttc" id="lock0priv_8h_html_a49bacfaaac1b0e5fcfd292189d099dfe"><div class="ttname"><a href="lock0priv_8h.html#a49bacfaaac1b0e5fcfd292189d099dfe">operator&lt;&lt;</a></div><div class="ttdeci">std::ostream &amp; operator&lt;&lt;(std::ostream &amp;out, const lock_table_t &amp;lock)</div><div class="ttdoc">The global output operator is overloaded to conveniently print the lock_table_t object into the given...</div><div class="ttdef"><b>Definition:</b> lock0priv.h:76</div></div>
<div class="ttc" id="classRecLock_html"><div class="ttname"><a href="classRecLock.html">RecLock</a></div><div class="ttdoc">Create record locks. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:648</div></div>
<div class="ttc" id="que0que_8h_html_a8a52bb487c54522cbb437ee19563c990"><div class="ttname"><a href="que0que_8h.html#a8a52bb487c54522cbb437ee19563c990">thr_get_trx</a></div><div class="ttdeci">UNIV_INLINE trx_t * thr_get_trx(que_thr_t *thr)</div><div class="ttdoc">Gets the trx of a query thread. </div></div>
<div class="ttc" id="lock0priv_8h_html_a3579e0d5ddc973a66fae09c8990e05ea"><div class="ttname"><a href="lock0priv_8h.html#a3579e0d5ddc973a66fae09c8990e05ea">lock_compatibility_matrix</a></div><div class="ttdeci">static const byte lock_compatibility_matrix[5][5]</div><div class="ttdef"><b>Definition:</b> lock0priv.h:554</div></div>
<div class="ttc" id="page0types_8h_html_ac84908ddc97c37107986280aa8f37897"><div class="ttname"><a href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a></div><div class="ttdeci">byte page_t</div><div class="ttdoc">Type of the index page. </div><div class="ttdef"><b>Definition:</b> page0types.h:148</div></div>
<div class="ttc" id="structlock__t_html_a772216ac59b70b716ad4090158e8631b"><div class="ttname"><a href="structlock__t.html#a772216ac59b70b716ad4090158e8631b">lock_t::trx_que_state</a></div><div class="ttdeci">trx_que_t trx_que_state() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:229</div></div>
<div class="ttc" id="structlock__rec__t_html"><div class="ttname"><a href="structlock__rec__t.html">lock_rec_t</a></div><div class="ttdoc">Record lock for a page. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:81</div></div>
<div class="ttc" id="namespaceut_html_aa3064bc8c3aa6595f1052c2c86e52725"><div class="ttname"><a href="namespaceut.html#aa3064bc8c3aa6595f1052c2c86e52725">ut::ostringstream</a></div><div class="ttdeci">std::basic_ostringstream&lt; char, std::char_traits&lt; char &gt;, ut_allocator&lt; char &gt; &gt; ostringstream</div><div class="ttdoc">Specialization of basic_ostringstream which uses ut_allocator. </div><div class="ttdef"><b>Definition:</b> ut0new.h:1302</div></div>
<div class="ttc" id="lock0prdt_8h_html_ae6ee8eb7348a3ee9c118a2816ce7f969"><div class="ttname"><a href="lock0prdt_8h.html#ae6ee8eb7348a3ee9c118a2816ce7f969">lock_prdt_t</a></div><div class="ttdeci">struct lock_prdt lock_prdt_t</div></div>
<div class="ttc" id="structlock__t_html_a46622ae01b70efd3cb250e57eef23460"><div class="ttname"><a href="structlock__t.html#a46622ae01b70efd3cb250e57eef23460">lock_t::includes_supremum</a></div><div class="ttdeci">bool includes_supremum() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:212</div></div>
<div class="ttc" id="structRecID_html_ae03e4bb0ef42ca8232bdfcff51f1c08e"><div class="ttname"><a href="structRecID.html#ae03e4bb0ef42ca8232bdfcff51f1c08e">RecID::m_page_id</a></div><div class="ttdeci">page_id_t m_page_id</div><div class="ttdoc">Tablespace ID and page number within space. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:635</div></div>
<div class="ttc" id="classRecLock_html_a5bac461b3f22b08a7639d8a7b44870df"><div class="ttname"><a href="classRecLock.html#a5bac461b3f22b08a7639d8a7b44870df">RecLock::RecLock</a></div><div class="ttdeci">RecLock(que_thr_t *thr, dict_index_t *index, const RecID &amp;rec_id, ulint mode)</div><div class="ttdef"><b>Definition:</b> lock0priv.h:656</div></div>
<div class="ttc" id="srv0srv_8h_html_abee3b4363b1c03c5eb8d9b515e80bad2"><div class="ttname"><a href="srv0srv_8h.html#abee3b4363b1c03c5eb8d9b515e80bad2">srv_read_only_mode</a></div><div class="ttdeci">bool srv_read_only_mode</div><div class="ttdoc">Set if InnoDB must operate in read-only mode. </div><div class="ttdef"><b>Definition:</b> srv0srv.cc:187</div></div>
<div class="ttc" id="structlock__t_html_acdde34489d4248e3752ffca049f3041f"><div class="ttname"><a href="structlock__t.html#acdde34489d4248e3752ffca049f3041f">lock_t::hash_table</a></div><div class="ttdeci">hash_table_t * hash_table() const</div><div class="ttdoc">Get lock hash table. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:226</div></div>
<div class="ttc" id="hash0hash_8h_html"><div class="ttname"><a href="hash0hash_8h.html">hash0hash.h</a></div><div class="ttdoc">The simple hash table utility. </div></div>
<div class="ttc" id="libmysql_2authentication__win_2common_8h_html_a0c8186d9b9b7880309c27230bbb5e69d"><div class="ttname"><a href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a></div><div class="ttdeci">unsigned char byte</div><div class="ttdoc">Blob class. </div><div class="ttdef"><b>Definition:</b> common.h:159</div></div>
<div class="ttc" id="structlock__t_html_ae72488b9bd2a94fde11301ac59cec2bd"><div class="ttname"><a href="structlock__t.html#ae72488b9bd2a94fde11301ac59cec2bd">lock_t::type_string</a></div><div class="ttdeci">const char * type_string() const</div><div class="ttdef"><b>Definition:</b> lock0priv.h:241</div></div>
<div class="ttc" id="lock0types_8h_html_acff05fa7dd69832a04f93b92db1e0013a7c98d16ae81460b73cc836948b622480"><div class="ttname"><a href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013a7c98d16ae81460b73cc836948b622480">LOCK_S</a></div><div class="ttdef"><b>Definition:</b> lock0types.h:54</div></div>
<div class="ttc" id="lock0types_8h_html_acff05fa7dd69832a04f93b92db1e0013"><div class="ttname"><a href="lock0types_8h.html#acff05fa7dd69832a04f93b92db1e0013">lock_mode</a></div><div class="ttdeci">lock_mode</div><div class="ttdef"><b>Definition:</b> lock0types.h:51</div></div>
<div class="ttc" id="lock0lock_8h_html_a7e59e399364d823b33bc010e93e9c278"><div class="ttname"><a href="lock0lock_8h.html#a7e59e399364d823b33bc010e93e9c278">LOCK_PREDICATE</a></div><div class="ttdeci">#define LOCK_PREDICATE</div><div class="ttdoc">Predicate lock. </div><div class="ttdef"><b>Definition:</b> lock0lock.h:945</div></div>
<div class="ttc" id="lock0lock_8h_html_a51876da8368dde6b362ce3c465dcc9eb"><div class="ttname"><a href="lock0lock_8h.html#a51876da8368dde6b362ce3c465dcc9eb">LOCK_TYPE_MASK</a></div><div class="ttdeci">#define LOCK_TYPE_MASK</div><div class="ttdoc">mask used to extract lock type from the \ type_mode field in a lock </div><div class="ttdef"><b>Definition:</b> lock0lock.h:876</div></div>
<div class="ttc" id="lock0priv_8h_html_ae0cb59e5d76d0647bfbc4096682228f3"><div class="ttname"><a href="lock0priv_8h.html#ae0cb59e5d76d0647bfbc4096682228f3">lock_rec_set_nth_bit</a></div><div class="ttdeci">UNIV_INLINE void lock_rec_set_nth_bit(lock_t *lock, ulint i)</div><div class="ttdoc">Sets the nth bit of a record lock to TRUE. </div></div>
<div class="ttc" id="structlock__t_html_afdd0a4b2080eceaa63acfe600a98f547"><div class="ttname"><a href="structlock__t.html#afdd0a4b2080eceaa63acfe600a98f547">lock_t::unlock_gap_lock</a></div><div class="ttdeci">void unlock_gap_lock()</div><div class="ttdoc">Unlock the GAP Lock part of this Next Key Lock. </div><div class="ttdef"><b>Definition:</b> lock0priv.h:173</div></div>
<div class="ttc" id="lock0priv_8h_html_a9398c6b6d42fd740b9fa25ae4be1f660"><div class="ttname"><a href="lock0priv_8h.html#a9398c6b6d42fd740b9fa25ae4be1f660">lock_rec_get_prev</a></div><div class="ttdeci">const lock_t * lock_rec_get_prev(const lock_t *in_lock, ulint heap_no)</div><div class="ttdoc">Gets the previous record lock set on a record. </div><div class="ttdef"><b>Definition:</b> lock0lock.cc:718</div></div>
<div class="ttc" id="lock0lock_8h_html_a92ad796dd0adc2da08468a220376fe76"><div class="ttname"><a href="lock0lock_8h.html#a92ad796dd0adc2da08468a220376fe76">LOCK_WAIT</a></div><div class="ttdeci">#define LOCK_WAIT</div><div class="ttdoc">Waiting lock flag; when set, it \ means that the lock has not yet been \ granted, it is just waiting ...</div><div class="ttdef"><b>Definition:</b> lock0lock.h:884</div></div>
<div class="ttc" id="innodb__utility_8h_html_a496a8f8646bff5c74c18ee0c04134b6d"><div class="ttname"><a href="innodb__utility_8h.html#a496a8f8646bff5c74c18ee0c04134b6d">UT_LIST_NODE_T</a></div><div class="ttdeci">#define UT_LIST_NODE_T(TYPE)</div><div class="ttdef"><b>Definition:</b> innodb_utility.h:40</div></div>
<div class="ttc" id="lock0priv_8h_html_a77353055fb4e9cff71124da74ecd85f4"><div class="ttname"><a href="lock0priv_8h.html#a77353055fb4e9cff71124da74ecd85f4">lock_rec_get_first_on_page</a></div><div class="ttdeci">UNIV_INLINE lock_t * lock_rec_get_first_on_page(hash_table_t *lock_hash, const buf_block_t *block)</div><div class="ttdoc">Gets the first record lock on a page, where the page is identified by a pointer to it...</div></div>
<div class="ttc" id="innodb__utility_8h_html_a1224310bbda440a206a480cbeeae7ca3"><div class="ttname"><a href="innodb__utility_8h.html#a1224310bbda440a206a480cbeeae7ca3">hash_get_nth_cell</a></div><div class="ttdeci">hash_cell_t * hash_get_nth_cell(hash_table_t *table, ib_ulint_t n)</div><div class="ttdoc">Gets the nth cell in a hash table. </div><div class="ttdef"><b>Definition:</b> innodb_utility.cc:188</div></div>
<div class="ttc" id="lock0lock_8h_html_a145ae646d1def688ee264b9d98c2e981"><div class="ttname"><a href="lock0lock_8h.html#a145ae646d1def688ee264b9d98c2e981">LOCK_REC</a></div><div class="ttdeci">#define LOCK_REC</div><div class="ttdoc">record lock </div><div class="ttdef"><b>Definition:</b> lock0lock.h:875</div></div>
<div class="ttc" id="lock0priv_8h_html_a1f9b9cd959650891d83421c521909b88"><div class="ttname"><a href="lock0priv_8h.html#a1f9b9cd959650891d83421c521909b88">lock_notify_about_deadlock</a></div><div class="ttdeci">void lock_notify_about_deadlock(const ut::vector&lt; const trx_t *&gt; &amp;trxs_on_cycle, const trx_t *victim_trx)</div><div class="ttdoc">Handles writing the information about found deadlock to the log files and caches it for future lock_l...</div><div class="ttdef"><b>Definition:</b> lock0lock.cc:6538</div></div>
<div class="ttc" id="xcom__base_8cc_html_ae59cfd3ffb63867637cd9aca530ec6fb"><div class="ttname"><a href="xcom__base_8cc.html#ae59cfd3ffb63867637cd9aca530ec6fb">prepare</a></div><div class="ttdeci">static void prepare(pax_msg *p, pax_op op)</div><div class="ttdef"><b>Definition:</b> xcom_base.cc:1304</div></div>
<div class="ttc" id="structdict__index__t_html"><div class="ttname"><a href="structdict__index__t.html">dict_index_t</a></div><div class="ttdoc">Data structure for an index. </div><div class="ttdef"><b>Definition:</b> dict0mem.h:886</div></div>
<div class="ttc" id="lock0priv_8h_html_ae4ba4d837532fb8eaf414d1cbaaf6d90"><div class="ttname"><a href="lock0priv_8h.html#ae4ba4d837532fb8eaf414d1cbaaf6d90">lock_get_mode</a></div><div class="ttdeci">UNIV_INLINE enum lock_mode lock_get_mode(const lock_t *lock)</div><div class="ttdoc">Gets the mode of a lock. </div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_70f20ecf11358dff00a0daf546d3147e.html">storage</a></li><li class="navelem"><a class="el" href="dir_3fec0aa9607ea05e0bb1c96aee1a8c4e.html">innobase</a></li><li class="navelem"><a class="el" href="dir_9b7ed1f29269ffabdc4c5f5522a0db25.html">include</a></li><li class="navelem"><a class="el" href="lock0priv_8h.html">lock0priv.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
