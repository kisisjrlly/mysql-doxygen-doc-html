<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: Checking for Expected Errors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('PAGE_CHECK_EXPECTED_ERRORS.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Checking for Expected Errors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A good test suite checks not only that operations succeed as they ought, but also that they fail as they ought.</p>
<p>For example, if a statement is illegal, the server should reject it with an error message. The test suite should verify that the statement fails and that it fails with the proper error message.</p>
<p>The test engine enables you to specify “expected failures.” Let's say that after we create <b>t1</b>, we try to create it again without dropping it first:</p>
<pre class="fragment">--disable_warnings
DROP TABLE IF EXISTS t1,t2;
--enable_warnings
CREATE TABLE t1 (
  Period SMALLINT(4) UNSIGNED ZEROFILL DEFAULT '0000' NOT NULL,
  Varor_period SMALLINT(4) UNSIGNED DEFAULT '0' NOT NULL
);
CREATE TABLE t2 (Period SMALLINT);

INSERT INTO t1 VALUES (9410,9412);
INSERT INTO t2 VALUES (9410),(9411),(9412),(9413);

SELECT period FROM t1;
SELECT * FROM t1;
SELECT t1.* FROM t1;
SELECT * FROM t1 INNER JOIN t2 USING (Period);

CREATE TABLE t1 (something SMALLINT(4));
</pre><p>The result is failure and an error:</p>
<pre class="fragment">At line 21: query 'CREATE TABLE t1 (something SMALLINT(4))'
failed: 1050: Table 't1' already exists
</pre><p>To handle this error and indicate that indeed we do expect it to occur, we can put an <b>error</b> command before the second <b>create table</b> statement. Either of the following commands test for this particular MySQL error:</p>
<pre class="fragment">--error 1050
--error ER_TABLE_EXISTS_ERROR
</pre><p><b>1050</b> is the numeric error code and <b>ER_TABLE_EXISTS_ERROR</b> is the symbolic name. Symbolic names are more stable than error numbers because the numbers sometimes change, particularly for those created during recent development. For such errors, use of numbers rather than the names in a test case will require test to be revised should the numbers change.</p>
<p>After we make a change to add an <b>error</b> command before the <b>CREATE TABLE</b> statement and run the test again, the end of the result will look like this:</p>
<pre class="fragment">CREATE TABLE t1 (something SMALLINT(4));
ERROR 42S01: Table 't1' already exists
</pre><p>In this case, the result shows the statement that causes the error, together with the resulting error message. The fact that <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> does not terminate and that the error message becomes part of the result indicates that the error was expected.</p>
<p>You can also test for errors by specifying an SQLSTATE value. For MySQL error number <b>1050</b>, the corresponding SQLSTATE value is <b>42S01</b>. To specify an SQLSTATE value in an <b>error</b> command, use an <b>S</b> prefix:</p>
<pre class="fragment">--error S42S01
</pre><p>A disadvantage of SQLSTATE values is that sometimes they correspond to more than one MySQL error code. Using the SQLSTATE value in this case might not be specific enough (it could let through an error that you do not actually expect).</p>
<p>If you want to test for multiple errors, the <b>error</b> command allows multiple arguments, separated by commas. For example:</p>
<pre class="fragment">--error ER_NO_SUCH_TABLE,ER_KEY_NOT_FOUND
</pre><p>For a list of MySQL error codes, symbolic names, and SQLSTATE values, see <a href="https://dev.mysql.com/doc/refman/8.0/en/error-messages-server.html">https://dev.mysql.com/doc/refman/8.0/en/error-messages-server.html</a>. You can also examine the <b>mysqld_error.h</b> and <b>sql_state.h</b> files in the <b>include</b> directory of a MySQL source distribution.</p>
<p>It is also possible to use symbolic error names to refer to client errors:</p>
<pre class="fragment">--error CR_SERVER_GONE_ERROR
</pre><p>For a list of MySQL client error codes, see <a href="https://dev.mysql.com/doc/refman/8.0/en/error-messages-client.html">https://dev.mysql.com/doc/refman/8.0/en/error-messages-client.html</a>. You can also examine the <b>errmsg.h</b> file in the <b>include</b> directory of a MySQL source distribution.</p>
<p>The built-in variable <b>$mysql_errno</b> contains the numeric error returned by the most recent SQL statement sent to the server, or 0 if the statement executed successfully. This may be useful after statements that may or may not fail, or fail in more than one way (more than one argument to the <b>error</b> command), in case you need to perform different actions. Note that this applies to SQL statements, not to other commands.</p>
<p>There is also a variable <b>$mysql_errname</b> which contains the symbolic name of the last error. In some cases the symbolic name is not available; in those cases the variable will contain the string <b>"&lt;Unknown&gt;"</b>. For new test development we recommend testing against the name rather than the number, since the number may change in future versions. If the last statement succeeded (<b>$mysql_errno</b> is 0), this variable is an empty string. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_TESTING_TOOLS.html">Testing Tools</a></li><li class="navelem"><a class="el" href="PAGE_MYSQL_TEST_RUN.html">The MySQL Test Framework</a></li><li class="navelem"><a class="el" href="PAGE_WRITING_TESTCASES.html">Writing Test Cases</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
