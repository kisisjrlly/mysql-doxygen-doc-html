<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: Stored Programs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_protocol_command_phase_sp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Stored Programs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In MySQL 5.0 the protocol was extended to handle:</p>
<ul>
<li><a class="el" href="page_protocol_command_phase_sp.html#sect_protocol_command_phase_sp_multi_resultset">Multi-Resultset</a></li>
<li><a class="el" href="page_protocol_command_phase_sp.html#sect_protocol_command_phase_sp_multi_statement">Multi-Statement</a></li>
</ul>
<h1><a class="anchor" id="sect_protocol_command_phase_sp_multi_resultset"></a>
Multi-Resultset</h1>
<p>Multi-resultsets are sent by a stored program if more than one resultset was generated inside of it. e.g.: </p><div class="fragment"><div class="line"><a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9a473b49382a20dcc5b0ee10ddbc6338b4">CREATE</a> <a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9a53f28ed69876a83aa787857961d5d217">TEMPORARY</a> <a class="code" href="structTABLE.html">TABLE</a> ins ( <span class="keywordtype">id</span> <a class="code" href="parser__yystype_8h.html#a39db6aec34d902dab6c97dc0dd72fa43a53f93baa3057821107c750323892fa92">INT</a> );</div><div class="line"><a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9a8b0b0025af76a3d8f0b7b1d4758e51a6">DROP</a> <a class="code" href="group__GROUP__PARSER.html#gga9e3ffdbaa8d88485570eaf514d3808e5a6c4d52355c694ee12dcd648562757f52">PROCEDURE</a> <a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9a252802eda493fb6b4a279c4452acb547">IF</a> <a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9a3197625a1bb2264943f5a95f236d9973">EXISTS</a> multi;</div><div class="line"><a class="code" href="namespacesha2__password.html#a2b7ae221fe6038a37dd6ddd50c32478d">DELIMITER</a> $$</div><div class="line"><a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9a473b49382a20dcc5b0ee10ddbc6338b4">CREATE</a> <a class="code" href="group__GROUP__PARSER.html#gga9e3ffdbaa8d88485570eaf514d3808e5a6c4d52355c694ee12dcd648562757f52">PROCEDURE</a> multi() <a class="code" href="lexyy_8cc.html#ab766bbbee08d04b67e3fe599d6900873">BEGIN</a></div><div class="line">  SELECT 1;</div><div class="line">  SELECT 1;</div><div class="line">  <a class="code" href="json__diff_8h.html#ac6bdf4cd490db1c02e98ca88e25107faa61ee777e7f71dc466c3b2c685d8d313b">INSERT</a> <a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9aab0fb930b459cfb52c8929bc8f048c4f">INTO</a> ins <a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9a91a9a6a83761d5dd2b34344be9dc8000">VALUES</a> (1);</div><div class="line">  <a class="code" href="json__diff_8h.html#ac6bdf4cd490db1c02e98ca88e25107faa61ee777e7f71dc466c3b2c685d8d313b">INSERT</a> <a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9aab0fb930b459cfb52c8929bc8f048c4f">INTO</a> ins VALUES (2);</div><div class="line"><a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9adc6f24fd6915a3f2786a1b7045406924">END</a>$$</div><div class="line"><a class="code" href="namespacesha2__password.html#a2b7ae221fe6038a37dd6ddd50c32478d">DELIMITER</a> ;</div><div class="line"></div><div class="line">CALL multi();</div><div class="line"><a class="code" href="sql__yacc_8h.html#a15c9f7bd2f0e9686df5d9df4f3314aa9a8b0b0025af76a3d8f0b7b1d4758e51a6">DROP</a> <a class="code" href="structTABLE.html">TABLE</a> ins;</div></div><!-- fragment --><p>results in:</p><ul>
<li>a resultset <div class="fragment"><div class="line">01 00 00 01 01 17 00 00    02 03 64 65 66 00 00 00    ..........def...</div><div class="line">01 31 00 0c 3f 00 01 00    00 00 08 81 00 00 00 00    .1..?...........</div><div class="line">05 00 00 03 fe 00 00 0a    00 02 00 00 04 01 31 05    ..............1.</div><div class="line">00 00 05 fe 00 00 0a 00                               ........</div></div><!-- fragment --><ul>
<li>see the <a class="el" href="page_protocol_basic_eof_packet.html">EOF_Packet</a> <code>05 00 00 03 fe 00 00 0a 00</code> with its status-flag being <code>0x0A</code></li>
</ul>
</li>
<li>another resultset: <div class="fragment"><div class="line">01 00 00 06 01 17 00 00    07 03 64 65 66 00 00 00    ..........def...</div><div class="line">01 31 00 0c 3f 00 01 00    00 00 08 81 00 00 00 00    .1..?...........</div><div class="line">05 00 00 08 fe 00 00 0a    00 02 00 00 09 01 31 05    ..............1.</div><div class="line">00 00 0a fe 00 00 0a 00                               ........</div></div><!-- fragment --><ul>
<li>see the <a class="el" href="page_protocol_basic_eof_packet.html">EOF_Packet</a> <code>05 00 00 03 fe 00 00 0a 00</code> with its status-flag being <code>0x0A</code></li>
</ul>
</li>
<li>and a closing empty resultset, an <a class="el" href="page_protocol_basic_ok_packet.html">OK_Packet</a> <div class="fragment"><div class="line">07 00 00 0b 00 01 00 02    00 00 00                   ...........</div></div><!-- fragment --></li>
</ul>
<p>If the SERVER_MORE_RESULTS_EXISTS flag ise set, that indicates more resultsets will follow.</p>
<p>The trailing <a class="el" href="page_protocol_basic_ok_packet.html">OK_Packet</a> is the response to the <code>CALL</code> statement and contains the <code>affected_rows</code> count of the last statement. In our case we inserted 2 rows, but only the <code>affected_rows</code> of the last <code>INSERT</code> statement is returned as part of the <a class="el" href="page_protocol_basic_ok_packet.html">OK_Packet</a>. If the last statement is a <code>SELECT</code>, the <code>affected_rows</code> count is 0.</p>
<p>As of MySQL 5.7.5, the resultset is followed by an <a class="el" href="page_protocol_basic_ok_packet.html">OK_Packet</a>, and this <a class="el" href="page_protocol_basic_ok_packet.html">OK_Packet</a> has the SERVER_MORE_RESULTS_EXISTS flag set to start the processing of the next resultset.</p>
<p>The client has to announce that it wants multi-resultsets by either setting the CLIENT_MULTI_RESULTS or CLIENT_PS_MULTI_RESULTS capabilitiy flags.</p>
<h2><a class="anchor" id="sect_protocol_command_phase_sp_multi_resultset_out_params"></a>
OUT Parameter Set</h2>
<p>Starting with MySQL 5.5.3, prepared statements can bind OUT parameters of stored procedures. They are returned as an extra resultset in the multi-resultset response. The client announces it can handle OUT parameters by settting the CLIENT_PS_MULTI_RESULTS capability.</p>
<p>To distinguish a normal resultset from an OUT parameter set, the <a class="el" href="page_protocol_basic_eof_packet.html">EOF_Packet</a> or (if CLIENT_DEPRECATE_EOF capability flag is set) <a class="el" href="page_protocol_basic_ok_packet.html">OK_Packet</a> that follows its field definition has the SERVER_PS_OUT_PARAMS flag set.</p>
<dl class="section note"><dt>Note</dt><dd>The closing <a class="el" href="page_protocol_basic_eof_packet.html">EOF_Packet</a> does NOT have either SERVER_PS_OUT_PARAMS flag nor the SERVER_MORE_RESULTS_EXISTS flag set. Only the first <a class="el" href="page_protocol_basic_eof_packet.html">EOF_Packet</a> has.</dd></dl>
<h1><a class="anchor" id="sect_protocol_command_phase_sp_multi_statement"></a>
Multi-Statement</h1>
<p>A multi-statement is permitting COM_QUERY to send more than one query to the server, separated by <code>;</code> characters.</p>
<p>The client musst announce that it wants multi-statements by either setting the CLIENT_MULTI_STATEMENTS capability or by using <a class="el" href="page_protocol_com_set_option.html">COM_SET_OPTION</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_PROTOCOL.html">Client/Server Protocol</a></li><li class="navelem"><a class="el" href="page_protocol_connection_lifecycle.html">Connection Lifecycle</a></li><li class="navelem"><a class="el" href="page_protocol_command_phase.html">%Command Phase</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
