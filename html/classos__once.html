<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: os_once Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classos__once.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classos__once-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">os_once Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Execute a given function exactly once in a multi-threaded environment or wait for the function to be executed by another thread.  
 <a href="classos__once.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="os0once_8h_source.html">os0once.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a76b1ff71a045a72c666cc0654bec1fcb"><td class="memItemLeft" align="right" valign="top">typedef ib_uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a></td></tr>
<tr class="memdesc:a76b1ff71a045a72c666cc0654bec1fcb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control variables' state type.  <a href="#a76b1ff71a045a72c666cc0654bec1fcb">More...</a><br /></td></tr>
<tr class="separator:a76b1ff71a045a72c666cc0654bec1fcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ad8346530fd75a7f08c573c396eb78b6b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classos__once.html#ad8346530fd75a7f08c573c396eb78b6b">do_or_wait_for_done</a> (volatile <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a> *state, void(*do_func)(void *), void *do_func_arg)</td></tr>
<tr class="memdesc:ad8346530fd75a7f08c573c396eb78b6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call a given function or wait its execution to complete if it is already called by another thread.  <a href="#ad8346530fd75a7f08c573c396eb78b6b">More...</a><br /></td></tr>
<tr class="separator:ad8346530fd75a7f08c573c396eb78b6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a8043b83d19ef578c3ea0f5a94632acac"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classos__once.html#a8043b83d19ef578c3ea0f5a94632acac">NEVER_DONE</a> = 0</td></tr>
<tr class="memdesc:a8043b83d19ef578c3ea0f5a94632acac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Not yet executed.  <a href="#a8043b83d19ef578c3ea0f5a94632acac">More...</a><br /></td></tr>
<tr class="separator:a8043b83d19ef578c3ea0f5a94632acac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f38d40cf5a65c11b588487c9d2eee00"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classos__once.html#a9f38d40cf5a65c11b588487c9d2eee00">IN_PROGRESS</a> = 1</td></tr>
<tr class="memdesc:a9f38d40cf5a65c11b588487c9d2eee00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Currently being executed by this or another thread.  <a href="#a9f38d40cf5a65c11b588487c9d2eee00">More...</a><br /></td></tr>
<tr class="separator:a9f38d40cf5a65c11b588487c9d2eee00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f150cffbcf350f47d698d836d5eea4d"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classos__once.html#a8f150cffbcf350f47d698d836d5eea4d">DONE</a> = 2</td></tr>
<tr class="memdesc:a8f150cffbcf350f47d698d836d5eea4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finished execution.  <a href="#a8f150cffbcf350f47d698d836d5eea4d">More...</a><br /></td></tr>
<tr class="separator:a8f150cffbcf350f47d698d836d5eea4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Execute a given function exactly once in a multi-threaded environment or wait for the function to be executed by another thread. </p>
<p>Example usage: First the user must create a control variable of type os_once::state_t and assign it os_once::NEVER_DONE. Then the user must pass this variable, together with a function to be executed to os_once::do_or_wait_for_done().</p>
<p>Multiple threads can call os_once::do_or_wait_for_done() simultaneously with the same (os_once::state_t) control variable. The provided function will be called exactly once and when os_once::do_or_wait_for_done() returns then this function has completed execution, by this or another thread. In other words os_once::do_or_wait_for_done() will either execute the provided function or will wait for its execution to complete if it is already called by another thread or will do nothing if the function has already completed its execution earlier.</p>
<p>This mimics pthread_once(3), but unfortunatelly pthread_once(3) does not support passing arguments to the init_routine() function. We should use std::call_once() when we start compiling with C++11 enabled. </p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a76b1ff71a045a72c666cc0654bec1fcb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76b1ff71a045a72c666cc0654bec1fcb">&#9670;&nbsp;</a></span>state_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef ib_uint32_t <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">os_once::state_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Control variables' state type. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ad8346530fd75a7f08c573c396eb78b6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8346530fd75a7f08c573c396eb78b6b">&#9670;&nbsp;</a></span>do_or_wait_for_done()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void os_once::do_or_wait_for_done </td>
          <td>(</td>
          <td class="paramtype">volatile <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void *)&#160;</td>
          <td class="paramname"><em>do_func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>do_func_arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Call a given function or wait its execution to complete if it is already called by another thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>control variable </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">do_func</td><td>function to call </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">do_func_arg</td><td>an argument to pass to do_func(). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a8f150cffbcf350f47d698d836d5eea4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f150cffbcf350f47d698d836d5eea4d">&#9670;&nbsp;</a></span>DONE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a> os_once::DONE = 2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Finished execution. </p>

</div>
</div>
<a id="a9f38d40cf5a65c11b588487c9d2eee00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f38d40cf5a65c11b588487c9d2eee00">&#9670;&nbsp;</a></span>IN_PROGRESS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a> os_once::IN_PROGRESS = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Currently being executed by this or another thread. </p>

</div>
</div>
<a id="a8043b83d19ef578c3ea0f5a94632acac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8043b83d19ef578c3ea0f5a94632acac">&#9670;&nbsp;</a></span>NEVER_DONE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classos__once.html#a76b1ff71a045a72c666cc0654bec1fcb">state_t</a> os_once::NEVER_DONE = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Not yet executed. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>storage/innobase/include/<a class="el" href="os0once_8h_source.html">os0once.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classos__once.html">os_once</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
