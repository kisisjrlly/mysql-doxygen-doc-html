<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: sql/mdl.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mdl_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mdl.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mdl_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifndef MDL_H</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#define MDL_H</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/* Copyright (c) 2009, 2020, Oracle and/or its affiliates.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">   This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">   it under the terms of the GNU General Public License, version 2.0,</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">   as published by the Free Software Foundation.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">   This program is also distributed with certain software (including</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">   but not limited to OpenSSL) that is licensed under separate terms,</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">   as designated in a particular file or component or in included license</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">   documentation.  The authors of MySQL hereby grant you an additional</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">   permission to link the program and your derivative works with the</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">   separately licensed software that they have included with MySQL.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">   This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">   GNU General Public License, version 2.0, for more details.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">   You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">   along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">   Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="string_8h.html">string.h</a>&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;new&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;unordered_map&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="m__string_8h.html">m_string.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="my__alloc_8h.html">my_alloc.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="my__compiler_8h.html">my_compiler.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="my__dbug_8h.html">my_dbug.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="my__inttypes_8h.html">my_inttypes.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="my__psi__config_8h.html">my_psi_config.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="my__sys_8h.html">my_sys.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="my__systime_8h.html">my_systime.h</a>&quot;</span>  <span class="comment">// Timout_type</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mysql__cond__bits_8h.html">mysql/components/services/mysql_cond_bits.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mysql__mutex__bits_8h.html">mysql/components/services/mysql_mutex_bits.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mysql__rwlock__bits_8h.html">mysql/components/services/mysql_rwlock_bits.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="psi__mdl__bits_8h.html">mysql/components/services/psi_mdl_bits.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="psi__stage__bits_8h.html">mysql/components/services/psi_stage_bits.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="psi_2mysql__rwlock_8h.html">mysql/psi/mysql_rwlock.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mysql__com_8h.html">mysql_com.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sql__plist_8h.html">sql/sql_plist.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="template__utils_8h.html">template_utils.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__context.html">MDL_context</a>;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__lock.html">MDL_lock</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__ticket.html">MDL_ticket</a>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">class </span><a class="code" href="classTHD.html">THD</a>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">struct </span><a class="code" href="structLF__PINS.html">LF_PINS</a>;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">struct </span><a class="code" href="structMDL__key.html">MDL_key</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">struct </span><a class="code" href="structMEM__ROOT.html">MEM_ROOT</a>;</div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="namespacemdl__unittest.html">   56</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacemdl__unittest.html">mdl_unittest</a> {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacemdl__unittest.html#aea02b0b10192df462ad24a7058f16ae1">test_drive_fix_pins</a>(<a class="code" href="classMDL__context.html">MDL_context</a> *);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}<span class="comment"></span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">  @def ENTER_COND(C, M, S, O)</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">  Start a wait on a condition.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">  @param C the condition to wait on</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">  @param M the associated mutex</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">  @param S the new stage to enter</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">  @param O the previous stage</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">  @sa EXIT_COND().</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="mdl_8h.html#a1ae771104888b978a2cba1f95995f67c">   68</a></span>&#160;<span class="preprocessor">#define ENTER_COND(C, M, S, O) \</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">  enter_cond(C, M, S, O, __func__, __FILE__, __LINE__)</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">  @def EXIT_COND(S)</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">  End a wait on a condition</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">  @param S the new stage to enter</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="mdl_8h.html#a582b3810a0711472ab0bf20db8c2a231">   76</a></span>&#160;<span class="preprocessor">#define EXIT_COND(S) exit_cond(S, __func__, __FILE__, __LINE__)</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">   An interface to separate the MDL module from the THD, and the rest of the</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">   server code.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="classMDL__context__owner.html">   83</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__context__owner.html">MDL_context_owner</a> {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="classMDL__context__owner.html#af1667fc1048ba40286d4d9dfee184b1d">   85</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="classMDL__context__owner.html#af1667fc1048ba40286d4d9dfee184b1d">~MDL_context_owner</a>() {}</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">    Enter a condition wait.</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">    For @c enter_cond() / @c exit_cond() to work the mutex must be held before</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">    @c enter_cond(); this mutex must then be released before @c exit_cond().</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">    Usage must be: lock mutex; enter_cond(); your code; unlock mutex;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">    exit_cond().</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">    @param cond the condition to wait on</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">    @param mutex the associated mutex</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">    @param [in] stage the stage to enter, or NULL</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">    @param [out] old_stage the previous stage, or NULL</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">    @param src_function function name of the caller</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">    @param src_file file name of the caller</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">    @param src_line line number of the caller</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">    @sa ENTER_COND(), THD::enter_cond()</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">    @sa EXIT_COND(), THD::exit_cond()</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> enter_cond(<a class="code" href="structmysql__cond__t.html">mysql_cond_t</a> *cond, <a class="code" href="structmysql__mutex__t.html">mysql_mutex_t</a> *<a class="code" href="memcached_8c.html#a4acff8232e4aec9cd5c6dc200ac55ef3">mutex</a>,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                          <span class="keyword">const</span> <a class="code" href="structPSI__stage__info__v1.html">PSI_stage_info</a> *stage,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                          <a class="code" href="structPSI__stage__info__v1.html">PSI_stage_info</a> *old_stage, <span class="keyword">const</span> <span class="keywordtype">char</span> *src_function,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">char</span> *src_file, <span class="keywordtype">int</span> src_line) = 0;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">    End a wait on a condition</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">    @param [in] stage the new stage to enter</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">    @param src_function function name of the caller</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">    @param src_file file name of the caller</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">    @param src_line line number of the caller</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">    @sa ENTER_COND(), THD::enter_cond()</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">    @sa EXIT_COND(), THD::exit_cond()</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> exit_cond(<span class="keyword">const</span> <a class="code" href="structPSI__stage__info__v1.html">PSI_stage_info</a> *stage, <span class="keyword">const</span> <span class="keywordtype">char</span> *src_function,</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                         <span class="keyword">const</span> <span class="keywordtype">char</span> *src_file, <span class="keywordtype">int</span> src_line) = 0;<span class="comment"></span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">     Has the owner thread been killed?</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">int</span> is_killed() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">    Does the owner still have connection to the client?</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="node__connection_8h.html#ac81c8c488b37932224b37520e063ea83">is_connected</a>() = 0;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">     Within MDL subsystem this one is only used for DEBUG_SYNC.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">     Do not use it to peek/poke into other parts of THD from MDL.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">     However it is OK to use this method in callbacks provided</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">     by SQL-layer to MDL subsystem (since SQL-layer has full</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">     access to THD anyway).</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">     @warning For some derived classes implementation of this method</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">              can return nullptr. Calling side must be ready to handle</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">              this case.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keyword">virtual</span> <a class="code" href="classTHD.html">THD</a> *get_thd() = 0;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">     @see THD::notify_shared_lock()</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> notify_shared_lock(<a class="code" href="classMDL__context__owner.html">MDL_context_owner</a> *in_use,</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                                  <span class="keywordtype">bool</span> needs_thr_lock_abort) = 0;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">    Notify/get permission from interested storage engines before acquiring</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">    exclusive lock for the key.</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">    The returned argument &#39;victimized&#39; specify reason for lock</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">    not granted. If &#39;true&#39;, lock was refused in an attempt to</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">    resolve a possible MDL-&gt;GSL deadlock. Locking may then be retried.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">    @return False if notification was successful and it is OK to acquire lock,</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">            True if one of SEs asks to abort lock acquisition.</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> notify_hton_pre_acquire_exclusive(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *mdl_key,</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                                                 <span class="keywordtype">bool</span> *victimized) = 0;<span class="comment"></span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">    Notify interested storage engines that we have just released exclusive</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">    lock for the key.</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> notify_hton_post_release_exclusive(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *mdl_key) = 0;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">    Get random seed specific to this THD to be used for initialization</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">    of PRNG for the MDL_context.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keyword">virtual</span> <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> get_rand_seed() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;};</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">  Type of metadata lock request.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">  @sa Comments for MDL_object_lock::can_grant_lock() and</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">      MDL_scoped_lock::can_grant_lock() for details.</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">  181</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">    An intention exclusive metadata lock. Used only for scoped locks.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">    Owner of this type of lock can acquire upgradable exclusive locks on</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">    individual objects.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">    This lock type is also used when doing lookups in the dictionary</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">    cache. When acquiring objects in a schema, we lock the schema with IX</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">    to prevent the schema from being deleted. This should conceptually</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">    be an IS lock, but it would have the same behavior as the current IX.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">    Compatible with other IX locks, but is incompatible with scoped S and</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">    X locks.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbae221f959e09d9dce2ac169f2d8bf33c6">  193</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbae221f959e09d9dce2ac169f2d8bf33c6">MDL_INTENTION_EXCLUSIVE</a> = 0,</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">    A shared metadata lock.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">    To be used in cases when we are interested in object metadata only</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">    and there is no intention to access object data (e.g. for stored</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">    routines or during preparing prepared statements).</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">    We also mis-use this type of lock for open HANDLERs, since lock</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">    acquired by this statement has to be compatible with lock acquired</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">    by LOCK TABLES ... WRITE statement, i.e. SNRW (We can&#39;t get by by</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">    acquiring S lock at HANDLER ... OPEN time and upgrading it to SR</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">    lock for HANDLER ... READ as it doesn&#39;t solve problem with need</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">    to abort DML statements which wait on table level lock while having</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">    open HANDLER in the same connection).</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">    To avoid deadlock which may occur when SNRW lock is being upgraded to</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">    X lock for table on which there is an active S lock which is owned by</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">    thread which waits in its turn for table-level lock owned by thread</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">    performing upgrade we have to use thr_abort_locks_for_thread()</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">    facility in such situation.</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">    This problem does not arise for locks on stored routines as we don&#39;t</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">    use SNRW locks for them. It also does not arise when S locks are used</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">    during PREPARE calls as table-level locks are not acquired in this</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">    case.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba0d978e40251b54054c3385529888387e">  216</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba0d978e40251b54054c3385529888387e">MDL_SHARED</a>,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">    A high priority shared metadata lock.</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">    Used for cases when there is no intention to access object data (i.e.</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">    data in the table).</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">    &quot;High priority&quot; means that, unlike other shared locks, it is granted</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">    ignoring pending requests for exclusive locks. Intended for use in</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">    cases when we only need to access metadata and not data, e.g. when</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">    filling an INFORMATION_SCHEMA table.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">    Since SH lock is compatible with SNRW lock, the connection that</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">    holds SH lock lock should not try to acquire any kind of table-level</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">    or row-level lock, as this can lead to a deadlock. Moreover, after</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">    acquiring SH lock, the connection should not wait for any other</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">    resource, as it might cause starvation for X locks and a potential</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">    deadlock during upgrade of SNW or SNRW to X lock (e.g. if the</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">    upgrading connection holds the resource that is being waited for).</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba4288d5afcff407e0f93a104141908442">  233</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba4288d5afcff407e0f93a104141908442">MDL_SHARED_HIGH_PRIO</a>,</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">    A shared metadata lock for cases when there is an intention to read data</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">    from table.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">    A connection holding this kind of lock can read table metadata and read</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">    table data (after acquiring appropriate table and row-level locks).</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">    This means that one can only acquire TL_READ, TL_READ_NO_INSERT, and</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">    similar table-level locks on table if one holds SR MDL lock on it.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">    To be used for tables in SELECTs, subqueries, and LOCK TABLE ...  READ</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">    statements.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbaab91717490fbe232e51005daa348ce4a">  244</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbaab91717490fbe232e51005daa348ce4a">MDL_SHARED_READ</a>,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">    A shared metadata lock for cases when there is an intention to modify</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">    (and not just read) data in the table.</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">    A connection holding SW lock can read table metadata and modify or read</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">    table data (after acquiring appropriate table and row-level locks).</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">    To be used for tables to be modified by INSERT, UPDATE, DELETE</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">    statements, but not LOCK TABLE ... WRITE or DDL). Also taken by</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">    SELECT ... FOR UPDATE.</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba00b10bf62b23e3af95e304378f46b21d">  254</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba00b10bf62b23e3af95e304378f46b21d">MDL_SHARED_WRITE</a>,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">    A version of MDL_SHARED_WRITE lock which has lower priority than</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">    MDL_SHARED_READ_ONLY locks. Used by DML statements modifying</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">    tables and using the LOW_PRIORITY clause.</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba81e412dfaef917fa454e800c21909149">  260</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba81e412dfaef917fa454e800c21909149">MDL_SHARED_WRITE_LOW_PRIO</a>,</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">    An upgradable shared metadata lock which allows concurrent updates and</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">    reads of table data.</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">    A connection holding this kind of lock can read table metadata and read</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">    table data. It should not modify data as this lock is compatible with</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">    SRO locks.</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">    Can be upgraded to SNW, SNRW and X locks. Once SU lock is upgraded to X</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">    or SNRW lock data modification can happen freely.</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">    To be used for the first phase of ALTER TABLE.</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba2be0df3ea6e3cc01a90bf1a2a1cb56c7">  271</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba2be0df3ea6e3cc01a90bf1a2a1cb56c7">MDL_SHARED_UPGRADABLE</a>,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">    A shared metadata lock for cases when we need to read data from table</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">    and block all concurrent modifications to it (for both data and metadata).</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">    Used by LOCK TABLES READ statement.</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba3f7dc90d30f753a5b96bfb365db37fa5">  277</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba3f7dc90d30f753a5b96bfb365db37fa5">MDL_SHARED_READ_ONLY</a>,</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">    An upgradable shared metadata lock which blocks all attempts to update</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">    table data, allowing reads.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">    A connection holding this kind of lock can read table metadata and read</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">    table data.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">    Can be upgraded to X metadata lock.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">    Note, that since this type of lock is not compatible with SNRW or SW</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">    lock types, acquiring appropriate engine-level locks for reading</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">    (TL_READ* for MyISAM, shared row locks in InnoDB) should be</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">    contention-free.</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">    To be used for the first phase of ALTER TABLE, when copying data between</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">    tables, to allow concurrent SELECTs from the table, but not UPDATEs.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba625286b5c7930c17c05fea3ffef0c1da">  291</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba625286b5c7930c17c05fea3ffef0c1da">MDL_SHARED_NO_WRITE</a>,</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">    An upgradable shared metadata lock which allows other connections</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">    to access table metadata, but not data.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">    It blocks all attempts to read or update table data, while allowing</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">    INFORMATION_SCHEMA and SHOW queries.</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">    A connection holding this kind of lock can read table metadata modify and</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">    read table data.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">    Can be upgraded to X metadata lock.</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">    To be used for LOCK TABLES WRITE statement.</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">    Not compatible with any other lock type except S and SH.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba7f4c8af6f7028729d507769697e1d74b">  303</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba7f4c8af6f7028729d507769697e1d74b">MDL_SHARED_NO_READ_WRITE</a>,</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">    An exclusive metadata lock.</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">    A connection holding this lock can modify both table&#39;s metadata and data.</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">    No other type of metadata lock can be granted while this lock is held.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">    To be used for CREATE/DROP/RENAME TABLE statements and for execution of</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">    certain phases of other DDL statements.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbac314c015883c75ddcbdad3ceccd0bb73">  311</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbac314c015883c75ddcbdad3ceccd0bb73">MDL_EXCLUSIVE</a>,</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">/* This should be the last !!! */</span></div><div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbab7a8d987a0c31983ba38d4f36ab91129">  313</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbab7a8d987a0c31983ba38d4f36ab91129">MDL_TYPE_END</a></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;};</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">/** Duration of metadata lock. */</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">  318</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> {<span class="comment"></span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">    Locks with statement duration are automatically released at the end</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">    of statement or transaction.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00323"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da675d77e333e224c13925f152d698ca14">  323</a></span>&#160;  <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da675d77e333e224c13925f152d698ca14">MDL_STATEMENT</a> = 0,<span class="comment"></span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">    Locks with transaction duration are automatically released at the end</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">    of transaction.</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da410364f4efe7a5b36f7be90f62c12fe9">  328</a></span>&#160;  <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da410364f4efe7a5b36f7be90f62c12fe9">MDL_TRANSACTION</a>,<span class="comment"></span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">    Locks with explicit duration survive the end of statement and transaction.</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">    They have to be released explicitly by calling MDL_context::release_lock().</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9679cdf9bf84fde07db17025ab004ab4">  333</a></span>&#160;  <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9679cdf9bf84fde07db17025ab004ab4">MDL_EXPLICIT</a>,</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">/* This should be the last ! */</span></div><div class="line"><a name="l00335"></a><span class="lineno"><a class="line" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9f14cfff6379a5bcfdbf708c571feeef">  335</a></span>&#160;  <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9f14cfff6379a5bcfdbf708c571feeef">MDL_DURATION_END</a></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;};</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">/** Maximal length of key for metadata locking subsystem. */</span></div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">  339</a></span>&#160;<span class="preprocessor">#define MAX_MDLKEY_LENGTH (1 + NAME_LEN + 1 + NAME_LEN + 1)</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">  Metadata lock object key.</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">  A lock is requested or granted based on a fully qualified name and type.</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">  E.g. They key for a table consists of @&lt;0 (=table)@&gt;+@&lt;database@&gt;+@&lt;table</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">  name@&gt;. Elsewhere in the comments this triple will be referred to simply as</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">  &quot;key&quot; or &quot;name&quot;.</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="structMDL__key.html">  350</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structMDL__key.html">MDL_key</a> {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">#ifdef HAVE_PSI_INTERFACE</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="socket__connection_8cc.html#aa02c478707f6f10d071c3ec485ba7cb9">init_psi_keys</a>();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">    Object namespaces.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">    Sic: when adding a new member to this enum make sure to</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">    update m_namespace_to_wait_state_name array in mdl.cc!</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">    Different types of objects exist in different namespaces</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">     - GLOBAL is used for the global read lock.</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">     - BACKUP_LOCK is to block any operations that could cause</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">       inconsistent backup. Such operations are most DDL statements,</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">       and some administrative statements.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">     - TABLESPACE is for tablespaces.</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">     - SCHEMA is for schemas (aka databases).</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">     - TABLE is for tables and views.</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">     - FUNCTION is for stored functions.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">     - PROCEDURE is for stored procedures.</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">     - TRIGGER is for triggers.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">     - EVENT is for event scheduler events.</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">     - COMMIT is for enabling the global read lock to block commits.</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">     - USER_LEVEL_LOCK is for user-level locks.</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">     - LOCKING_SERVICE is for the name plugin RW-lock service</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">     - SRID is for spatial reference systems</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">     - ACL_CACHE is for ACL caches</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">     - COLUMN_STATISTICS is for column statistics, such as histograms</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">     - RESOURCE_GROUPS is for resource groups.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">     - FOREIGN_KEY is for foreign key names.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">     - CHECK_CONSTRAINT is for check constraint names.</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">    Note that requests waiting for user-level locks get special</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">    treatment - waiting is aborted if connection to client is lost.</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">  385</a></span>&#160;  <span class="keyword">enum</span> <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">enum_mdl_namespace</a> {</div><div class="line"><a name="l00386"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba1f750c65584b50cc9e8f8f2774c4c724">  386</a></span>&#160;    <a class="code" href="system__variable__source__type_8h.html#a67d92d73cedea4ef0fb6d7457e8cd7c0afde1bb5ef04b28059e61df449501f1c0">GLOBAL</a> = 0,</div><div class="line"><a name="l00387"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba0905d47dab5686782d127c119b855e58">  387</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba0905d47dab5686782d127c119b855e58">BACKUP_LOCK</a>,</div><div class="line"><a name="l00388"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3bae24cd124a1f2be1554d932ad06740c70">  388</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3bae24cd124a1f2be1554d932ad06740c70">TABLESPACE</a>,</div><div class="line"><a name="l00389"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba5de8105a5b1406f2788096b0044ed269">  389</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba5de8105a5b1406f2788096b0044ed269">SCHEMA</a>,</div><div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baec5c041db4f492536a66b079fc5ceaaa">  390</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baec5c041db4f492536a66b079fc5ceaaa">TABLE</a>,</div><div class="line"><a name="l00391"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba767899e9782aa506f61957d82781abd2">  391</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba767899e9782aa506f61957d82781abd2">FUNCTION</a>,</div><div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baac972459c46835d6d698ba1b5e16d9ac">  392</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baac972459c46835d6d698ba1b5e16d9ac">PROCEDURE</a>,</div><div class="line"><a name="l00393"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba87fa3eac99e78ce63bbadf552a6456b1">  393</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba87fa3eac99e78ce63bbadf552a6456b1">TRIGGER</a>,</div><div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba111e1a1778189d883d78cf2f747099b2">  394</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba111e1a1778189d883d78cf2f747099b2">EVENT</a>,</div><div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba4f789972af09de8649e3b2a2e0ff0d7a">  395</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba4f789972af09de8649e3b2a2e0ff0d7a">COMMIT</a>,</div><div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba27968b8eb4c5885673c044279eddfa9d">  396</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba27968b8eb4c5885673c044279eddfa9d">USER_LEVEL_LOCK</a>,</div><div class="line"><a name="l00397"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba25b17557203e1a4f16207513ef08f89b">  397</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba25b17557203e1a4f16207513ef08f89b">LOCKING_SERVICE</a>,</div><div class="line"><a name="l00398"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baa803317d088b4287ee5eee2f5e745705">  398</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baa803317d088b4287ee5eee2f5e745705">SRID</a>,</div><div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba8a1977cedcb3056c1b44c58a54cd2a32">  399</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba8a1977cedcb3056c1b44c58a54cd2a32">ACL_CACHE</a>,</div><div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba35038f0ecbeea1d4b900bcb6a2e9e811">  400</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba35038f0ecbeea1d4b900bcb6a2e9e811">COLUMN_STATISTICS</a>,</div><div class="line"><a name="l00401"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba56f7ee9d3dc0ea534d4538cf050ec49d">  401</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba56f7ee9d3dc0ea534d4538cf050ec49d">RESOURCE_GROUPS</a>,</div><div class="line"><a name="l00402"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baa6d0d9679075d600212dea21179317e4">  402</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baa6d0d9679075d600212dea21179317e4">FOREIGN_KEY</a>,</div><div class="line"><a name="l00403"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baf2e116eb16927e1a154c8ca811496293">  403</a></span>&#160;    <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baf2e116eb16927e1a154c8ca811496293">CHECK_CONSTRAINT</a>,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">/* This should be the last ! */</span></div><div class="line"><a name="l00405"></a><span class="lineno"><a class="line" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba6ef71abfcc223a301add24ef28947831">  405</a></span>&#160;    NAMESPACE_END</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  };</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno"><a class="line" href="structMDL__key.html#a1b08a07c4e9650a662feabb466507404">  408</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="my__inttypes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="code" href="structMDL__key.html#a1b08a07c4e9650a662feabb466507404">ptr</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="template__utils_8h.html#abaa3204566f2da1d5876a24eb4f0e5cd">pointer_cast</a>&lt;<span class="keyword">const</span> <a class="code" href="my__inttypes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&gt;(m_ptr); }</div><div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="structMDL__key.html#a5f901f5163e7887d1e482241e4813f9e">  409</a></span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="code" href="structMDL__key.html#a5f901f5163e7887d1e482241e4813f9e">length</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_length; }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="structMDL__key.html#a6d996da020bfc9851710b4ca44f30d51">  411</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structMDL__key.html#a6d996da020bfc9851710b4ca44f30d51">db_name</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_ptr + 1; }</div><div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="structMDL__key.html#a15208204dd28afcfc756941b368b236a">  412</a></span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="code" href="structMDL__key.html#a15208204dd28afcfc756941b368b236a">db_name_length</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_db_name_length; }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno"><a class="line" href="structMDL__key.html#adf33ece720f68e35f1439813694297e4">  414</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structMDL__key.html#adf33ece720f68e35f1439813694297e4">name</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">return</span> (use_normalized_object_name() ? m_ptr + m_length</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                                         : m_ptr + m_db_name_length + 2);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  }</div><div class="line"><a name="l00418"></a><span class="lineno"><a class="line" href="structMDL__key.html#a192c557333fbba426a4bc31eb59e084e">  418</a></span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="code" href="structMDL__key.html#a192c557333fbba426a4bc31eb59e084e">name_length</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_object_name_length; }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="structMDL__key.html#a36785e32ba57b9150984ba23f714d7ab">  420</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structMDL__key.html#a36785e32ba57b9150984ba23f714d7ab">col_name</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(!use_normalized_object_name());</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span> (m_db_name_length + m_object_name_length + 3 &lt; m_length) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="comment">/* A column name was stored in the key buffer. */</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">return</span> m_ptr + m_db_name_length + m_object_name_length + 3;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">/* No column name stored. */</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="structMDL__key.html#a9986ed7c9c3c0b887bdfb39d99a145e3">  432</a></span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="code" href="structMDL__key.html#a9986ed7c9c3c0b887bdfb39d99a145e3">col_name_length</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(!use_normalized_object_name());</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span> (m_db_name_length + m_object_name_length + 3 &lt; m_length) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="comment">/* A column name was stored in the key buffer. */</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">return</span> m_length - m_db_name_length - m_object_name_length - 4;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">/* No column name stored. */</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="structMDL__key.html#a3c7ad7b46384b15803aa0b77b3bd52f6">  444</a></span>&#160;  <a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">enum_mdl_namespace</a> <a class="code" href="structMDL__key.html#a3c7ad7b46384b15803aa0b77b3bd52f6">mdl_namespace</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">enum_mdl_namespace</a>)(m_ptr[0]);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">    Construct a metadata lock key from a triplet (mdl_namespace,</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">    database and name).</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">    @remark The key for a table is @&lt;mdl_namespace@&gt;+@&lt;database name@&gt;+@&lt;table</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">    name@&gt;</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">    @param  mdl_namespace Id of namespace of object to be locked</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">    @param  db            Name of database to which the object belongs</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">    @param  name          Name of of the object</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00459"></a><span class="lineno"><a class="line" href="structMDL__key.html#a3815fd610e5670602ecffd82b695d1e7">  459</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structMDL__key.html#a3815fd610e5670602ecffd82b695d1e7">mdl_key_init</a>(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">enum_mdl_namespace</a> mdl_namespace, <span class="keyword">const</span> <span class="keywordtype">char</span> *db,</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="sslopt-case_8h.html#ae00b773898ac853cec38cdf7a08b8e89">name</a>) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    m_ptr[0] = (char)mdl_namespace;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(!use_normalized_object_name());</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">      It is responsibility of caller to ensure that db and object names</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">      are not longer than NAME_LEN. Still we play safe and try to avoid</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">      buffer overruns.</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">      Implicit tablespace names in InnoDB may be longer than NAME_LEN.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">      We will lock based on the first NAME_LEN characters.</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">      TODO: The patch acquires metadata locks on the NAME_LEN</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">            first bytest of the tablespace names. For long names,</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">            the consequence of locking on this prefix is</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">            that locking a single implicit tablespace might end up</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">            effectively lock all implicit tablespaces in the same</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">            schema. A possible fix is to lock on a prefix of length</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">            NAME_LEN * 2, since this is the real buffer size of</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">            the metadata lock key. Dependencies from the PFS</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">            implementation, possibly relying on the key format,</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">            must be investigated first, though.</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(strlen(db) &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>((mdl_namespace == TABLESPACE) || (strlen(name) &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>));</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    m_db_name_length =</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(<a class="code" href="m__string_8h.html#accb13dc1bbc754b77a9ecd9c3e832595">strmake</a>(m_ptr + 1, db, <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>) - m_ptr - 1);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    m_object_name_length = <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <a class="code" href="m__string_8h.html#accb13dc1bbc754b77a9ecd9c3e832595">strmake</a>(m_ptr + m_db_name_length + 2, name, <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>) - m_ptr -</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        m_db_name_length - 2);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    m_length = m_db_name_length + m_object_name_length + 3;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  }</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">    Construct a metadata lock key from a quadruplet (mdl_namespace,</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">    database, table and column name).</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">    @remark The key for a column is</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">      @&lt;mdl_namespace@&gt;+@&lt;database name@&gt;+@&lt;table name@&gt;+@&lt;column name@&gt;</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">    @param  mdl_namespace Id of namespace of object to be locked</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">    @param  db            Name of database to which the object belongs</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">    @param  name          Name of of the object</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">    @param  column_name   Name of of the column</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="structMDL__key.html#aca5b38f1f41d1d99e86f8cd92b0cc838">  506</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structMDL__key.html#aca5b38f1f41d1d99e86f8cd92b0cc838">mdl_key_init</a>(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">enum_mdl_namespace</a> mdl_namespace, <span class="keyword">const</span> <span class="keywordtype">char</span> *db,</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="sslopt-case_8h.html#ae00b773898ac853cec38cdf7a08b8e89">name</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *column_name) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    m_ptr[0] = (char)mdl_namespace;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="http__auth__backend__plugin_8cc.html#aee70c8416f705726100824ba89f1e090">start</a>;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="namespacerules__table__service.html#a71d6ca457fe4ae5d5151f92c06cc3fd3">end</a>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(!use_normalized_object_name());</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(strlen(db) &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    start = m_ptr + 1;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    end = <a class="code" href="m__string_8h.html#accb13dc1bbc754b77a9ecd9c3e832595">strmake</a>(start, db, <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    m_db_name_length = <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(end - <a class="code" href="http__auth__backend__plugin_8cc.html#aee70c8416f705726100824ba89f1e090">start</a>);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(strlen(name) &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    start = end + 1;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    end = <a class="code" href="m__string_8h.html#accb13dc1bbc754b77a9ecd9c3e832595">strmake</a>(start, name, <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    m_object_name_length = <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(end - <a class="code" href="http__auth__backend__plugin_8cc.html#aee70c8416f705726100824ba89f1e090">start</a>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordtype">size_t</span> col_len = strlen(column_name);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(col_len &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    start = end + 1;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordtype">size_t</span> remaining =</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <a class="code" href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">MAX_MDLKEY_LENGTH</a> - m_db_name_length - m_object_name_length - 3;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a> extra_length = 0;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">      In theory:</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">      - schema name is up to NAME_LEN characters</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">      - object name is up to NAME_LEN characters</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">      - column name is up to NAME_LEN characters</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">      - NAME_LEN is 64 characters</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">      - 1 character is up to 3 bytes (UTF8MB3),</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">        and when moving to UTF8MB4, up to 4 bytes.</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">      - Storing a SCHEMA + OBJECT MDL key</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">        can take up to 387 bytes</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">      - Storing a SCHEMA + OBJECT + COLUMN MDL key</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">        can take up to 580 bytes.</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">      In practice:</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">      - full storage is allocated for SCHEMA + OBJECT only,</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">        storage for COLUMN is **NOT** reserved.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">      - SCHEMA and OBJECT names are typically shorter,</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">        and are not using systematically multi-bytes characters</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">        for each character, so that less space is required.</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">      - MDL keys that are not COLUMN_STATISTICS</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">        are stored in full, without truncation.</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">      For the COLUMN_STATISTICS name space:</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">      - either the full SCHEMA + OBJECT + COLUMN key fits</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">        within 387 bytes, in which case the fully qualified</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">        column name is stored,</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">        leading to MDL locks per column (as intended)</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">      - or the SCHEMA and OBJECT names are very long,</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">        so that not enough room is left to store a column name,</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">        in which case the MDL key is truncated to be</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">        COLUMN_STATISTICS + SCHEMA + NAME.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">        In this case, MDL locks for columns col_X and col_Y</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">        in table LONG_FOO.LONG_BAR will both share the same</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">        key LONG_FOO.LONG_BAR, in effect providing a lock</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">        granularity not per column but per table.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">        This is a degraded mode of operation,</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">        which serializes MDL access to columns</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">        (for tables with a very long fully qualified name),</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">        to reduce the memory footprint for all MDL access.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">      To be revised if the MDL key buffer is allocated dynamically</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">      instead.</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    static_assert(<a class="code" href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">MAX_MDLKEY_LENGTH</a> == 387, <span class="stringliteral">&quot;UTF8MB3&quot;</span>);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">      Check if there is room to store the whole column name.</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">      This code is not trying to store truncated column names,</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">      to avoid cutting column_name in the middle of a</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">      multi-byte character.</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">if</span> (remaining &gt;= col_len + 1) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      end = <a class="code" href="m__string_8h.html#accb13dc1bbc754b77a9ecd9c3e832595">strmake</a>(start, column_name, remaining);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      extra_length = <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(end - <a class="code" href="http__auth__backend__plugin_8cc.html#aee70c8416f705726100824ba89f1e090">start</a>) + 1;  <span class="comment">// With \0</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    m_length = m_db_name_length + m_object_name_length + 3 + extra_length;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(m_length &lt;= <a class="code" href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">MAX_MDLKEY_LENGTH</a>);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">    Construct a metadata lock key from a quadruplet (mdl_namespace, database,</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">    normalized object name buffer and the object name).</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">    @remark The key for a routine/event/resource group/trigger is</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">      @&lt;mdl_namespace@&gt;+@&lt;database name@&gt;+@&lt;normalized object name@&gt;</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">      additionaly @&lt;object name@&gt; is stored in the same buffer for information</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">      purpose if buffer has sufficent space.</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">    Routine, Event and Resource group names are case sensitive and accent</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">    sensitive. So normalized object name is used to form a MDL_key.</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">    With the UTF8MB3 charset space reserved for the db name/object name is</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">    64 * 3  bytes. utf8_general_ci collation is used for the Routine, Event and</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">    Resource group names. With this collation, the normalized object name uses</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">    just 2 bytes for each character (max length = 64 * 2 bytes). MDL_key has</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">    still some space to store the object names. If there is a sufficient space</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">    for the object name in the MDL_key then it is stored in the MDL_key (similar</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">    to the column names in the MDL_key). Actual object name is used by the PFS.</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">    Not listing actual object name from the PFS should be OK when there is no</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">    space to store it (instead of increasing the MDL_key size). Object name is</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">    not used in the key comparisons. So only (mdl_namespace + strlen(db) + 1 +</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">    normalized_name_len + 1) value is stored in the m_length member.</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">    @param  mdl_namespace       Id of namespace of object to be locked.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">    @param  db                  Name of database to which the object belongs.</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">    @param  normalized_name     Normalized name of the object.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">    @param  normalized_name_len Length of the normalized object name.</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">    @param  name                Name of the object.</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00621"></a><span class="lineno"><a class="line" href="structMDL__key.html#a46f0e8182ff6b75d2331e3bb4c359b01">  621</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structMDL__key.html#a46f0e8182ff6b75d2331e3bb4c359b01">mdl_key_init</a>(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">enum_mdl_namespace</a> mdl_namespace, <span class="keyword">const</span> <span class="keywordtype">char</span> *db,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">char</span> *normalized_name, <span class="keywordtype">size_t</span> normalized_name_len,</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="sslopt-case_8h.html#ae00b773898ac853cec38cdf7a08b8e89">name</a>) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    m_ptr[0] = (char)mdl_namespace;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">      FUNCTION, PROCEDURE, EVENT and RESOURCE_GROUPS names are case and accent</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">      insensitive. For other objects key should not be formed from this method.</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(use_normalized_object_name());</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(strlen(db) &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a> &amp;&amp; strlen(name) &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a> &amp;&amp;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                normalized_name_len &lt;= <a class="code" href="mysql__com_8h.html#a891948a8c3b63220ac0428a8982b0810">NAME_CHAR_LEN</a> * 2);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">// Database name.</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    m_db_name_length =</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(<a class="code" href="m__string_8h.html#accb13dc1bbc754b77a9ecd9c3e832595">strmake</a>(m_ptr + 1, db, <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>) - m_ptr - 1);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">// Normalized object name.</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    m_length = <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(m_db_name_length + normalized_name_len + 3);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    memcpy(m_ptr + m_db_name_length + 2, normalized_name, normalized_name_len);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    *(m_ptr + m_length - 1) = 0;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">      Copy name of the object if there is a sufficient space to store the name</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">      in the MDL key. This code is not trying to store truncated object names,</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">      to avoid cutting object_name in the middle of a multi-byte character.</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">if</span> (strlen(name) &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(<a class="code" href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">MAX_MDLKEY_LENGTH</a> - m_length)) {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      m_object_name_length = <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          (<a class="code" href="m__string_8h.html#accb13dc1bbc754b77a9ecd9c3e832595">strmake</a>(m_ptr + m_length, name, <a class="code" href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">MAX_MDLKEY_LENGTH</a> - m_length - 1) -</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;           m_ptr - m_length));</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      m_object_name_length = 0;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      *(m_ptr + m_length) = 0;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(m_length + m_object_name_length &lt; <a class="code" href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">MAX_MDLKEY_LENGTH</a>);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">    Construct a metadata lock key from namespace and partial key, which</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">    contains info about object database and name.</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">    @remark The partial key must be &quot;&lt;database&gt;\0&lt;name&gt;\0&quot;.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">    @param  mdl_namespace   Id of namespace of object to be locked</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">    @param  part_key        Partial key.</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">    @param  part_key_length Partial key length</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">    @param  db_length       Database name length.</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00672"></a><span class="lineno"><a class="line" href="structMDL__key.html#a9c8cd488f84b3b9b530217cba55217e0">  672</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structMDL__key.html#a9c8cd488f84b3b9b530217cba55217e0">mdl_key_init</a>(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">enum_mdl_namespace</a> mdl_namespace, <span class="keyword">const</span> <span class="keywordtype">char</span> *part_key,</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                    <span class="keywordtype">size_t</span> part_key_length, <span class="keywordtype">size_t</span> db_length) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">      Key suffix provided should be in compatible format and</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">      its components should adhere to length restrictions.</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(strlen(part_key) == db_length);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(db_length + 1 + strlen(part_key + db_length + 1) + 1 ==</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                part_key_length);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(db_length &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a>);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(part_key_length &lt;= <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a> + 1 + <a class="code" href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a> + 1);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    m_ptr[0] = (char)mdl_namespace;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">      Partial key of objects with normalized object name can not be used to</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">      initialize MDL key.</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(!use_normalized_object_name());</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    memcpy(m_ptr + 1, part_key, part_key_length);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    m_length = <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(part_key_length + 1);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    m_db_name_length = <span class="keyword">static_cast&lt;</span><a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a><span class="keyword">&gt;</span>(db_length);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    m_object_name_length = m_length - m_db_name_length - 3;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  }</div><div class="line"><a name="l00696"></a><span class="lineno"><a class="line" href="structMDL__key.html#a409fb8b6038ac18165d3d291373c0319">  696</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structMDL__key.html#a409fb8b6038ac18165d3d291373c0319">mdl_key_init</a>(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *rhs) {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a> copy_length = rhs-&gt;<a class="code" href="structMDL__key.html#adf7c11832f60c947a13056463cf22c3f">use_normalized_object_name</a>()</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                             ? rhs-&gt;<a class="code" href="structMDL__key.html#a5766c840ba81340f39de04e4dfccfcba">m_length</a> + rhs-&gt;<a class="code" href="structMDL__key.html#ac999815f3e2a14c7e385b27aa14ed020">m_object_name_length</a> + 1</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                             : rhs-&gt;<a class="code" href="structMDL__key.html#a5766c840ba81340f39de04e4dfccfcba">m_length</a>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    memcpy(m_ptr, rhs-&gt;<a class="code" href="structMDL__key.html#a632b8c5c857c7316d805f2678cb9bfe4">m_ptr</a>, copy_length);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    m_length = rhs-&gt;<a class="code" href="structMDL__key.html#a5766c840ba81340f39de04e4dfccfcba">m_length</a>;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    m_db_name_length = rhs-&gt;<a class="code" href="structMDL__key.html#a0ae1f63ddb11b34750db21379eb7ca38">m_db_name_length</a>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    m_object_name_length = rhs-&gt;<a class="code" href="structMDL__key.html#ac999815f3e2a14c7e385b27aa14ed020">m_object_name_length</a>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  }</div><div class="line"><a name="l00705"></a><span class="lineno"><a class="line" href="structMDL__key.html#a9f5a9fa542651ab35c4f9ee4f99846ee">  705</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structMDL__key.html#a9f5a9fa542651ab35c4f9ee4f99846ee">reset</a>() {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    m_ptr[0] = NAMESPACE_END;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    m_db_name_length = 0;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    m_object_name_length = 0;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    m_length = 0;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  }</div><div class="line"><a name="l00711"></a><span class="lineno"><a class="line" href="structMDL__key.html#a213166cb4050445cbe7353448ef5d578">  711</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structMDL__key.html#a213166cb4050445cbe7353448ef5d578">is_equal</a>(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *rhs)<span class="keyword"> const </span>{</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">return</span> (m_length == rhs-&gt;<a class="code" href="structMDL__key.html#a5766c840ba81340f39de04e4dfccfcba">m_length</a> &amp;&amp;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            memcmp(m_ptr, rhs-&gt;<a class="code" href="structMDL__key.html#a632b8c5c857c7316d805f2678cb9bfe4">m_ptr</a>, m_length) == 0);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  }<span class="comment"></span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">    Compare two MDL keys lexicographically.</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00718"></a><span class="lineno"><a class="line" href="structMDL__key.html#a0fd5e296b28b81a930cd59df5f23df59">  718</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structMDL__key.html#a0fd5e296b28b81a930cd59df5f23df59">cmp</a>(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *rhs)<span class="keyword"> const </span>{</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">      For the keys with the normalized names, there is a possibility of getting</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">      &#39;\0&#39; in its middle. So only key content comparison would yield incorrect</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">      result. Hence comparing key length too when keys are equal.</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">      For other keys, key buffer is always &#39;\0&#39;-terminated. Since key character</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">      set is utf-8, we can safely assume that no character starts with a zero</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">      byte.</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordtype">int</span> res = memcmp(m_ptr, rhs-&gt;<a class="code" href="structMDL__key.html#a632b8c5c857c7316d805f2678cb9bfe4">m_ptr</a>, std::min(m_length, rhs-&gt;<a class="code" href="structMDL__key.html#a5766c840ba81340f39de04e4dfccfcba">m_length</a>));</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">if</span> (res == 0) res = m_length - rhs-&gt;<a class="code" href="structMDL__key.html#a5766c840ba81340f39de04e4dfccfcba">m_length</a>;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno"><a class="line" href="structMDL__key.html#a15c625aec6b2dae280b30f506129da9d">  732</a></span>&#160;  <a class="code" href="structMDL__key.html#a15c625aec6b2dae280b30f506129da9d">MDL_key</a>(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> &amp;rhs) { mdl_key_init(&amp;rhs); }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno"><a class="line" href="structMDL__key.html#a9cf18b0c96bed61e47f9fb959157fb5e">  734</a></span>&#160;  <a class="code" href="structMDL__key.html">MDL_key</a> &amp;<a class="code" href="structMDL__key.html#a9cf18b0c96bed61e47f9fb959157fb5e">operator=</a>(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> &amp;rhs) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    mdl_key_init(&amp;rhs);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno"><a class="line" href="structMDL__key.html#abcae5989a7728de6cb2d822d7a66487b">  739</a></span>&#160;  <a class="code" href="structMDL__key.html#abcae5989a7728de6cb2d822d7a66487b">MDL_key</a>(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">enum_mdl_namespace</a> namespace_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *db_arg,</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg) {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    mdl_key_init(namespace_arg, db_arg, name_arg);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  }</div><div class="line"><a name="l00743"></a><span class="lineno"><a class="line" href="structMDL__key.html#ae334aedb745856117233199d67f65d2f">  743</a></span>&#160;  <a class="code" href="structMDL__key.html#ae334aedb745856117233199d67f65d2f">MDL_key</a>() {} <span class="comment">/* To use when part of MDL_request. */</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">    Get thread state name to be used in case when we have to</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">    wait on resource identified by key.</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00749"></a><span class="lineno"><a class="line" href="structMDL__key.html#ac6f4051535fef0ad4f557a551bd1aa77">  749</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="structPSI__stage__info__v1.html">PSI_stage_info</a> *<a class="code" href="structMDL__key.html#ac6f4051535fef0ad4f557a551bd1aa77">get_wait_state_name</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">return</span> &amp;m_namespace_to_wait_state_name[(int)mdl_namespace()];</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">    Check if normalized object name should be used.</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">    @return true if normlized object name should be used, false</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">    otherwise.</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00760"></a><span class="lineno"><a class="line" href="structMDL__key.html#adf7c11832f60c947a13056463cf22c3f">  760</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structMDL__key.html#adf7c11832f60c947a13056463cf22c3f">use_normalized_object_name</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">return</span> (mdl_namespace() == <a class="code" href="group__GROUP__PARSER.html#gga9e3ffdbaa8d88485570eaf514d3808e5a6a72a6a776662a244f82d31e9274a07b">FUNCTION</a> || mdl_namespace() == <a class="code" href="group__GROUP__PARSER.html#gga9e3ffdbaa8d88485570eaf514d3808e5a6c4d52355c694ee12dcd648562757f52">PROCEDURE</a> ||</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            mdl_namespace() == EVENT || mdl_namespace() == RESOURCE_GROUPS ||</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            mdl_namespace() == TRIGGER);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00767"></a><span class="lineno"><a class="line" href="structMDL__key.html#a5766c840ba81340f39de04e4dfccfcba">  767</a></span>&#160;  <a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a> m_length{0};</div><div class="line"><a name="l00768"></a><span class="lineno"><a class="line" href="structMDL__key.html#a0ae1f63ddb11b34750db21379eb7ca38">  768</a></span>&#160;  <a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a> m_db_name_length{0};</div><div class="line"><a name="l00769"></a><span class="lineno"><a class="line" href="structMDL__key.html#ac999815f3e2a14c7e385b27aa14ed020">  769</a></span>&#160;  <a class="code" href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a> m_object_name_length{0};</div><div class="line"><a name="l00770"></a><span class="lineno"><a class="line" href="structMDL__key.html#a632b8c5c857c7316d805f2678cb9bfe4">  770</a></span>&#160;  <span class="keywordtype">char</span> m_ptr[<a class="code" href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">MAX_MDLKEY_LENGTH</a>]{0};</div><div class="line"><a name="l00771"></a><span class="lineno"><a class="line" href="structMDL__key.html#af1ac3850d150e19f8589bc8ce4a052ca">  771</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="structPSI__stage__info__v1.html">PSI_stage_info</a> m_namespace_to_wait_state_name[NAMESPACE_END];</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;};</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">  A pending metadata lock request.</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">  A lock request and a granted metadata lock are represented by</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">  different classes because they have different allocation</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">  sites and hence different lifetimes. The allocation of lock requests is</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">  controlled from outside of the MDL subsystem, while allocation of granted</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">  locks (tickets) is controlled within the MDL subsystem.</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno"><a class="line" href="classMDL__request.html">  784</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__request.html">MDL_request</a> {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">  /** Type of metadata lock. */</span></div><div class="line"><a name="l00787"></a><span class="lineno"><a class="line" href="classMDL__request.html#a45697de7da028013d9b8752607bf6768">  787</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> <a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a>{<a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbae221f959e09d9dce2ac169f2d8bf33c6">MDL_INTENTION_EXCLUSIVE</a>};<span class="comment"></span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">  /** Duration for requested lock. */</span></div><div class="line"><a name="l00789"></a><span class="lineno"><a class="line" href="classMDL__request.html#abe787d830f07c3cef8127660cc53a6cb">  789</a></span>&#160;  <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> duration{<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da675d77e333e224c13925f152d698ca14">MDL_STATEMENT</a>};</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">    Pointers for participating in the list of lock requests for this context.</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00794"></a><span class="lineno"><a class="line" href="classMDL__request.html#ad9d3b3f440b67b7665b3a2701a14e2b2">  794</a></span>&#160;  <a class="code" href="classMDL__request.html">MDL_request</a> *next_in_list{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00795"></a><span class="lineno"><a class="line" href="classMDL__request.html#a9e7ba7a3d2a1b9374f0dbe0be197854a">  795</a></span>&#160;  <a class="code" href="classMDL__request.html">MDL_request</a> **prev_in_list{<span class="keyword">nullptr</span>};<span class="comment"></span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">    Pointer to the lock ticket object for this lock request.</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">    Valid only if this lock request is satisfied.</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00800"></a><span class="lineno"><a class="line" href="classMDL__request.html#a99421002fe2ea1580766846c0ef339ae">  800</a></span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a> *ticket{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">  /** A lock is requested based on a fully qualified name and type. */</span></div><div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="classMDL__request.html#ab30e06e36d9191120575cc0c0402554a">  803</a></span>&#160;  <a class="code" href="structMDL__key.html">MDL_key</a> <a class="code" href="classMDL__request.html#ab30e06e36d9191120575cc0c0402554a">key</a>;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno"><a class="line" href="classMDL__request.html#aa55387aeb49a4f81ecaa87fd481a310b">  805</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *m_src_file{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="classMDL__request.html#aeb5f59ed9b9bfa377f8f4afab470653b">  806</a></span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> m_src_line{0};</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00809"></a><span class="lineno"><a class="line" href="classMDL__request.html#a3bbf52f5d0a8cf5708fdae8e2324c09d">  809</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> *<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="keywordtype">size_t</span> size, <a class="code" href="structMEM__ROOT.html">MEM_ROOT</a> *<a class="code" href="client__plugin_8cc.html#a7d0fe2f135db987da18cea87b4778737">mem_root</a>,</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                            <span class="keyword">const</span> std::nothrow_t &amp;arg MY_ATTRIBUTE((unused)) =</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                std::nothrow) noexcept {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">return</span> mem_root-&gt;Alloc(size);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  }</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno"><a class="line" href="classMDL__request.html#a7e8922223338424c4294b2cecc482182">  815</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>(<span class="keywordtype">void</span> *, <a class="code" href="structMEM__ROOT.html">MEM_ROOT</a> *,</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                              <span class="keyword">const</span> std::nothrow_t &amp;) noexcept {}</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordtype">void</span> init_with_source(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">MDL_key::enum_mdl_namespace</a> namespace_arg,</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">char</span> *db_arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *name_arg,</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                        <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> mdl_type_arg,</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                        <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> mdl_duration_arg,</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">char</span> *src_file, <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> src_line);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keywordtype">void</span> init_by_key_with_source(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *key_arg,</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                               <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> mdl_type_arg,</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                               <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> mdl_duration_arg,</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">char</span> *src_file, <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> src_line);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keywordtype">void</span> init_by_part_key_with_source(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">MDL_key::enum_mdl_namespace</a> namespace_arg,</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *part_key_arg,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                                    <span class="keywordtype">size_t</span> part_key_length_arg,</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                                    <span class="keywordtype">size_t</span> db_length_arg,</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                                    <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> mdl_type_arg,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                    <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> mdl_duration_arg,</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *src_file, <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> src_line);<span class="comment"></span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">  /** Set type of lock request. Can be only applied to pending locks. */</span></div><div class="line"><a name="l00835"></a><span class="lineno"><a class="line" href="classMDL__request.html#a6cc77971b2b370098d3e6d89f816180e">  835</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classMDL__request.html#a6cc77971b2b370098d3e6d89f816180e">set_type</a>(<a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> type_arg) {</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(ticket == <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a> = type_arg;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  }</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">    Is this a request for a lock which allow data to be updated?</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">    @note This method returns true for MDL_SHARED_UPGRADABLE type of</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">          lock. Even though this type of lock doesn&#39;t allow updates</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">          it will always be upgraded to one that does.</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="classMDL__request.html#a2eba1fb8ec80fc083ddee0b45c683294">  847</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__request.html#a2eba1fb8ec80fc083ddee0b45c683294">is_write_lock_request</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a> &gt;= <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba00b10bf62b23e3af95e304378f46b21d">MDL_SHARED_WRITE</a> &amp;&amp; <a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a> != <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba3f7dc90d30f753a5b96bfb365db37fa5">MDL_SHARED_READ_ONLY</a>);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  }</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">  /** Is this a request for a strong, DDL/LOCK TABLES-type, of lock? */</span></div><div class="line"><a name="l00852"></a><span class="lineno"><a class="line" href="classMDL__request.html#a0464ab737f8f687f27626d2595a7125a">  852</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__request.html#a0464ab737f8f687f27626d2595a7125a">is_ddl_or_lock_tables_lock_request</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a> &gt;= <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba2be0df3ea6e3cc01a90bf1a2a1cb56c7">MDL_SHARED_UPGRADABLE</a>;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  }</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">    This constructor exists for two reasons:</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">    - TABLE_LIST objects are sometimes default-constructed. We plan to remove</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">      this as there is no practical reason, the call to the default</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">      constructor is always followed by either a call to TABLE_LIST::operator=</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">      or memberwise assignments.</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">    - In some legacy cases TABLE_LIST objects are copy-assigned without</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">      intention to copy the TABLE_LIST::mdl_request member. In this cases they</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">      are overwritten with an uninitialized MDL_request object. The cases are:</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">      - Sql_cmd_handler_open::execute()</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">      - mysql_execute_command()</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">      - SELECT_LEX_UNIT::prepare()</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">      - fill_defined_view_parts()</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">      No new cases are expected.  In all other cases, so far only</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">      Locked_tables_list::rename_locked_table(), a move assignment is actually</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">      what is intended.</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00877"></a><span class="lineno"><a class="line" href="classMDL__request.html#a5c427f6ecbd29a5fc41808444260798d">  877</a></span>&#160;  <a class="code" href="classMDL__request.html#a5c427f6ecbd29a5fc41808444260798d">MDL_request</a>() {}</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno"><a class="line" href="classMDL__request.html#afc3bbdffd2a0b94c57a4fa34aac7262e">  879</a></span>&#160;  <a class="code" href="classMDL__request.html#afc3bbdffd2a0b94c57a4fa34aac7262e">MDL_request</a>(<span class="keyword">const</span> <a class="code" href="classMDL__request.html">MDL_request</a> &amp;rhs)</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      : <a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a>(rhs.<a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a>), duration(rhs.duration), ticket(<a class="code" href="dialog_8cc.html#ae7bd12bd7c9e418a420087971d0a7e31">nullptr</a>), key(rhs.key) {}</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <a class="code" href="classMDL__request.html">MDL_request</a>(<a class="code" href="classMDL__request.html">MDL_request</a> &amp;&amp;) = <span class="keywordflow">default</span>;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <a class="code" href="classMDL__request.html">MDL_request</a> &amp;operator=(<a class="code" href="classMDL__request.html">MDL_request</a> &amp;&amp;) = <span class="keywordflow">default</span>;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;};</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno"><a class="line" href="mdl_8h.html#a342c5ba54f4e4bda061134b0f4711c72">  887</a></span>&#160;<span class="preprocessor">#define MDL_REQUEST_INIT(R, P1, P2, P3, P4, P5) \</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="preprocessor">  (*R).init_with_source(P1, P2, P3, P4, P5, __FILE__, __LINE__)</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno"><a class="line" href="mdl_8h.html#a1c8b61c990186a404f5b2770d8e63eec">  890</a></span>&#160;<span class="preprocessor">#define MDL_REQUEST_INIT_BY_KEY(R, P1, P2, P3) \</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="preprocessor">  (*R).init_by_key_with_source(P1, P2, P3, __FILE__, __LINE__)</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno"><a class="line" href="mdl_8h.html#a40c932013555d9eac0f2412488a4e5a6">  893</a></span>&#160;<span class="preprocessor">#define MDL_REQUEST_INIT_BY_PART_KEY(R, P1, P2, P3, P4, P5, P6) \</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="preprocessor">  (*R).init_by_part_key_with_source(P1, P2, P3, P4, P5, P6, __FILE__, __LINE__)</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">  An abstract class for inspection of a connected</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">  subgraph of the wait-for graph.</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno"><a class="line" href="classMDL__wait__for__graph__visitor.html">  901</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__wait__for__graph__visitor.html">MDL_wait_for_graph_visitor</a> {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> enter_node(<a class="code" href="classMDL__context.html">MDL_context</a> *node) = 0;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> leave_node(<a class="code" href="classMDL__context.html">MDL_context</a> *node) = 0;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> inspect_edge(<a class="code" href="classMDL__context.html">MDL_context</a> *dest) = 0;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keyword">virtual</span> ~<a class="code" href="classMDL__wait__for__graph__visitor.html">MDL_wait_for_graph_visitor</a>();</div><div class="line"><a name="l00908"></a><span class="lineno"><a class="line" href="classMDL__wait__for__graph__visitor.html#a07a066c40bdf26ab6f17b352cda08ca4">  908</a></span>&#160;  <a class="code" href="classMDL__wait__for__graph__visitor.html#a07a066c40bdf26ab6f17b352cda08ca4">MDL_wait_for_graph_visitor</a>() : m_lock_open_count(0) {}</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">   XXX, hack: During deadlock search, we may need to</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">   inspect TABLE_SHAREs and acquire LOCK_open. Since</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">   LOCK_open is not a recursive mutex, count here how many</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">   times we &quot;took&quot; it (but only take and release once).</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">   Not using a native recursive mutex or rwlock in 5.5 for</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">   LOCK_open since it has significant performance impacts.</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00919"></a><span class="lineno"><a class="line" href="classMDL__wait__for__graph__visitor.html#ad2e6efb3798e08ce8efa992b0ccbba38">  919</a></span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="code" href="classMDL__wait__for__graph__visitor.html#ad2e6efb3798e08ce8efa992b0ccbba38">m_lock_open_count</a>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;};</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">  Abstract class representing an edge in the waiters graph</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">  to be traversed by deadlock detection algorithm.</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno"><a class="line" href="classMDL__wait__for__subgraph.html">  927</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__wait__for__subgraph.html">MDL_wait_for_subgraph</a> {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keyword">virtual</span> ~<a class="code" href="classMDL__wait__for__subgraph.html">MDL_wait_for_subgraph</a>();</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">    Accept a wait-for graph visitor to inspect the node</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">    this edge is leading to.</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> accept_visitor(<a class="code" href="classMDL__wait__for__graph__visitor.html">MDL_wait_for_graph_visitor</a> *gvisitor) = 0;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno"><a class="line" href="classMDL__wait__for__subgraph.html#a5119d1bfb2134d441d8bda0cfb4eb738">  937</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> DEADLOCK_WEIGHT_DML = 0;</div><div class="line"><a name="l00938"></a><span class="lineno"><a class="line" href="classMDL__wait__for__subgraph.html#a1e7921734bd77f21429dc603e676a49c">  938</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> DEADLOCK_WEIGHT_ULL = 50;</div><div class="line"><a name="l00939"></a><span class="lineno"><a class="line" href="classMDL__wait__for__subgraph.html#a70d33347828ce8ca522fa494f98bfbc4">  939</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> DEADLOCK_WEIGHT_DDL = 100;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="comment">/* A helper used to determine which lock request should be aborted. */</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keyword">virtual</span> <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> get_deadlock_weight() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;};</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">  A granted metadata lock.</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">  @warning MDL_ticket members are private to the MDL subsystem.</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">  @note Multiple shared locks on a same object are represented by a</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">        single ticket. The same does not apply for other lock types.</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">  @note There are two groups of MDL_ticket members:</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">        - &quot;Externally accessible&quot;. These members can be accessed from</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">          threads/contexts different than ticket owner in cases when</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">          ticket participates in some list of granted or waiting tickets</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">          for a lock. Therefore one should change these members before</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">          including then to waiting/granted lists or while holding lock</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">          protecting those lists.</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">        - &quot;Context private&quot;. Such members are private to thread/context</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">          owning this ticket. I.e. they should not be accessed from other</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">          threads/contexts.</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno"><a class="line" href="classMDL__ticket.html">  965</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__ticket.html">MDL_ticket</a> : <span class="keyword">public</span> <a class="code" href="classMDL__wait__for__subgraph.html">MDL_wait_for_subgraph</a> {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">    Pointers for participating in the list of lock requests for this context.</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">    Context private.</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00971"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a74155707577dfd12cc7f47229e4f0d17">  971</a></span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a> *<a class="code" href="classMDL__ticket.html#a74155707577dfd12cc7f47229e4f0d17">next_in_context</a>;</div><div class="line"><a name="l00972"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a88281cdb21f74551799ae0940b89aed1">  972</a></span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a> **<a class="code" href="classMDL__ticket.html#a88281cdb21f74551799ae0940b89aed1">prev_in_context</a>;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">    Pointers for participating in the list of satisfied/pending requests</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">    for the lock. Externally accessible.</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00978"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#ad9c009e5c097d2159dd142aa7f58e010">  978</a></span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a> *<a class="code" href="classMDL__ticket.html#ad9c009e5c097d2159dd142aa7f58e010">next_in_lock</a>;</div><div class="line"><a name="l00979"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a873d87712e75f3e7f58399575571198d">  979</a></span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a> **<a class="code" href="classMDL__ticket.html#a873d87712e75f3e7f58399575571198d">prev_in_lock</a>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordtype">bool</span> has_pending_conflicting_lock() <span class="keyword">const</span>;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a2b0c1bd15feca45b1b67791de5a3a027">  984</a></span>&#160;  <a class="code" href="classMDL__context.html">MDL_context</a> *<a class="code" href="classMDL__ticket.html#a2b0c1bd15feca45b1b67791de5a3a027">get_ctx</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_ctx; }</div><div class="line"><a name="l00985"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a8dd08e1eb3ca1bd5842cdb028bcfc5cd">  985</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__ticket.html#a8dd08e1eb3ca1bd5842cdb028bcfc5cd">is_upgradable_or_exclusive</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">return</span> m_type == <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba2be0df3ea6e3cc01a90bf1a2a1cb56c7">MDL_SHARED_UPGRADABLE</a> || m_type == <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba625286b5c7930c17c05fea3ffef0c1da">MDL_SHARED_NO_WRITE</a> ||</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;           m_type == <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba7f4c8af6f7028729d507769697e1d74b">MDL_SHARED_NO_READ_WRITE</a> || m_type == <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbac314c015883c75ddcbdad3ceccd0bb73">MDL_EXCLUSIVE</a>;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  }</div><div class="line"><a name="l00989"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#ad87cffc63ead6571484ac6f142f0b19f">  989</a></span>&#160;  <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> <a class="code" href="classMDL__ticket.html#ad87cffc63ead6571484ac6f142f0b19f">get_type</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_type; }</div><div class="line"><a name="l00990"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aeb8547f86d05a1eb3990834edc7af9a0">  990</a></span>&#160;  <a class="code" href="classMDL__lock.html">MDL_lock</a> *<a class="code" href="classMDL__ticket.html#aeb8547f86d05a1eb3990834edc7af9a0">get_lock</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_lock; }</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *get_key() <span class="keyword">const</span>;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordtype">void</span> downgrade_lock(<a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> <a class="code" href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">type</a>);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordtype">bool</span> has_stronger_or_equal_type(<a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> type) <span class="keyword">const</span>;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordtype">bool</span> is_incompatible_when_granted(<a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> type) <span class="keyword">const</span>;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordtype">bool</span> is_incompatible_when_waiting(<a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> type) <span class="keyword">const</span>;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">  /** Implement MDL_wait_for_subgraph interface. */</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordtype">bool</span> accept_visitor(<a class="code" href="classMDL__wait__for__graph__visitor.html">MDL_wait_for_graph_visitor</a> *dvisitor) <span class="keyword">override</span>;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> get_deadlock_weight() <span class="keyword">const override</span>;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="preprocessor">#ifndef DBUG_OFF</span></div><div class="line"><a name="l01004"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a8d8c2d64e19607ad1d38ba7233decbde"> 1004</a></span>&#160;  <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> <a class="code" href="classMDL__ticket.html#a8d8c2d64e19607ad1d38ba7233decbde">get_duration</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_duration; }</div><div class="line"><a name="l01005"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#acb46c69305fbce6bf80a9ec232359043"> 1005</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__ticket.html#acb46c69305fbce6bf80a9ec232359043">set_duration</a>(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> dur) { m_duration = dur; }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">    Status of lock request represented by the ticket as reflected in P_S.</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01012"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894f"> 1012</a></span>&#160;  <span class="keyword">enum</span> <a class="code" href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894f">enum_psi_status</a> {</div><div class="line"><a name="l01013"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894fafca20cce9bbb3cc899aeabf3bd10b4f3"> 1013</a></span>&#160;    PENDING = 0,</div><div class="line"><a name="l01014"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894fa25b458b8a95d18a5f0b6c3fef9f356fb"> 1014</a></span>&#160;    <a class="code" href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894fa25b458b8a95d18a5f0b6c3fef9f356fb">GRANTED</a>,</div><div class="line"><a name="l01015"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894fa9e51c37e4c5598d6aef6f48fbd5a2f16"> 1015</a></span>&#160;    <a class="code" href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894fa9e51c37e4c5598d6aef6f48fbd5a2f16">PRE_ACQUIRE_NOTIFY</a>,</div><div class="line"><a name="l01016"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894fa6f7bc27ef0b798afb4c5c6d518c28b6e"> 1016</a></span>&#160;    POST_RELEASE_NOTIFY</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  };</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l01020"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aab25f1f33d2f55eb5c79f0f7b6bfaecd"> 1020</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classMDL__context.html">MDL_context</a>;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a51ae7b84f5a61ecf3ae411ee1431f71f"> 1022</a></span>&#160;  <a class="code" href="classMDL__ticket.html#a51ae7b84f5a61ecf3ae411ee1431f71f">MDL_ticket</a>(<a class="code" href="classMDL__context.html">MDL_context</a> *ctx_arg, <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> type_arg</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;#ifndef DBUG_OFF</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;             ,</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;             <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> duration_arg</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;#endif</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;             )</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      : m_type(type_arg),</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;#ifndef DBUG_OFF</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        m_duration(duration_arg),</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;#endif</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        m_ctx(ctx_arg),</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        m_lock(<a class="code" href="dialog_8cc.html#ae7bd12bd7c9e418a420087971d0a7e31">nullptr</a>),</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        m_is_fast_path(<a class="code" href="config__static_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>),</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        m_hton_notified(<a class="code" href="config__static_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>),</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        m_psi(<a class="code" href="dialog_8cc.html#ae7bd12bd7c9e418a420087971d0a7e31">nullptr</a>) {</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  }</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a517f72ec428bd824bb4b5c97e1842b92"> 1039</a></span>&#160;  <a class="code" href="classMDL__ticket.html#a517f72ec428bd824bb4b5c97e1842b92">~MDL_ticket</a>()<span class="keyword"> override </span>{ <a class="code" href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(m_psi == <span class="keyword">nullptr</span>); }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keyword">static</span> <a class="code" href="classMDL__ticket.html">MDL_ticket</a> *<a class="code" href="namespacedblwr_1_1v1.html#a2213362152a12bb25be6185d420285b6">create</a>(<a class="code" href="classMDL__context.html">MDL_context</a> *ctx_arg, <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> type_arg</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;#ifndef DBUG_OFF</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                            ,</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                            <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> duration_arg</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;#endif</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  );</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="my__alloc_8h.html#a28315dc6f65bdd04a2c84b4aca4ca248">destroy</a>(<a class="code" href="classMDL__ticket.html">MDL_ticket</a> *ticket);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">  /** Type of metadata lock. Externally accessible. */</span></div><div class="line"><a name="l01051"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a027686d37b2f7f1af7d9aaa6acd48448"> 1051</a></span>&#160;  <span class="keyword">enum</span> <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> m_type;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="preprocessor">#ifndef DBUG_OFF</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">    Duration of lock represented by this ticket.</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">    Context private. Debug-only.</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01057"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aa81a40be82b1e8015e3c0be5c99d5d72"> 1057</a></span>&#160;  <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> <a class="code" href="classMDL__ticket.html#aa81a40be82b1e8015e3c0be5c99d5d72">m_duration</a>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">    Context of the owner of the metadata lock ticket. Externally accessible.</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01062"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#ae06e96fbda7d5f2ad5a15e583a415f91"> 1062</a></span>&#160;  <a class="code" href="classMDL__context.html">MDL_context</a> *<a class="code" href="classMDL__ticket.html#ae06e96fbda7d5f2ad5a15e583a415f91">m_ctx</a>;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">    Pointer to the lock object for this lock ticket. Externally accessible.</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01067"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#ac31749048c6f9a807473ef2849bda7fb"> 1067</a></span>&#160;  <a class="code" href="classMDL__lock.html">MDL_lock</a> *<a class="code" href="classMDL__ticket.html#ac31749048c6f9a807473ef2849bda7fb">m_lock</a>;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">    Indicates that ticket corresponds to lock acquired using &quot;fast path&quot;</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">    algorithm. Particularly this means that it was not included into</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">    MDL_lock::m_granted bitmap/list and instead is accounted for by</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">    MDL_lock::m_fast_path_locks_granted_counter</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01075"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a1445824789d90c16bd7db55ee8bb8b35"> 1075</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__ticket.html#a1445824789d90c16bd7db55ee8bb8b35">m_is_fast_path</a>;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">    Indicates that ticket corresponds to lock request which required</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">    storage engine notification during its acquisition and requires</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">    storage engine notification after its release.</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01082"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#aa725b028ddf1a762c7ad32616c59f209"> 1082</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__ticket.html#aa725b028ddf1a762c7ad32616c59f209">m_hton_notified</a>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"><a class="line" href="classMDL__ticket.html#a7bf75eb1d944160a09c85d5ac1188e20"> 1084</a></span>&#160;  <a class="code" href="group__psi__abi__mdl.html#gae84cbe4318c91ae4325248f8204e3edc">PSI_metadata_lock</a> *<a class="code" href="classMDL__ticket.html#a7bf75eb1d944160a09c85d5ac1188e20">m_psi</a>;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a>(<span class="keyword">const</span> <a class="code" href="classMDL__ticket.html">MDL_ticket</a> &amp;);            <span class="comment">/* not implemented */</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a> &amp;<a class="code" href="classMDL__context.html#a33fe77708ce2d770e0b0145e1a6d9f24">operator=</a>(<span class="keyword">const</span> <a class="code" href="classMDL__ticket.html">MDL_ticket</a> &amp;); <span class="comment">/* not implemented */</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;};</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">  Keep track of MDL_ticket for different durations. Maintains a</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">  hash-based secondary index into the linked lists, to speed up access</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">  by MDL_key.</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01096"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html"> 1096</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__ticket__store.html">MDL_ticket_store</a> {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">    Utility struct for representing a ticket pointer and its duration.</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01101"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1MDL__ticket__handle.html"> 1101</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structMDL__ticket__store_1_1MDL__ticket__handle.html">MDL_ticket_handle</a> {</div><div class="line"><a name="l01102"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1MDL__ticket__handle.html#a92092a6d5f9e099d8e9b71263424f667"> 1102</a></span>&#160;    <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> m_dur = <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9f14cfff6379a5bcfdbf708c571feeef">MDL_DURATION_END</a>;</div><div class="line"><a name="l01103"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1MDL__ticket__handle.html#ae4f8fb86aff6b67754da382b45ea2aef"> 1103</a></span>&#160;    <a class="code" href="classMDL__ticket.html">MDL_ticket</a> *m_ticket = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <a class="code" href="structMDL__ticket__store_1_1MDL__ticket__handle.html">MDL_ticket_handle</a>() = <span class="keywordflow">default</span>;</div><div class="line"><a name="l01106"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1MDL__ticket__handle.html#ab7759ee297d93de3bd2bd033618bba96"> 1106</a></span>&#160;    <a class="code" href="structMDL__ticket__store_1_1MDL__ticket__handle.html#ab7759ee297d93de3bd2bd033618bba96">MDL_ticket_handle</a>(<a class="code" href="classMDL__ticket.html">MDL_ticket</a> *t, <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> d)</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        : m_dur{d}, m_ticket{t} {}</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  };</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="keyword">using</span> <a class="code" href="classI__P__List.html">Ticket_p_list</a> =</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <a class="code" href="classI__P__List.html">I_P_List</a>&lt;<a class="code" href="classMDL__ticket.html">MDL_ticket</a>,</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;               <a class="code" href="structI__P__List__adapter.html">I_P_List_adapter</a>&lt;MDL_ticket, &amp;<a class="code" href="classMDL__ticket.html#a74155707577dfd12cc7f47229e4f0d17">MDL_ticket::next_in_context</a>,</div><div class="line"><a name="l01114"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a3deaa00ef1edc059a61b3de93c7ca2c4"> 1114</a></span>&#160;                                &amp;<a class="code" href="classMDL__ticket.html#a88281cdb21f74551799ae0940b89aed1">MDL_ticket::prev_in_context</a>&gt;&gt;;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1Duration.html"> 1116</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structMDL__ticket__store_1_1Duration.html">Duration</a> {</div><div class="line"><a name="l01117"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1Duration.html#ae40dced3df3b7a8229a6754c76bab635"> 1117</a></span>&#160;    <a class="code" href="classI__P__List.html">Ticket_p_list</a> <a class="code" href="structMDL__ticket__store_1_1Duration.html#ae40dced3df3b7a8229a6754c76bab635">m_ticket_list</a>;<span class="comment"></span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">      m_mat_front tracks what was the front of m_ticket_list, the last</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">      time MDL_context::materialize_fast_path_locks() was called. This</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">      just an optimization which allows</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">      MDL_context::materialize_fast_path_locks() only to consider the</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">      locks added since the last time it ran. Consequently, it can be</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">      assumed that every ticket after m_mat_front is materialized, but</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">      the converse is not necessarily true as new, already</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">      materialized, locks may have been added since the last time</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">      materialize_fast_path_locks() ran.</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01129"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1Duration.html#ab27359cb84c875ee1fe2f07bcc165de8"> 1129</a></span>&#160;    MDL_ticket *m_mat_front = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  };</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#ab67a3c00c54dd9bd8d8c464e2277c4e4"> 1132</a></span>&#160;  <a class="code" href="structMDL__ticket__store_1_1Duration.html">Duration</a> m_durations[<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9f14cfff6379a5bcfdbf708c571feeef">MDL_DURATION_END</a>];</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1Hash.html"> 1134</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structMDL__ticket__store_1_1Hash.html">Hash</a> {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordtype">size_t</span> operator()(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *k) <span class="keyword">const</span>;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  };</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1Key__equal.html"> 1138</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structMDL__ticket__store_1_1Key__equal.html">Key_equal</a> {</div><div class="line"><a name="l01139"></a><span class="lineno"><a class="line" href="structMDL__ticket__store_1_1Key__equal.html#aae32cdc856f5ee862496f68f2ec170d0"> 1139</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structMDL__ticket__store_1_1Key__equal.html#aae32cdc856f5ee862496f68f2ec170d0">operator()</a>(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *a, <span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *b)<span class="keyword"> const </span>{</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keywordflow">return</span> a-&gt;<a class="code" href="structMDL__key.html#a213166cb4050445cbe7353448ef5d578">is_equal</a>(b);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    }</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  };</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <span class="keyword">using</span> <a class="code" href="classMDL__ticket__store.html#afdb16835bf5f5f81453266ee3066a13b">Ticket_map</a> = std::unordered_multimap&lt;<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *, <a class="code" href="structMDL__ticket__store_1_1MDL__ticket__handle.html">MDL_ticket_handle</a>,</div><div class="line"><a name="l01145"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#afdb16835bf5f5f81453266ee3066a13b"> 1145</a></span>&#160;                                             <a class="code" href="structMDL__ticket__store_1_1Hash.html">Hash</a>, <a class="code" href="structMDL__ticket__store_1_1Key__equal.html">Key_equal</a>&gt;;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">    If the number of tickets in the ticket store (in all durations) is equal</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">    to, or exceeds this constant the hash index (in the form of an</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">    unordered_multi_map) will be maintained and used for lookups.</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">    The value 256 is chosen as it has worked well in benchmarks.</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01154"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a92ee947504d735aa617c2a4f607612da"> 1154</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> THRESHOLD = 256;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">    Initial number of buckets in the hash index. THRESHOLD is chosen</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">    to get a fill-factor of 50% when reaching the threshold value.</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01160"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a517bb3e760ddbde73b3d47e479d80dd9"> 1160</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> INITIAL_BUCKET_COUNT = THRESHOLD * 2;</div><div class="line"><a name="l01161"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a3287539f6f5669d364feb327f7e1f95d"> 1161</a></span>&#160;  <span class="keywordtype">size_t</span> m_count = 0;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a2811408e413eb7061f998ea33fb95f6d"> 1163</a></span>&#160;  std::unique_ptr&lt;Ticket_map&gt; <a class="code" href="classMDL__ticket__store.html#a2811408e413eb7061f998ea33fb95f6d">m_map</a>;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  MDL_ticket_handle find_in_lists(<span class="keyword">const</span> <a class="code" href="classMDL__request.html">MDL_request</a> &amp;req) <span class="keyword">const</span>;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  MDL_ticket_handle find_in_hash(<span class="keyword">const</span> <a class="code" href="classMDL__request.html">MDL_request</a> &amp;req) <span class="keyword">const</span>;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">    Public alias.</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01172"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a6b84e4255a5517289e8810df6067161c"> 1172</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classI__P__List__iterator.html">List_iterator</a> = <a class="code" href="classI__P__List__iterator.html">Ticket_p_list::Iterator</a>;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">    Constructs store. The hash index is initially empty. Filled on demand.</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01177"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a971d3a003a90f2626df37f74e654cb16"> 1177</a></span>&#160;  <a class="code" href="classMDL__ticket__store.html#a971d3a003a90f2626df37f74e654cb16">MDL_ticket_store</a>()</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      :  <span class="comment">// Comment in to test threshold values in unit test micro benchmark</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;         <span class="comment">// THRESHOLD{read_from_env(&quot;TS_THRESHOLD&quot;, 500)},</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        m_map{<span class="keyword">nullptr</span>} {}</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">    Calls the closure provided as argument for each of the MDL_tickets</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">    in the given duration.</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">    @param dur duration list to iterate over</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">    @param clos closure to invoke for each ticket in the list</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> CLOS&gt;</div><div class="line"><a name="l01189"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#ae52f4bcf5558071569eef455ec10257c"> 1189</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__ticket__store.html#ae52f4bcf5558071569eef455ec10257c">for_each_ticket_in_duration_list</a>(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> dur, CLOS &amp;&amp;clos) {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <a class="code" href="classI__P__List__iterator.html">List_iterator</a> it(m_durations[dur].m_ticket_list);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordflow">for</span> (MDL_ticket *t = it++; t != <span class="keyword">nullptr</span>; t = it++) {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      clos(t, dur);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  }</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">    Calls the closure provided as argument for each of the MDL_tickets</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">    in the store.</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">    @param clos closure to invoke for each ticket in the store</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> CLOS&gt;</div><div class="line"><a name="l01202"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a17e85e55ea73767a816343393c85ed62"> 1202</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__ticket__store.html#a17e85e55ea73767a816343393c85ed62">for_each_ticket_in_ticket_lists</a>(CLOS &amp;&amp;clos) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    for_each_ticket_in_duration_list(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da675d77e333e224c13925f152d698ca14">MDL_STATEMENT</a>, std::forward&lt;CLOS&gt;(clos));</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    for_each_ticket_in_duration_list(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da410364f4efe7a5b36f7be90f62c12fe9">MDL_TRANSACTION</a>, std::forward&lt;CLOS&gt;(clos));</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    for_each_ticket_in_duration_list(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9679cdf9bf84fde07db17025ab004ab4">MDL_EXPLICIT</a>, std::forward&lt;CLOS&gt;(clos));</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  }</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment">    Predicate for the emptiness of the store.</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">    @return true if there are no tickets in the store</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="keywordtype">bool</span> is_empty() <span class="keyword">const</span>;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment">    Predicate for the emptiness of a given duration list.</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment">    @param di the duration to check</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment">    @return true if there are no tickets with the given duration</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="keywordtype">bool</span> is_empty(<span class="keywordtype">int</span> di) <span class="keyword">const</span>;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">    Return the first MDL_ticket for the given duration.</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">    @param di duration to get first ticket for</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">    @return first ticket in the given duration or nullptr if no such</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">    tickets exist</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  MDL_ticket *<a class="code" href="xcom__base_8cc.html#ac261b45b6346e633de22d510c9f6a770">front</a>(<span class="keywordtype">int</span> di);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment">    Push a ticket onto the list for a given duration.</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">    @param dur duration list to push into</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">    @param ticket to push</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="keywordtype">void</span> push_front(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> dur, MDL_ticket *ticket);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">    Remove a ticket from a duration list. Note that since the</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment">    underlying list is an intrusive linked list there is no guarantee</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">    that the ticket is actually in the duration list. It will be</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment">    removed from which ever list it is in.</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordtype">void</span> <span class="keyword">remove</span>(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> dur, MDL_ticket *ticket);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">    Return a P-list iterator to the given duration.</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">    @param di duration list index</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">    @return P-list iterator to tickets with given duration</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01251"></a><span class="lineno"><a class="line" href="classMDL__ticket__store.html#a21c456b3ed00e418a7eb1c6e4960e0cd"> 1251</a></span>&#160;  <a class="code" href="classI__P__List__iterator.html">List_iterator</a> <a class="code" href="classMDL__ticket__store.html#a21c456b3ed00e418a7eb1c6e4960e0cd">list_iterator</a>(<span class="keywordtype">int</span> di)<span class="keyword"> const </span>{</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classI__P__List__iterator.html">List_iterator</a>{m_durations[di].<a class="code" href="structMDL__ticket__store_1_1Duration.html#ae40dced3df3b7a8229a6754c76bab635">m_ticket_list</a>};</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">    Move all tickets to the explicit duration list.</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keywordtype">void</span> move_all_to_explicit_duration();</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">    Move all tickets to the transaction duration list.</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <span class="keywordtype">void</span> move_explicit_to_transaction_duration();</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">    Look up a ticket based on its MDL_key.</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">    @param req request to locate ticket for</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">    @return MDL_ticket_handle with ticket pointer and found duration</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">            (or nullptr and MDL_DURATION_END if not found</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  MDL_ticket_handle <a class="code" href="namespacedblwr_1_1recv.html#a4d87e29e585a1f0ddb67f6f0b3b2d0ea">find</a>(<span class="keyword">const</span> <a class="code" href="classMDL__request.html">MDL_request</a> &amp;req) <span class="keyword">const</span>;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">    Mark boundary for tickets with fast_path=false, so that later</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">    calls to materialize_fast_path_locks() do not have to traverse the</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">    whole set of tickets.</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordtype">void</span> set_materialized();</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">    Return the first ticket for which materialize_fast_path_locks</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">    already has been called for the given duration.</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">    @param di duration list index</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">    @return first materialized ticket for the given duration</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  MDL_ticket *materialized_front(<span class="keywordtype">int</span> di);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;};</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">  Savepoint for MDL context.</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">  Doesn&#39;t include metadata locks with explicit duration as</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">  they are not released during rollback to savepoint.</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"><a class="line" href="classMDL__savepoint.html"> 1297</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__savepoint.html">MDL_savepoint</a> {</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01299"></a><span class="lineno"><a class="line" href="classMDL__savepoint.html#a97ade82fc1d8f4ae62f5d83c0306f5a6"> 1299</a></span>&#160;  <a class="code" href="classMDL__savepoint.html#a97ade82fc1d8f4ae62f5d83c0306f5a6">MDL_savepoint</a>() {}</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l01302"></a><span class="lineno"><a class="line" href="classMDL__savepoint.html#afea95c3996c91d17d6cee03b9e0bef98"> 1302</a></span>&#160;  <a class="code" href="classMDL__savepoint.html#afea95c3996c91d17d6cee03b9e0bef98">MDL_savepoint</a>(<a class="code" href="classMDL__ticket.html">MDL_ticket</a> *stmt_ticket, <a class="code" href="classMDL__ticket.html">MDL_ticket</a> *trans_ticket)</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      : m_stmt_ticket(stmt_ticket), m_trans_ticket(trans_ticket) {}</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"><a class="line" href="classMDL__savepoint.html#aab25f1f33d2f55eb5c79f0f7b6bfaecd"> 1305</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classMDL__context.html">MDL_context</a>;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160; <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">    Pointer to last lock with statement duration which was taken</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">    before creation of savepoint.</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01312"></a><span class="lineno"><a class="line" href="classMDL__savepoint.html#a6cd0387de9d0787ce4ac3a1f94792ee1"> 1312</a></span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a> *<a class="code" href="classMDL__savepoint.html#a6cd0387de9d0787ce4ac3a1f94792ee1">m_stmt_ticket</a>;<span class="comment"></span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">    Pointer to last lock with transaction duration which was taken</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">    before creation of savepoint.</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01317"></a><span class="lineno"><a class="line" href="classMDL__savepoint.html#a4c0cc2fa532cfcb55607f2eff2bcce0d"> 1317</a></span>&#160;  <a class="code" href="classMDL__ticket.html">MDL_ticket</a> *<a class="code" href="classMDL__savepoint.html#a4c0cc2fa532cfcb55607f2eff2bcce0d">m_trans_ticket</a>;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;};</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">  A reliable way to wait on an MDL lock.</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div><div class="line"><a name="l01324"></a><span class="lineno"><a class="line" href="classMDL__wait.html"> 1324</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__wait.html">MDL_wait</a> {</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <a class="code" href="classMDL__wait.html">MDL_wait</a>();</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  ~<a class="code" href="classMDL__wait.html">MDL_wait</a>();</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="comment">// WS_EMPTY since EMPTY conflicts with #define in system headers on some</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="comment">// platforms.</span></div><div class="line"><a name="l01331"></a><span class="lineno"><a class="line" href="classMDL__wait.html#a737e84aa2586749f901d7880e7534a03a4ce4d3648f8463f90db0eedff78342c4"> 1331</a></span>&#160;  <span class="keyword">enum</span> <a class="code" href="classMDL__wait.html#a737e84aa2586749f901d7880e7534a03">enum_wait_status</a> { WS_EMPTY = 0, GRANTED, VICTIM, TIMEOUT, KILLED };</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="keywordtype">bool</span> set_status(<a class="code" href="classMDL__wait.html#a737e84aa2586749f901d7880e7534a03">enum_wait_status</a> result_arg);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <a class="code" href="classMDL__wait.html#a737e84aa2586749f901d7880e7534a03">enum_wait_status</a> get_status();</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keywordtype">void</span> reset_status();</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <a class="code" href="classMDL__wait.html#a737e84aa2586749f901d7880e7534a03">enum_wait_status</a> timed_wait(<a class="code" href="classMDL__context__owner.html">MDL_context_owner</a> *owner,</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                              <span class="keyword">struct</span> timespec *abs_timeout, <span class="keywordtype">bool</span> signal_timeout,</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                              <span class="keyword">const</span> <a class="code" href="structPSI__stage__info__v1.html">PSI_stage_info</a> *wait_state_name);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160; <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">    Condvar which is used for waiting until this context&#39;s pending</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">    request can be satisfied or this thread has to perform actions</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">    to resolve a potential deadlock (we subscribe to such</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">    notification by adding a ticket corresponding to the request</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">    to an appropriate queue of waiters).</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01348"></a><span class="lineno"><a class="line" href="classMDL__wait.html#af7eb4ab4dc1e485b2e855d3f69e0b687"> 1348</a></span>&#160;  <a class="code" href="structmysql__mutex__t.html">mysql_mutex_t</a> <a class="code" href="classMDL__wait.html#af7eb4ab4dc1e485b2e855d3f69e0b687">m_LOCK_wait_status</a>;</div><div class="line"><a name="l01349"></a><span class="lineno"><a class="line" href="classMDL__wait.html#ad3f6cee3c2d52fa08440c24a70f4e955"> 1349</a></span>&#160;  <a class="code" href="structmysql__cond__t.html">mysql_cond_t</a> <a class="code" href="classMDL__wait.html#ad3f6cee3c2d52fa08440c24a70f4e955">m_COND_wait_status</a>;</div><div class="line"><a name="l01350"></a><span class="lineno"><a class="line" href="classMDL__wait.html#a49314fb3626164ad6d76f3c6ce96867d"> 1350</a></span>&#160;  <a class="code" href="classMDL__wait.html#a737e84aa2586749f901d7880e7534a03">enum_wait_status</a> <a class="code" href="classMDL__wait.html#a49314fb3626164ad6d76f3c6ce96867d">m_wait_status</a>;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;};</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">  Base class to find out if the lock represented by a given ticket</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">  should be released. Users of release_locks() need to subclass</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">  this and specify an implementation of release(). Only for locks</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment">  with explicit duration.</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"><a class="line" href="classMDL__release__locks__visitor.html"> 1360</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__release__locks__visitor.html">MDL_release_locks_visitor</a> {</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01362"></a><span class="lineno"><a class="line" href="classMDL__release__locks__visitor.html#a587aa8b019da40e5b5a7c3234fbb234b"> 1362</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="classMDL__release__locks__visitor.html#a587aa8b019da40e5b5a7c3234fbb234b">~MDL_release_locks_visitor</a>() {}<span class="comment"></span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment">    Check if the given ticket represents a lock that should be released.</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">    @retval true if the lock should be released, false otherwise.</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> release(<a class="code" href="classMDL__ticket.html">MDL_ticket</a> *ticket) = 0;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;};</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">  Abstract visitor class for inspecting MDL_context.</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"><a class="line" href="classMDL__context__visitor.html"> 1375</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__context__visitor.html">MDL_context_visitor</a> {</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01377"></a><span class="lineno"><a class="line" href="classMDL__context__visitor.html#aeaf789cf7a5131394d4901e73f7b39d5"> 1377</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="classMDL__context__visitor.html#aeaf789cf7a5131394d4901e73f7b39d5">~MDL_context_visitor</a>() {}</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> visit_context(<span class="keyword">const</span> <a class="code" href="classMDL__context.html">MDL_context</a> *ctx) = 0;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;};</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="keyword">typedef</span> <a class="code" href="classI__P__List.html">I_P_List</a>&lt;<a class="code" href="classMDL__request.html">MDL_request</a>,</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                 <a class="code" href="structI__P__List__adapter.html">I_P_List_adapter</a>&lt;MDL_request, &amp;<a class="code" href="classMDL__request.html#ad9d3b3f440b67b7665b3a2701a14e2b2">MDL_request::next_in_list</a>,</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                                  &amp;<a class="code" href="classMDL__request.html#a9e7ba7a3d2a1b9374f0dbe0be197854a">MDL_request::prev_in_list</a>&gt;,</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                 <a class="code" href="classI__P__List__counter.html">I_P_List_counter</a>&gt;</div><div class="line"><a name="l01385"></a><span class="lineno"><a class="line" href="mdl_8h.html#a1e6fbbe4110a5b3e32f1a8c13dd1a329"> 1385</a></span>&#160;    <a class="code" href="mdl_8h.html#a1e6fbbe4110a5b3e32f1a8c13dd1a329">MDL_request_list</a>;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">  Context of the owner of metadata locks. I.e. each server</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">  connection has such a context.</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"><a class="line" href="classMDL__context.html"> 1392</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__context.html">MDL_context</a> {</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classI__P__List.html">I_P_List</a>&lt;<a class="code" href="classMDL__ticket.html">MDL_ticket</a>,</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                   <a class="code" href="structI__P__List__adapter.html">I_P_List_adapter</a>&lt;MDL_ticket, &amp;<a class="code" href="classMDL__ticket.html#a74155707577dfd12cc7f47229e4f0d17">MDL_ticket::next_in_context</a>,</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                                    &amp;<a class="code" href="classMDL__ticket.html#a88281cdb21f74551799ae0940b89aed1">MDL_ticket::prev_in_context</a>&gt;&gt;</div><div class="line"><a name="l01397"></a><span class="lineno"><a class="line" href="classMDL__context.html#ab0e1989a324f4a2918656245963f23fa"> 1397</a></span>&#160;      <a class="code" href="classMDL__context.html#ab0e1989a324f4a2918656245963f23fa">Ticket_list</a>;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div><div class="line"><a name="l01399"></a><span class="lineno"><a class="line" href="classMDL__context.html#a0c46960d79806f52abbf0ba43af6ad04"> 1399</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classI__P__List__iterator.html">Ticket_list::Iterator</a> <a class="code" href="classMDL__context.html#a0c46960d79806f52abbf0ba43af6ad04">Ticket_iterator</a>;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <a class="code" href="classMDL__context.html">MDL_context</a>();</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="my__alloc_8h.html#a28315dc6f65bdd04a2c84b4aca4ca248">destroy</a>();</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="keywordtype">bool</span> try_acquire_lock(MDL_request *<a class="code" href="namespacedd_1_1sdi.html#af01bdf5d23d30e39aad11ff273c55b87">mdl_request</a>);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="keywordtype">bool</span> acquire_lock(MDL_request *<a class="code" href="namespacedd_1_1sdi.html#af01bdf5d23d30e39aad11ff273c55b87">mdl_request</a>, <a class="code" href="my__systime_8h.html#aefa3851a2bb36f7eaa5a3164f7e881c4">Timeout_type</a> lock_wait_timeout);</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordtype">bool</span> acquire_locks(<a class="code" href="classI__P__List.html">MDL_request_list</a> *requests,</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                     <a class="code" href="my__systime_8h.html#aefa3851a2bb36f7eaa5a3164f7e881c4">Timeout_type</a> lock_wait_timeout);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="keywordtype">bool</span> upgrade_shared_lock(MDL_ticket *mdl_ticket, <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> new_type,</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                           <a class="code" href="my__systime_8h.html#aefa3851a2bb36f7eaa5a3164f7e881c4">Timeout_type</a> lock_wait_timeout);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <span class="keywordtype">bool</span> clone_ticket(MDL_request *<a class="code" href="namespacedd_1_1sdi.html#af01bdf5d23d30e39aad11ff273c55b87">mdl_request</a>);</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">    Create copy of all granted tickets of particular duration from given</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">    context to current context.</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">    Used by XA for preserving locks during client disconnect.</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">    @param ticket_owner  Owner of tickets to be cloned</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">    @param duration      MDL lock duration for that tickets are to be cloned</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">    @retval true   Out of memory or deadlock happened or</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">                   lock request was refused by storage engine.</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">    @retval false  Success.</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  <span class="keywordtype">bool</span> clone_tickets(<span class="keyword">const</span> <a class="code" href="classMDL__context.html">MDL_context</a> *ticket_owner,</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                     <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> duration);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="keywordtype">void</span> release_all_locks_for_name(MDL_ticket *ticket);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordtype">void</span> release_locks(<a class="code" href="classMDL__release__locks__visitor.html">MDL_release_locks_visitor</a> *visitor);</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <span class="keywordtype">void</span> release_lock(MDL_ticket *ticket);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  <span class="keywordtype">bool</span> owns_equal_or_stronger_lock(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *mdl_key,</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                                   <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> mdl_type);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <span class="keywordtype">bool</span> owns_equal_or_stronger_lock(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">MDL_key::enum_mdl_namespace</a> mdl_namespace,</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                                   <span class="keyword">const</span> <span class="keywordtype">char</span> *db, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="sslopt-case_8h.html#ae00b773898ac853cec38cdf7a08b8e89">name</a>,</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                                   <a class="code" href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a> mdl_type);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordtype">bool</span> find_lock_owner(<span class="keyword">const</span> <a class="code" href="structMDL__key.html">MDL_key</a> *mdl_key, <a class="code" href="classMDL__context__visitor.html">MDL_context_visitor</a> *visitor);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="keywordtype">bool</span> has_lock(<span class="keyword">const</span> <a class="code" href="classMDL__savepoint.html">MDL_savepoint</a> &amp;mdl_savepoint, MDL_ticket *mdl_ticket);</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"><a class="line" href="classMDL__context.html#ae36680261ff26d6eb9ea19e2a290294d"> 1444</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classMDL__context.html#ae36680261ff26d6eb9ea19e2a290294d">has_locks</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !m_ticket_store.is_empty(); }</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="keywordtype">bool</span> has_locks(<a class="code" href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">MDL_key::enum_mdl_namespace</a> mdl_namespace) <span class="keyword">const</span>;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="keywordtype">bool</span> has_locks_waited_for() <span class="keyword">const</span>;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="preprocessor">#ifndef DBUG_OFF</span></div><div class="line"><a name="l01451"></a><span class="lineno"><a class="line" href="classMDL__context.html#a31cf8bad7c905c8ae85921b4ace5ac4a"> 1451</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__context.html#a31cf8bad7c905c8ae85921b4ace5ac4a">has_locks</a>(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> duration) {</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keywordflow">return</span> !m_ticket_store.is_empty(duration);</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  }</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div><div class="line"><a name="l01456"></a><span class="lineno"><a class="line" href="classMDL__context.html#a213edf20be43313e0346a489c2f47dd6"> 1456</a></span>&#160;  <a class="code" href="classMDL__savepoint.html">MDL_savepoint</a> <a class="code" href="classMDL__context.html#a213edf20be43313e0346a489c2f47dd6">mdl_savepoint</a>() {</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classMDL__savepoint.html">MDL_savepoint</a>(m_ticket_store.front(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da675d77e333e224c13925f152d698ca14">MDL_STATEMENT</a>),</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                         m_ticket_store.front(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da410364f4efe7a5b36f7be90f62c12fe9">MDL_TRANSACTION</a>));</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  }</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordtype">void</span> set_explicit_duration_for_all_locks();</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="keywordtype">void</span> set_transaction_duration_for_all_locks();</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="keywordtype">void</span> set_lock_duration(MDL_ticket *mdl_ticket, <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> duration);</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="keywordtype">void</span> release_statement_locks();</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="keywordtype">void</span> release_transactional_locks();</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="keywordtype">void</span> rollback_to_savepoint(<span class="keyword">const</span> <a class="code" href="classMDL__savepoint.html">MDL_savepoint</a> &amp;mdl_savepoint);</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"><a class="line" href="classMDL__context.html#aa476fbd9d7d0352352d551279e853314"> 1469</a></span>&#160;  <a class="code" href="classMDL__context__owner.html">MDL_context_owner</a> *<a class="code" href="classMDL__context.html#aa476fbd9d7d0352352d551279e853314">get_owner</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_owner; }</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">  /** @pre Only valid if we started waiting for lock. */</span></div><div class="line"><a name="l01472"></a><span class="lineno"><a class="line" href="classMDL__context.html#a3563d6d05aeb758f495f44c123c5306b"> 1472</a></span>&#160;  <span class="keyword">inline</span> <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="code" href="classMDL__context.html#a3563d6d05aeb758f495f44c123c5306b">get_deadlock_weight</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="keywordflow">return</span> m_force_dml_deadlock_weight</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;               ? <a class="code" href="classMDL__wait__for__subgraph.html#a5119d1bfb2134d441d8bda0cfb4eb738">MDL_wait_for_subgraph::DEADLOCK_WEIGHT_DML</a></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;               : m_waiting_for-&gt;get_deadlock_weight();</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  }</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div><div class="line"><a name="l01478"></a><span class="lineno"><a class="line" href="classMDL__context.html#a4c29aa7919001edcdfaa82bc360c65df"> 1478</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__context.html#a4c29aa7919001edcdfaa82bc360c65df">init</a>(<a class="code" href="classMDL__context__owner.html">MDL_context_owner</a> *arg) { m_owner = arg; }</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"><a class="line" href="classMDL__context.html#a74608d443dfc4754ce1b14c672a914f1"> 1480</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__context.html#a74608d443dfc4754ce1b14c672a914f1">set_needs_thr_lock_abort</a>(<span class="keywordtype">bool</span> needs_thr_lock_abort) {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">      @note In theory, this member should be modified under protection</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">            of some lock since it can be accessed from different threads.</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="comment">            In practice, this is not necessary as code which reads this</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment">            value and so might miss the fact that value was changed will</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment">            always re-try reading it after small timeout and therefore</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment">            will see the new value eventually.</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    m_needs_thr_lock_abort = needs_thr_lock_abort;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">if</span> (m_needs_thr_lock_abort) {</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="comment">        For MDL_object_lock::notify_conflicting_locks() to work properly</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment">        all context requiring thr_lock aborts should not have any &quot;fast</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">        path&quot; locks.</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      materialize_fast_path_locks();</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    }</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  }</div><div class="line"><a name="l01500"></a><span class="lineno"><a class="line" href="classMDL__context.html#adbc1ba94d5bbd550b7e1d0ab88882060"> 1500</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__context.html#adbc1ba94d5bbd550b7e1d0ab88882060">get_needs_thr_lock_abort</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_needs_thr_lock_abort; }</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"><a class="line" href="classMDL__context.html#a39728ceab1f092a3bf1e8a4ec168f9bb"> 1502</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__context.html#a39728ceab1f092a3bf1e8a4ec168f9bb">set_force_dml_deadlock_weight</a>(<span class="keywordtype">bool</span> force_dml_deadlock_weight) {</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    m_force_dml_deadlock_weight = force_dml_deadlock_weight;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  }</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">    Get pseudo random value in [0 .. 2^31-1] range.</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">    @note We use Linear Congruential Generator with venerable constant</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">          parameters for this.</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment">          It is known to have problems with its lower bits are not being</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">          very random so probably is not good enough for generic use.</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">          However, we only use it to do random dives into MDL_lock objects</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">          hash when searching for unused objects to be freed, and for this</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">          purposes it is sufficient.</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment">          We rely on values of &quot;get_random() % 2^k&quot; expression having &quot;2^k&quot;</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment">          as a period to ensure that random dives eventually cover all hash</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">          (the former can be proven to be true). This also means that there</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">          is no bias towards any specific objects to be expelled (as hash</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">          values don&#39;t repeat), which is nice for performance.</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01522"></a><span class="lineno"><a class="line" href="classMDL__context.html#a6023ebdf937cfcbf9991b10945ad952f"> 1522</a></span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="code" href="classMDL__context.html#a6023ebdf937cfcbf9991b10945ad952f">get_random</a>() {</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="keywordflow">if</span> (m_rand_state &gt; <a class="code" href="my__inttypes_8h.html#ab65fadcd8a8ed6dd7cec3fb95116e466">INT_MAX32</a>) {</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">        Perform lazy initialization of LCG. We can&#39;t initialize it at the</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">        point when MDL_context is created since THD represented through</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">        MDL_context_owner interface is not fully initialized at this point</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">        itself.</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;      m_rand_state = m_owner-&gt;get_rand_seed() &amp; <a class="code" href="my__inttypes_8h.html#ab65fadcd8a8ed6dd7cec3fb95116e466">INT_MAX32</a>;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    }</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    m_rand_state = (m_rand_state * 1103515245 + 12345) &amp; <a class="code" href="my__inttypes_8h.html#ab65fadcd8a8ed6dd7cec3fb95116e466">INT_MAX32</a>;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordflow">return</span> m_rand_state;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  }</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">    Within MDL subsystem this one is only used for DEBUG_SYNC.</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">    Do not use it to peek/poke into other parts of THD from MDL.</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">    @sa MDL_context_owner::get_thd().</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01541"></a><span class="lineno"><a class="line" href="classMDL__context.html#a2260019c16977e8ed6aba3081f16348f"> 1541</a></span>&#160;  <a class="code" href="classTHD.html">THD</a> *<a class="code" href="classMDL__context.html#a2260019c16977e8ed6aba3081f16348f">get_thd</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_owner-&gt;<a class="code" href="classTHD.html#a5d23050388716b61772b6d92ab169efd">get_thd</a>(); }</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment">    If our request for a lock is scheduled, or aborted by the deadlock</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="comment">    detector, the result is recorded in this class.</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01548"></a><span class="lineno"><a class="line" href="classMDL__context.html#aeaf51be6c5480bb1e718aea933f55d9d"> 1548</a></span>&#160;  <a class="code" href="classMDL__wait.html">MDL_wait</a> <a class="code" href="classMDL__context.html#aeaf51be6c5480bb1e718aea933f55d9d">m_wait</a>;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160; <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment">    Lists of all MDL tickets acquired by this connection.</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment">    Lists of MDL tickets:</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment">    ---------------------</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment">    The entire set of locks acquired by a connection can be separated</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment">    in three subsets according to their duration: locks released at</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment">    the end of statement, at the end of transaction and locks are</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment">    released explicitly.</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="comment">    Statement and transactional locks are locks with automatic scope.</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="comment">    They are accumulated in the course of a transaction, and released</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="comment">    either at the end of uppermost statement (for statement locks) or</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="comment">    on COMMIT, ROLLBACK or ROLLBACK TO SAVEPOINT (for transactional</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="comment">    locks). They must not be (and never are) released manually,</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">    i.e. with release_lock() call.</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment">    Tickets with explicit duration are taken for locks that span</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment">    multiple transactions or savepoints.</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">    These are: HANDLER SQL locks (HANDLER SQL is</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">    transaction-agnostic), LOCK TABLES locks (you can COMMIT/etc</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">    under LOCK TABLES, and the locked tables stay locked), user level</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">    locks (GET_LOCK()/RELEASE_LOCK() functions) and</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">    locks implementing &quot;global read lock&quot;.</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">    Statement/transactional locks are always prepended to the</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">    beginning of the appropriate list. In other words, they are</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">    stored in reverse temporal order. Thus, when we rollback to</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">    a savepoint, we start popping and releasing tickets from the</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">    front until we reach the last ticket acquired after the savepoint.</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment">    Locks with explicit duration are not stored in any</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment">    particular order, and among each other can be split into</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">    four sets:</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment">    - LOCK TABLES locks</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment">    - User-level locks</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">    - HANDLER locks</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment">    - GLOBAL READ LOCK locks</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01590"></a><span class="lineno"><a class="line" href="classMDL__context.html#ae3d37a4facb1fb33b41ddda7df064976"> 1590</a></span>&#160;  <a class="code" href="classMDL__ticket__store.html">MDL_ticket_store</a> <a class="code" href="classMDL__context.html#ae3d37a4facb1fb33b41ddda7df064976">m_ticket_store</a>;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"><a class="line" href="classMDL__context.html#a4f6586c3bee7136984083f6dc74952c7"> 1592</a></span>&#160;  <a class="code" href="classMDL__context__owner.html">MDL_context_owner</a> *<a class="code" href="classMDL__context.html#a4f6586c3bee7136984083f6dc74952c7">m_owner</a>;<span class="comment"></span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment">    true -  if for this context we will break protocol and try to</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">            acquire table-level locks while having only S lock on</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">            some table.</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">            To avoid deadlocks which might occur during concurrent</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">            upgrade of SNRW lock on such object to X lock we have to</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">            abort waits for table-level locks for such connections.</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">    false - Otherwise.</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01602"></a><span class="lineno"><a class="line" href="classMDL__context.html#ac2dce4e93fbbc1eaeef6a819fb8e3945"> 1602</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__context.html#ac2dce4e93fbbc1eaeef6a819fb8e3945">m_needs_thr_lock_abort</a>;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">    Indicates that we need to use DEADLOCK_WEIGHT_DML deadlock</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">    weight for this context and ignore the deadlock weight provided</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">    by the MDL_wait_for_subgraph object which we are waiting for.</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">    @note Can be changed only when there is a guarantee that this</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment">          MDL_context is not waiting for a metadata lock or table</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="comment">          definition entry.</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01613"></a><span class="lineno"><a class="line" href="classMDL__context.html#aa5664bc101a22b6af0490fc6b1b8f98b"> 1613</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__context.html#aa5664bc101a22b6af0490fc6b1b8f98b">m_force_dml_deadlock_weight</a>;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">    Read-write lock protecting m_waiting_for member.</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">    @note The fact that this read-write lock prefers readers is</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">          important as deadlock detector won&#39;t work correctly</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">          otherwise. @sa Comment for MDL_lock::m_rwlock.</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01622"></a><span class="lineno"><a class="line" href="classMDL__context.html#a7071f0afcce4718309d55797bdc165c0"> 1622</a></span>&#160;  <a class="code" href="structmysql__prlock__t.html">mysql_prlock_t</a> <a class="code" href="classMDL__context.html#a7071f0afcce4718309d55797bdc165c0">m_LOCK_waiting_for</a>;<span class="comment"></span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">    Tell the deadlock detector what metadata lock or table</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">    definition cache entry this session is waiting for.</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">    In principle, this is redundant, as information can be found</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">    by inspecting waiting queues, but we&#39;d very much like it to be</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">    readily available to the wait-for graph iterator.</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01630"></a><span class="lineno"><a class="line" href="classMDL__context.html#acccb108b2dcf787b7f942b58382aafbf"> 1630</a></span>&#160;  <a class="code" href="classMDL__wait__for__subgraph.html">MDL_wait_for_subgraph</a> *<a class="code" href="classMDL__context.html#acccb108b2dcf787b7f942b58382aafbf">m_waiting_for</a>;<span class="comment"></span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">    Thread&#39;s pins (a.k.a. hazard pointers) to be used by lock-free</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment">    implementation of MDL_map::m_locks container. NULL if pins are</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment">    not yet allocated from container&#39;s pinbox.</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01636"></a><span class="lineno"><a class="line" href="classMDL__context.html#ab4e7fe8ce114384c37ce158f3527c26f"> 1636</a></span>&#160;  <a class="code" href="structLF__PINS.html">LF_PINS</a> *<a class="code" href="classMDL__context.html#ab4e7fe8ce114384c37ce158f3527c26f">m_pins</a>;<span class="comment"></span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment">    State for pseudo random numbers generator (PRNG) which output</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment">    is used to perform random dives into MDL_lock objects hash</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">    when searching for unused objects to free.</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01642"></a><span class="lineno"><a class="line" href="classMDL__context.html#a8a6858d2b6a0b853b9bdc28263079efe"> 1642</a></span>&#160;  <a class="code" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="code" href="classMDL__context.html#a8a6858d2b6a0b853b9bdc28263079efe">m_rand_state</a>;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  MDL_ticket *find_ticket(MDL_request *<a class="code" href="namespacedd.html#ac154034c902d8b970316eb24b5bb17b7">mdl_req</a>, <a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> *duration);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  <span class="keywordtype">void</span> release_locks_stored_before(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> duration,</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                                   MDL_ticket *sentinel);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  <span class="keywordtype">void</span> release_lock(<a class="code" href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a> duration, MDL_ticket *ticket);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  <span class="keywordtype">bool</span> try_acquire_lock_impl(MDL_request *<a class="code" href="namespacedd_1_1sdi.html#af01bdf5d23d30e39aad11ff273c55b87">mdl_request</a>, MDL_ticket **out_ticket);</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <span class="keywordtype">void</span> materialize_fast_path_locks();</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <span class="keyword">friend</span> <span class="keywordtype">bool</span> <a class="code" href="namespacemdl__unittest.html#aea02b0b10192df462ad24a7058f16ae1">mdl_unittest::test_drive_fix_pins</a>(<a class="code" href="classMDL__context.html">MDL_context</a> *);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;  <span class="keywordtype">bool</span> fix_pins();</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  <span class="keywordtype">void</span> find_deadlock();</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  <span class="keywordtype">bool</span> visit_subgraph(<a class="code" href="classMDL__wait__for__graph__visitor.html">MDL_wait_for_graph_visitor</a> *dvisitor);</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment">  /** Inform the deadlock detector there is an edge in the wait-for graph. */</span></div><div class="line"><a name="l01661"></a><span class="lineno"><a class="line" href="classMDL__context.html#afd74a4227cf8ddea993d96ee3be25331"> 1661</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__context.html#afd74a4227cf8ddea993d96ee3be25331">will_wait_for</a>(<a class="code" href="classMDL__wait__for__subgraph.html">MDL_wait_for_subgraph</a> *waiting_for_arg) {</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment">      Before starting wait for any resource we need to materialize</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment">      all &quot;fast path&quot; tickets belonging to this thread. Otherwise</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="comment">      locks acquired which are represented by these tickets won&#39;t</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="comment">      be present in wait-for graph and could cause missed deadlocks.</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment">      It is OK for context which doesn&#39;t wait for any resource to</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">      have &quot;fast path&quot; tickets, as such context can&#39;t participate</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">      in any deadlock.</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    materialize_fast_path_locks();</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    <a class="code" href="components_2services_2mysql__rwlock_8h.html#a2bb95995c827632ffaab607ad86375cd">mysql_prlock_wrlock</a>(&amp;m_LOCK_waiting_for);</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    m_waiting_for = waiting_for_arg;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    <a class="code" href="components_2services_2mysql__rwlock_8h.html#aecb3475a13a4f4e9508a8b9f4e920fc0">mysql_prlock_unlock</a>(&amp;m_LOCK_waiting_for);</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  }</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">  /** Remove the wait-for edge from the graph after we&#39;re done waiting. */</span></div><div class="line"><a name="l01680"></a><span class="lineno"><a class="line" href="classMDL__context.html#ad5d3fb033110d449d894c95f33f6d9b1"> 1680</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__context.html#ad5d3fb033110d449d894c95f33f6d9b1">done_waiting_for</a>() {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    <a class="code" href="components_2services_2mysql__rwlock_8h.html#a2bb95995c827632ffaab607ad86375cd">mysql_prlock_wrlock</a>(&amp;m_LOCK_waiting_for);</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    m_waiting_for = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <a class="code" href="components_2services_2mysql__rwlock_8h.html#aecb3475a13a4f4e9508a8b9f4e920fc0">mysql_prlock_unlock</a>(&amp;m_LOCK_waiting_for);</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  }</div><div class="line"><a name="l01685"></a><span class="lineno"><a class="line" href="classMDL__context.html#aaca0ec235888a94af4dd25107a8af389"> 1685</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__context.html#aaca0ec235888a94af4dd25107a8af389">lock_deadlock_victim</a>() { <a class="code" href="components_2services_2mysql__rwlock_8h.html#a56ac1c548d8a344de5d60bb855c6dbe6">mysql_prlock_rdlock</a>(&amp;m_LOCK_waiting_for); }</div><div class="line"><a name="l01686"></a><span class="lineno"><a class="line" href="classMDL__context.html#af3a0ef8ba360e3d48885f711723aa3ea"> 1686</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__context.html#af3a0ef8ba360e3d48885f711723aa3ea">unlock_deadlock_victim</a>() { <a class="code" href="components_2services_2mysql__rwlock_8h.html#aecb3475a13a4f4e9508a8b9f4e920fc0">mysql_prlock_unlock</a>(&amp;m_LOCK_waiting_for); }</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <a class="code" href="classMDL__context.html">MDL_context</a>(<span class="keyword">const</span> <a class="code" href="classMDL__context.html">MDL_context</a> &amp;rhs);      <span class="comment">/* not implemented */</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <a class="code" href="classMDL__context.html">MDL_context</a> &amp;operator=(<a class="code" href="classMDL__context.html">MDL_context</a> &amp;rhs); <span class="comment">/* not implemented */</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;};</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="keywordtype">void</span> <a class="code" href="mdl_8h.html#a160bee7404e7cf77f30f0906dd25d69b">mdl_init</a>();</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="keywordtype">void</span> <a class="code" href="mdl_8h.html#aab480d981bdab19ddc287ed3beb3c281">mdl_destroy</a>();</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="preprocessor">#ifndef DBUG_OFF</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="keyword">extern</span> <a class="code" href="structmysql__mutex__t.html">mysql_mutex_t</a> <a class="code" href="group__Data__Dictionary.html#ga99c8e1e3e72cd74032d5f11c486911fd">LOCK_open</a>;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="comment">  Metadata locking subsystem tries not to grant more than</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="comment">  max_write_lock_count high priority, strong locks successively,</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">  to avoid starving out weak, lower priority locks.</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="keyword">extern</span> <a class="code" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> <a class="code" href="mdl_8h.html#af3a3420c5e72f749905304d03a19fffc">max_write_lock_count</a>;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="keyword">extern</span> <a class="code" href="my__inttypes_8h.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="mdl_8h.html#a35272ac313bfb1544659ff2a035dad7f">mdl_locks_unused_locks_low_water</a>;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">  Default value for threshold for number of unused MDL_lock objects after</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment">  exceeding which we start considering freeing them. Only unit tests use</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">  different threshold value.</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01714"></a><span class="lineno"><a class="line" href="mdl_8h.html#a3ad10e3cfef426aaa679a47623796fc3"> 1714</a></span>&#160;<span class="keyword">const</span> <a class="code" href="my__inttypes_8h.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="mdl_8h.html#a3ad10e3cfef426aaa679a47623796fc3">MDL_LOCKS_UNUSED_LOCKS_LOW_WATER_DEFAULT</a> = 1000;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="comment">  Ratio of unused/total MDL_lock objects after exceeding which we</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="comment">  start trying to free unused MDL_lock objects (assuming that</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment">  mdl_locks_unused_locks_low_water threshold is passed as well).</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment">  Note that this value should be high enough for our algorithm</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment">  using random dives into hash to work well.</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01723"></a><span class="lineno"><a class="line" href="mdl_8h.html#a9c949d77c2573db605ed0adb507e7d4b"> 1723</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="mdl_8h.html#a9c949d77c2573db605ed0adb507e7d4b">MDL_LOCKS_UNUSED_LOCKS_MIN_RATIO</a> = 0.25;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<a class="code" href="my__inttypes_8h.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="mdl_8h.html#a4f3255cb75ebffb59b75910bd04eb7ae">mdl_get_unused_locks_count</a>();</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="comment">  Inspect if MDL_context is owned by any thread.</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01730"></a><span class="lineno"><a class="line" href="classMDL__lock__is__owned__visitor.html"> 1730</a></span>&#160;<span class="keyword">class </span><a class="code" href="classMDL__lock__is__owned__visitor.html">MDL_lock_is_owned_visitor</a> : <span class="keyword">public</span> <a class="code" href="classMDL__context__visitor.html">MDL_context_visitor</a> {</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01732"></a><span class="lineno"><a class="line" href="classMDL__lock__is__owned__visitor.html#a44c748551fc74ad3f16d8e4972ad66f3"> 1732</a></span>&#160;  <a class="code" href="classMDL__lock__is__owned__visitor.html#a44c748551fc74ad3f16d8e4972ad66f3">MDL_lock_is_owned_visitor</a>() : m_exists(<a class="code" href="config__static_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>) {}</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="comment">    Collects relevant information about the MDL lock owner.</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">    This function is only called by MDL_context::find_lock_owner() when</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">    searching for MDL lock owners to collect extra information about the</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">    owner. As we only need to know that the MDL lock is owned, setting</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">    m_exists to true is enough.</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div><div class="line"><a name="l01743"></a><span class="lineno"><a class="line" href="classMDL__lock__is__owned__visitor.html#af4ac0813112fc9d51a64ddb9a5ef0e2e"> 1743</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classMDL__lock__is__owned__visitor.html#af4ac0813112fc9d51a64ddb9a5ef0e2e">visit_context</a>(<span class="keyword">const</span> <a class="code" href="classMDL__context.html">MDL_context</a> *ctx MY_ATTRIBUTE((unused)))<span class="keyword"> override </span>{</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    m_exists = <span class="keyword">true</span>;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  }</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">  /**</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">    Returns if an owner for the MDL lock being inspected exists.</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">    @return true when MDL lock is owned, false otherwise.</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"><a class="line" href="classMDL__lock__is__owned__visitor.html#aaaafdf721b30fad65d46bdbb639cfb4b"> 1753</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__lock__is__owned__visitor.html#aaaafdf721b30fad65d46bdbb639cfb4b">exists</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_exists; }</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="comment">/* holds information about MDL being owned by any thread */</span></div><div class="line"><a name="l01757"></a><span class="lineno"><a class="line" href="classMDL__lock__is__owned__visitor.html#a81593173d6829dc6862200271c00e5f0"> 1757</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMDL__lock__is__owned__visitor.html#a81593173d6829dc6862200271c00e5f0">m_exists</a>;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;};</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="classMDL__ticket_html_a8dd08e1eb3ca1bd5842cdb028bcfc5cd"><div class="ttname"><a href="classMDL__ticket.html#a8dd08e1eb3ca1bd5842cdb028bcfc5cd">MDL_ticket::is_upgradable_or_exclusive</a></div><div class="ttdeci">bool is_upgradable_or_exclusive() const</div><div class="ttdef"><b>Definition:</b> mdl.h:985</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccba0d978e40251b54054c3385529888387e"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba0d978e40251b54054c3385529888387e">MDL_SHARED</a></div><div class="ttdef"><b>Definition:</b> mdl.h:216</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccba00b10bf62b23e3af95e304378f46b21d"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba00b10bf62b23e3af95e304378f46b21d">MDL_SHARED_WRITE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:254</div></div>
<div class="ttc" id="classMDL__ticket_html"><div class="ttname"><a href="classMDL__ticket.html">MDL_ticket</a></div><div class="ttdoc">A granted metadata lock. </div><div class="ttdef"><b>Definition:</b> mdl.h:965</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccba3f7dc90d30f753a5b96bfb365db37fa5"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba3f7dc90d30f753a5b96bfb365db37fa5">MDL_SHARED_READ_ONLY</a></div><div class="ttdef"><b>Definition:</b> mdl.h:277</div></div>
<div class="ttc" id="my__inttypes_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="my__inttypes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> my_inttypes.h:51</div></div>
<div class="ttc" id="classMDL__context_html_aaca0ec235888a94af4dd25107a8af389"><div class="ttname"><a href="classMDL__context.html#aaca0ec235888a94af4dd25107a8af389">MDL_context::lock_deadlock_victim</a></div><div class="ttdeci">void lock_deadlock_victim()</div><div class="ttdef"><b>Definition:</b> mdl.h:1685</div></div>
<div class="ttc" id="group__GROUP__PARSER_html_gga9e3ffdbaa8d88485570eaf514d3808e5a6c4d52355c694ee12dcd648562757f52"><div class="ttname"><a href="group__GROUP__PARSER.html#gga9e3ffdbaa8d88485570eaf514d3808e5a6c4d52355c694ee12dcd648562757f52">enum_sp_type::PROCEDURE</a></div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3baa6d0d9679075d600212dea21179317e4"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baa6d0d9679075d600212dea21179317e4">MDL_key::FOREIGN_KEY</a></div><div class="ttdef"><b>Definition:</b> mdl.h:402</div></div>
<div class="ttc" id="classMDL__savepoint_html_a4c0cc2fa532cfcb55607f2eff2bcce0d"><div class="ttname"><a href="classMDL__savepoint.html#a4c0cc2fa532cfcb55607f2eff2bcce0d">MDL_savepoint::m_trans_ticket</a></div><div class="ttdeci">MDL_ticket * m_trans_ticket</div><div class="ttdoc">Pointer to last lock with transaction duration which was taken before creation of savepoint...</div><div class="ttdef"><b>Definition:</b> mdl.h:1317</div></div>
<div class="ttc" id="node__connection_8h_html_ac81c8c488b37932224b37520e063ea83"><div class="ttname"><a href="node__connection_8h.html#ac81c8c488b37932224b37520e063ea83">is_connected</a></div><div class="ttdeci">static int is_connected(connection_descriptor *con)</div><div class="ttdef"><b>Definition:</b> node_connection.h:74</div></div>
<div class="ttc" id="structMDL__key_html_ae334aedb745856117233199d67f65d2f"><div class="ttname"><a href="structMDL__key.html#ae334aedb745856117233199d67f65d2f">MDL_key::MDL_key</a></div><div class="ttdeci">MDL_key()</div><div class="ttdef"><b>Definition:</b> mdl.h:743</div></div>
<div class="ttc" id="structMDL__ticket__store_1_1MDL__ticket__handle_html_ab7759ee297d93de3bd2bd033618bba96"><div class="ttname"><a href="structMDL__ticket__store_1_1MDL__ticket__handle.html#ab7759ee297d93de3bd2bd033618bba96">MDL_ticket_store::MDL_ticket_handle::MDL_ticket_handle</a></div><div class="ttdeci">MDL_ticket_handle(MDL_ticket *t, enum_mdl_duration d)</div><div class="ttdef"><b>Definition:</b> mdl.h:1106</div></div>
<div class="ttc" id="mdl_8h_html_a35272ac313bfb1544659ff2a035dad7f"><div class="ttname"><a href="mdl_8h.html#a35272ac313bfb1544659ff2a035dad7f">mdl_locks_unused_locks_low_water</a></div><div class="ttdeci">int32 mdl_locks_unused_locks_low_water</div><div class="ttdoc">Threshold for number of unused MDL_lock objects. </div><div class="ttdef"><b>Definition:</b> mdl.cc:282</div></div>
<div class="ttc" id="classMDL__context_html_a39728ceab1f092a3bf1e8a4ec168f9bb"><div class="ttname"><a href="classMDL__context.html#a39728ceab1f092a3bf1e8a4ec168f9bb">MDL_context::set_force_dml_deadlock_weight</a></div><div class="ttdeci">void set_force_dml_deadlock_weight(bool force_dml_deadlock_weight)</div><div class="ttdef"><b>Definition:</b> mdl.h:1502</div></div>
<div class="ttc" id="template__utils_8h_html_abaa3204566f2da1d5876a24eb4f0e5cd"><div class="ttname"><a href="template__utils_8h.html#abaa3204566f2da1d5876a24eb4f0e5cd">pointer_cast</a></div><div class="ttdeci">T pointer_cast(void *p)</div><div class="ttdoc">Casts from one pointer type, to another, without using reinterpret_cast or C-style cast: foo f; bar *...</div><div class="ttdef"><b>Definition:</b> template_utils.h:73</div></div>
<div class="ttc" id="my__systime_8h_html"><div class="ttname"><a href="my__systime_8h.html">my_systime.h</a></div><div class="ttdoc">Defines for getting and processing the current system type programmatically. </div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba767899e9782aa506f61957d82781abd2"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba767899e9782aa506f61957d82781abd2">MDL_key::FUNCTION</a></div><div class="ttdef"><b>Definition:</b> mdl.h:391</div></div>
<div class="ttc" id="classMDL__context_html_afd74a4227cf8ddea993d96ee3be25331"><div class="ttname"><a href="classMDL__context.html#afd74a4227cf8ddea993d96ee3be25331">MDL_context::will_wait_for</a></div><div class="ttdeci">void will_wait_for(MDL_wait_for_subgraph *waiting_for_arg)</div><div class="ttdoc">Inform the deadlock detector there is an edge in the wait-for graph. </div><div class="ttdef"><b>Definition:</b> mdl.h:1661</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba56f7ee9d3dc0ea534d4538cf050ec49d"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba56f7ee9d3dc0ea534d4538cf050ec49d">MDL_key::RESOURCE_GROUPS</a></div><div class="ttdef"><b>Definition:</b> mdl.h:401</div></div>
<div class="ttc" id="mysql__com_8h_html_a891948a8c3b63220ac0428a8982b0810"><div class="ttname"><a href="mysql__com_8h.html#a891948a8c3b63220ac0428a8982b0810">NAME_CHAR_LEN</a></div><div class="ttdeci">#define NAME_CHAR_LEN</div><div class="ttdoc">Field/table name length. </div><div class="ttdef"><b>Definition:</b> mysql_com.h:59</div></div>
<div class="ttc" id="mdl_8h_html_a1fe73ff402b1179d3ff8bcc9410bfaa9"><div class="ttname"><a href="mdl_8h.html#a1fe73ff402b1179d3ff8bcc9410bfaa9">MAX_MDLKEY_LENGTH</a></div><div class="ttdeci">#define MAX_MDLKEY_LENGTH</div><div class="ttdoc">Maximal length of key for metadata locking subsystem. </div><div class="ttdef"><b>Definition:</b> mdl.h:339</div></div>
<div class="ttc" id="classMDL__lock__is__owned__visitor_html_a44c748551fc74ad3f16d8e4972ad66f3"><div class="ttname"><a href="classMDL__lock__is__owned__visitor.html#a44c748551fc74ad3f16d8e4972ad66f3">MDL_lock_is_owned_visitor::MDL_lock_is_owned_visitor</a></div><div class="ttdeci">MDL_lock_is_owned_visitor()</div><div class="ttdef"><b>Definition:</b> mdl.h:1732</div></div>
<div class="ttc" id="classMDL__wait_html_af7eb4ab4dc1e485b2e855d3f69e0b687"><div class="ttname"><a href="classMDL__wait.html#af7eb4ab4dc1e485b2e855d3f69e0b687">MDL_wait::m_LOCK_wait_status</a></div><div class="ttdeci">mysql_mutex_t m_LOCK_wait_status</div><div class="ttdoc">Condvar which is used for waiting until this context&amp;#39;s pending request can be satisfied or this threa...</div><div class="ttdef"><b>Definition:</b> mdl.h:1348</div></div>
<div class="ttc" id="classMDL__wait_html_ad3f6cee3c2d52fa08440c24a70f4e955"><div class="ttname"><a href="classMDL__wait.html#ad3f6cee3c2d52fa08440c24a70f4e955">MDL_wait::m_COND_wait_status</a></div><div class="ttdeci">mysql_cond_t m_COND_wait_status</div><div class="ttdef"><b>Definition:</b> mdl.h:1349</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba5de8105a5b1406f2788096b0044ed269"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba5de8105a5b1406f2788096b0044ed269">MDL_key::SCHEMA</a></div><div class="ttdef"><b>Definition:</b> mdl.h:389</div></div>
<div class="ttc" id="classMDL__context__visitor_html_aeaf789cf7a5131394d4901e73f7b39d5"><div class="ttname"><a href="classMDL__context__visitor.html#aeaf789cf7a5131394d4901e73f7b39d5">MDL_context_visitor::~MDL_context_visitor</a></div><div class="ttdeci">virtual ~MDL_context_visitor()</div><div class="ttdef"><b>Definition:</b> mdl.h:1377</div></div>
<div class="ttc" id="string_8h_html"><div class="ttname"><a href="string_8h.html">string.h</a></div></div>
<div class="ttc" id="components_2services_2mysql__rwlock_8h_html_aecb3475a13a4f4e9508a8b9f4e920fc0"><div class="ttname"><a href="components_2services_2mysql__rwlock_8h.html#aecb3475a13a4f4e9508a8b9f4e920fc0">mysql_prlock_unlock</a></div><div class="ttdeci">#define mysql_prlock_unlock(T)</div><div class="ttdef"><b>Definition:</b> mysql_rwlock.h:95</div></div>
<div class="ttc" id="structMDL__key_html_a9f5a9fa542651ab35c4f9ee4f99846ee"><div class="ttname"><a href="structMDL__key.html#a9f5a9fa542651ab35c4f9ee4f99846ee">MDL_key::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> mdl.h:705</div></div>
<div class="ttc" id="structmysql__cond__t_html"><div class="ttname"><a href="structmysql__cond__t.html">mysql_cond_t</a></div><div class="ttdoc">An instrumented cond structure. </div><div class="ttdef"><b>Definition:</b> mysql_cond_bits.h:49</div></div>
<div class="ttc" id="namespacemdl__unittest_html"><div class="ttname"><a href="namespacemdl__unittest.html">mdl_unittest</a></div><div class="ttdef"><b>Definition:</b> mdl.h:56</div></div>
<div class="ttc" id="classI__P__List__iterator_html"><div class="ttname"><a href="classI__P__List__iterator.html">I_P_List_iterator</a></div><div class="ttdoc">Iterator for I_P_List. </div><div class="ttdef"><b>Definition:</b> sql_plist.h:30</div></div>
<div class="ttc" id="my__inttypes_8h_html"><div class="ttname"><a href="my__inttypes_8h.html">my_inttypes.h</a></div><div class="ttdoc">Some integer typedefs for easier portability. </div></div>
<div class="ttc" id="classMDL__context_html_aeaf51be6c5480bb1e718aea933f55d9d"><div class="ttname"><a href="classMDL__context.html#aeaf51be6c5480bb1e718aea933f55d9d">MDL_context::m_wait</a></div><div class="ttdeci">MDL_wait m_wait</div><div class="ttdoc">If our request for a lock is scheduled, or aborted by the deadlock detector, the result is recorded i...</div><div class="ttdef"><b>Definition:</b> mdl.h:1548</div></div>
<div class="ttc" id="mdl_8h_html_a1e6fbbe4110a5b3e32f1a8c13dd1a329"><div class="ttname"><a href="mdl_8h.html#a1e6fbbe4110a5b3e32f1a8c13dd1a329">MDL_request_list</a></div><div class="ttdeci">I_P_List&lt; MDL_request, I_P_List_adapter&lt; MDL_request, &amp;MDL_request::next_in_list, &amp;MDL_request::prev_in_list &gt;, I_P_List_counter &gt; MDL_request_list</div><div class="ttdef"><b>Definition:</b> mdl.h:1385</div></div>
<div class="ttc" id="memcached_8c_html_a4acff8232e4aec9cd5c6dc200ac55ef3"><div class="ttname"><a href="memcached_8c.html#a4acff8232e4aec9cd5c6dc200ac55ef3">mutex</a></div><div class="ttdeci">pthread_mutex_t mutex</div><div class="ttdef"><b>Definition:</b> memcached.c:384</div></div>
<div class="ttc" id="classMDL__ticket_html_aac8808e99159aafeabd6ed1bde13894f"><div class="ttname"><a href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894f">MDL_ticket::enum_psi_status</a></div><div class="ttdeci">enum_psi_status</div><div class="ttdoc">Status of lock request represented by the ticket as reflected in P_S. </div><div class="ttdef"><b>Definition:</b> mdl.h:1012</div></div>
<div class="ttc" id="classMDL__lock__is__owned__visitor_html"><div class="ttname"><a href="classMDL__lock__is__owned__visitor.html">MDL_lock_is_owned_visitor</a></div><div class="ttdoc">Inspect if MDL_context is owned by any thread. </div><div class="ttdef"><b>Definition:</b> mdl.h:1730</div></div>
<div class="ttc" id="namespacedd_1_1sdi_html_af01bdf5d23d30e39aad11ff273c55b87"><div class="ttname"><a href="namespacedd_1_1sdi.html#af01bdf5d23d30e39aad11ff273c55b87">dd::sdi::mdl_request</a></div><div class="ttdeci">MDL_request * mdl_request(const Import_target &amp;t, MEM_ROOT *mem_root)</div><div class="ttdoc">Creates an MDL_request for exclusive MDL on the table being imported. </div><div class="ttdef"><b>Definition:</b> sdi_api.cc:244</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccbac314c015883c75ddcbdad3ceccd0bb73"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbac314c015883c75ddcbdad3ceccd0bb73">MDL_EXCLUSIVE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:311</div></div>
<div class="ttc" id="classMDL__context__owner_html"><div class="ttname"><a href="classMDL__context__owner.html">MDL_context_owner</a></div><div class="ttdoc">An interface to separate the MDL module from the THD, and the rest of the server code. </div><div class="ttdef"><b>Definition:</b> mdl.h:83</div></div>
<div class="ttc" id="structMDL__key_html_a5f901f5163e7887d1e482241e4813f9e"><div class="ttname"><a href="structMDL__key.html#a5f901f5163e7887d1e482241e4813f9e">MDL_key::length</a></div><div class="ttdeci">uint length() const</div><div class="ttdef"><b>Definition:</b> mdl.h:409</div></div>
<div class="ttc" id="classMDL__lock_html"><div class="ttname"><a href="classMDL__lock.html">MDL_lock</a></div><div class="ttdoc">The lock context. </div><div class="ttdef"><b>Definition:</b> mdl.cc:426</div></div>
<div class="ttc" id="classMDL__savepoint_html_afea95c3996c91d17d6cee03b9e0bef98"><div class="ttname"><a href="classMDL__savepoint.html#afea95c3996c91d17d6cee03b9e0bef98">MDL_savepoint::MDL_savepoint</a></div><div class="ttdeci">MDL_savepoint(MDL_ticket *stmt_ticket, MDL_ticket *trans_ticket)</div><div class="ttdef"><b>Definition:</b> mdl.h:1302</div></div>
<div class="ttc" id="classMDL__context_html_ae36680261ff26d6eb9ea19e2a290294d"><div class="ttname"><a href="classMDL__context.html#ae36680261ff26d6eb9ea19e2a290294d">MDL_context::has_locks</a></div><div class="ttdeci">bool has_locks() const</div><div class="ttdef"><b>Definition:</b> mdl.h:1444</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccb"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccb">enum_mdl_type</a></div><div class="ttdeci">enum_mdl_type</div><div class="ttdoc">Type of metadata lock request. </div><div class="ttdef"><b>Definition:</b> mdl.h:181</div></div>
<div class="ttc" id="structMDL__key_html_ac6f4051535fef0ad4f557a551bd1aa77"><div class="ttname"><a href="structMDL__key.html#ac6f4051535fef0ad4f557a551bd1aa77">MDL_key::get_wait_state_name</a></div><div class="ttdeci">const PSI_stage_info * get_wait_state_name() const</div><div class="ttdoc">Get thread state name to be used in case when we have to wait on resource identified by key...</div><div class="ttdef"><b>Definition:</b> mdl.h:749</div></div>
<div class="ttc" id="structMDL__key_html_a0fd5e296b28b81a930cd59df5f23df59"><div class="ttname"><a href="structMDL__key.html#a0fd5e296b28b81a930cd59df5f23df59">MDL_key::cmp</a></div><div class="ttdeci">int cmp(const MDL_key *rhs) const</div><div class="ttdoc">Compare two MDL keys lexicographically. </div><div class="ttdef"><b>Definition:</b> mdl.h:718</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba27968b8eb4c5885673c044279eddfa9d"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba27968b8eb4c5885673c044279eddfa9d">MDL_key::USER_LEVEL_LOCK</a></div><div class="ttdef"><b>Definition:</b> mdl.h:396</div></div>
<div class="ttc" id="classMDL__request_html_ab30e06e36d9191120575cc0c0402554a"><div class="ttname"><a href="classMDL__request.html#ab30e06e36d9191120575cc0c0402554a">MDL_request::key</a></div><div class="ttdeci">MDL_key key</div><div class="ttdoc">A lock is requested based on a fully qualified name and type. </div><div class="ttdef"><b>Definition:</b> mdl.h:803</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba4f789972af09de8649e3b2a2e0ff0d7a"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba4f789972af09de8649e3b2a2e0ff0d7a">MDL_key::COMMIT</a></div><div class="ttdef"><b>Definition:</b> mdl.h:395</div></div>
<div class="ttc" id="structMDL__key_html_a1b08a07c4e9650a662feabb466507404"><div class="ttname"><a href="structMDL__key.html#a1b08a07c4e9650a662feabb466507404">MDL_key::ptr</a></div><div class="ttdeci">const uchar * ptr() const</div><div class="ttdef"><b>Definition:</b> mdl.h:408</div></div>
<div class="ttc" id="classMDL__context_html_a33fe77708ce2d770e0b0145e1a6d9f24"><div class="ttname"><a href="classMDL__context.html#a33fe77708ce2d770e0b0145e1a6d9f24">MDL_context::operator=</a></div><div class="ttdeci">MDL_context &amp; operator=(MDL_context &amp;rhs)</div></div>
<div class="ttc" id="mysql__com_8h_html_a4853f6c25c8394fd57c4d99f61d5cd89"><div class="ttname"><a href="mysql__com_8h.html#a4853f6c25c8394fd57c4d99f61d5cd89">NAME_LEN</a></div><div class="ttdeci">#define NAME_LEN</div><div class="ttdef"><b>Definition:</b> mysql_com.h:67</div></div>
<div class="ttc" id="classMDL__lock__is__owned__visitor_html_af4ac0813112fc9d51a64ddb9a5ef0e2e"><div class="ttname"><a href="classMDL__lock__is__owned__visitor.html#af4ac0813112fc9d51a64ddb9a5ef0e2e">MDL_lock_is_owned_visitor::visit_context</a></div><div class="ttdeci">void visit_context(const MDL_context *ctx) override</div><div class="ttdoc">Collects relevant information about the MDL lock owner. </div><div class="ttdef"><b>Definition:</b> mdl.h:1743</div></div>
<div class="ttc" id="classMDL__context_html_a213edf20be43313e0346a489c2f47dd6"><div class="ttname"><a href="classMDL__context.html#a213edf20be43313e0346a489c2f47dd6">MDL_context::mdl_savepoint</a></div><div class="ttdeci">MDL_savepoint mdl_savepoint()</div><div class="ttdef"><b>Definition:</b> mdl.h:1456</div></div>
<div class="ttc" id="group__psi__abi__mdl_html_gae84cbe4318c91ae4325248f8204e3edc"><div class="ttname"><a href="group__psi__abi__mdl.html#gae84cbe4318c91ae4325248f8204e3edc">PSI_metadata_lock</a></div><div class="ttdeci">struct PSI_metadata_lock PSI_metadata_lock</div><div class="ttdef"><b>Definition:</b> psi_mdl_bits.h:51</div></div>
<div class="ttc" id="classMDL__wait__for__graph__visitor_html_ad2e6efb3798e08ce8efa992b0ccbba38"><div class="ttname"><a href="classMDL__wait__for__graph__visitor.html#ad2e6efb3798e08ce8efa992b0ccbba38">MDL_wait_for_graph_visitor::m_lock_open_count</a></div><div class="ttdeci">uint m_lock_open_count</div><div class="ttdoc">XXX, hack: During deadlock search, we may need to inspect TABLE_SHAREs and acquire LOCK_open...</div><div class="ttdef"><b>Definition:</b> mdl.h:919</div></div>
<div class="ttc" id="components_2services_2mysql__rwlock_8h_html_a56ac1c548d8a344de5d60bb855c6dbe6"><div class="ttname"><a href="components_2services_2mysql__rwlock_8h.html#a56ac1c548d8a344de5d60bb855c6dbe6">mysql_prlock_rdlock</a></div><div class="ttdeci">#define mysql_prlock_rdlock(T)</div><div class="ttdef"><b>Definition:</b> mysql_rwlock.h:65</div></div>
<div class="ttc" id="m__string_8h_html"><div class="ttname"><a href="m__string_8h.html">m_string.h</a></div></div>
<div class="ttc" id="structMDL__ticket__store_1_1MDL__ticket__handle_html"><div class="ttname"><a href="structMDL__ticket__store_1_1MDL__ticket__handle.html">MDL_ticket_store::MDL_ticket_handle</a></div><div class="ttdoc">Utility struct for representing a ticket pointer and its duration. </div><div class="ttdef"><b>Definition:</b> mdl.h:1101</div></div>
<div class="ttc" id="mdl_8h_html_a7006da9c94c9b6cfb347cfc58b87c30da9f14cfff6379a5bcfdbf708c571feeef"><div class="ttname"><a href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9f14cfff6379a5bcfdbf708c571feeef">MDL_DURATION_END</a></div><div class="ttdef"><b>Definition:</b> mdl.h:335</div></div>
<div class="ttc" id="structMDL__key_html_a5766c840ba81340f39de04e4dfccfcba"><div class="ttname"><a href="structMDL__key.html#a5766c840ba81340f39de04e4dfccfcba">MDL_key::m_length</a></div><div class="ttdeci">uint16 m_length</div><div class="ttdef"><b>Definition:</b> mdl.h:767</div></div>
<div class="ttc" id="classMDL__context_html_aa5664bc101a22b6af0490fc6b1b8f98b"><div class="ttname"><a href="classMDL__context.html#aa5664bc101a22b6af0490fc6b1b8f98b">MDL_context::m_force_dml_deadlock_weight</a></div><div class="ttdeci">bool m_force_dml_deadlock_weight</div><div class="ttdoc">Indicates that we need to use DEADLOCK_WEIGHT_DML deadlock weight for this context and ignore the dea...</div><div class="ttdef"><b>Definition:</b> mdl.h:1613</div></div>
<div class="ttc" id="mysql__cond__bits_8h_html"><div class="ttname"><a href="mysql__cond__bits_8h.html">mysql_cond_bits.h</a></div><div class="ttdoc">Instrumentation helpers for conditions. </div></div>
<div class="ttc" id="classMDL__ticket__store_html"><div class="ttname"><a href="classMDL__ticket__store.html">MDL_ticket_store</a></div><div class="ttdoc">Keep track of MDL_ticket for different durations. </div><div class="ttdef"><b>Definition:</b> mdl.h:1096</div></div>
<div class="ttc" id="structMDL__key_html_a3815fd610e5670602ecffd82b695d1e7"><div class="ttname"><a href="structMDL__key.html#a3815fd610e5670602ecffd82b695d1e7">MDL_key::mdl_key_init</a></div><div class="ttdeci">void mdl_key_init(enum_mdl_namespace mdl_namespace, const char *db, const char *name)</div><div class="ttdoc">Construct a metadata lock key from a triplet (mdl_namespace, database and name). </div><div class="ttdef"><b>Definition:</b> mdl.h:459</div></div>
<div class="ttc" id="classMDL__context_html_ab4e7fe8ce114384c37ce158f3527c26f"><div class="ttname"><a href="classMDL__context.html#ab4e7fe8ce114384c37ce158f3527c26f">MDL_context::m_pins</a></div><div class="ttdeci">LF_PINS * m_pins</div><div class="ttdoc">Thread&amp;#39;s pins (a.k.a. </div><div class="ttdef"><b>Definition:</b> mdl.h:1636</div></div>
<div class="ttc" id="classMDL__wait__for__subgraph_html"><div class="ttname"><a href="classMDL__wait__for__subgraph.html">MDL_wait_for_subgraph</a></div><div class="ttdoc">Abstract class representing an edge in the waiters graph to be traversed by deadlock detection algori...</div><div class="ttdef"><b>Definition:</b> mdl.h:927</div></div>
<div class="ttc" id="mdl_8h_html_a160bee7404e7cf77f30f0906dd25d69b"><div class="ttname"><a href="mdl_8h.html#a160bee7404e7cf77f30f0906dd25d69b">mdl_init</a></div><div class="ttdeci">void mdl_init()</div><div class="ttdoc">Initialize the metadata locking subsystem. </div><div class="ttdef"><b>Definition:</b> mdl.cc:1063</div></div>
<div class="ttc" id="classMDL__ticket_html_a8d8c2d64e19607ad1d38ba7233decbde"><div class="ttname"><a href="classMDL__ticket.html#a8d8c2d64e19607ad1d38ba7233decbde">MDL_ticket::get_duration</a></div><div class="ttdeci">enum_mdl_duration get_duration() const</div><div class="ttdef"><b>Definition:</b> mdl.h:1004</div></div>
<div class="ttc" id="classMDL__ticket__store_html_a2811408e413eb7061f998ea33fb95f6d"><div class="ttname"><a href="classMDL__ticket__store.html#a2811408e413eb7061f998ea33fb95f6d">MDL_ticket_store::m_map</a></div><div class="ttdeci">std::unique_ptr&lt; Ticket_map &gt; m_map</div><div class="ttdef"><b>Definition:</b> mdl.h:1163</div></div>
<div class="ttc" id="mysql__com_8h_html"><div class="ttname"><a href="mysql__com_8h.html">mysql_com.h</a></div><div class="ttdoc">Common definition between mysql server &amp; client. </div></div>
<div class="ttc" id="classMDL__ticket_html_a7bf75eb1d944160a09c85d5ac1188e20"><div class="ttname"><a href="classMDL__ticket.html#a7bf75eb1d944160a09c85d5ac1188e20">MDL_ticket::m_psi</a></div><div class="ttdeci">PSI_metadata_lock * m_psi</div><div class="ttdef"><b>Definition:</b> mdl.h:1084</div></div>
<div class="ttc" id="classMDL__ticket__store_html_afdb16835bf5f5f81453266ee3066a13b"><div class="ttname"><a href="classMDL__ticket__store.html#afdb16835bf5f5f81453266ee3066a13b">MDL_ticket_store::Ticket_map</a></div><div class="ttdeci">std::unordered_multimap&lt; const MDL_key *, MDL_ticket_handle, Hash, Key_equal &gt; Ticket_map</div><div class="ttdef"><b>Definition:</b> mdl.h:1145</div></div>
<div class="ttc" id="classMDL__ticket_html_a88281cdb21f74551799ae0940b89aed1"><div class="ttname"><a href="classMDL__ticket.html#a88281cdb21f74551799ae0940b89aed1">MDL_ticket::prev_in_context</a></div><div class="ttdeci">MDL_ticket ** prev_in_context</div><div class="ttdef"><b>Definition:</b> mdl.h:972</div></div>
<div class="ttc" id="classMDL__wait__for__graph__visitor_html"><div class="ttname"><a href="classMDL__wait__for__graph__visitor.html">MDL_wait_for_graph_visitor</a></div><div class="ttdoc">An abstract class for inspection of a connected subgraph of the wait-for graph. </div><div class="ttdef"><b>Definition:</b> mdl.h:901</div></div>
<div class="ttc" id="my__dbug_8h_html_af5d75f213550ec27715b65d9bdfa45ec"><div class="ttname"><a href="my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a></div><div class="ttdeci">#define DBUG_ASSERT(A)</div><div class="ttdef"><b>Definition:</b> my_dbug.h:199</div></div>
<div class="ttc" id="classMDL__context_html_af3a0ef8ba360e3d48885f711723aa3ea"><div class="ttname"><a href="classMDL__context.html#af3a0ef8ba360e3d48885f711723aa3ea">MDL_context::unlock_deadlock_victim</a></div><div class="ttdeci">void unlock_deadlock_victim()</div><div class="ttdef"><b>Definition:</b> mdl.h:1686</div></div>
<div class="ttc" id="m__string_8h_html_accb13dc1bbc754b77a9ecd9c3e832595"><div class="ttname"><a href="m__string_8h.html#accb13dc1bbc754b77a9ecd9c3e832595">strmake</a></div><div class="ttdeci">char * strmake(char *dst, const char *src, size_t length)</div><div class="ttdef"><b>Definition:</b> strmake.cc:42</div></div>
<div class="ttc" id="structmysql__prlock__t_html"><div class="ttname"><a href="structmysql__prlock__t.html">mysql_prlock_t</a></div><div class="ttdoc">An instrumented prlock structure. </div><div class="ttdef"><b>Definition:</b> mysql_rwlock_bits.h:71</div></div>
<div class="ttc" id="classMDL__savepoint_html_a97ade82fc1d8f4ae62f5d83c0306f5a6"><div class="ttname"><a href="classMDL__savepoint.html#a97ade82fc1d8f4ae62f5d83c0306f5a6">MDL_savepoint::MDL_savepoint</a></div><div class="ttdeci">MDL_savepoint()</div><div class="ttdef"><b>Definition:</b> mdl.h:1299</div></div>
<div class="ttc" id="classMDL__ticket_html_a2b0c1bd15feca45b1b67791de5a3a027"><div class="ttname"><a href="classMDL__ticket.html#a2b0c1bd15feca45b1b67791de5a3a027">MDL_ticket::get_ctx</a></div><div class="ttdeci">MDL_context * get_ctx() const</div><div class="ttdef"><b>Definition:</b> mdl.h:984</div></div>
<div class="ttc" id="structI__P__List__adapter_html"><div class="ttname"><a href="structI__P__List__adapter.html">I_P_List_adapter</a></div><div class="ttdoc">Hook class which via its methods specifies which members of T should be used for participating in a i...</div><div class="ttdef"><b>Definition:</b> sql_plist.h:197</div></div>
<div class="ttc" id="classMDL__ticket__store_html_ae52f4bcf5558071569eef455ec10257c"><div class="ttname"><a href="classMDL__ticket__store.html#ae52f4bcf5558071569eef455ec10257c">MDL_ticket_store::for_each_ticket_in_duration_list</a></div><div class="ttdeci">void for_each_ticket_in_duration_list(enum_mdl_duration dur, CLOS &amp;&amp;clos)</div><div class="ttdoc">Calls the closure provided as argument for each of the MDL_tickets in the given duration. </div><div class="ttdef"><b>Definition:</b> mdl.h:1189</div></div>
<div class="ttc" id="classMDL__ticket_html_aac8808e99159aafeabd6ed1bde13894fa25b458b8a95d18a5f0b6c3fef9f356fb"><div class="ttname"><a href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894fa25b458b8a95d18a5f0b6c3fef9f356fb">MDL_ticket::GRANTED</a></div><div class="ttdef"><b>Definition:</b> mdl.h:1014</div></div>
<div class="ttc" id="classMDL__ticket_html_a1445824789d90c16bd7db55ee8bb8b35"><div class="ttname"><a href="classMDL__ticket.html#a1445824789d90c16bd7db55ee8bb8b35">MDL_ticket::m_is_fast_path</a></div><div class="ttdeci">bool m_is_fast_path</div><div class="ttdoc">Indicates that ticket corresponds to lock acquired using &quot;fast path&quot; algorithm. </div><div class="ttdef"><b>Definition:</b> mdl.h:1075</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccba4288d5afcff407e0f93a104141908442"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba4288d5afcff407e0f93a104141908442">MDL_SHARED_HIGH_PRIO</a></div><div class="ttdef"><b>Definition:</b> mdl.h:233</div></div>
<div class="ttc" id="classMDL__request_html_a2eba1fb8ec80fc083ddee0b45c683294"><div class="ttname"><a href="classMDL__request.html#a2eba1fb8ec80fc083ddee0b45c683294">MDL_request::is_write_lock_request</a></div><div class="ttdeci">bool is_write_lock_request() const</div><div class="ttdoc">Is this a request for a lock which allow data to be updated? </div><div class="ttdef"><b>Definition:</b> mdl.h:847</div></div>
<div class="ttc" id="structPSI__stage__info__v1_html"><div class="ttname"><a href="structPSI__stage__info__v1.html">PSI_stage_info_v1</a></div><div class="ttdoc">Stage instrument information. </div><div class="ttdef"><b>Definition:</b> psi_stage_bits.h:71</div></div>
<div class="ttc" id="classMDL__savepoint_html"><div class="ttname"><a href="classMDL__savepoint.html">MDL_savepoint</a></div><div class="ttdoc">Savepoint for MDL context. </div><div class="ttdef"><b>Definition:</b> mdl.h:1297</div></div>
<div class="ttc" id="psi_2mysql__rwlock_8h_html"><div class="ttname"><a href="psi_2mysql__rwlock_8h.html">mysql_rwlock.h</a></div><div class="ttdoc">Instrumentation helpers for rwlock. </div></div>
<div class="ttc" id="my__systime_8h_html_aefa3851a2bb36f7eaa5a3164f7e881c4"><div class="ttname"><a href="my__systime_8h.html#aefa3851a2bb36f7eaa5a3164f7e881c4">Timeout_type</a></div><div class="ttdeci">std::uint64_t Timeout_type</div><div class="ttdoc">Type alias to reduce chance of coversion errors on timeout values. </div><div class="ttdef"><b>Definition:</b> my_systime.h:126</div></div>
<div class="ttc" id="structMDL__key_html_ac999815f3e2a14c7e385b27aa14ed020"><div class="ttname"><a href="structMDL__key.html#ac999815f3e2a14c7e385b27aa14ed020">MDL_key::m_object_name_length</a></div><div class="ttdeci">uint16 m_object_name_length</div><div class="ttdef"><b>Definition:</b> mdl.h:769</div></div>
<div class="ttc" id="classMDL__release__locks__visitor_html_a587aa8b019da40e5b5a7c3234fbb234b"><div class="ttname"><a href="classMDL__release__locks__visitor.html#a587aa8b019da40e5b5a7c3234fbb234b">MDL_release_locks_visitor::~MDL_release_locks_visitor</a></div><div class="ttdeci">virtual ~MDL_release_locks_visitor()</div><div class="ttdef"><b>Definition:</b> mdl.h:1362</div></div>
<div class="ttc" id="structMDL__key_html_a9cf18b0c96bed61e47f9fb959157fb5e"><div class="ttname"><a href="structMDL__key.html#a9cf18b0c96bed61e47f9fb959157fb5e">MDL_key::operator=</a></div><div class="ttdeci">MDL_key &amp; operator=(const MDL_key &amp;rhs)</div><div class="ttdef"><b>Definition:</b> mdl.h:734</div></div>
<div class="ttc" id="classMDL__ticket_html_a51ae7b84f5a61ecf3ae411ee1431f71f"><div class="ttname"><a href="classMDL__ticket.html#a51ae7b84f5a61ecf3ae411ee1431f71f">MDL_ticket::MDL_ticket</a></div><div class="ttdeci">MDL_ticket(MDL_context *ctx_arg, enum_mdl_type type_arg, enum_mdl_duration duration_arg)</div><div class="ttdef"><b>Definition:</b> mdl.h:1022</div></div>
<div class="ttc" id="components_2services_2mysql__rwlock_8h_html_a2bb95995c827632ffaab607ad86375cd"><div class="ttname"><a href="components_2services_2mysql__rwlock_8h.html#a2bb95995c827632ffaab607ad86375cd">mysql_prlock_wrlock</a></div><div class="ttdeci">#define mysql_prlock_wrlock(T)</div><div class="ttdef"><b>Definition:</b> mysql_rwlock.h:75</div></div>
<div class="ttc" id="http__auth__backend__plugin_8cc_html_aee70c8416f705726100824ba89f1e090"><div class="ttname"><a href="http__auth__backend__plugin_8cc.html#aee70c8416f705726100824ba89f1e090">start</a></div><div class="ttdeci">static void start(mysql_harness::PluginFuncEnv *env)</div><div class="ttdef"><b>Definition:</b> http_auth_backend_plugin.cc:161</div></div>
<div class="ttc" id="structMDL__key_html_adf7c11832f60c947a13056463cf22c3f"><div class="ttname"><a href="structMDL__key.html#adf7c11832f60c947a13056463cf22c3f">MDL_key::use_normalized_object_name</a></div><div class="ttdeci">bool use_normalized_object_name() const</div><div class="ttdoc">Check if normalized object name should be used. </div><div class="ttdef"><b>Definition:</b> mdl.h:760</div></div>
<div class="ttc" id="classMDL__context_html_a4f6586c3bee7136984083f6dc74952c7"><div class="ttname"><a href="classMDL__context.html#a4f6586c3bee7136984083f6dc74952c7">MDL_context::m_owner</a></div><div class="ttdeci">MDL_context_owner * m_owner</div><div class="ttdef"><b>Definition:</b> mdl.h:1592</div></div>
<div class="ttc" id="namespacerules__table__service_html_a71d6ca457fe4ae5d5151f92c06cc3fd3"><div class="ttname"><a href="namespacerules__table__service.html#a71d6ca457fe4ae5d5151f92c06cc3fd3">rules_table_service::end</a></div><div class="ttdeci">Cursor end()</div><div class="ttdoc">A past-the-end Cursor. </div><div class="ttdef"><b>Definition:</b> rules_table_service.cc:188</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba87fa3eac99e78ce63bbadf552a6456b1"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba87fa3eac99e78ce63bbadf552a6456b1">MDL_key::TRIGGER</a></div><div class="ttdef"><b>Definition:</b> mdl.h:393</div></div>
<div class="ttc" id="classMDL__request_html_a5c427f6ecbd29a5fc41808444260798d"><div class="ttname"><a href="classMDL__request.html#a5c427f6ecbd29a5fc41808444260798d">MDL_request::MDL_request</a></div><div class="ttdeci">MDL_request()</div><div class="ttdoc">This constructor exists for two reasons: </div><div class="ttdef"><b>Definition:</b> mdl.h:877</div></div>
<div class="ttc" id="classMDL__context_html_a31cf8bad7c905c8ae85921b4ace5ac4a"><div class="ttname"><a href="classMDL__context.html#a31cf8bad7c905c8ae85921b4ace5ac4a">MDL_context::has_locks</a></div><div class="ttdeci">bool has_locks(enum_mdl_duration duration)</div><div class="ttdef"><b>Definition:</b> mdl.h:1451</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccba7f4c8af6f7028729d507769697e1d74b"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba7f4c8af6f7028729d507769697e1d74b">MDL_SHARED_NO_READ_WRITE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:303</div></div>
<div class="ttc" id="classMDL__context_html_ae3d37a4facb1fb33b41ddda7df064976"><div class="ttname"><a href="classMDL__context.html#ae3d37a4facb1fb33b41ddda7df064976">MDL_context::m_ticket_store</a></div><div class="ttdeci">MDL_ticket_store m_ticket_store</div><div class="ttdoc">Lists of all MDL tickets acquired by this connection. </div><div class="ttdef"><b>Definition:</b> mdl.h:1590</div></div>
<div class="ttc" id="classMDL__lock__is__owned__visitor_html_a81593173d6829dc6862200271c00e5f0"><div class="ttname"><a href="classMDL__lock__is__owned__visitor.html#a81593173d6829dc6862200271c00e5f0">MDL_lock_is_owned_visitor::m_exists</a></div><div class="ttdeci">bool m_exists</div><div class="ttdef"><b>Definition:</b> mdl.h:1757</div></div>
<div class="ttc" id="classMDL__ticket_html_a873d87712e75f3e7f58399575571198d"><div class="ttname"><a href="classMDL__ticket.html#a873d87712e75f3e7f58399575571198d">MDL_ticket::prev_in_lock</a></div><div class="ttdeci">MDL_ticket ** prev_in_lock</div><div class="ttdef"><b>Definition:</b> mdl.h:979</div></div>
<div class="ttc" id="namespacedblwr_1_1v1_html_a2213362152a12bb25be6185d420285b6"><div class="ttname"><a href="namespacedblwr_1_1v1.html#a2213362152a12bb25be6185d420285b6">dblwr::v1::create</a></div><div class="ttdeci">dberr_t create() noexcept</div><div class="ttdoc">Create the dblwr data structures in the system tablespace. </div><div class="ttdef"><b>Definition:</b> buf0dblwr.cc:1834</div></div>
<div class="ttc" id="my__compiler_8h_html"><div class="ttname"><a href="my__compiler_8h.html">my_compiler.h</a></div><div class="ttdoc">Header for compiler-dependent features. </div></div>
<div class="ttc" id="classMDL__context_html_acccb108b2dcf787b7f942b58382aafbf"><div class="ttname"><a href="classMDL__context.html#acccb108b2dcf787b7f942b58382aafbf">MDL_context::m_waiting_for</a></div><div class="ttdeci">MDL_wait_for_subgraph * m_waiting_for</div><div class="ttdoc">Tell the deadlock detector what metadata lock or table definition cache entry this session is waiting...</div><div class="ttdef"><b>Definition:</b> mdl.h:1630</div></div>
<div class="ttc" id="classMDL__context_html"><div class="ttname"><a href="classMDL__context.html">MDL_context</a></div><div class="ttdoc">Context of the owner of metadata locks. </div><div class="ttdef"><b>Definition:</b> mdl.h:1392</div></div>
<div class="ttc" id="classMDL__context_html_a6023ebdf937cfcbf9991b10945ad952f"><div class="ttname"><a href="classMDL__context.html#a6023ebdf937cfcbf9991b10945ad952f">MDL_context::get_random</a></div><div class="ttdeci">uint get_random()</div><div class="ttdoc">Get pseudo random value in [0 . </div><div class="ttdef"><b>Definition:</b> mdl.h:1522</div></div>
<div class="ttc" id="mdl_8h_html_a7006da9c94c9b6cfb347cfc58b87c30da410364f4efe7a5b36f7be90f62c12fe9"><div class="ttname"><a href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da410364f4efe7a5b36f7be90f62c12fe9">MDL_TRANSACTION</a></div><div class="ttdoc">Locks with transaction duration are automatically released at the end of transaction. </div><div class="ttdef"><b>Definition:</b> mdl.h:328</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccba2be0df3ea6e3cc01a90bf1a2a1cb56c7"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba2be0df3ea6e3cc01a90bf1a2a1cb56c7">MDL_SHARED_UPGRADABLE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:271</div></div>
<div class="ttc" id="my__psi__config_8h_html"><div class="ttname"><a href="my__psi__config_8h.html">my_psi_config.h</a></div><div class="ttdoc">Defines various enable/disable and HAVE_ macros related to the performance schema instrumentation sys...</div></div>
<div class="ttc" id="classMDL__ticket_html_aeb8547f86d05a1eb3990834edc7af9a0"><div class="ttname"><a href="classMDL__ticket.html#aeb8547f86d05a1eb3990834edc7af9a0">MDL_ticket::get_lock</a></div><div class="ttdeci">MDL_lock * get_lock() const</div><div class="ttdef"><b>Definition:</b> mdl.h:990</div></div>
<div class="ttc" id="my__inttypes_8h_html_ac2a9e79eb120216f855626495b7bd18a"><div class="ttname"><a href="my__inttypes_8h.html#ac2a9e79eb120216f855626495b7bd18a">uint16</a></div><div class="ttdeci">uint16_t uint16</div><div class="ttdef"><b>Definition:</b> my_inttypes.h:64</div></div>
<div class="ttc" id="uca-dump_8cc_html_a91ad9478d81a7aaf2593e8d9c3d06a14"><div class="ttname"><a href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a></div><div class="ttdeci">unsigned int uint</div><div class="ttdef"><b>Definition:</b> uca-dump.cc:29</div></div>
<div class="ttc" id="sslopt-case_8h_html_ae00b773898ac853cec38cdf7a08b8e89"><div class="ttname"><a href="sslopt-case_8h.html#ae00b773898ac853cec38cdf7a08b8e89">name</a></div><div class="ttdeci">case opt name</div><div class="ttdef"><b>Definition:</b> sslopt-case.h:32</div></div>
<div class="ttc" id="structMDL__key_html_a213166cb4050445cbe7353448ef5d578"><div class="ttname"><a href="structMDL__key.html#a213166cb4050445cbe7353448ef5d578">MDL_key::is_equal</a></div><div class="ttdeci">bool is_equal(const MDL_key *rhs) const</div><div class="ttdef"><b>Definition:</b> mdl.h:711</div></div>
<div class="ttc" id="my__inttypes_8h_html_ab65fadcd8a8ed6dd7cec3fb95116e466"><div class="ttname"><a href="my__inttypes_8h.html#ab65fadcd8a8ed6dd7cec3fb95116e466">INT_MAX32</a></div><div class="ttdeci">#define INT_MAX32</div><div class="ttdef"><b>Definition:</b> my_inttypes.h:77</div></div>
<div class="ttc" id="group__GROUP__PARSER_html_gga9e3ffdbaa8d88485570eaf514d3808e5a6a72a6a776662a244f82d31e9274a07b"><div class="ttname"><a href="group__GROUP__PARSER.html#gga9e3ffdbaa8d88485570eaf514d3808e5a6a72a6a776662a244f82d31e9274a07b">enum_sp_type::FUNCTION</a></div></div>
<div class="ttc" id="structMDL__key_html_a15c625aec6b2dae280b30f506129da9d"><div class="ttname"><a href="structMDL__key.html#a15c625aec6b2dae280b30f506129da9d">MDL_key::MDL_key</a></div><div class="ttdeci">MDL_key(const MDL_key &amp;rhs)</div><div class="ttdef"><b>Definition:</b> mdl.h:732</div></div>
<div class="ttc" id="mdl_8h_html_af3a3420c5e72f749905304d03a19fffc"><div class="ttname"><a href="mdl_8h.html#af3a3420c5e72f749905304d03a19fffc">max_write_lock_count</a></div><div class="ttdeci">ulong max_write_lock_count</div><div class="ttdef"><b>Definition:</b> thr_lock.cc:122</div></div>
<div class="ttc" id="structMDL__key_html_a46f0e8182ff6b75d2331e3bb4c359b01"><div class="ttname"><a href="structMDL__key.html#a46f0e8182ff6b75d2331e3bb4c359b01">MDL_key::mdl_key_init</a></div><div class="ttdeci">void mdl_key_init(enum_mdl_namespace mdl_namespace, const char *db, const char *normalized_name, size_t normalized_name_len, const char *name)</div><div class="ttdoc">Construct a metadata lock key from a quadruplet (mdl_namespace, database, normalized object name buff...</div><div class="ttdef"><b>Definition:</b> mdl.h:621</div></div>
<div class="ttc" id="namespacebinary__log_1_1transaction_1_1compression_html_a22a3b5d8096f4c73ced74c0b668df0be"><div class="ttname"><a href="namespacebinary__log_1_1transaction_1_1compression.html#a22a3b5d8096f4c73ced74c0b668df0be">binary_log::transaction::compression::type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> base.h:36</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3baf2e116eb16927e1a154c8ca811496293"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baf2e116eb16927e1a154c8ca811496293">MDL_key::CHECK_CONSTRAINT</a></div><div class="ttdef"><b>Definition:</b> mdl.h:403</div></div>
<div class="ttc" id="structMDL__key_html_a192c557333fbba426a4bc31eb59e084e"><div class="ttname"><a href="structMDL__key.html#a192c557333fbba426a4bc31eb59e084e">MDL_key::name_length</a></div><div class="ttdeci">uint name_length() const</div><div class="ttdef"><b>Definition:</b> mdl.h:418</div></div>
<div class="ttc" id="mdl_8h_html_a7006da9c94c9b6cfb347cfc58b87c30da675d77e333e224c13925f152d698ca14"><div class="ttname"><a href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da675d77e333e224c13925f152d698ca14">MDL_STATEMENT</a></div><div class="ttdoc">Locks with statement duration are automatically released at the end of statement or transaction...</div><div class="ttdef"><b>Definition:</b> mdl.h:323</div></div>
<div class="ttc" id="classMDL__request_html"><div class="ttname"><a href="classMDL__request.html">MDL_request</a></div><div class="ttdoc">A pending metadata lock request. </div><div class="ttdef"><b>Definition:</b> mdl.h:784</div></div>
<div class="ttc" id="classMDL__ticket_html_ad9c009e5c097d2159dd142aa7f58e010"><div class="ttname"><a href="classMDL__ticket.html#ad9c009e5c097d2159dd142aa7f58e010">MDL_ticket::next_in_lock</a></div><div class="ttdeci">MDL_ticket * next_in_lock</div><div class="ttdoc">Pointers for participating in the list of satisfied/pending requests for the lock. </div><div class="ttdef"><b>Definition:</b> mdl.h:978</div></div>
<div class="ttc" id="structMDL__key_html_a632b8c5c857c7316d805f2678cb9bfe4"><div class="ttname"><a href="structMDL__key.html#a632b8c5c857c7316d805f2678cb9bfe4">MDL_key::m_ptr</a></div><div class="ttdeci">char m_ptr[MAX_MDLKEY_LENGTH]</div><div class="ttdef"><b>Definition:</b> mdl.h:770</div></div>
<div class="ttc" id="structMDL__key_html_a0ae1f63ddb11b34750db21379eb7ca38"><div class="ttname"><a href="structMDL__key.html#a0ae1f63ddb11b34750db21379eb7ca38">MDL_key::m_db_name_length</a></div><div class="ttdeci">uint16 m_db_name_length</div><div class="ttdef"><b>Definition:</b> mdl.h:768</div></div>
<div class="ttc" id="my__sys_8h_html"><div class="ttname"><a href="my__sys_8h.html">my_sys.h</a></div><div class="ttdoc">Common header for many mysys elements. </div></div>
<div class="ttc" id="classMDL__context__visitor_html"><div class="ttname"><a href="classMDL__context__visitor.html">MDL_context_visitor</a></div><div class="ttdoc">Abstract visitor class for inspecting MDL_context. </div><div class="ttdef"><b>Definition:</b> mdl.h:1375</div></div>
<div class="ttc" id="classI__P__List_html"><div class="ttname"><a href="classI__P__List.html">I_P_List&lt; MDL_ticket, I_P_List_adapter&lt; MDL_ticket, &amp;MDL_ticket::next_in_context, &amp;MDL_ticket::prev_in_context &gt; &gt;</a></div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba111e1a1778189d883d78cf2f747099b2"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba111e1a1778189d883d78cf2f747099b2">MDL_key::EVENT</a></div><div class="ttdef"><b>Definition:</b> mdl.h:394</div></div>
<div class="ttc" id="classMDL__wait__for__subgraph_html_a5119d1bfb2134d441d8bda0cfb4eb738"><div class="ttname"><a href="classMDL__wait__for__subgraph.html#a5119d1bfb2134d441d8bda0cfb4eb738">MDL_wait_for_subgraph::DEADLOCK_WEIGHT_DML</a></div><div class="ttdeci">static const uint DEADLOCK_WEIGHT_DML</div><div class="ttdef"><b>Definition:</b> mdl.h:937</div></div>
<div class="ttc" id="classMDL__ticket_html_acb46c69305fbce6bf80a9ec232359043"><div class="ttname"><a href="classMDL__ticket.html#acb46c69305fbce6bf80a9ec232359043">MDL_ticket::set_duration</a></div><div class="ttdeci">void set_duration(enum_mdl_duration dur)</div><div class="ttdef"><b>Definition:</b> mdl.h:1005</div></div>
<div class="ttc" id="classMDL__ticket__store_html_a21c456b3ed00e418a7eb1c6e4960e0cd"><div class="ttname"><a href="classMDL__ticket__store.html#a21c456b3ed00e418a7eb1c6e4960e0cd">MDL_ticket_store::list_iterator</a></div><div class="ttdeci">List_iterator list_iterator(int di) const</div><div class="ttdoc">Return a P-list iterator to the given duration. </div><div class="ttdef"><b>Definition:</b> mdl.h:1251</div></div>
<div class="ttc" id="classMDL__wait_html"><div class="ttname"><a href="classMDL__wait.html">MDL_wait</a></div><div class="ttdoc">A reliable way to wait on an MDL lock. </div><div class="ttdef"><b>Definition:</b> mdl.h:1324</div></div>
<div class="ttc" id="client__plugin_8cc_html_a7d0fe2f135db987da18cea87b4778737"><div class="ttname"><a href="client__plugin_8cc.html#a7d0fe2f135db987da18cea87b4778737">mem_root</a></div><div class="ttdeci">static MEM_ROOT mem_root</div><div class="ttdef"><b>Definition:</b> client_plugin.cc:109</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba25b17557203e1a4f16207513ef08f89b"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba25b17557203e1a4f16207513ef08f89b">MDL_key::LOCKING_SERVICE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:397</div></div>
<div class="ttc" id="classMDL__lock__is__owned__visitor_html_aaaafdf721b30fad65d46bdbb639cfb4b"><div class="ttname"><a href="classMDL__lock__is__owned__visitor.html#aaaafdf721b30fad65d46bdbb639cfb4b">MDL_lock_is_owned_visitor::exists</a></div><div class="ttdeci">bool exists() const</div><div class="ttdoc">Returns if an owner for the MDL lock being inspected exists. </div><div class="ttdef"><b>Definition:</b> mdl.h:1753</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccbaab91717490fbe232e51005daa348ce4a"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbaab91717490fbe232e51005daa348ce4a">MDL_SHARED_READ</a></div><div class="ttdef"><b>Definition:</b> mdl.h:244</div></div>
<div class="ttc" id="socket__connection_8cc_html_aa02c478707f6f10d071c3ec485ba7cb9"><div class="ttname"><a href="socket__connection_8cc.html#aa02c478707f6f10d071c3ec485ba7cb9">init_psi_keys</a></div><div class="ttdeci">static void init_psi_keys(void)</div><div class="ttdef"><b>Definition:</b> socket_connection.cc:1012</div></div>
<div class="ttc" id="structMDL__key_html_adf33ece720f68e35f1439813694297e4"><div class="ttname"><a href="structMDL__key.html#adf33ece720f68e35f1439813694297e4">MDL_key::name</a></div><div class="ttdeci">const char * name() const</div><div class="ttdef"><b>Definition:</b> mdl.h:414</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba35038f0ecbeea1d4b900bcb6a2e9e811"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba35038f0ecbeea1d4b900bcb6a2e9e811">MDL_key::COLUMN_STATISTICS</a></div><div class="ttdef"><b>Definition:</b> mdl.h:400</div></div>
<div class="ttc" id="system__variable__source__type_8h_html_a67d92d73cedea4ef0fb6d7457e8cd7c0afde1bb5ef04b28059e61df449501f1c0"><div class="ttname"><a href="system__variable__source__type_8h.html#a67d92d73cedea4ef0fb6d7457e8cd7c0afde1bb5ef04b28059e61df449501f1c0">GLOBAL</a></div><div class="ttdef"><b>Definition:</b> system_variable_source_type.h:34</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccbae221f959e09d9dce2ac169f2d8bf33c6"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbae221f959e09d9dce2ac169f2d8bf33c6">MDL_INTENTION_EXCLUSIVE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:193</div></div>
<div class="ttc" id="template__utils_8h_html"><div class="ttname"><a href="template__utils_8h.html">template_utils.h</a></div></div>
<div class="ttc" id="mdl_8h_html_a7006da9c94c9b6cfb347cfc58b87c30da9679cdf9bf84fde07db17025ab004ab4"><div class="ttname"><a href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30da9679cdf9bf84fde07db17025ab004ab4">MDL_EXPLICIT</a></div><div class="ttdoc">Locks with explicit duration survive the end of statement and transaction. </div><div class="ttdef"><b>Definition:</b> mdl.h:333</div></div>
<div class="ttc" id="classMDL__context_html_a7071f0afcce4718309d55797bdc165c0"><div class="ttname"><a href="classMDL__context.html#a7071f0afcce4718309d55797bdc165c0">MDL_context::m_LOCK_waiting_for</a></div><div class="ttdeci">mysql_prlock_t m_LOCK_waiting_for</div><div class="ttdoc">Read-write lock protecting m_waiting_for member. </div><div class="ttdef"><b>Definition:</b> mdl.h:1622</div></div>
<div class="ttc" id="classMDL__release__locks__visitor_html"><div class="ttname"><a href="classMDL__release__locks__visitor.html">MDL_release_locks_visitor</a></div><div class="ttdoc">Base class to find out if the lock represented by a given ticket should be released. </div><div class="ttdef"><b>Definition:</b> mdl.h:1360</div></div>
<div class="ttc" id="psi__stage__bits_8h_html"><div class="ttname"><a href="psi__stage__bits_8h.html">psi_stage_bits.h</a></div><div class="ttdoc">Performance schema instrumentation interface. </div></div>
<div class="ttc" id="classMDL__context_html_a4c29aa7919001edcdfaa82bc360c65df"><div class="ttname"><a href="classMDL__context.html#a4c29aa7919001edcdfaa82bc360c65df">MDL_context::init</a></div><div class="ttdeci">void init(MDL_context_owner *arg)</div><div class="ttdef"><b>Definition:</b> mdl.h:1478</div></div>
<div class="ttc" id="sql__plist_8h_html"><div class="ttname"><a href="sql__plist_8h.html">sql_plist.h</a></div></div>
<div class="ttc" id="structMDL__ticket__store_1_1Hash_html"><div class="ttname"><a href="structMDL__ticket__store_1_1Hash.html">MDL_ticket_store::Hash</a></div><div class="ttdef"><b>Definition:</b> mdl.h:1134</div></div>
<div class="ttc" id="namespacedd_html_ac154034c902d8b970316eb24b5bb17b7"><div class="ttname"><a href="namespacedd.html#ac154034c902d8b970316eb24b5bb17b7">dd::mdl_req</a></div><div class="ttdeci">MDL_request * mdl_req(THD *thd, const Tablespace_table_ref &amp;tref, enum enum_mdl_type mdl_type)</div><div class="ttdoc">Create am MDL_request for a the table identified by a Tablespace_table_ref. </div><div class="ttdef"><b>Definition:</b> tablespace_impl.cc:531</div></div>
<div class="ttc" id="my__dbug_8h_html"><div class="ttname"><a href="my__dbug_8h.html">my_dbug.h</a></div></div>
<div class="ttc" id="classMDL__ticket_html_ae06e96fbda7d5f2ad5a15e583a415f91"><div class="ttname"><a href="classMDL__ticket.html#ae06e96fbda7d5f2ad5a15e583a415f91">MDL_ticket::m_ctx</a></div><div class="ttdeci">MDL_context * m_ctx</div><div class="ttdoc">Context of the owner of the metadata lock ticket. </div><div class="ttdef"><b>Definition:</b> mdl.h:1062</div></div>
<div class="ttc" id="classMDL__wait__for__graph__visitor_html_a07a066c40bdf26ab6f17b352cda08ca4"><div class="ttname"><a href="classMDL__wait__for__graph__visitor.html#a07a066c40bdf26ab6f17b352cda08ca4">MDL_wait_for_graph_visitor::MDL_wait_for_graph_visitor</a></div><div class="ttdeci">MDL_wait_for_graph_visitor()</div><div class="ttdef"><b>Definition:</b> mdl.h:908</div></div>
<div class="ttc" id="mdl_8h_html_a9c949d77c2573db605ed0adb507e7d4b"><div class="ttname"><a href="mdl_8h.html#a9c949d77c2573db605ed0adb507e7d4b">MDL_LOCKS_UNUSED_LOCKS_MIN_RATIO</a></div><div class="ttdeci">const double MDL_LOCKS_UNUSED_LOCKS_MIN_RATIO</div><div class="ttdoc">Ratio of unused/total MDL_lock objects after exceeding which we start trying to free unused MDL_lock ...</div><div class="ttdef"><b>Definition:</b> mdl.h:1723</div></div>
<div class="ttc" id="structmysql__mutex__t_html"><div class="ttname"><a href="structmysql__mutex__t.html">mysql_mutex_t</a></div><div class="ttdoc">An instrumented mutex structure. </div><div class="ttdef"><b>Definition:</b> mysql_mutex_bits.h:49</div></div>
<div class="ttc" id="classMDL__context_html_a2260019c16977e8ed6aba3081f16348f"><div class="ttname"><a href="classMDL__context.html#a2260019c16977e8ed6aba3081f16348f">MDL_context::get_thd</a></div><div class="ttdeci">THD * get_thd() const</div><div class="ttdoc">Within MDL subsystem this one is only used for DEBUG_SYNC. </div><div class="ttdef"><b>Definition:</b> mdl.h:1541</div></div>
<div class="ttc" id="classMDL__wait_html_a49314fb3626164ad6d76f3c6ce96867d"><div class="ttname"><a href="classMDL__wait.html#a49314fb3626164ad6d76f3c6ce96867d">MDL_wait::m_wait_status</a></div><div class="ttdeci">enum_wait_status m_wait_status</div><div class="ttdef"><b>Definition:</b> mdl.h:1350</div></div>
<div class="ttc" id="classMDL__request_html_a0464ab737f8f687f27626d2595a7125a"><div class="ttname"><a href="classMDL__request.html#a0464ab737f8f687f27626d2595a7125a">MDL_request::is_ddl_or_lock_tables_lock_request</a></div><div class="ttdeci">bool is_ddl_or_lock_tables_lock_request() const</div><div class="ttdoc">Is this a request for a strong, DDL/LOCK TABLES-type, of lock? </div><div class="ttdef"><b>Definition:</b> mdl.h:852</div></div>
<div class="ttc" id="structMDL__key_html_a6d996da020bfc9851710b4ca44f30d51"><div class="ttname"><a href="structMDL__key.html#a6d996da020bfc9851710b4ca44f30d51">MDL_key::db_name</a></div><div class="ttdeci">const char * db_name() const</div><div class="ttdef"><b>Definition:</b> mdl.h:411</div></div>
<div class="ttc" id="classMDL__request_html_ad9d3b3f440b67b7665b3a2701a14e2b2"><div class="ttname"><a href="classMDL__request.html#ad9d3b3f440b67b7665b3a2701a14e2b2">MDL_request::next_in_list</a></div><div class="ttdeci">MDL_request * next_in_list</div><div class="ttdoc">Pointers for participating in the list of lock requests for this context. </div><div class="ttdef"><b>Definition:</b> mdl.h:794</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3bae24cd124a1f2be1554d932ad06740c70"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3bae24cd124a1f2be1554d932ad06740c70">MDL_key::TABLESPACE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:388</div></div>
<div class="ttc" id="classMDL__wait_html_a737e84aa2586749f901d7880e7534a03"><div class="ttname"><a href="classMDL__wait.html#a737e84aa2586749f901d7880e7534a03">MDL_wait::enum_wait_status</a></div><div class="ttdeci">enum_wait_status</div><div class="ttdef"><b>Definition:</b> mdl.h:1331</div></div>
<div class="ttc" id="structMDL__ticket__store_1_1Key__equal_html_aae32cdc856f5ee862496f68f2ec170d0"><div class="ttname"><a href="structMDL__ticket__store_1_1Key__equal.html#aae32cdc856f5ee862496f68f2ec170d0">MDL_ticket_store::Key_equal::operator()</a></div><div class="ttdeci">bool operator()(const MDL_key *a, const MDL_key *b) const</div><div class="ttdef"><b>Definition:</b> mdl.h:1139</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3baec5c041db4f492536a66b079fc5ceaaa"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baec5c041db4f492536a66b079fc5ceaaa">MDL_key::TABLE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:390</div></div>
<div class="ttc" id="mysql__mutex__bits_8h_html"><div class="ttname"><a href="mysql__mutex__bits_8h.html">mysql_mutex_bits.h</a></div><div class="ttdoc">ABI for instrumented mutexes. </div></div>
<div class="ttc" id="my__alloc_8h_html_a28315dc6f65bdd04a2c84b4aca4ca248"><div class="ttname"><a href="my__alloc_8h.html#a28315dc6f65bdd04a2c84b4aca4ca248">destroy</a></div><div class="ttdeci">void destroy(T *ptr)</div><div class="ttdef"><b>Definition:</b> my_alloc.h:382</div></div>
<div class="ttc" id="classMDL__context_html_a74608d443dfc4754ce1b14c672a914f1"><div class="ttname"><a href="classMDL__context.html#a74608d443dfc4754ce1b14c672a914f1">MDL_context::set_needs_thr_lock_abort</a></div><div class="ttdeci">void set_needs_thr_lock_abort(bool needs_thr_lock_abort)</div><div class="ttdef"><b>Definition:</b> mdl.h:1480</div></div>
<div class="ttc" id="structMDL__ticket__store_1_1Duration_html_ae40dced3df3b7a8229a6754c76bab635"><div class="ttname"><a href="structMDL__ticket__store_1_1Duration.html#ae40dced3df3b7a8229a6754c76bab635">MDL_ticket_store::Duration::m_ticket_list</a></div><div class="ttdeci">Ticket_p_list m_ticket_list</div><div class="ttdef"><b>Definition:</b> mdl.h:1117</div></div>
<div class="ttc" id="mdl_8h_html_a3ad10e3cfef426aaa679a47623796fc3"><div class="ttname"><a href="mdl_8h.html#a3ad10e3cfef426aaa679a47623796fc3">MDL_LOCKS_UNUSED_LOCKS_LOW_WATER_DEFAULT</a></div><div class="ttdeci">const int32 MDL_LOCKS_UNUSED_LOCKS_LOW_WATER_DEFAULT</div><div class="ttdoc">Default value for threshold for number of unused MDL_lock objects after exceeding which we start cons...</div><div class="ttdef"><b>Definition:</b> mdl.h:1714</div></div>
<div class="ttc" id="my__inttypes_8h_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="my__inttypes_8h.html#ab7903878916593daecbeb95b98115ab0">int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> my_inttypes.h:65</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccba625286b5c7930c17c05fea3ffef0c1da"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba625286b5c7930c17c05fea3ffef0c1da">MDL_SHARED_NO_WRITE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:291</div></div>
<div class="ttc" id="mdl_8h_html_aab480d981bdab19ddc287ed3beb3c281"><div class="ttname"><a href="mdl_8h.html#aab480d981bdab19ddc287ed3beb3c281">mdl_destroy</a></div><div class="ttdeci">void mdl_destroy()</div><div class="ttdoc">Release resources of metadata locking subsystem. </div><div class="ttdef"><b>Definition:</b> mdl.cc:1081</div></div>
<div class="ttc" id="classI__P__List__counter_html"><div class="ttname"><a href="classI__P__List__counter.html">I_P_List_counter</a></div><div class="ttdoc">Element counting policy class for I_P_List which provides basic element counting. ...</div><div class="ttdef"><b>Definition:</b> sql_plist.h:221</div></div>
<div class="ttc" id="namespacemdl__unittest_html_aea02b0b10192df462ad24a7058f16ae1"><div class="ttname"><a href="namespacemdl__unittest.html#aea02b0b10192df462ad24a7058f16ae1">mdl_unittest::test_drive_fix_pins</a></div><div class="ttdeci">bool test_drive_fix_pins(MDL_context *)</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3b"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3b">MDL_key::enum_mdl_namespace</a></div><div class="ttdeci">enum_mdl_namespace</div><div class="ttdoc">Object namespaces. </div><div class="ttdef"><b>Definition:</b> mdl.h:385</div></div>
<div class="ttc" id="classMDL__context_html_a8a6858d2b6a0b853b9bdc28263079efe"><div class="ttname"><a href="classMDL__context.html#a8a6858d2b6a0b853b9bdc28263079efe">MDL_context::m_rand_state</a></div><div class="ttdeci">uint m_rand_state</div><div class="ttdoc">State for pseudo random numbers generator (PRNG) which output is used to perform random dives into MD...</div><div class="ttdef"><b>Definition:</b> mdl.h:1642</div></div>
<div class="ttc" id="mdl_8h_html_a7006da9c94c9b6cfb347cfc58b87c30d"><div class="ttname"><a href="mdl_8h.html#a7006da9c94c9b6cfb347cfc58b87c30d">enum_mdl_duration</a></div><div class="ttdeci">enum_mdl_duration</div><div class="ttdoc">Duration of metadata lock. </div><div class="ttdef"><b>Definition:</b> mdl.h:318</div></div>
<div class="ttc" id="structMDL__key_html_abcae5989a7728de6cb2d822d7a66487b"><div class="ttname"><a href="structMDL__key.html#abcae5989a7728de6cb2d822d7a66487b">MDL_key::MDL_key</a></div><div class="ttdeci">MDL_key(enum_mdl_namespace namespace_arg, const char *db_arg, const char *name_arg)</div><div class="ttdef"><b>Definition:</b> mdl.h:739</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3baa803317d088b4287ee5eee2f5e745705"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baa803317d088b4287ee5eee2f5e745705">MDL_key::SRID</a></div><div class="ttdef"><b>Definition:</b> mdl.h:398</div></div>
<div class="ttc" id="structMDL__ticket__store_1_1Duration_html"><div class="ttname"><a href="structMDL__ticket__store_1_1Duration.html">MDL_ticket_store::Duration</a></div><div class="ttdef"><b>Definition:</b> mdl.h:1116</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba8a1977cedcb3056c1b44c58a54cd2a32"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba8a1977cedcb3056c1b44c58a54cd2a32">MDL_key::ACL_CACHE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:399</div></div>
<div class="ttc" id="classMDL__context_html_a0c46960d79806f52abbf0ba43af6ad04"><div class="ttname"><a href="classMDL__context.html#a0c46960d79806f52abbf0ba43af6ad04">MDL_context::Ticket_iterator</a></div><div class="ttdeci">Ticket_list::Iterator Ticket_iterator</div><div class="ttdef"><b>Definition:</b> mdl.h:1399</div></div>
<div class="ttc" id="classTHD_html_a5d23050388716b61772b6d92ab169efd"><div class="ttname"><a href="classTHD.html#a5d23050388716b61772b6d92ab169efd">THD::get_thd</a></div><div class="ttdeci">THD * get_thd() override</div><div class="ttdoc">Within MDL subsystem this one is only used for DEBUG_SYNC. </div><div class="ttdef"><b>Definition:</b> sql_class.h:2711</div></div>
<div class="ttc" id="structMDL__key_html_a36785e32ba57b9150984ba23f714d7ab"><div class="ttname"><a href="structMDL__key.html#a36785e32ba57b9150984ba23f714d7ab">MDL_key::col_name</a></div><div class="ttdeci">const char * col_name() const</div><div class="ttdef"><b>Definition:</b> mdl.h:420</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3baac972459c46835d6d698ba1b5e16d9ac"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3baac972459c46835d6d698ba1b5e16d9ac">MDL_key::PROCEDURE</a></div><div class="ttdef"><b>Definition:</b> mdl.h:392</div></div>
<div class="ttc" id="structMEM__ROOT_html"><div class="ttname"><a href="structMEM__ROOT.html">MEM_ROOT</a></div><div class="ttdoc">The MEM_ROOT is a simple arena, where allocations are carved out of larger blocks. </div><div class="ttdef"><b>Definition:</b> my_alloc.h:77</div></div>
<div class="ttc" id="structMDL__key_html_a391ec4bd98fec6852a48f7856546ed3ba0905d47dab5686782d127c119b855e58"><div class="ttname"><a href="structMDL__key.html#a391ec4bd98fec6852a48f7856546ed3ba0905d47dab5686782d127c119b855e58">MDL_key::BACKUP_LOCK</a></div><div class="ttdef"><b>Definition:</b> mdl.h:387</div></div>
<div class="ttc" id="mdl_8h_html_a4f3255cb75ebffb59b75910bd04eb7ae"><div class="ttname"><a href="mdl_8h.html#a4f3255cb75ebffb59b75910bd04eb7ae">mdl_get_unused_locks_count</a></div><div class="ttdeci">int32 mdl_get_unused_locks_count()</div><div class="ttdoc">Get number of unused MDL_lock objects in MDL_map cache. </div><div class="ttdef"><b>Definition:</b> mdl.cc:1093</div></div>
<div class="ttc" id="structMDL__key_html_aca5b38f1f41d1d99e86f8cd92b0cc838"><div class="ttname"><a href="structMDL__key.html#aca5b38f1f41d1d99e86f8cd92b0cc838">MDL_key::mdl_key_init</a></div><div class="ttdeci">void mdl_key_init(enum_mdl_namespace mdl_namespace, const char *db, const char *name, const char *column_name)</div><div class="ttdoc">Construct a metadata lock key from a quadruplet (mdl_namespace, database, table and column name)...</div><div class="ttdef"><b>Definition:</b> mdl.h:506</div></div>
<div class="ttc" id="classMDL__context__owner_html_af1667fc1048ba40286d4d9dfee184b1d"><div class="ttname"><a href="classMDL__context__owner.html#af1667fc1048ba40286d4d9dfee184b1d">MDL_context_owner::~MDL_context_owner</a></div><div class="ttdeci">virtual ~MDL_context_owner()</div><div class="ttdef"><b>Definition:</b> mdl.h:85</div></div>
<div class="ttc" id="classMDL__ticket_html_aa725b028ddf1a762c7ad32616c59f209"><div class="ttname"><a href="classMDL__ticket.html#aa725b028ddf1a762c7ad32616c59f209">MDL_ticket::m_hton_notified</a></div><div class="ttdeci">bool m_hton_notified</div><div class="ttdoc">Indicates that ticket corresponds to lock request which required storage engine notification during i...</div><div class="ttdef"><b>Definition:</b> mdl.h:1082</div></div>
<div class="ttc" id="classMDL__request_html_afc3bbdffd2a0b94c57a4fa34aac7262e"><div class="ttname"><a href="classMDL__request.html#afc3bbdffd2a0b94c57a4fa34aac7262e">MDL_request::MDL_request</a></div><div class="ttdeci">MDL_request(const MDL_request &amp;rhs)</div><div class="ttdef"><b>Definition:</b> mdl.h:879</div></div>
<div class="ttc" id="group__Data__Dictionary_html_ga99c8e1e3e72cd74032d5f11c486911fd"><div class="ttname"><a href="group__Data__Dictionary.html#ga99c8e1e3e72cd74032d5f11c486911fd">LOCK_open</a></div><div class="ttdeci">mysql_mutex_t LOCK_open</div><div class="ttdoc">LOCK_open protects the following variables/objects: </div><div class="ttdef"><b>Definition:</b> sql_base.cc:244</div></div>
<div class="ttc" id="structMDL__key_html_a409fb8b6038ac18165d3d291373c0319"><div class="ttname"><a href="structMDL__key.html#a409fb8b6038ac18165d3d291373c0319">MDL_key::mdl_key_init</a></div><div class="ttdeci">void mdl_key_init(const MDL_key *rhs)</div><div class="ttdef"><b>Definition:</b> mdl.h:696</div></div>
<div class="ttc" id="classMDL__request_html_a9e7ba7a3d2a1b9374f0dbe0be197854a"><div class="ttname"><a href="classMDL__request.html#a9e7ba7a3d2a1b9374f0dbe0be197854a">MDL_request::prev_in_list</a></div><div class="ttdeci">MDL_request ** prev_in_list</div><div class="ttdef"><b>Definition:</b> mdl.h:795</div></div>
<div class="ttc" id="classMDL__ticket__store_html_a17e85e55ea73767a816343393c85ed62"><div class="ttname"><a href="classMDL__ticket__store.html#a17e85e55ea73767a816343393c85ed62">MDL_ticket_store::for_each_ticket_in_ticket_lists</a></div><div class="ttdeci">void for_each_ticket_in_ticket_lists(CLOS &amp;&amp;clos)</div><div class="ttdoc">Calls the closure provided as argument for each of the MDL_tickets in the store. </div><div class="ttdef"><b>Definition:</b> mdl.h:1202</div></div>
<div class="ttc" id="structMDL__key_html_a15208204dd28afcfc756941b368b236a"><div class="ttname"><a href="structMDL__key.html#a15208204dd28afcfc756941b368b236a">MDL_key::db_name_length</a></div><div class="ttdeci">uint db_name_length() const</div><div class="ttdef"><b>Definition:</b> mdl.h:412</div></div>
<div class="ttc" id="classMDL__ticket_html_aa81a40be82b1e8015e3c0be5c99d5d72"><div class="ttname"><a href="classMDL__ticket.html#aa81a40be82b1e8015e3c0be5c99d5d72">MDL_ticket::m_duration</a></div><div class="ttdeci">enum_mdl_duration m_duration</div><div class="ttdoc">Duration of lock represented by this ticket. </div><div class="ttdef"><b>Definition:</b> mdl.h:1057</div></div>
<div class="ttc" id="structMDL__key_html_a9c8cd488f84b3b9b530217cba55217e0"><div class="ttname"><a href="structMDL__key.html#a9c8cd488f84b3b9b530217cba55217e0">MDL_key::mdl_key_init</a></div><div class="ttdeci">void mdl_key_init(enum_mdl_namespace mdl_namespace, const char *part_key, size_t part_key_length, size_t db_length)</div><div class="ttdoc">Construct a metadata lock key from namespace and partial key, which contains info about object databa...</div><div class="ttdef"><b>Definition:</b> mdl.h:672</div></div>
<div class="ttc" id="classMDL__ticket_html_aac8808e99159aafeabd6ed1bde13894fa9e51c37e4c5598d6aef6f48fbd5a2f16"><div class="ttname"><a href="classMDL__ticket.html#aac8808e99159aafeabd6ed1bde13894fa9e51c37e4c5598d6aef6f48fbd5a2f16">MDL_ticket::PRE_ACQUIRE_NOTIFY</a></div><div class="ttdef"><b>Definition:</b> mdl.h:1015</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccbab7a8d987a0c31983ba38d4f36ab91129"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccbab7a8d987a0c31983ba38d4f36ab91129">MDL_TYPE_END</a></div><div class="ttdef"><b>Definition:</b> mdl.h:313</div></div>
<div class="ttc" id="classMDL__ticket__store_html_a971d3a003a90f2626df37f74e654cb16"><div class="ttname"><a href="classMDL__ticket__store.html#a971d3a003a90f2626df37f74e654cb16">MDL_ticket_store::MDL_ticket_store</a></div><div class="ttdeci">MDL_ticket_store()</div><div class="ttdoc">Constructs store. </div><div class="ttdef"><b>Definition:</b> mdl.h:1177</div></div>
<div class="ttc" id="classMDL__context_html_ad5d3fb033110d449d894c95f33f6d9b1"><div class="ttname"><a href="classMDL__context.html#ad5d3fb033110d449d894c95f33f6d9b1">MDL_context::done_waiting_for</a></div><div class="ttdeci">void done_waiting_for()</div><div class="ttdoc">Remove the wait-for edge from the graph after we&amp;#39;re done waiting. </div><div class="ttdef"><b>Definition:</b> mdl.h:1680</div></div>
<div class="ttc" id="mysql__rwlock__bits_8h_html"><div class="ttname"><a href="mysql__rwlock__bits_8h.html">mysql_rwlock_bits.h</a></div><div class="ttdoc">Instrumentation helpers for rwlock. </div></div>
<div class="ttc" id="classMDL__request_html_a6cc77971b2b370098d3e6d89f816180e"><div class="ttname"><a href="classMDL__request.html#a6cc77971b2b370098d3e6d89f816180e">MDL_request::set_type</a></div><div class="ttdeci">void set_type(enum_mdl_type type_arg)</div><div class="ttdoc">Set type of lock request. </div><div class="ttdef"><b>Definition:</b> mdl.h:835</div></div>
<div class="ttc" id="psi__mdl__bits_8h_html"><div class="ttname"><a href="psi__mdl__bits_8h.html">psi_mdl_bits.h</a></div><div class="ttdoc">Performance schema instrumentation interface. </div></div>
<div class="ttc" id="structMDL__key_html_a9986ed7c9c3c0b887bdfb39d99a145e3"><div class="ttname"><a href="structMDL__key.html#a9986ed7c9c3c0b887bdfb39d99a145e3">MDL_key::col_name_length</a></div><div class="ttdeci">uint col_name_length() const</div><div class="ttdef"><b>Definition:</b> mdl.h:432</div></div>
<div class="ttc" id="classMDL__ticket_html_ad87cffc63ead6571484ac6f142f0b19f"><div class="ttname"><a href="classMDL__ticket.html#ad87cffc63ead6571484ac6f142f0b19f">MDL_ticket::get_type</a></div><div class="ttdeci">enum_mdl_type get_type() const</div><div class="ttdef"><b>Definition:</b> mdl.h:989</div></div>
<div class="ttc" id="classMDL__context_html_a3563d6d05aeb758f495f44c123c5306b"><div class="ttname"><a href="classMDL__context.html#a3563d6d05aeb758f495f44c123c5306b">MDL_context::get_deadlock_weight</a></div><div class="ttdeci">uint get_deadlock_weight() const</div><div class="ttdef"><b>Definition:</b> mdl.h:1472</div></div>
<div class="ttc" id="classMDL__ticket_html_a517f72ec428bd824bb4b5c97e1842b92"><div class="ttname"><a href="classMDL__ticket.html#a517f72ec428bd824bb4b5c97e1842b92">MDL_ticket::~MDL_ticket</a></div><div class="ttdeci">~MDL_ticket() override</div><div class="ttdef"><b>Definition:</b> mdl.h:1039</div></div>
<div class="ttc" id="classMDL__context_html_ab0e1989a324f4a2918656245963f23fa"><div class="ttname"><a href="classMDL__context.html#ab0e1989a324f4a2918656245963f23fa">MDL_context::Ticket_list</a></div><div class="ttdeci">I_P_List&lt; MDL_ticket, I_P_List_adapter&lt; MDL_ticket, &amp;MDL_ticket::next_in_context, &amp;MDL_ticket::prev_in_context &gt; &gt; Ticket_list</div><div class="ttdef"><b>Definition:</b> mdl.h:1397</div></div>
<div class="ttc" id="my__inttypes_8h_html_a718b4eb2652c286f4d42dc18a8e71a1a"><div class="ttname"><a href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a></div><div class="ttdeci">unsigned long ulong</div><div class="ttdef"><b>Definition:</b> my_inttypes.h:48</div></div>
<div class="ttc" id="classMDL__context_html_ac2dce4e93fbbc1eaeef6a819fb8e3945"><div class="ttname"><a href="classMDL__context.html#ac2dce4e93fbbc1eaeef6a819fb8e3945">MDL_context::m_needs_thr_lock_abort</a></div><div class="ttdeci">bool m_needs_thr_lock_abort</div><div class="ttdoc">true - if for this context we will break protocol and try to acquire table-level locks while having o...</div><div class="ttdef"><b>Definition:</b> mdl.h:1602</div></div>
<div class="ttc" id="structMDL__ticket__store_1_1Key__equal_html"><div class="ttname"><a href="structMDL__ticket__store_1_1Key__equal.html">MDL_ticket_store::Key_equal</a></div><div class="ttdef"><b>Definition:</b> mdl.h:1138</div></div>
<div class="ttc" id="structMDL__key_html_a3c7ad7b46384b15803aa0b77b3bd52f6"><div class="ttname"><a href="structMDL__key.html#a3c7ad7b46384b15803aa0b77b3bd52f6">MDL_key::mdl_namespace</a></div><div class="ttdeci">enum_mdl_namespace mdl_namespace() const</div><div class="ttdef"><b>Definition:</b> mdl.h:444</div></div>
<div class="ttc" id="config__static_8h_html_a65e9886d74aaee76545e83dd09011727"><div class="ttname"><a href="config__static_8h.html#a65e9886d74aaee76545e83dd09011727">false</a></div><div class="ttdeci">#define false</div><div class="ttdef"><b>Definition:</b> config_static.h:43</div></div>
<div class="ttc" id="classMDL__ticket_html_ac31749048c6f9a807473ef2849bda7fb"><div class="ttname"><a href="classMDL__ticket.html#ac31749048c6f9a807473ef2849bda7fb">MDL_ticket::m_lock</a></div><div class="ttdeci">MDL_lock * m_lock</div><div class="ttdoc">Pointer to the lock object for this lock ticket. </div><div class="ttdef"><b>Definition:</b> mdl.h:1067</div></div>
<div class="ttc" id="mdl_8h_html_a7b8d423b69ef9a2842803673e2f0dccba81e412dfaef917fa454e800c21909149"><div class="ttname"><a href="mdl_8h.html#a7b8d423b69ef9a2842803673e2f0dccba81e412dfaef917fa454e800c21909149">MDL_SHARED_WRITE_LOW_PRIO</a></div><div class="ttdef"><b>Definition:</b> mdl.h:260</div></div>
<div class="ttc" id="classMDL__savepoint_html_a6cd0387de9d0787ce4ac3a1f94792ee1"><div class="ttname"><a href="classMDL__savepoint.html#a6cd0387de9d0787ce4ac3a1f94792ee1">MDL_savepoint::m_stmt_ticket</a></div><div class="ttdeci">MDL_ticket * m_stmt_ticket</div><div class="ttdoc">Pointer to last lock with statement duration which was taken before creation of savepoint. </div><div class="ttdef"><b>Definition:</b> mdl.h:1312</div></div>
<div class="ttc" id="my__alloc_8h_html"><div class="ttname"><a href="my__alloc_8h.html">my_alloc.h</a></div><div class="ttdoc">This file follows Google coding style, except for the name MEM_ROOT (which is kept for historical rea...</div></div>
<div class="ttc" id="classTHD_html"><div class="ttname"><a href="classTHD.html">THD</a></div><div class="ttdoc">For each client connection we create a separate thread with THD serving as a thread/connection descri...</div><div class="ttdef"><b>Definition:</b> sql_class.h:803</div></div>
<div class="ttc" id="classMDL__context_html_adbc1ba94d5bbd550b7e1d0ab88882060"><div class="ttname"><a href="classMDL__context.html#adbc1ba94d5bbd550b7e1d0ab88882060">MDL_context::get_needs_thr_lock_abort</a></div><div class="ttdeci">bool get_needs_thr_lock_abort() const</div><div class="ttdef"><b>Definition:</b> mdl.h:1500</div></div>
<div class="ttc" id="dialog_8cc_html_ae7bd12bd7c9e418a420087971d0a7e31"><div class="ttname"><a href="dialog_8cc.html#ae7bd12bd7c9e418a420087971d0a7e31">nullptr</a></div><div class="ttdeci">Dialog Client Authentication nullptr</div><div class="ttdef"><b>Definition:</b> dialog.cc:353</div></div>
<div class="ttc" id="namespacedblwr_1_1recv_html_a4d87e29e585a1f0ddb67f6f0b3b2d0ea"><div class="ttname"><a href="namespacedblwr_1_1recv.html#a4d87e29e585a1f0ddb67f6f0b3b2d0ea">dblwr::recv::find</a></div><div class="ttdeci">const byte * find(const Pages *pages, const page_id_t &amp;page_id) noexcept</div><div class="ttdoc">Find a doublewrite copy of a page. </div><div class="ttdef"><b>Definition:</b> buf0dblwr.cc:2222</div></div>
<div class="ttc" id="structLF__PINS_html"><div class="ttname"><a href="structLF__PINS.html">LF_PINS</a></div><div class="ttdef"><b>Definition:</b> lf.h:83</div></div>
<div class="ttc" id="xcom__base_8cc_html_ac261b45b6346e633de22d510c9f6a770"><div class="ttname"><a href="xcom__base_8cc.html#ac261b45b6346e633de22d510c9f6a770">front</a></div><div class="ttdeci">int front</div><div class="ttdef"><b>Definition:</b> xcom_base.cc:3013</div></div>
<div class="ttc" id="classMDL__ticket_html_a74155707577dfd12cc7f47229e4f0d17"><div class="ttname"><a href="classMDL__ticket.html#a74155707577dfd12cc7f47229e4f0d17">MDL_ticket::next_in_context</a></div><div class="ttdeci">MDL_ticket * next_in_context</div><div class="ttdoc">Pointers for participating in the list of lock requests for this context. </div><div class="ttdef"><b>Definition:</b> mdl.h:971</div></div>
<div class="ttc" id="structMDL__key_html"><div class="ttname"><a href="structMDL__key.html">MDL_key</a></div><div class="ttdoc">Metadata lock object key. </div><div class="ttdef"><b>Definition:</b> mdl.h:350</div></div>
<div class="ttc" id="classMDL__context_html_aa476fbd9d7d0352352d551279e853314"><div class="ttname"><a href="classMDL__context.html#aa476fbd9d7d0352352d551279e853314">MDL_context::get_owner</a></div><div class="ttdeci">MDL_context_owner * get_owner() const</div><div class="ttdef"><b>Definition:</b> mdl.h:1469</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5bd71961b401a432086d0fb290a87f3f.html">sql</a></li><li class="navelem"><a class="el" href="mdl_8h.html">mdl.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
