<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: MySQL Component - creating implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('PAGE_COMPONENTS_IMPLEMENTATION.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MySQL Component - creating implementation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Component for the Dynamic Loader needs to be a dynamic library (for example .so or .dll) with specified entry-point method.</p>
<p>The only exception is the MySQL server, for which, for now, it will be statically linked. All these implementation details are hidden away by macros defined in header files. All macros to define Services are specified in service.h, for defining Service Implementations in service_implementation.h and for specifying Components in component_implementation.h.</p>
<h1><a class="anchor" id="EXAMPLE"></a>
The Component example</h1>
<p>Example Components are located in components/example directory. These Components are used also for unit and MTR test, which assures these Components are fully functional and they quality is maintained. The example Services are defined in example_services.h, while implemented in three example Components defined in files example_component1.cc, example_component2.cc, and example_component3.cc. These files are specifically prepared to be used as examples as they provide simplicity and an extensive documentation. The following tutorial bases on these Components and will try to show a process to create similar.</p>
<h2><a class="anchor" id="EXAMPLE_SERVICES"></a>
Services defined in the example</h2>
<p>Example contains definition of 3 Services which will be used to show a general idea of services, basic implementations and simple example of one of concepts possible with the Component Infrastructure. These example Services are defined in example_services.h and are s_mysql_greetings, s_mysql_greetings_localization and s_mysql_example_math.</p>
<h1><a class="anchor" id="TROUBLESHOOTING"></a>
Common problems</h1>
<h1><a class="anchor" id="TUTORIAL"></a>
Step by step tutorial for creating new Component</h1>
<p>The creation of component is a mean to get some functionality exported for the Components infrastructure. It can be divided into several steps:</p><ol type="1">
<li>List all high level functionalities Component is planned to have implemented. This will assure we know exactly what we need to benefit from next steps. In the example, we would like to have a "Hello, World!" string provider and simple math functions.</li>
<li>Look for existing Services, that are designed specifically to provide some part of the new functionalities to reuse them, or other that are in any degree similar in functionality, design or use cases to use as an example. The Component infrastructure is highly oriented on reuse of Services and will benefit with every reuse case, as it will decrease total size of Services. In the example the existing base of Services is really small, with the core Components infrastructure Services available only leading to no reuse possible.</li>
<li>Design list of functions needed to provide all functionalities. Try to make they follow existing patterns and ideas, possibly having some identical to existing ones.</li>
<li>Try to separate groups of functions that specify some complete part of functionality into separate small Services to improve re-usability. Also, try to separate groups that seem to have more potential to be extended or modified in future, because changing existing Services is forbidden, in such a case this will lead to a lot of functions in Services that will be duplicates and will introduce more boilerplate code to implement them. Remove all functions that can be found in fully reused existing Services.</li>
<li>Create definitions of Services, ideally one Service per file, or a group of really closely connected Services. In most cases you want to make these definitions public, in case of MySQL that means placing them in include/mysql/components/services/ directory to include them in mysql-dev package. See example_services.h, which in contrary is not made public and resides in example component source directory.</li>
<li>Create declarations of all handles, the Opaque pointers for all opaque objects that are meant to be returned to the Services users. See usages of DEFINE_SERVICE_HANDLE in registry.h.</li>
<li>Create basic structure of new Component. Use BEGIN_COMPONENT_PROVIDES, BEGIN_COMPONENT_REQUIRES, BEGIN_COMPONENT_METADATA, DECLARE_COMPONENT and DECLARE_LIBRARY_COMPONENTS. Fill in all information necessary to describe the new Component extensively. The example_component1.cc and example_component2.cc shows how structure should look like, and in example_component3.cc there is an example with additional Service references, for which placeholder definitions are kept in header file of the new Component, see example_component3.h. Note the placeholder for the Registry Service, which is available by default in every component.</li>
<li>Create implementations of the desired Service interfaces. Implement handles used, as for example my_h_service_iterator_imp and my_h_service_metadata_iterator_imp in registry.cc. Create separate source and header files for each Service or closely connected group of Services. Remember to include the header file for Service Implementation in the Service Implementation source file to have no linkage problems. The Service Implementations in english_greeting_service_imp.cc and simple_example_math_imp.cc are implementations used in example_component1, polish_greeting_service_imp.cc and example_math_wrapping_imp.cc are implementations for example_component2 and example_component3 respectively.</li>
<li>Make sure component is loaded/initialized before using its services. Atomic variable is_intialized represents the state of the component. Please check the details about the variable from validate_password_imp.cc file.</li>
<li>Using registry acquire/release services inside component's init/deint functions is not supported. All the required services for the component has to be specified under BEGIN_COMPONENT_REQUIRES section only.</li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_EXTENDING.html">Extending MySQL</a></li><li class="navelem"><a class="el" href="PAGE_COMPONENTS.html">Component Subsystem</a></li><li class="navelem"><a class="el" href="PAGE_COMPONENTS_CONCEPTS.html">Component Subsystem Concepts</a></li><li class="navelem"><a class="el" href="PAGE_COMPONENTS_COMPONENT.html">A Component</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
