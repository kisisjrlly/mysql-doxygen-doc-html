<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: mysys/lf_alloc-pin.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lf__alloc-pin_8cc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">lf_alloc-pin.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>wait-free concurrent allocator based on pinning addresses.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;atomic&gt;</code><br />
<code>#include &quot;<a class="el" href="lf_8h_source.html">lf.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__atomic_8h_source.html">my_atomic.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__compiler_8h_source.html">my_compiler.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__dbug_8h_source.html">my_dbug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__inttypes_8h_source.html">my_inttypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__sys_8h_source.html">my_sys.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__thread_8h_source.html">my_thread.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="service__mysql__alloc_8h_source.html">mysql/service_mysql_alloc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mysys__priv_8h_source.html">mysys/mysys_priv.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structst__match__and__save__arg.html">st_match_and_save_arg</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a9177efd5eacc7b0903ab1fc6866cf766"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a9177efd5eacc7b0903ab1fc6866cf766">LF_PINBOX_MAX_PINS</a>&#160;&#160;&#160;65536</td></tr>
<tr class="separator:a9177efd5eacc7b0903ab1fc6866cf766"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75742a07721e5c046f6ae9487792311b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a75742a07721e5c046f6ae9487792311b">pnext_node</a>(<a class="el" href="dtoa_8cc.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>,  <a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a>)&#160;&#160;&#160;(*((void **)(((char *)(<a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a>)) + (<a class="el" href="dtoa_8cc.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>)-&gt;free_ptr_offset)))</td></tr>
<tr class="separator:a75742a07721e5c046f6ae9487792311b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afce5bb8eb6026edb133db5658df8006c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#afce5bb8eb6026edb133db5658df8006c">anext_node</a>(<a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a>)&#160;&#160;&#160;<a class="el" href="lf__alloc-pin_8cc.html#a041d24c239b20c091a930c2f9be9c4ae">next_node</a>(&amp;allocator-&gt;pinbox, (<a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a>))</td></tr>
<tr class="separator:afce5bb8eb6026edb133db5658df8006c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a98248f6720411083c5ed2598fec8254b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a98248f6720411083c5ed2598fec8254b">lf_pinbox_real_free</a> (<a class="el" href="structLF__PINS.html">LF_PINS</a> *pins)</td></tr>
<tr class="separator:a98248f6720411083c5ed2598fec8254b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace3416c162ab02e0612d74df4c6007cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#ace3416c162ab02e0612d74df4c6007cf">lf_pinbox_init</a> (<a class="el" href="structLF__PINBOX.html">LF_PINBOX</a> *pinbox, <a class="el" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> free_ptr_offset, <a class="el" href="lf_8h.html#a4471c507089e2b16759e53b73e89b2a2">lf_pinbox_free_func</a> *free_func, void *free_func_arg)</td></tr>
<tr class="separator:ace3416c162ab02e0612d74df4c6007cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f371e617ccfd9351c4b51a3b825a00b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a4f371e617ccfd9351c4b51a3b825a00b">lf_pinbox_destroy</a> (<a class="el" href="structLF__PINBOX.html">LF_PINBOX</a> *pinbox)</td></tr>
<tr class="separator:a4f371e617ccfd9351c4b51a3b825a00b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ad77889582d7d60d676559df7ccafd3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structLF__PINS.html">LF_PINS</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a9ad77889582d7d60d676559df7ccafd3">lf_pinbox_get_pins</a> (<a class="el" href="structLF__PINBOX.html">LF_PINBOX</a> *pinbox)</td></tr>
<tr class="separator:a9ad77889582d7d60d676559df7ccafd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4231eb8a5de57ce49877a072100c26a2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a4231eb8a5de57ce49877a072100c26a2">lf_pinbox_put_pins</a> (<a class="el" href="structLF__PINS.html">LF_PINS</a> *pins)</td></tr>
<tr class="separator:a4231eb8a5de57ce49877a072100c26a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71c285db0b169c5b0d8f82874c9b62f9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a71c285db0b169c5b0d8f82874c9b62f9">add_to_purgatory</a> (<a class="el" href="structLF__PINS.html">LF_PINS</a> *pins, void *addr)</td></tr>
<tr class="separator:a71c285db0b169c5b0d8f82874c9b62f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6671934407c93c68dd57fb9ab04e82d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a6671934407c93c68dd57fb9ab04e82d6">lf_pinbox_free</a> (<a class="el" href="structLF__PINS.html">LF_PINS</a> *pins, void *addr)</td></tr>
<tr class="separator:a6671934407c93c68dd57fb9ab04e82d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ea5ab56252b8d264ca14a81bc18e731"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a9ea5ab56252b8d264ca14a81bc18e731">match_and_save</a> (void *v_el, void *v_arg)</td></tr>
<tr class="separator:a9ea5ab56252b8d264ca14a81bc18e731"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a041d24c239b20c091a930c2f9be9c4ae"><td class="memItemLeft" align="right" valign="top">static std::atomic&lt; <a class="el" href="my__inttypes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> * &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a041d24c239b20c091a930c2f9be9c4ae">next_node</a> (<a class="el" href="structLF__PINBOX.html">LF_PINBOX</a> *<a class="el" href="dtoa_8cc.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>, <a class="el" href="my__inttypes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a>)</td></tr>
<tr class="separator:a041d24c239b20c091a930c2f9be9c4ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0282d4ab808f192a15b796d2a5267e9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#aa0282d4ab808f192a15b796d2a5267e9">alloc_free</a> (void *v_first, void *v_last, void *v_allocator)</td></tr>
<tr class="separator:aa0282d4ab808f192a15b796d2a5267e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69861bbd8faa0ac35e77f37b3e2626b6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a69861bbd8faa0ac35e77f37b3e2626b6">lf_alloc_init2</a> (<a class="el" href="structLF__ALLOCATOR.html">LF_ALLOCATOR</a> *allocator, <a class="el" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> size, <a class="el" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> free_ptr_offset, <a class="el" href="lf_8h.html#a09ada87b90923f10ba3bf6fe8e7cf1c0">lf_allocator_func</a> *ctor, <a class="el" href="lf_8h.html#a09ada87b90923f10ba3bf6fe8e7cf1c0">lf_allocator_func</a> *dtor)</td></tr>
<tr class="memdesc:a69861bbd8faa0ac35e77f37b3e2626b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize lock-free allocator.  <a href="#a69861bbd8faa0ac35e77f37b3e2626b6">More...</a><br /></td></tr>
<tr class="separator:a69861bbd8faa0ac35e77f37b3e2626b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20d660bda9afb33d82312e509a1ed86b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#a20d660bda9afb33d82312e509a1ed86b">lf_alloc_destroy</a> (<a class="el" href="structLF__ALLOCATOR.html">LF_ALLOCATOR</a> *allocator)</td></tr>
<tr class="separator:a20d660bda9afb33d82312e509a1ed86b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae195ac4e1ba4db71447cc125a86dbf05"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#ae195ac4e1ba4db71447cc125a86dbf05">lf_alloc_new</a> (<a class="el" href="structLF__PINS.html">LF_PINS</a> *pins)</td></tr>
<tr class="separator:ae195ac4e1ba4db71447cc125a86dbf05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0905a955898dffec4c5bd357f12e89a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lf__alloc-pin_8cc.html#ac0905a955898dffec4c5bd357f12e89a">lf_alloc_pool_count</a> (<a class="el" href="structLF__ALLOCATOR.html">LF_ALLOCATOR</a> *allocator)</td></tr>
<tr class="separator:ac0905a955898dffec4c5bd357f12e89a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>wait-free concurrent allocator based on pinning addresses. </p>
<p>It works as follows: every thread (strictly speaking - every CPU, but it's too difficult to do) has a small array of pointers. They're called "pins". Before using an object its address must be stored in this array (pinned). When an object is no longer necessary its address must be removed from this array (unpinned). When a thread wants to free() an object it scans all pins of all threads to see if somebody has this object pinned. If yes - the object is not freed (but stored in a "purgatory"). To reduce the cost of a single free() pins are not scanned on every free() but only added to (thread-local) purgatory. On every LF_PURGATORY_SIZE free() purgatory is scanned and all unpinned objects are freed.</p>
<p>Pins are used to solve ABA problem. To use pins one must obey a pinning protocol:</p>
<ol type="1">
<li>Let's assume that PTR is a shared pointer to an object. Shared means that any thread may modify it anytime to point to a different object and free the old object. Later the freed object may be potentially allocated by another thread. If we're unlucky that other thread may set PTR to point to this object again. This is ABA problem.</li>
<li>Create a local pointer LOCAL_PTR.</li>
<li>Pin the PTR in a loop: do { LOCAL_PTR= PTR; pin(PTR, PIN_NUMBER); } while (LOCAL_PTR != PTR)</li>
<li>It is guaranteed that after the loop has ended, LOCAL_PTR points to an object (or NULL, if PTR may be NULL), that will never be freed. It is not guaranteed though that LOCAL_PTR == PTR (as PTR can change any time)</li>
<li>When done working with the object, remove the pin: unpin(PIN_NUMBER)</li>
<li>When copying pins (as in the list traversing loop: pin(CUR, 1); while () { do // standard { // pinning NEXT=CUR-&gt;next; // loop pin(NEXT, 0); // see #3 } while (NEXT != CUR-&gt;next); // above ... ... CUR=NEXT; pin(CUR, 1); // copy pin[0] to pin[1] } which keeps CUR address constantly pinned), note than pins may be copied only upwards (!!!), that is pin[N] to pin[M], M &gt; N.</li>
<li>Don't keep the object pinned longer than necessary - the number of pins you have is limited (and small), keeping an object pinned prevents its reuse and cause unnecessary mallocs.</li>
</ol>
<p>Explanations:</p>
<ol type="1">
<li>The loop is important. The following can occur: thread1&gt; LOCAL_PTR= PTR thread2&gt; free(PTR); PTR=0; thread1&gt; pin(PTR, PIN_NUMBER); now thread1 cannot access LOCAL_PTR, even if it's pinned, because it points to a freed memory. That is, it <em>must</em> verify that it has indeed pinned PTR, the shared pointer.</li>
<li>When a thread wants to free some LOCAL_PTR, and it scans all lists of pins to see whether it's pinned, it does it upwards, from low pin numbers to high. Thus another thread must copy an address from one pin to another in the same direction - upwards, otherwise the scanning thread may miss it.</li>
</ol>
<p>Implementation details:</p>
<p>Pins are given away from a "pinbox". Pinbox is stack-based allocator. It used dynarray for storing pins, new elements are allocated by dynarray as necessary, old are pushed in the stack for reuse. ABA is solved by versioning a pointer - because we use an array, a pointer to pins is 16 bit, upper 16 bits are used for a version. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="afce5bb8eb6026edb133db5658df8006c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afce5bb8eb6026edb133db5658df8006c">&#9670;&nbsp;</a></span>anext_node</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define anext_node</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a></td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="lf__alloc-pin_8cc.html#a041d24c239b20c091a930c2f9be9c4ae">next_node</a>(&amp;allocator-&gt;pinbox, (<a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9177efd5eacc7b0903ab1fc6866cf766"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9177efd5eacc7b0903ab1fc6866cf766">&#9670;&nbsp;</a></span>LF_PINBOX_MAX_PINS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LF_PINBOX_MAX_PINS&#160;&#160;&#160;65536</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a75742a07721e5c046f6ae9487792311b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75742a07721e5c046f6ae9487792311b">&#9670;&nbsp;</a></span>pnext_node</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pnext_node</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="dtoa_8cc.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(*((void **)(((char *)(<a class="el" href="ctype-tis620_8cc.html#a207fd5507206d307cd63f95374fcd00d">X</a>)) + (<a class="el" href="dtoa_8cc.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>)-&gt;free_ptr_offset)))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a71c285db0b169c5b0d8f82874c9b62f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71c285db0b169c5b0d8f82874c9b62f9">&#9670;&nbsp;</a></span>add_to_purgatory()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void add_to_purgatory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINS.html">LF_PINS</a> *&#160;</td>
          <td class="paramname"><em>pins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aa0282d4ab808f192a15b796d2a5267e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0282d4ab808f192a15b796d2a5267e9">&#9670;&nbsp;</a></span>alloc_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void alloc_free </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>v_first</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>v_last</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>v_allocator</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a20d660bda9afb33d82312e509a1ed86b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20d660bda9afb33d82312e509a1ed86b">&#9670;&nbsp;</a></span>lf_alloc_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lf_alloc_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__ALLOCATOR.html">LF_ALLOCATOR</a> *&#160;</td>
          <td class="paramname"><em>allocator</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a69861bbd8faa0ac35e77f37b3e2626b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69861bbd8faa0ac35e77f37b3e2626b6">&#9670;&nbsp;</a></span>lf_alloc_init2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lf_alloc_init2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__ALLOCATOR.html">LF_ALLOCATOR</a> *&#160;</td>
          <td class="paramname"><em>allocator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>free_ptr_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lf_8h.html#a09ada87b90923f10ba3bf6fe8e7cf1c0">lf_allocator_func</a> *&#160;</td>
          <td class="paramname"><em>ctor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lf_8h.html#a09ada87b90923f10ba3bf6fe8e7cf1c0">lf_allocator_func</a> *&#160;</td>
          <td class="paramname"><em>dtor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize lock-free allocator. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">allocator</td><td>Allocator structure to initialize. </td></tr>
    <tr><td class="paramname">size</td><td>A size of an object to allocate. </td></tr>
    <tr><td class="paramname">free_ptr_offset</td><td>An offset inside the object to a sizeof(void *) memory that is guaranteed to be unused after the object is put in the purgatory. Unused by ANY thread, not only the purgatory owner. This memory will be used to link waiting-to-be-freed objects in a purgatory list. </td></tr>
    <tr><td class="paramname">ctor</td><td>Function to be called after object was malloc()'ed. </td></tr>
    <tr><td class="paramname">dtor</td><td>Function to be called before object is free()'d. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae195ac4e1ba4db71447cc125a86dbf05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae195ac4e1ba4db71447cc125a86dbf05">&#9670;&nbsp;</a></span>lf_alloc_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* lf_alloc_new </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINS.html">LF_PINS</a> *&#160;</td>
          <td class="paramname"><em>pins</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac0905a955898dffec4c5bd357f12e89a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0905a955898dffec4c5bd357f12e89a">&#9670;&nbsp;</a></span>lf_alloc_pool_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> lf_alloc_pool_count </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__ALLOCATOR.html">LF_ALLOCATOR</a> *&#160;</td>
          <td class="paramname"><em>allocator</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4f371e617ccfd9351c4b51a3b825a00b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f371e617ccfd9351c4b51a3b825a00b">&#9670;&nbsp;</a></span>lf_pinbox_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lf_pinbox_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINBOX.html">LF_PINBOX</a> *&#160;</td>
          <td class="paramname"><em>pinbox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6671934407c93c68dd57fb9ab04e82d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6671934407c93c68dd57fb9ab04e82d6">&#9670;&nbsp;</a></span>lf_pinbox_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lf_pinbox_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINS.html">LF_PINS</a> *&#160;</td>
          <td class="paramname"><em>pins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9ad77889582d7d60d676559df7ccafd3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ad77889582d7d60d676559df7ccafd3">&#9670;&nbsp;</a></span>lf_pinbox_get_pins()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structLF__PINS.html">LF_PINS</a>* lf_pinbox_get_pins </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINBOX.html">LF_PINBOX</a> *&#160;</td>
          <td class="paramname"><em>pinbox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ace3416c162ab02e0612d74df4c6007cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace3416c162ab02e0612d74df4c6007cf">&#9670;&nbsp;</a></span>lf_pinbox_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lf_pinbox_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINBOX.html">LF_PINBOX</a> *&#160;</td>
          <td class="paramname"><em>pinbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uca-dump_8cc.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>free_ptr_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lf_8h.html#a4471c507089e2b16759e53b73e89b2a2">lf_pinbox_free_func</a> *&#160;</td>
          <td class="paramname"><em>free_func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>free_func_arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4231eb8a5de57ce49877a072100c26a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4231eb8a5de57ce49877a072100c26a2">&#9670;&nbsp;</a></span>lf_pinbox_put_pins()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lf_pinbox_put_pins </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINS.html">LF_PINS</a> *&#160;</td>
          <td class="paramname"><em>pins</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a98248f6720411083c5ed2598fec8254b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98248f6720411083c5ed2598fec8254b">&#9670;&nbsp;</a></span>lf_pinbox_real_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void lf_pinbox_real_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINS.html">LF_PINS</a> *&#160;</td>
          <td class="paramname"><em>pins</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a9ea5ab56252b8d264ca14a81bc18e731"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ea5ab56252b8d264ca14a81bc18e731">&#9670;&nbsp;</a></span>match_and_save()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int match_and_save </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>v_el</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>v_arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a041d24c239b20c091a930c2f9be9c4ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a041d24c239b20c091a930c2f9be9c4ae">&#9670;&nbsp;</a></span>next_node()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static std::atomic&lt;<a class="el" href="my__inttypes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&gt;&amp; next_node </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLF__PINBOX.html">LF_PINBOX</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="my__inttypes_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>X</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_7507adac5764e4f818c81969b3802964.html">mysys</a></li><li class="navelem"><a class="el" href="lf__alloc-pin_8cc.html">lf_alloc-pin.cc</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
