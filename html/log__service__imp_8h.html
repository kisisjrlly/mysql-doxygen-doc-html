<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: components/logging/log_service_imp.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('log__service__imp_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">log_service_imp.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="log__service_8h_source.html">mysql/components/services/log_service.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="log__shared_8h_source.html">mysql/components/services/log_shared.h</a>&gt;</code><br />
</div>
<p><a href="log__service__imp_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlog__service__imp.html">log_service_imp</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac3b18181caf7858bb23cde6253f55604"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="log__service__imp_8h.html#ac3b18181caf7858bb23cde6253f55604">REQUIRES_SERVICE_PLACEHOLDER</a> (registry)</td></tr>
<tr class="memdesc:ac3b18181caf7858bb23cde6253f55604"><td class="mdescLeft">&#160;</td><td class="mdescRight">LOG SINKS: WRITERS.  <a href="#ac3b18181caf7858bb23cde6253f55604">More...</a><br /></td></tr>
<tr class="separator:ac3b18181caf7858bb23cde6253f55604"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac3b18181caf7858bb23cde6253f55604"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3b18181caf7858bb23cde6253f55604">&#9670;&nbsp;</a></span>REQUIRES_SERVICE_PLACEHOLDER()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">REQUIRES_SERVICE_PLACEHOLDER </td>
          <td>(</td>
          <td class="paramtype">registry&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>LOG SINKS: WRITERS. </p>
<p>There are two types of writers. "Modern services" like the XML or JSON writers don't care whether a key/value pair is a table name or an error message, or what &ndash; a string is a string. Thus, these services have to cover just three cases: format as string, format as integer, or format as float. Trivial.</p>
<p>The other type is services that write to a fixed format, like the traditional MySQL error log. The error log has a timestamp, connection ID, severity label, and an error message, in that exact order. The traditional error log service therefore doesn't attempt to process all the information we might send its way; it just needs to know how to retrieve the few items it's interested in, and about printing them in the prescribed order. All other information is ignored. Still simple, just a different kind of simple.</p>
<p>INPUT</p>
<p>So as we've seen, both kinds of writers are quite straightforward. It's either "handle 3 storage classes" (which is simple) or "handle as
many specific item types are you're interested in". The first group (which handles any and all items) is actually the simplest, and perhaps easier to read and understand than the second group, as they're little more than a glorified</p>
<p>switch (item-&gt;item_class) { case STRING: sprintf(buf, "%s", item-&gt;value.data_string); break; case INTEGER: sprintf(buf, "%d", item-&gt;value.data_integer); break; case FLOAT: sprintf(buf, "%f", item-&gt;value.data_float); break; }</p>
<p>Anything beyond that in a given source file is usually either boilerplate code needed by the component framework (which is going to be there no matter how simple or complex our actual writer is) or required by the specific output format the sink is intended to generate (writing e.g. JSON rows or XML tags, escaping characters/entities in string values, indentation, and so on).</p>
<p>ERROR MESSAGES THAT AREN'T STRINGS, AND OTHER INSANITY</p>
<p>So what if a service is looking for the error message, but it turns out that message is not a string?</p>
<p>Well, first off, the well-know items (log message, error number, ...) all also have a well-known storage class, so an error message for example shall always be of string class. Our code (submission API, filter, ...) ensures this. Additionally, there is code in the server to help guard against broken modules that violate these guarantees, so individual loadable services won't have to check that themselves, either.</p>
<p>In summary, if a case like that happens, it's a bug, and it's a bug that we have tools to detect. The expectation is NOT that services have to convert data-types on the fly and be able to handle error messages that are numbers, or integers that come wrapped in a string, or any such nonsense. It is true that modern writers like XML or JSON gracefully handle this case at zero overhead (as they only look at storage class, not type or semantics), but this is very specifically NOT required of any service. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_ba7003cabaac1cb590f88da6d6afc151.html">logging</a></li><li class="navelem"><a class="el" href="log__service__imp_8h.html">log_service_imp.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
