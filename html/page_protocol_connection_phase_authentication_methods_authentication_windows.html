<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: Windows Native Authentication</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_protocol_connection_phase_authentication_methods_authentication_windows.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Windows Native Authentication </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Authentication::WindowsAuth:</p>
<ul>
<li>
The server name is <em>authentication_windows</em>  </li>
<li>
The client name is <em>authentication_windows_client</em>  </li>
</ul>
<p>The Windows Native Authentication method is more complex than the other methods and extends the auth protocol as it has to send more data forth and back than the old handshake permitted.</p>
<p>Basically it wraps the output of the [Negotiate SSP]("http://msdn.microsoft.com/en-us/library/windows/desktop/aa378748(v=VS.85).aspx") in the Auth Phase protocol which either means <a class="el" href="page_protocol_connection_phase_authentication_methods_authentication_windows.html#sect_protocol_connection_phase_authentication_methods_authentication_windows_ntlm">NTLM</a> or <a class="el" href="page_protocol_connection_phase_authentication_methods_authentication_windows.html#sect_protocol_connection_phase_authentication_methods_authentication_windows_spnego">SPNEGO</a> are used as underlying protocol.</p>
<p>Due to the implementation details the Windows Native Authentication method doesn't use the fast path of the <a class="el" href="page_protocol_connection_phase.html">Connection Phase</a>, but is only triggered on request as part of the <a class="el" href="page_protocol_connection_phase_packets_protocol_auth_switch_request.html">Protocol::AuthSwitchRequest:</a> packet.</p>
<dl class="section note"><dt>Note</dt><dd>Due to implementation details (again) the first packet sent from the client to the server is expected to be either <ul>
<li>
254 bytes long max or </li>
<li>
send the first 254 bytes first, appended by 1 byte with a magic value plus a 2nd packet with rest of the data</li>
</ul>
Also following windows authentication packets don't get split.</dd></dl>
<p>The client will send either a <a class="el" href="page_protocol_connection_phase_authentication_methods_authentication_windows.html#sect_protocol_connection_phase_authentication_methods_authentication_windows_spnego">SPNEGO</a> or a <a class="el" href="page_protocol_connection_phase_authentication_methods_authentication_windows.html#sect_protocol_connection_phase_authentication_methods_authentication_windows_ntlm">NTLM</a> packet as a next packet.</p>
<p>To implement the protocol one can use several existing implementations: </p><ul>
<li>
MS Windows provides <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa375509(v=VS.85).aspx">InitializeSecurityContextW</a> and <a href="http://msdn.microsoft.com/en-us/library/aa374703.aspx">AcceptSecurityContext</a>  </li>
<li>
A open source implemenation of NTML, SPNEGO and Kerberos5 are provided by <a href="http://www.h5l.org/">Heimdal</a>  </li>
<li>
Java6 added SPNEGO support to <a href="http://download.oracle.com/javase/6/docs/technotes/guides/security/jgss/lab/part5.html#SPNEGO">JGSS</a> which also provides the NTLM and Kerberos5 support. </li>
</ul>
<dl class="section see"><dt>See also</dt><dd>win_auth_handshake_client</dd></dl>
<h1><a class="anchor" id="sect_protocol_connection_phase_authentication_methods_authentication_windows_ntlm"></a>
NTLM</h1>
<dl class="section note"><dt>Note</dt><dd><a href="http://msdn.microsoft.com/en-us/library/aa480152.aspx#appcomp_topic16">Removed in Windows Vista and 2008</a></dd>
<dd>
Documented in <a href="https://msdn.microsoft.com/en-us/library/cc207842.aspx">MSDN</a></dd></dl>
<h1><a class="anchor" id="sect_protocol_connection_phase_authentication_methods_authentication_windows_spnego"></a>
SPNEGO</h1>
<p>Uses GSS-API as protocol and negotiates the proper auth-method automatically. </p><dl class="section user"><dt>Tip</dt><dd>To decode these packets by hand you need to read: <ul>
<li>
<a href="http://tools.ietf.org/html/rfc2743.html#page-81">RFC2473</a> Section 3.1: Mechanism-independent Token Format </li>
<li>
<a href="http://tools.ietf.org/html/rfc4178.html#page-7">RFC4178</a> Section 4: Token Defintions </li>
<li>
<a href="http://www.itu.int/ITU-T/studygroups/com17/languages/X.680-0207.pdf">X.680</a> ASN.1 </li>
<li>
<a href="http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf">X.690</a> DER  </li>
</ul>
</dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_PROTOCOL.html">Client/Server Protocol</a></li><li class="navelem"><a class="el" href="page_protocol_connection_lifecycle.html">Connection Lifecycle</a></li><li class="navelem"><a class="el" href="page_protocol_connection_phase.html">Connection Phase</a></li><li class="navelem"><a class="el" href="page_protocol_connection_phase_authentication_methods.html">Authentication Methods</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
