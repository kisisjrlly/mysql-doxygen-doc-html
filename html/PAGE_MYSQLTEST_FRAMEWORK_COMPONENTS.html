<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: MySQL Test Framework Components</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('PAGE_MYSQLTEST_FRAMEWORK_COMPONENTS.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MySQL Test Framework Components </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Table of Contents</h3>
<ul>
<li><a class="el" href="PAGE_TEST_FRAMEWORK_SYSTEM_REQUIREMENTS.html">Test Framework System Requirements</a></li>
<li><a class="el" href="PAGE_REPORT_BUGS.html">How to Report Bugs from Tests in the MySQL Test Suite</a></li>
</ul>
<p>The MySQL test framework consists of programs that run tests, and directories and files used by those programs.</p>
<h2>Test Framework Programs </h2>
<p>The MySQL test framework uses several programs:</p>
<ul>
<li>
<p class="startli">The <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a> Perl script is the main application used to run the test suite. It invokes <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> to run individual test cases. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> runs test cases. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <a class="el" href="PAGE_MYSQL_CLIENT_TEST.html">mysql_client_test</a> program is used for testing aspects of the MySQL client API that cannot be tested using <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> and its test language. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <a class="el" href="PAGE_MYSQL_STRESS_TEST_PL.html">mysql-stress-test.pl</a> Perl script performs stress-testing of the MySQL server. </p>
<p class="endli"></p>
</li>
<li>
A unit-testing facility is provided so that individual unit test programs can be created for storage engines and plugins.  </li>
</ul>
<p>Test suite programs can be found in these locations:</p>
<ul>
<li>
<p class="startli">For a source distribution, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> is in the <b>client</b> directory. For a binary distribution, it is in the MySQL <b>bin</b> directory. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">For a source distribution, <a class="el" href="PAGE_MYSQL_CLIENT_TEST.html">mysql_client_test</a> is in the <b>tests</b> directory. For a binary distribution, it is in the MySQL <b>bin</b> directory. </p>
<p class="endli"></p>
</li>
<li>
The other programs are located in the <b>mysql-test</b> directory. For a source distribution, <b>mysql-test</b> is found under the source tree root. For a binary distribution, the location of <b>mysql-test</b> depends on the layout used for the distribution format.  </li>
</ul>
<h2>Test Framework Directories and Files </h2>
<p>The test suite is located in the <code>mysql-test</code> directory, which contains the following components:</p>
<ul>
<li>
<p class="startli">The <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a> and <a class="el" href="PAGE_MYSQL_STRESS_TEST_PL.html">mysql-stress-test.pl</a> programs that are used for running tests. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>t</b> directory contains test case input files. A test case file might also have additional files associated with it. </p>
<ul>
<li>
<p class="startli">A file name of the form <b><em>test_name</em>.test</b> is a test case file for a test named <b><em>test_name</em></b>. For example, <b>subquery.test</b> is the test case file for the test named <b>subquery</b>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b><em>test_name</em>-master.opt</b> provides options to associate with the named test case. <b>mysql-test-run.pl</b> restarts the server with the options given in the file if the options are different from those required for the currently running server.</p>
<p>Note that the <b>-master.opt</b> file is used for the “main” server of a test, even if no replication is involved. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b><em>test_name</em>-slave.opt</b> provides slave options. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Server options which need to be passed during initialization of the server can be passed in both <b><em>test_name</em>-master.opt</b> and <b><em>test_name</em>-slave.opt</b>. Each bootstrap variable must be passed as the value of a <b><code>--initialize</code></b> option so that <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a> can recognize that the variable should be used during server initialization, remove the existing data directory, and initialize a new data directory with the options provided. <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a> will also start the server afterwards, with the bootstrap options, and other options specified. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b><em>test_name</em>-client.opt </b> provides <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> client options. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b><em>test_name</em>.cnf</b> contains additional entries for the config file to be used for this test.</p>
<ul>
<li>
<p class="startli">During a test run, each server is started with a different <b>defaults-group-suffix</b> value and this suffix value can be used with a group name to specify server specific options. For example, section <b>[mysqld.1]</b> is used to specify options for mysqld server with suffix value <b>".1"</b>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>[mysqltest]</b> section is used to specify options for mysqltest client. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>[ENV]</b> section is used to specify environment variables for a test case. </p>
<p class="endli"></p>
</li>
<li>
To include the options mentioned in another <b>.cnf</b> file, <b>!include path_to_cnf_file</b> is used. Path to the included <b>.cnf</b> should either be an absolute path or a relative path from current location or from <b>mysql-test</b> directory.  </li>
</ul>
<p>Here is a sample <b>.cnf</b> file.</p>
<pre class="fragment">!include include/default_my.cnf

[mysqld.1]
Options for server mysqld.1

[mysqld.2]
Options for server mysqld.2

[mysqltest]
ps-protocol

...
...
...

[ENV]
SERVER_MYPORT_1= @mysqld.1.port
SERVER_MYPORT_2= @mysqld.2.port</pre> <p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b><em>test_name</em>.combinations</b> provides section of options for each test run. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b><em>suite</em>.opt</b> provides server options to all the tests within the suite it belongs to.</p>
<p>If a test run is started with more than one server, the options specified in a <b><em>suite</em>.opt</b> are used by all of them. It is also possible to pass the server options needed during the server initialization in the <b><em>suite</em>.opt</b> file.</p>
<p>The options mentioned in the <b><em>suite</em>.opt</b> file are overridden by those found in a <b><em>test_name</em>-master.opt</b> file or in a <b><em>test_name</em>-slave.opt</b> file. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b><em>test_name</em>-master.sh</b> is a shell script that will be executed before the server is started for the named test case. There may also be a <b><em>test_name</em>-slave.sh</b> which is executed before the slave server is started.</p>
<p>These files will not work on Windows and may therefore be replaced with a more portable mechanism in the future. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>disabled.def</b> file contains information about deferred/disabled tests. When a test is failing because of a bug in the server and you want it to be ignored by <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a>, list the test in this file.</p>
<p>The format of a line in the <b>disabled.def</b> file looks like this, where fields are separated by one or more spaces.</p>
<pre class="fragment">suite_name.test_name [@platform|@!platform] : &lt;BUG|WL&gt;#&lt;XXXX&gt; [&lt;comment&gt;]</pre><p>Example:</p>
<pre class="fragment">main.1st @linux : BUG#18980 Test fails randomly</pre><p><b><em>suite_name</em></b> is the suite name. <b><em>test_name</em></b> is the test case name.</p>
<p>An additional element after the test name and before the colon you may add a <b>@<em>platform</em></b> to have the test disabled only on a specific platform. Basic OS names as reported by <b>$^O</b> in Perl, or <b>'windows'</b> are supported. Alternatively, <b>@!<em>platform</em></b> will disable the test on all except the named platform.</p>
<p><b>BUG#<em>nnnnn</em></b> or <b>WL#<em>nnnn</em></b> indicates the bug or the WL related to the test that causes it to fail (and thus requires it to be disabled).</p>
<p>The <b><em>comment</em></b> text following the <b>BUG#<em>nnnnn</em></b> or the <b>WL#<em>nnnn</em></b> is not part of the mandatory syntax for this file, <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a> will not actually care what is written here. Length of a <b><em>comment</em></b> text must not be more than <b>80</b> characters.</p>
<p class="endli">A comment line can be written in the file by beginning the line with a “<b>#</b>” character.  </p>
</li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>r</b> directory contains test case result files:</p>
<ul>
<li>
<p class="startli">A file name of the form <b><em>test_name</em>.result</b> is the expected result for the named test case. A file <b>r/<em>test_name</em>.result</b> is the output that corresponds to the input in the test case file <b>t/<em>test_name</em>.test</b>. </p>
<p class="endli"></p>
</li>
<li>
A file name of the form <b><em>test_name</em>.reject</b> contains output for the named test case if the test fails due to output mismatch (but not it it fails for other reasons).  </li>
</ul>
<p>For a test case that succeeds, the <b>.result</b> file represents both the expected and actual result. For a test case that fails, the <b>.result</b> file represents the expected result, and the <b>.reject</b> file represents the actual result.</p>
<p>If a <b>.reject</b> file is created because a test fails, <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a> removes the file later the next time the test succeeds.</p>
<p>When <b><code>--check-testcases</code></b> option is enabled, a test case not having its corresponding <b>.result</b> file is marked as failed by MTR. See <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>include</b> directory contains files that are included by test case files using the <b>source</b> command. These include files encapsulate operations of varying complexity into a single file so that you can perform the operations in a single step. See <a class="el" href="PAGE_INCLUDE_FILES.html">Using Include Files to Simplify Test Cases</a>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>lib</b> directory contains library files used by <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a>, and database initialization SQL code. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>std_data</b> directory contains data files used by some of the tests. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>var</b> directory is used during test runs for various kinds of files: log files, temporary files, trace files, Unix socket files for the servers started during the tests, and so forth. This directory cannot be shared by simultaneous test runs. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>suite</b> directory contains a set of subdirectories containing named test suites. Each subdirectory represents a test suite with the same name.</p>
<p>A test suite directory contains the following components:</p>
<ul>
<li>
<p class="startli">The <b>t</b> directory contains test cases. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>r</b> directory contains test case result files. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b>include</b> directory contains files that are included by the test cases belonging to that suite. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b>combinations</b> provides section of options for each test run. See <a class="el" href="PAGE_CONTROLLING_BINARY_LOG_FORMAT.html">Controlling the Binary Log Format Used for an Entire Test Run</a>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">A file name of the form <b><em>my</em>.cnf</b> contains additional entries for the config file used by all the tests within the suite it belongs to.</p>
<p class="endli">A suite specific <b><em>my</em>.cnf</b> file is overridden by a <b><em>test_name</em>.cnf</b> file.  </p>
</li>
</ul>
<p class="endli"></p>
</li>
<li>
The <b>collections</b> directory contains collections of test runs that are run during integration and release testing of MySQL. They are not directly useful outside this context, but need to be part of the source repository and are included for reference.  </li>
</ul>
<p>Unit test-related files are located in the <b>unittest</b> directory. Additional files specific to storage engines and plugins may be present under the subdirectories of the <b>storage</b> or <b>plugin</b> directories.</p>
<h2>Test Execution and Evaluation </h2>
<p>There are a number of targets in the top-level <b>Makefile</b> that can be used to run sets of tests. <b>make test</b> only runs unit tests. Other targets run subsets of the tests, or run tests with specific options for the test programs. Have a look at the <b>Makefile</b> to see what targets are available.</p>
<p>A “test case” is a single file. The case might contain multiple individual test commands. If any individual command fails, the entire test case is considered to fail. Note that “fail” means “does not produce the expected result.” It does <b><em>not</em></b> necessarily mean “executes without error,” because some tests are written precisely to verify that an illegal statement does in fact produce an error. In such an instance, if the statement executes successfully without producing the expected error, that is considered failure of the test.</p>
<p>Test case output (the test result) consists of:</p>
<ul>
<li>
<p class="startli">Input SQL statements and their output. Each statement is written to the result followed by its output. Columns in output resulting from SQL statements are separated by tab characters. </p>
<p class="endli"></p>
</li>
<li>
The result from <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> commands such as <b>echo</b> and <b>exec</b>. The commands themselves are not echoed to the result, only their output.  </li>
</ul>
<p>The <b>disable_query_log</b> and <b>enable_query_log</b> commands control logging of input SQL statements. The <b>disable_result_log</b> and <b>enable_result_log</b> commands control logging of SQL statement results, and warning or error messages resulting from those statements.</p>
<p><a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> reads a test case file from its standard input by default. The <b><code>--test-file</code></b> or <b>-x</b> option can be given to name a test case file explicitly.</p>
<p><a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> writes test case output to the standard output by default. The <b><code>--result-file</code></b> or <b>-R</b> option can be used to indicate the location of the result file. That option, together with the <b><code>--record</code></b> option, determine how <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> treats the test actual and expected results for a test case:</p>
<ul>
<li>
<p class="startli">If the test produces no results, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> exits with an error message to that effect, unless <b><code>--result-file</code></b> is given and this file is empty. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Otherwise, if <b><code>--result-file</code></b> is not given, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> sends test results to the standard output. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">With <b><code>--result-file</code></b> but not <b><code>--record</code></b>, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> reads the expected results from the given file and compares them with the actual results. If the results do not match, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> writes a <b>.reject</b> file in the log directory and exits with an error. It will also print out a diff of the expected and actual result, provided it can find an appropriate <b>diff</b> tool to use. </p>
<p class="endli"></p>
</li>
<li>
With both <b><code>--result-file</code></b> and <b><code>--record</code></b>, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> updates the given file by writing the actual test results to it. The file does not need to pre-exist.  </li>
</ul>
<p><a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> itself knows nothing of the <b>t</b> and <b>r</b> directories under the <b>mysql-test</b> directory. The use of files in those directories is a convention that is used by <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a>, which invokes <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> with the appropriate options for each test case to tell <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> where to read input and write output. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_TESTING_TOOLS.html">Testing Tools</a></li><li class="navelem"><a class="el" href="PAGE_MYSQL_TEST_RUN.html">The MySQL Test Framework</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
