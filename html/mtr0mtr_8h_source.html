<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: storage/innobase/include/mtr0mtr.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mtr0mtr_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mtr0mtr.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mtr0mtr_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">Copyright (c) 1995, 2020, Oracle and/or its affiliates. All Rights Reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">Copyright (c) 2012, Facebook Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">This program is free software; you can redistribute it and/or modify it under</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">the terms of the GNU General Public License, version 2.0, as published by the</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">Free Software Foundation.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">This program is also distributed with certain software (including but not</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">limited to OpenSSL) that is licensed under separate terms, as designated in a</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">particular file or component or in included license documentation. The authors</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">of MySQL hereby grant you an additional permission to link the program and</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">your derivative works with the separately licensed software that they have</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">included with MySQL.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License, version 2.0,</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">for more details.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">You should have received a copy of the GNU General Public License along with</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">this program; if not, write to the Free Software Foundation, Inc.,</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">*****************************************************************************/</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/** @file include/mtr0mtr.h</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> Mini-transaction buffer</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> Created 11/26/1995 Heikki Tuuri</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *******************************************************/</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#ifndef mtr0mtr_h</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#define mtr0mtr_h</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;stddef.h&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;univ.i&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="buf0types_8h.html">buf0types.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dyn0buf_8h.html">dyn0buf.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fil0fil_8h.html">fil0fil.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="log0types_8h.html">log0types.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mtr0types_8h.html">mtr0types.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="srv0srv_8h.html">srv0srv.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trx0types_8h.html">trx0types.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">/** Start a mini-transaction. */</span></div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#ac9c24ec6a2afbfd1d6dcfc8202fdc99f">   50</a></span>&#160;<span class="preprocessor">#define mtr_start(m) (m)-&gt;start()</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">/** Start a synchronous mini-transaction */</span></div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a364f91356329860e3207a9e21518232b">   53</a></span>&#160;<span class="preprocessor">#define mtr_start_sync(m) (m)-&gt;start(true)</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">/** Start an asynchronous read-only mini-transaction */</span></div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a917c6f8a35322f44550863ebf30f244b">   56</a></span>&#160;<span class="preprocessor">#define mtr_start_ro(m) (m)-&gt;start(true, true)</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">/** Commit a mini-transaction. */</span></div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a2ade6240dcb9e1551f01e319b12b4d7b">   59</a></span>&#160;<span class="preprocessor">#define mtr_commit(m) (m)-&gt;commit()</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">/** Set and return a savepoint in mtr.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">@return savepoint */</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#accf9d90b2e4713b1e136fe2253c0b7c5">   63</a></span>&#160;<span class="preprocessor">#define mtr_set_savepoint(m) (m)-&gt;get_savepoint()</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/** Release the (index tree) s-latch stored in an mtr memo after a</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">savepoint. */</span></div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#ac0a47dabf04cf96252beed043b6d1a17">   67</a></span>&#160;<span class="preprocessor">#define mtr_release_s_latch_at_savepoint(m, s, l) \</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">  (m)-&gt;release_s_latch_at_savepoint((s), (l))</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">/** Get the logging mode of a mini-transaction.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">@return logging mode: MTR_LOG_NONE, ... */</span></div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a15de84e402ccc5341d051ad6c5706b28">   72</a></span>&#160;<span class="preprocessor">#define mtr_get_log_mode(m) (m)-&gt;get_log_mode()</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/** Change the logging mode of a mini-transaction.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">@return old mode */</span></div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#ac1e3353003b8fcc6dcfb4241ec87a913">   76</a></span>&#160;<span class="preprocessor">#define mtr_set_log_mode(m, d) (m)-&gt;set_log_mode((d))</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/** Get the flush observer of a mini-transaction.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">@return flush observer object */</span></div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#ab40ea4d5d36fbd474da10a07d943cf39">   80</a></span>&#160;<span class="preprocessor">#define mtr_get_flush_observer(m) (m)-&gt;get_flush_observer()</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">/** Set the flush observer of a mini-transaction. */</span></div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#adabbaaca58f089cd379288f4e35b693c">   83</a></span>&#160;<span class="preprocessor">#define mtr_set_flush_observer(m, d) (m)-&gt;set_flush_observer((d))</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">/** Read 1 - 4 bytes from a file page buffered in the buffer pool.</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">@return value read */</span></div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#af1976eaaa61b75d8cfe82573c3711e5a">   87</a></span>&#160;<span class="preprocessor">#define mtr_read_ulint(p, t, m) (m)-&gt;read_ulint((p), (t))</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">/** Release an object in the memo stack.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">@return true if released */</span></div><div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#ae555932661e101f217bf2c597b20ca9f">   91</a></span>&#160;<span class="preprocessor">#define mtr_memo_release(m, o, t) (m)-&gt;memo_release((o), (t))</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">/** Check if memo contains the given item ignore if table is intrinsic</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">@return true if contains or table is intrinsic. */</span></div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a32530e3eb42f2b1df794f06d177bb928">   97</a></span>&#160;<span class="preprocessor">#define mtr_is_block_fix(m, o, t, table) \</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">  (mtr_memo_contains(m, o, t) || table-&gt;is_intrinsic())</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">/** Check if memo contains the given page ignore if table is intrinsic</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">@return true if contains or table is intrinsic. */</span></div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a27f538633751b9412fb356d48266be42">  102</a></span>&#160;<span class="preprocessor">#define mtr_is_page_fix(m, p, t, table) \</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">  (mtr_memo_contains_page(m, p, t) || table-&gt;is_intrinsic())</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">/** Check if memo contains the given item.</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">@return true if contains */</span></div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a8529b80cd6b2e94e30e04b07998f55b7">  107</a></span>&#160;<span class="preprocessor">#define mtr_memo_contains(m, o, t) (m)-&gt;memo_contains((m)-&gt;get_memo(), (o), (t))</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">/** Check if memo contains the given page.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">@return true if contains */</span></div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a7b5c92c6d857786a4d9665aea9c9ef0f">  111</a></span>&#160;<span class="preprocessor">#define mtr_memo_contains_page(m, p, t) \</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">  (m)-&gt;memo_contains_page_flagged((p), (t))</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/** Print info of an mtr handle. */</span></div><div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a31e6f6e96cdddf9a38dffa7f37a69444">  116</a></span>&#160;<span class="preprocessor">#define mtr_print(m) (m)-&gt;print()</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">/** Return the log object of a mini-transaction buffer.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">@return log */</span></div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a18f10a733d5fdf8082af279cd22c4f6e">  120</a></span>&#160;<span class="preprocessor">#define mtr_get_log(m) (m)-&gt;get_log()</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">/** Push an object to an mtr memo stack. */</span></div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a0fd201296deeb62b874b0a61b8100607">  123</a></span>&#160;<span class="preprocessor">#define mtr_memo_push(m, o, t) (m)-&gt;memo_push(o, t)</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/** Lock an rw-lock in s-mode. */</span></div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a0b9a8ff01b438bfe8b235fd210a9e64d">  126</a></span>&#160;<span class="preprocessor">#define mtr_s_lock(l, m) (m)-&gt;s_lock((l), __FILE__, __LINE__)</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">/** Lock an rw-lock in x-mode. */</span></div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a1a3d928d76feeccb7dca2339c7c74d81">  129</a></span>&#160;<span class="preprocessor">#define mtr_x_lock(l, m) (m)-&gt;x_lock((l), __FILE__, __LINE__)</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">/** Lock a tablespace in x-mode. */</span></div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a62b0b83572b39b4652ad1e835c7c145d">  132</a></span>&#160;<span class="preprocessor">#define mtr_x_lock_space(s, m) (m)-&gt;x_lock_space((s), __FILE__, __LINE__)</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">/** Lock an rw-lock in sx-mode. */</span></div><div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a29fc153553186ea48a2de9de04442667">  135</a></span>&#160;<span class="preprocessor">#define mtr_sx_lock(l, m) (m)-&gt;sx_lock((l), __FILE__, __LINE__)</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#ac6c482412bc28098b7c7774339996740">  137</a></span>&#160;<span class="preprocessor">#define mtr_memo_contains_flagged(m, p, l) (m)-&gt;memo_contains_flagged((p), (l))</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a2b57548730f2405f4758f4fb805c75ad">  139</a></span>&#160;<span class="preprocessor">#define mtr_memo_contains_page_flagged(m, p, l) \</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">  (m)-&gt;memo_contains_page_flagged((p), (l))</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a565b683d05c5429753fc2c6a1bc315f7">  142</a></span>&#160;<span class="preprocessor">#define mtr_release_block_at_savepoint(m, s, b) \</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="preprocessor">  (m)-&gt;release_block_at_savepoint((s), (b))</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a336920fc2b99b2572a758f427f37cde3">  145</a></span>&#160;<span class="preprocessor">#define mtr_block_sx_latch_at_savepoint(m, s, b) \</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">  (m)-&gt;sx_latch_at_savepoint((s), (b))</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#a6b5a55aafd91202dda69924c10e52268">  148</a></span>&#160;<span class="preprocessor">#define mtr_block_x_latch_at_savepoint(m, s, b) \</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">  (m)-&gt;x_latch_at_savepoint((s), (b))</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">/** Check if a mini-transaction is dirtying a clean page.</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">@param b        block being x-fixed</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">@return true if the mtr is dirtying a clean page. */</span></div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="mtr0mtr_8h.html#afe3105ed1810d0f3f3b95a568ca1fe9d">  154</a></span>&#160;<span class="preprocessor">#define mtr_block_dirtied(b) mtr_t::is_block_dirtied((b))</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">/** Forward declaration of a tablespace object */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">struct </span><a class="code" href="structfil__space__t.html">fil_space_t</a>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">/** Mini-transaction memo stack slot. */</span></div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="structmtr__memo__slot__t.html">  160</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structmtr__memo__slot__t.html">mtr_memo_slot_t</a> {<span class="comment"></span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">  /** pointer to the object */</span></div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="structmtr__memo__slot__t.html#aba6b26df48618b6d6e704af6815816a7">  162</a></span>&#160;  <span class="keywordtype">void</span> *<a class="code" href="structmtr__memo__slot__t.html#aba6b26df48618b6d6e704af6815816a7">object</a>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">  /** type of the stored object (MTR_MEMO_S_LOCK, ...) */</span></div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="structmtr__memo__slot__t.html#a60699ec7dbfd14cd125e5e4dd1bd20f4">  165</a></span>&#160;  ulint <a class="code" href="structmtr__memo__slot__t.html#a60699ec7dbfd14cd125e5e4dd1bd20f4">type</a>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;};</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">/** Mini-transaction handle and buffer */</span></div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="structmtr__t.html">  169</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structmtr__t.html">mtr_t</a> {<span class="comment"></span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">  /** State variables of the mtr */</span></div><div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html">  171</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structmtr__t_1_1Impl.html">Impl</a> {<span class="comment"></span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">    /** memo stack for locks etc. */</span></div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#ae303f44de9a75cf4b1c0abf227d147e1">  173</a></span>&#160;    <a class="code" href="classdyn__buf__t.html">mtr_buf_t</a> <a class="code" href="structmtr__t_1_1Impl.html#ae303f44de9a75cf4b1c0abf227d147e1">m_memo</a>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">    /** mini-transaction log */</span></div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#ad3f5a1cbaebcba43059930fbab97673a">  176</a></span>&#160;    <a class="code" href="classdyn__buf__t.html">mtr_buf_t</a> <a class="code" href="structmtr__t_1_1Impl.html#ad3f5a1cbaebcba43059930fbab97673a">m_log</a>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">    /** true if mtr has made at least one buffer pool page dirty */</span></div><div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#a383809a09ce50213e7a9492b3d018594">  179</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structmtr__t_1_1Impl.html#a383809a09ce50213e7a9492b3d018594">m_made_dirty</a>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">    /** true if inside ibuf changes */</span></div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#a7ab3324aca4bbf10b063cbe41287a154">  182</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structmtr__t_1_1Impl.html#a7ab3324aca4bbf10b063cbe41287a154">m_inside_ibuf</a>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">    /** true if the mini-transaction modified buffer pool pages */</span></div><div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#ad9cdd810fd6f803814655efb1b09a02d">  185</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structmtr__t_1_1Impl.html#ad9cdd810fd6f803814655efb1b09a02d">m_modifications</a>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">    /** true if mtr is forced to NO_LOG mode because redo logging is</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">    disabled globally. In this case, mtr increments the global counter</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">    at ::start and must decrement it back at ::commit. */</span></div><div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#af051f8d947e4fa8bdb34b0d6d9bd2ca1">  190</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structmtr__t_1_1Impl.html#af051f8d947e4fa8bdb34b0d6d9bd2ca1">m_marked_nolog</a>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">    /** Shard index used for incrementing global counter at ::start. We need</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">    to use the same shard while decrementing counter at ::commit. */</span></div><div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#a912d862a5a63d83512c93405ee23ca1c">  194</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structmtr__t_1_1Impl.html#a912d862a5a63d83512c93405ee23ca1c">m_shard_index</a>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">    /** Count of how many page initial log records have been</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">    written to the mtr log */</span></div><div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#a3349502821f20c758810c3ce966dd559">  198</a></span>&#160;    ib_uint32_t <a class="code" href="structmtr__t_1_1Impl.html#a3349502821f20c758810c3ce966dd559">m_n_log_recs</a>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">    /** specifies which operations should be logged; default</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">    value MTR_LOG_ALL */</span></div><div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#a7c6100f0bb92446971835c022fde8da5">  202</a></span>&#160;    <a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9">mtr_log_t</a> <a class="code" href="structmtr__t_1_1Impl.html#a7c6100f0bb92446971835c022fde8da5">m_log_mode</a>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">    /** State of the transaction */</span></div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#a83ecdfe81523d988e3ac03d5577973f2">  205</a></span>&#160;    <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fb">mtr_state_t</a> <a class="code" href="structmtr__t_1_1Impl.html#a83ecdfe81523d988e3ac03d5577973f2">m_state</a>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">    /** Flush Observer */</span></div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#af10203a976b39d912e1be65deae882cd">  208</a></span>&#160;    <a class="code" href="classFlushObserver.html">FlushObserver</a> *<a class="code" href="structmtr__t_1_1Impl.html#af10203a976b39d912e1be65deae882cd">m_flush_observer</a>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">    /** For checking corruption. */</span></div><div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#ac018aa062636848b9babfe00857f1f75">  212</a></span>&#160;    ulint <a class="code" href="structmtr__t_1_1Impl.html#ac018aa062636848b9babfe00857f1f75">m_magic_n</a>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">    /** Owning mini-transaction */</span></div><div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="structmtr__t_1_1Impl.html#a877176bfa9fb233149816763f984b1b6">  217</a></span>&#160;    <a class="code" href="structmtr__t.html">mtr_t</a> *<a class="code" href="structmtr__t_1_1Impl.html#a877176bfa9fb233149816763f984b1b6">m_mtr</a>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  };</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">  /** mtr global logging */</span></div><div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html">  222</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classmtr__t_1_1Logging.html">Logging</a> {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">    /** mtr global redo logging state.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">    Enable Logging  :</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">    [ENABLED] -&gt; [ENABLED_RESTRICT] -&gt; [DISABLED]</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">    Disable Logging :</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">    [DISABLED] -&gt; [ENABLED_RESTRICT] -&gt; [ENABLED_DBLWR] -&gt; [ENABLED] */</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32">  231</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32">State</a> : uint32_t {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="comment">/* Redo Logging is enabled. Server is crash safe. */</span></div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32a3824ba03ea321c9695e14847d972a442">  233</a></span>&#160;      <a class="code" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32a3824ba03ea321c9695e14847d972a442">ENABLED</a>,</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">/* Redo logging is enabled. All non-logging mtr are finished with the</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">      pages flushed to disk. Double write is enabled. Some pages could be</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">      still getting written to disk without double-write. Not safe to crash. */</span></div><div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32aadbb3c8587b09b4487f9c62d7dd867e5">  237</a></span>&#160;      <a class="code" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32aadbb3c8587b09b4487f9c62d7dd867e5">ENABLED_DBLWR</a>,</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="comment">/* Redo logging is enabled but there could be some mtrs still running</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">      in no logging mode. Redo archiving and clone are not allowed to start.</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">      No double-write */</span></div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32a466a489e848edda192907c05e54f7015">  241</a></span>&#160;      <a class="code" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32a466a489e848edda192907c05e54f7015">ENABLED_RESTRICT</a>,</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="comment">/* Redo logging is disabled and all new mtrs would not generate any redo.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">      Redo archiving and clone are not allowed. */</span></div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32ad15d60ca42931438a900df96cadbdc13">  244</a></span>&#160;      DISABLED</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    };</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">    /** Initialize logging state at server start up. */</span></div><div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#ae1874f28bea9dea1c722bad6a69cd37d">  248</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmtr__t_1_1Logging.html#ae1874f28bea9dea1c722bad6a69cd37d">init</a>() {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      m_state.store(ENABLED);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="comment">/* We use sharded counter and force sequentially consistent counting</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">      which is the general default for c++ atomic operation. If we try to</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">      optimize it further specific to current operations, we could use</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">      Release-Acquire ordering i.e. std::memory_order_release during counting</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">      and std::memory_order_acquire while checking for the count. However,</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">      sharding looks to be good enough for now and we should go for non default</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">      memory ordering only with some visible proof for improvement. */</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      m_count_nologging_mtr.set_order(std::memory_order_seq_cst);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <a class="code" href="namespaceCounter.html#abffd9234ba48273d835ae5cf193e3844">Counter::clear</a>(m_count_nologging_mtr);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">    /** Disable mtr redo logging. Server is crash unsafe without logging.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">    @param[in]  thd     server connection THD</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">    @return mysql error code. */</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordtype">int</span> disable(<a class="code" href="classTHD.html">THD</a> *thd);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">    /** Enable mtr redo logging. Ensure that the server is crash safe</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">    before returning.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">    @param[in]  thd     server connection THD</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">    @return mysql error code. */</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordtype">int</span> enable(<a class="code" href="classTHD.html">THD</a> *thd);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">    /** Mark a no-logging mtr to indicate that it would not generate redo log</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">    and system is crash unsafe.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">    @return true iff logging is disabled and mtr is marked. */</span></div><div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a4588f6734ccf0b5786392b87fe81df3a">  275</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classmtr__t_1_1Logging.html#a4588f6734ccf0b5786392b87fe81df3a">mark_mtr</a>(<span class="keywordtype">size_t</span> <a class="code" href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a>) {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">/* Have initial check to avoid incrementing global counter for regular</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">      case when redo logging is enabled. */</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">if</span> (is_disabled()) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="comment">/* Increment counter to restrict state change DISABLED to ENABLED. */</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <a class="code" href="namespaceCounter.html#a023ef5324f702e17ab0d296546bf1876">Counter::inc</a>(m_count_nologging_mtr, index);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">/* Check if the no-logging is still disabled. At this point, if we</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">        find the state disabled, it is no longer possible for the state move</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">        back to enabled till the mtr finishes and we unmark the mtr. */</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">if</span> (is_disabled()) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          <span class="keywordflow">return</span> (<span class="keyword">true</span>);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <a class="code" href="namespaceCounter.html#a797c2d7934585e10e3e7b548520c3a95">Counter::dec</a>(m_count_nologging_mtr, index);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">    /** unmark a no logging mtr. */</span></div><div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a2fbdb2e0948c885eb286c9bea91059a1">  294</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmtr__t_1_1Logging.html#a2fbdb2e0948c885eb286c9bea91059a1">unmark_mtr</a>(<span class="keywordtype">size_t</span> <a class="code" href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a>) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(!is_enabled());</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="namespaceCounter.html#a7ba056d7d4c2cd809eca09fc5fe2e075">Counter::total</a>(m_count_nologging_mtr) &gt; 0);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <a class="code" href="namespaceCounter.html#a797c2d7934585e10e3e7b548520c3a95">Counter::dec</a>(m_count_nologging_mtr, index);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">/* @return flush loop count for faster response when logging is disabled. */</span></div><div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a8f414ed9ce052edc05bdc2799ec77180">  301</a></span>&#160;    uint32_t <a class="code" href="classmtr__t_1_1Logging.html#a8f414ed9ce052edc05bdc2799ec77180">get_nolog_flush_loop</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (NOLOG_MAX_FLUSH_LOOP); }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">    /** @return true iff redo logging is enabled and server is crash safe. */</span></div><div class="line"><a name="l00304"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#ae5dff5a196ee6c50388ac7eca02d6e0b">  304</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classmtr__t_1_1Logging.html#ae5dff5a196ee6c50388ac7eca02d6e0b">is_enabled</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (m_state.load() == ENABLED); }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">    /** @return true iff redo logging is disabled and new mtrs are not going</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">    to generate redo log. */</span></div><div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#ac643e840dd2a71dae28b6f5dba5eed09">  308</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classmtr__t_1_1Logging.html#ac643e840dd2a71dae28b6f5dba5eed09">is_disabled</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (m_state.load() == DISABLED); }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">    /** @return true iff we can skip data page double write. */</span></div><div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a054ad19de05c21920c905cc2f16749db">  311</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classmtr__t_1_1Logging.html#a054ad19de05c21920c905cc2f16749db">dblwr_disabled</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keyword">auto</span> state = m_state.load();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordflow">return</span> (state == DISABLED || state == ENABLED_RESTRICT);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">/* Force faster flush loop for quicker adaptive flush response when logging</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">    is disabled. When redo logging is disabled the system operates faster with</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">    dirty pages generated at much faster rate. */</span></div><div class="line"><a name="l00319"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#ab950a4d24161ffbb351b01e412fce73a">  319</a></span>&#160;    <span class="keyword">static</span> constexpr uint32_t NOLOG_MAX_FLUSH_LOOP = 5;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;   <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">    /** Wait till all no-logging mtrs are finished.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">    @return mysql error code. */</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordtype">int</span> wait_no_log_mtr(<a class="code" href="classTHD.html">THD</a> *thd);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">    /** Global redo logging state. */</span></div><div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#adad0c68a632d906b103dffd67da0a823">  328</a></span>&#160;    std::atomic&lt;State&gt; <a class="code" href="classmtr__t_1_1Logging.html#adad0c68a632d906b103dffd67da0a823">m_state</a>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#a195017b69ca720a20570de50f967d719">  330</a></span>&#160;    <span class="keyword">using</span> <a class="code" href="structCounter_1_1Shards.html">Shards</a> = <a class="code" href="structCounter_1_1Shards.html">Counter::Shards&lt;128&gt;</a>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">    /** Number of no logging mtrs currently running. */</span></div><div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="classmtr__t_1_1Logging.html#aee55df93b0cb8ed6a6a368d3a8b6662b">  333</a></span>&#160;    <a class="code" href="structCounter_1_1Shards.html">Shards</a> <a class="code" href="classmtr__t_1_1Logging.html#aee55df93b0cb8ed6a6a368d3a8b6662b">m_count_nologging_mtr</a>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  };</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">  /** Check if redo logging is disabled globally and mark</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">  the global counter till mtr ends. */</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordtype">void</span> check_nolog_and_mark();</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">  /** Check if the mtr has marked the global no log counter and</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">  unmark it. */</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordtype">void</span> check_nolog_and_unmark();</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="structmtr__t.html#a998e4bf44228cccd483961e8e3b86844">  345</a></span>&#160;  <a class="code" href="structmtr__t.html#a998e4bf44228cccd483961e8e3b86844">mtr_t</a>() {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    m_impl.m_state = <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbac2b1f9ea34a93b8a8305f4fa4494ae62">MTR_STATE_INIT</a>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    m_impl.m_marked_nolog = <span class="keyword">false</span>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    m_impl.m_shard_index = 0;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="structmtr__t.html#aea17ef007d058fa26c5c61de1517875e">  351</a></span>&#160;  <a class="code" href="structmtr__t.html#aea17ef007d058fa26c5c61de1517875e">~mtr_t</a>() {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">switch</span> (m_impl.m_state) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbab108a28d90c60572abd2e2371dcae9c3">MTR_STATE_ACTIVE</a>:</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_impl.m_memo.size() == 0);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbac2b1f9ea34a93b8a8305f4fa4494ae62">MTR_STATE_INIT</a>:</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbac68876238c9eca2e6457c39e36922512">MTR_STATE_COMMITTED</a>:</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fba3bf727dacb4af2889bb952bed03751bd">MTR_STATE_COMMITTING</a>:</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <a class="code" href="ut0dbg_8h.html#a14595937e3433e1d84a3e5bca4958a96">ut_error</a>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">/* Safety check in case mtr is not committed. */</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (m_impl.m_state != <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbac2b1f9ea34a93b8a8305f4fa4494ae62">MTR_STATE_INIT</a>) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      check_nolog_and_unmark();</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">  /** Start a mini-transaction.</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">  @param sync           true if it is a synchronous mini-transaction</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">  @param read_only      true if read only mini-transaction */</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="http__auth__backend__plugin_8cc.html#aee70c8416f705726100824ba89f1e090">start</a>(<span class="keywordtype">bool</span> sync = <span class="keyword">true</span>, <span class="keywordtype">bool</span> <a class="code" href="mysqld_8cc.html#ae851b490bae2ad91e401b972664fde81">read_only</a> = <span class="keyword">false</span>);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">  /** @return whether this is an asynchronous mini-transaction. */</span></div><div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="structmtr__t.html#a567517d4a6102fb3cf7100ecc03b9763">  378</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structmtr__t.html#a567517d4a6102fb3cf7100ecc03b9763">is_async</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (!m_sync); }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">  /** Request a future commit to be synchronous. */</span></div><div class="line"><a name="l00381"></a><span class="lineno"><a class="line" href="structmtr__t.html#a9573ee51893885b271044e629434211b">  381</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structmtr__t.html#a9573ee51893885b271044e629434211b">set_sync</a>() { m_sync = <span class="keyword">true</span>; }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">  /** Commit the mini-transaction. */</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="sql__cmd__srs_8cc.html#af8756202cf6ab572edb0e832014f1a5f">commit</a>();</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">  /** Return current size of the buffer.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">  @return       savepoint */</span></div><div class="line"><a name="l00388"></a><span class="lineno"><a class="line" href="structmtr__t.html#acc55dec377f4c619c5d706f44b9186e5">  388</a></span>&#160;  ulint <a class="code" href="structmtr__t.html#acc55dec377f4c619c5d706f44b9186e5">get_savepoint</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(<a class="code" href="namespaceundo.html#af16fb6085ef2e93316f4b550861c179c">is_active</a>());</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_impl.m_magic_n == <a class="code" href="mtr0types_8h.html#abef9c3a0bceb1a41296836b1be5bde33">MTR_MAGIC_N</a>);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_memo.size());</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">  /** Release the (index tree) s-latch stored in an mtr memo after a</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">  savepoint.</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">  @param savepoint      value returned by @see set_savepoint.</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">  @param lock           latch to release */</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> release_s_latch_at_savepoint(ulint savepoint, <a class="code" href="structrw__lock__t.html">rw_lock_t</a> *lock);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">  /** Release the block in an mtr memo after a savepoint. */</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> release_block_at_savepoint(ulint savepoint, <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">  /** SX-latch a not yet latched block after a savepoint. */</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> sx_latch_at_savepoint(ulint savepoint, <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">  /** X-latch a not yet latched block after a savepoint. */</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> x_latch_at_savepoint(ulint savepoint, <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">  /** Get the logging mode.</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">  @return       logging mode */</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keyword">inline</span> <a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9">mtr_log_t</a> get_log_mode() <span class="keyword">const</span> MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">  /** Change the logging mode.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">  @param mode    logging mode</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">  @return       old mode */</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9">mtr_log_t</a> set_log_mode(<a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9">mtr_log_t</a> <a class="code" href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">mode</a>);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">  /** Read 1 - 4 bytes from a file page buffered in the buffer pool.</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">  @param ptr    pointer from where to read</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">  @param type   MLOG_1BYTE, MLOG_2BYTES, MLOG_4BYTES</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">  @return       value read */</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keyword">inline</span> uint32_t read_ulint(<span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *ptr, <a class="code" href="mtr0types_8h.html#a11a0f116bed9e1c33900d379901595d1">mlog_id_t</a> <a class="code" href="structmtr__memo__slot__t.html#a60699ec7dbfd14cd125e5e4dd1bd20f4">type</a>) <span class="keyword">const</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">  /** Locks a rw-latch in S mode.</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">  NOTE: use mtr_s_lock().</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">  @param lock   rw-lock</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">  @param file   file name from where called</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">  @param line   line number in file */</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> s_lock(<a class="code" href="structrw__lock__t.html">rw_lock_t</a> *lock, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacefile.html">file</a>, ulint line);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">  /** Locks a rw-latch in X mode.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">  NOTE: use mtr_x_lock().</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">  @param lock   rw-lock</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">  @param file   file name from where called</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">  @param line   line number in file */</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> x_lock(<a class="code" href="structrw__lock__t.html">rw_lock_t</a> *lock, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, ulint line);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">  /** Locks a rw-latch in X mode.</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">  NOTE: use mtr_sx_lock().</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">  @param lock   rw-lock</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">  @param file   file name from where called</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">  @param line   line number in file */</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> sx_lock(<a class="code" href="structrw__lock__t.html">rw_lock_t</a> *lock, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, ulint line);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">  /** Acquire a tablespace X-latch.</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">  NOTE: use mtr_x_lock_space().</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">  @param[in]    space           tablespace instance</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">  @param[in]    file            file name from where called</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">  @param[in]    line            line number in file */</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordtype">void</span> x_lock_space(<a class="code" href="structfil__space__t.html">fil_space_t</a> *space, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, ulint line);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">  /** Release an object in the memo stack.</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">  @param object object</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">  @param type   object type: MTR_MEMO_S_LOCK, ... */</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">void</span> memo_release(<span class="keyword">const</span> <span class="keywordtype">void</span> *<span class="keywordtype">object</span>, ulint type);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">  /** Release a page latch.</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">  @param[in]    ptr     pointer to within a page frame</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">  @param[in]    type    object type: MTR_MEMO_PAGE_X_FIX, ... */</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">void</span> release_page(<span class="keyword">const</span> <span class="keywordtype">void</span> *ptr, <a class="code" href="mtr0types_8h.html#ae8bcc01a7143e0c3a836c8941f386c3a">mtr_memo_type_t</a> type);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">  /** Note that the mini-transaction has modified data. */</span></div><div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="structmtr__t.html#a7848bb73a5f6561bc9accab705579be0">  465</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structmtr__t.html#a7848bb73a5f6561bc9accab705579be0">set_modified</a>() { m_impl.m_modifications = <span class="keyword">true</span>; }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">  /** Set the state to not-modified. This will not log the</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">  changes.  This is only used during redo log apply, to avoid</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">  logging the changes. */</span></div><div class="line"><a name="l00470"></a><span class="lineno"><a class="line" href="structmtr__t.html#a0845294c96183512d5e34e2c006bf1ed">  470</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structmtr__t.html#a0845294c96183512d5e34e2c006bf1ed">discard_modifications</a>() { m_impl.m_modifications = <span class="keyword">false</span>; }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">  /** Get the LSN of commit().</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">  @return the commit LSN</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">  @retval 0 if the transaction only modified temporary tablespaces or logging</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">  is disabled globally. */</span></div><div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="structmtr__t.html#acc8807462d867ea1bb2504b39b55239c">  476</a></span>&#160;  <a class="code" href="log0types_8h.html#aa7401e3081ffb8ee7e8fb182647f475c">lsn_t</a> <a class="code" href="structmtr__t.html#acc8807462d867ea1bb2504b39b55239c">commit_lsn</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(has_committed());</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_impl.m_log_mode == <a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9aa1f4319b953b206e588a63fadfac338c">MTR_LOG_ALL</a>);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span> (m_commit_lsn);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">  /** Note that we are inside the change buffer code. */</span></div><div class="line"><a name="l00483"></a><span class="lineno"><a class="line" href="structmtr__t.html#acd3326ae99b456279480e81aab5b4089">  483</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structmtr__t.html#acd3326ae99b456279480e81aab5b4089">enter_ibuf</a>() { m_impl.m_inside_ibuf = <span class="keyword">true</span>; }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">  /** Note that we have exited from the change buffer code. */</span></div><div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="structmtr__t.html#a6a80aba6d7b4330b2d9de5e22dda1877">  486</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structmtr__t.html#a6a80aba6d7b4330b2d9de5e22dda1877">exit_ibuf</a>() { m_impl.m_inside_ibuf = <span class="keyword">false</span>; }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">  /** @return true if we are inside the change buffer code */</span></div><div class="line"><a name="l00489"></a><span class="lineno"><a class="line" href="structmtr__t.html#aa68c4044f1c32276a5bd2385b118eee6">  489</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structmtr__t.html#aa68c4044f1c32276a5bd2385b118eee6">is_inside_ibuf</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_inside_ibuf);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">  @return true if the mini-transaction is active */</span></div><div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="structmtr__t.html#a5d6d30cebb05dfbdfe3caeebe9e7576b">  495</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structmtr__t.html#a5d6d30cebb05dfbdfe3caeebe9e7576b">is_active</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_state == <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbab108a28d90c60572abd2e2371dcae9c3">MTR_STATE_ACTIVE</a>);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">  /** Get flush observer</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">  @return flush observer */</span></div><div class="line"><a name="l00501"></a><span class="lineno"><a class="line" href="structmtr__t.html#a95cb37601c1d42044a766d7a5eec92c7">  501</a></span>&#160;  <a class="code" href="classFlushObserver.html">FlushObserver</a> *<a class="code" href="structmtr__t.html#a95cb37601c1d42044a766d7a5eec92c7">get_flush_observer</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_flush_observer);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">  /** Set flush observer</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">  @param[in]    observer        flush observer */</span></div><div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="structmtr__t.html#a9a34889c30e7764db785de94b074ab33">  507</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structmtr__t.html#a9a34889c30e7764db785de94b074ab33">set_flush_observer</a>(<a class="code" href="classFlushObserver.html">FlushObserver</a> *observer) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(observer == <span class="keyword">nullptr</span> || m_impl.m_log_mode == <a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9acb38ddbc32b67f5e2f6526ab12d6a4da">MTR_LOG_NO_REDO</a>);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    m_impl.m_flush_observer = observer;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">  /** Check if memo contains the given item.</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">  @param memo   memo stack</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">  @param object object to search</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">  @param type   type of object</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">  @return       true if contains */</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> memo_contains(<span class="keyword">const</span> <a class="code" href="classdyn__buf__t.html">mtr_buf_t</a> *memo, <span class="keyword">const</span> <span class="keywordtype">void</span> *<span class="keywordtype">object</span>,</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                            ulint type) MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">  /** Check if memo contains the given item.</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">  @param ptr            object to search</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">  @param flags          specify types of object (can be ORred) of</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">                          MTR_MEMO_PAGE_S_FIX ... values</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">  @return true if contains */</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordtype">bool</span> memo_contains_flagged(<span class="keyword">const</span> <span class="keywordtype">void</span> *ptr, ulint <a class="code" href="hp__test1_8cc.html#a6eec09a91807e20d7b3d6ef3da594067">flags</a>) <span class="keyword">const</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">  /** Check if memo contains the given page.</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">  @param[in]    ptr     pointer to within buffer frame</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">  @param[in]    flags   specify types of object with OR of</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">                          MTR_MEMO_PAGE_S_FIX... values</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">  @return       the block</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">  @retval       NULL    if not found */</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <a class="code" href="structbuf__block__t.html">buf_block_t</a> *memo_contains_page_flagged(<span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *ptr, ulint flags) <span class="keyword">const</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">  /** Mark the given latched page as modified.</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">  @param[in]    ptr     pointer to within buffer frame */</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordtype">void</span> memo_modify_page(<span class="keyword">const</span> <a class="code" href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> *ptr);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">  /** Print info of an mtr handle. */</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="mcstat_8c.html#aeb0a66a1106a1c0097d605cbcb19766d">print</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">  /** @return true if the mini-transaction has committed */</span></div><div class="line"><a name="l00547"></a><span class="lineno"><a class="line" href="structmtr__t.html#acbb46d15006a7dd38a1fc39fee131755">  547</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structmtr__t.html#acbb46d15006a7dd38a1fc39fee131755">has_committed</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_state == <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbac68876238c9eca2e6457c39e36922512">MTR_STATE_COMMITTED</a>);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  }</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">  /** @return true if the mini-transaction is committing */</span></div><div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="structmtr__t.html#aa8e35e00d8a3e542fdf3e934e5249ca1">  552</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structmtr__t.html#aa8e35e00d8a3e542fdf3e934e5249ca1">is_committing</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_state == <a class="code" href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fba3bf727dacb4af2889bb952bed03751bd">MTR_STATE_COMMITTING</a>);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">  /** @return true if mini-transaction contains modifications. */</span></div><div class="line"><a name="l00557"></a><span class="lineno"><a class="line" href="structmtr__t.html#a50f9a1979f3e919714c8e3ddb0397322">  557</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structmtr__t.html#a50f9a1979f3e919714c8e3ddb0397322">has_modifications</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_modifications);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  }</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">  /** Check if the changes done in this mtr conflicts with changes done</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">  in the given mtr.  Two mtrs are said to conflict with each other, if</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">  they modify the same buffer block.</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">  @param[in]   mtr2  the given mtr.</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">  @return true if there is conflict, false otherwise. */</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordtype">bool</span> conflicts_with(<span class="keyword">const</span> <a class="code" href="structmtr__t.html">mtr_t</a> *mtr2) <span class="keyword">const</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">  /** @return the memo stack */</span></div><div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="structmtr__t.html#a9b7d1f4291d80ce417b0ad1fdbfe0940">  570</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classdyn__buf__t.html">mtr_buf_t</a> *<a class="code" href="structmtr__t.html#a9b7d1f4291d80ce417b0ad1fdbfe0940">get_memo</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">return</span> (&amp;m_impl.m_memo);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">  /** @return the memo stack */</span></div><div class="line"><a name="l00575"></a><span class="lineno"><a class="line" href="structmtr__t.html#a84fc922492f4d1bd0931d62874741e3a">  575</a></span>&#160;  <a class="code" href="classdyn__buf__t.html">mtr_buf_t</a> *<a class="code" href="structmtr__t.html#a84fc922492f4d1bd0931d62874741e3a">get_memo</a>() MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">return</span> (&amp;m_impl.m_memo);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">  /** Computes the number of bytes that would be written to the redo</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">  log if mtr was committed right now (excluding headers of log blocks).</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">  @return  number of bytes of the colllected log records increased</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">           by 1 if MLOG_MULTI_REC_END would already be required */</span></div><div class="line"><a name="l00583"></a><span class="lineno"><a class="line" href="structmtr__t.html#a800727ee66e7fec91a8d0d8114f43660">  583</a></span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="structmtr__t.html#a800727ee66e7fec91a8d0d8114f43660">get_expected_log_size</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_log.size() + (m_impl.m_n_log_recs &gt; 1 ? 1 : 0));</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keywordtype">void</span> wait_for_flush();</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">  /** @return true if a record was added to the mini-transaction */</span></div><div class="line"><a name="l00591"></a><span class="lineno"><a class="line" href="structmtr__t.html#a0987e1b53ee9a5f93eb043350dfe88b5">  591</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structmtr__t.html#a0987e1b53ee9a5f93eb043350dfe88b5">is_dirty</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">return</span> (m_impl.m_made_dirty);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">  /** Note that a record has been added to the log */</span></div><div class="line"><a name="l00596"></a><span class="lineno"><a class="line" href="structmtr__t.html#aa34906d54e5138a26b5d34790c388e2b">  596</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structmtr__t.html#aa34906d54e5138a26b5d34790c388e2b">added_rec</a>() { ++m_impl.m_n_log_recs; }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">  /** Get the buffered redo log of this mini-transaction.</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">  @return       redo log */</span></div><div class="line"><a name="l00600"></a><span class="lineno"><a class="line" href="structmtr__t.html#a1052c89090caf6debedcf490e008acb4">  600</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classdyn__buf__t.html">mtr_buf_t</a> *<a class="code" href="structmtr__t.html#a1052c89090caf6debedcf490e008acb4">get_log</a>() const MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_impl.m_magic_n == <a class="code" href="mtr0types_8h.html#abef9c3a0bceb1a41296836b1be5bde33">MTR_MAGIC_N</a>);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">return</span> (&amp;m_impl.m_log);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">  /** Get the buffered redo log of this mini-transaction.</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">  @return       redo log */</span></div><div class="line"><a name="l00608"></a><span class="lineno"><a class="line" href="structmtr__t.html#a4bde0d70a0e4760b0630c695c90d8dae">  608</a></span>&#160;  <a class="code" href="classdyn__buf__t.html">mtr_buf_t</a> *<a class="code" href="structmtr__t.html#a4bde0d70a0e4760b0630c695c90d8dae">get_log</a>() MY_ATTRIBUTE((warn_unused_result)) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a>(m_impl.m_magic_n == <a class="code" href="mtr0types_8h.html#abef9c3a0bceb1a41296836b1be5bde33">MTR_MAGIC_N</a>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">return</span> (&amp;m_impl.m_log);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">  /** Push an object to an mtr memo stack.</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">  @param object object</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">  @param type   object type: MTR_MEMO_S_LOCK, ... */</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> memo_push(<span class="keywordtype">void</span> *<span class="keywordtype">object</span>, <a class="code" href="mtr0types_8h.html#ae8bcc01a7143e0c3a836c8941f386c3a">mtr_memo_type_t</a> type);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">  /** Check if this mini-transaction is dirtying a clean page.</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">  @param block  block being x-fixed</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">  @return true if the mtr is dirtying a clean page. */</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> is_block_dirtied(<span class="keyword">const</span> <a class="code" href="structbuf__block__t.html">buf_block_t</a> *block)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      MY_ATTRIBUTE((warn_unused_result));</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">  /** Matrix to check if a mode update request should be ignored. */</span></div><div class="line"><a name="l00626"></a><span class="lineno"><a class="line" href="structmtr__t.html#ad87913ce2568b884b42a6660393b1435">  626</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> s_mode_update[<a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9afe0cfcef9cc3f4ed93e1515359d166bb">MTR_LOG_MODE_MAX</a>][<a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9afe0cfcef9cc3f4ed93e1515359d166bb">MTR_LOG_MODE_MAX</a>];</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">  /** For checking invalid mode update requests. */</span></div><div class="line"><a name="l00630"></a><span class="lineno"><a class="line" href="structmtr__t.html#aecea0845929b2bb5a53f59d7075f93dd">  630</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> s_mode_update_valid[<a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9afe0cfcef9cc3f4ed93e1515359d166bb">MTR_LOG_MODE_MAX</a>][<a class="code" href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9afe0cfcef9cc3f4ed93e1515359d166bb">MTR_LOG_MODE_MAX</a>];</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">  /** Instance level logging information for all mtrs. */</span></div><div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="structmtr__t.html#ad2293be314e618f9453bced83d6adfdc">  635</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="classmtr__t_1_1Logging.html">Logging</a> <a class="code" href="structmtr__t.html#ad2293be314e618f9453bced83d6adfdc">s_logging</a>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00639"></a><span class="lineno"><a class="line" href="structmtr__t.html#a4aa5b9a74d58411942653f6b479d6026">  639</a></span>&#160;  <a class="code" href="structmtr__t_1_1Impl.html">Impl</a> <a class="code" href="structmtr__t.html#a4aa5b9a74d58411942653f6b479d6026">m_impl</a>;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">  /** LSN at commit time */</span></div><div class="line"><a name="l00642"></a><span class="lineno"><a class="line" href="structmtr__t.html#a57ac236848f2e4395dcda24632ebf60f">  642</a></span>&#160;  <a class="code" href="log0types_8h.html#aa7401e3081ffb8ee7e8fb182647f475c">lsn_t</a> <a class="code" href="structmtr__t.html#a57ac236848f2e4395dcda24632ebf60f">m_commit_lsn</a>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">  /** true if it is synchronous mini-transaction */</span></div><div class="line"><a name="l00645"></a><span class="lineno"><a class="line" href="structmtr__t.html#a4a74412c5bdc5bc9e64bb9d8eb12a233">  645</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structmtr__t.html#a4a74412c5bdc5bc9e64bb9d8eb12a233">m_sync</a>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno"><a class="line" href="structmtr__t.html#a62a7fc89f0ee4604e3ccab9b6b6a343f">  647</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classmtr__t_1_1Command.html">Command</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classmtr__t_1_1Command.html">Command</a>;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;};</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="preprocessor">#ifndef UNIV_HOTBACKUP</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="preprocessor">#ifdef UNIV_DEBUG</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">/** Reserves space in the log buffer and writes a single MLOG_TEST.</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">@param[in,out]  log      redo log</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">@param[in]      payload  number of extra bytes within the record,</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">                         not greater than 1024</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">@return end_lsn pointing to the first byte after the written record */</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<a class="code" href="log0types_8h.html#aa7401e3081ffb8ee7e8fb182647f475c">lsn_t</a> <a class="code" href="mtr0mtr_8h.html#a23aff4a16793840da6677270aa37b1ad">mtr_commit_mlog_test</a>(<a class="code" href="structlog__t.html">log_t</a> &amp;log, <span class="keywordtype">size_t</span> payload = 0);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">/** Reserves space in the log buffer and writes a single MLOG_TEST.</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">Adjusts size of the payload in the record, in order to fill the current</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">block up to its boundary. If nothing else is happening in parallel,</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">we could expect to see afterwards:</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">(cur_lsn + space_left) % OS_FILE_LOG_BLOCK_SIZE == LOG_BLOCK_HDR_SIZE,</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">where cur_lsn = log_get_lsn(log).</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">@param[in,out]  log         redo log</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">@param[in]      space_left  extra bytes left to the boundary of block,</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">                            must be not greater than 496 */</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="keywordtype">void</span> <a class="code" href="mtr0mtr_8h.html#ab9fc71d5a86029fd87087b543ea1daf4">mtr_commit_mlog_test_filling_block</a>(<a class="code" href="structlog__t.html">log_t</a> &amp;log, <span class="keywordtype">size_t</span> space_left = 0);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* UNIV_DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !UNIV_HOTBACKUP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="preprocessor">#include &quot;mtr0mtr.ic&quot;</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* mtr0mtr_h */</span><span class="preprocessor"></span></div><div class="ttc" id="classmtr__t_1_1Logging_html_a2843d2da1764019b8a8a38e78248fb32a3824ba03ea321c9695e14847d972a442"><div class="ttname"><a href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32a3824ba03ea321c9695e14847d972a442">mtr_t::Logging::ENABLED</a></div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:233</div></div>
<div class="ttc" id="namespaceCounter_html_abffd9234ba48273d835ae5cf193e3844"><div class="ttname"><a href="namespaceCounter.html#abffd9234ba48273d835ae5cf193e3844">Counter::clear</a></div><div class="ttdeci">void clear(Shards&lt; COUNT &gt; &amp;shards) noexcept</div><div class="ttdoc">Clear the counter - reset to 0. </div><div class="ttdef"><b>Definition:</b> ut0counter.h:343</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_ae303f44de9a75cf4b1c0abf227d147e1"><div class="ttname"><a href="structmtr__t_1_1Impl.html#ae303f44de9a75cf4b1c0abf227d147e1">mtr_t::Impl::m_memo</a></div><div class="ttdeci">mtr_buf_t m_memo</div><div class="ttdoc">memo stack for locks etc. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:173</div></div>
<div class="ttc" id="mcstat_8c_html_aeb0a66a1106a1c0097d605cbcb19766d"><div class="ttname"><a href="mcstat_8c.html#aeb0a66a1106a1c0097d605cbcb19766d">print</a></div><div class="ttdeci">static void print(const char *key, int keylen, const char *val, int vallen)</div><div class="ttdoc">Print the key value pair. </div><div class="ttdef"><b>Definition:</b> mcstat.c:106</div></div>
<div class="ttc" id="mtr0mtr_8h_html_a23aff4a16793840da6677270aa37b1ad"><div class="ttname"><a href="mtr0mtr_8h.html#a23aff4a16793840da6677270aa37b1ad">mtr_commit_mlog_test</a></div><div class="ttdeci">lsn_t mtr_commit_mlog_test(log_t &amp;log, size_t payload=0)</div><div class="ttdoc">Reserves space in the log buffer and writes a single MLOG_TEST. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.cc:1022</div></div>
<div class="ttc" id="structrw__lock__t_html"><div class="ttname"><a href="structrw__lock__t.html">rw_lock_t</a></div><div class="ttdoc">The structure used in the spin lock implementation of a read-write lock. </div><div class="ttdef"><b>Definition:</b> sync0rw.h:564</div></div>
<div class="ttc" id="log0types_8h_html_aa7401e3081ffb8ee7e8fb182647f475c"><div class="ttname"><a href="log0types_8h.html#aa7401e3081ffb8ee7e8fb182647f475c">lsn_t</a></div><div class="ttdeci">uint64_t lsn_t</div><div class="ttdoc">Type used for all log sequence number storage and arithmetics. </div><div class="ttdef"><b>Definition:</b> log0types.h:60</div></div>
<div class="ttc" id="structmtr__t_html_a998e4bf44228cccd483961e8e3b86844"><div class="ttname"><a href="structmtr__t.html#a998e4bf44228cccd483961e8e3b86844">mtr_t::mtr_t</a></div><div class="ttdeci">mtr_t()</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:345</div></div>
<div class="ttc" id="classdyn__buf__t_html"><div class="ttname"><a href="classdyn__buf__t.html">dyn_buf_t&lt; DYN_ARRAY_DATA_SIZE &gt;</a></div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_adad0c68a632d906b103dffd67da0a823"><div class="ttname"><a href="classmtr__t_1_1Logging.html#adad0c68a632d906b103dffd67da0a823">mtr_t::Logging::m_state</a></div><div class="ttdeci">std::atomic&lt; State &gt; m_state</div><div class="ttdoc">Global redo logging state. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:328</div></div>
<div class="ttc" id="mtr0types_8h_html_a84bed98f1f44be6de72e9486e75ce3f9aa1f4319b953b206e588a63fadfac338c"><div class="ttname"><a href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9aa1f4319b953b206e588a63fadfac338c">MTR_LOG_ALL</a></div><div class="ttdoc">Default mode: log all operations modifying disk-based data. </div><div class="ttdef"><b>Definition:</b> mtr0types.h:43</div></div>
<div class="ttc" id="mtr0types_8h_html_a84bed98f1f44be6de72e9486e75ce3f9afe0cfcef9cc3f4ed93e1515359d166bb"><div class="ttname"><a href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9afe0cfcef9cc3f4ed93e1515359d166bb">MTR_LOG_MODE_MAX</a></div><div class="ttdoc">Last element. </div><div class="ttdef"><b>Definition:</b> mtr0types.h:55</div></div>
<div class="ttc" id="fil0fil_8h_html"><div class="ttname"><a href="fil0fil_8h.html">fil0fil.h</a></div><div class="ttdoc">The low-level file system. </div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_af051f8d947e4fa8bdb34b0d6d9bd2ca1"><div class="ttname"><a href="structmtr__t_1_1Impl.html#af051f8d947e4fa8bdb34b0d6d9bd2ca1">mtr_t::Impl::m_marked_nolog</a></div><div class="ttdeci">bool m_marked_nolog</div><div class="ttdoc">true if mtr is forced to NO_LOG mode because redo logging is disabled globally. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:190</div></div>
<div class="ttc" id="sql__cmd__srs_8cc_html_af8756202cf6ab572edb0e832014f1a5f"><div class="ttname"><a href="sql__cmd__srs_8cc.html#af8756202cf6ab572edb0e832014f1a5f">commit</a></div><div class="ttdeci">static bool commit(THD *thd)</div><div class="ttdoc">Commit the current statement and transaction. </div><div class="ttdef"><b>Definition:</b> sql_cmd_srs.cc:151</div></div>
<div class="ttc" id="dyn0buf_8h_html"><div class="ttname"><a href="dyn0buf_8h.html">dyn0buf.h</a></div><div class="ttdoc">The dynamically allocated buffer implementation. </div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_ae1874f28bea9dea1c722bad6a69cd37d"><div class="ttname"><a href="classmtr__t_1_1Logging.html#ae1874f28bea9dea1c722bad6a69cd37d">mtr_t::Logging::init</a></div><div class="ttdeci">void init()</div><div class="ttdoc">Initialize logging state at server start up. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:248</div></div>
<div class="ttc" id="structmtr__t_html_acd3326ae99b456279480e81aab5b4089"><div class="ttname"><a href="structmtr__t.html#acd3326ae99b456279480e81aab5b4089">mtr_t::enter_ibuf</a></div><div class="ttdeci">void enter_ibuf()</div><div class="ttdoc">Note that we are inside the change buffer code. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:483</div></div>
<div class="ttc" id="structmtr__t_html_a6a80aba6d7b4330b2d9de5e22dda1877"><div class="ttname"><a href="structmtr__t.html#a6a80aba6d7b4330b2d9de5e22dda1877">mtr_t::exit_ibuf</a></div><div class="ttdeci">void exit_ibuf()</div><div class="ttdoc">Note that we have exited from the change buffer code. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:486</div></div>
<div class="ttc" id="structbuf__block__t_html"><div class="ttname"><a href="structbuf__block__t.html">buf_block_t</a></div><div class="ttdoc">The buffer control block structure. </div><div class="ttdef"><b>Definition:</b> buf0buf.h:1324</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_a8f414ed9ce052edc05bdc2799ec77180"><div class="ttname"><a href="classmtr__t_1_1Logging.html#a8f414ed9ce052edc05bdc2799ec77180">mtr_t::Logging::get_nolog_flush_loop</a></div><div class="ttdeci">uint32_t get_nolog_flush_loop() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:301</div></div>
<div class="ttc" id="namespaceCounter_html_a797c2d7934585e10e3e7b548520c3a95"><div class="ttname"><a href="namespaceCounter.html#a797c2d7934585e10e3e7b548520c3a95">Counter::dec</a></div><div class="ttdeci">Type dec(Shards&lt; COUNT &gt; &amp;shards, size_t id)</div><div class="ttdoc">Decrement the counter of a shard by 1. </div><div class="ttdef"><b>Definition:</b> ut0counter.h:301</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_a2843d2da1764019b8a8a38e78248fb32a466a489e848edda192907c05e54f7015"><div class="ttname"><a href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32a466a489e848edda192907c05e54f7015">mtr_t::Logging::ENABLED_RESTRICT</a></div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:241</div></div>
<div class="ttc" id="mtr0types_8h_html_a11a0f116bed9e1c33900d379901595d1"><div class="ttname"><a href="mtr0types_8h.html#a11a0f116bed9e1c33900d379901595d1">mlog_id_t</a></div><div class="ttdeci">mlog_id_t</div><div class="ttdef"><b>Definition:</b> mtr0types.h:62</div></div>
<div class="ttc" id="structmtr__t_html_aa34906d54e5138a26b5d34790c388e2b"><div class="ttname"><a href="structmtr__t.html#aa34906d54e5138a26b5d34790c388e2b">mtr_t::added_rec</a></div><div class="ttdeci">void added_rec()</div><div class="ttdoc">Note that a record has been added to the log. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:596</div></div>
<div class="ttc" id="structlog__t_html"><div class="ttname"><a href="structlog__t.html">log_t</a></div><div class="ttdoc">Redo log - single data structure with state of the redo log system. </div><div class="ttdef"><b>Definition:</b> log0types.h:133</div></div>
<div class="ttc" id="structmtr__t_html_a0845294c96183512d5e34e2c006bf1ed"><div class="ttname"><a href="structmtr__t.html#a0845294c96183512d5e34e2c006bf1ed">mtr_t::discard_modifications</a></div><div class="ttdeci">void discard_modifications()</div><div class="ttdoc">Set the state to not-modified. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:470</div></div>
<div class="ttc" id="namespacestdx_1_1io_html_a2c9b563b772005f7960909d0d12186f5"><div class="ttname"><a href="namespacestdx_1_1io.html#a2c9b563b772005f7960909d0d12186f5">stdx::io::mode</a></div><div class="ttdeci">mode</div><div class="ttdef"><b>Definition:</b> file_handle.h:59</div></div>
<div class="ttc" id="structfil__space__t_html"><div class="ttname"><a href="structfil__space__t.html">fil_space_t</a></div><div class="ttdoc">Tablespace or log data space. </div><div class="ttdef"><b>Definition:</b> fil0fil.h:219</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html"><div class="ttname"><a href="structmtr__t_1_1Impl.html">mtr_t::Impl</a></div><div class="ttdoc">State variables of the mtr. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:171</div></div>
<div class="ttc" id="structmtr__t_html_a800727ee66e7fec91a8d0d8114f43660"><div class="ttname"><a href="structmtr__t.html#a800727ee66e7fec91a8d0d8114f43660">mtr_t::get_expected_log_size</a></div><div class="ttdeci">size_t get_expected_log_size() const</div><div class="ttdoc">Computes the number of bytes that would be written to the redo log if mtr was committed right now (ex...</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:583</div></div>
<div class="ttc" id="structmtr__t_html_a9573ee51893885b271044e629434211b"><div class="ttname"><a href="structmtr__t.html#a9573ee51893885b271044e629434211b">mtr_t::set_sync</a></div><div class="ttdeci">void set_sync()</div><div class="ttdoc">Request a future commit to be synchronous. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:381</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_a83ecdfe81523d988e3ac03d5577973f2"><div class="ttname"><a href="structmtr__t_1_1Impl.html#a83ecdfe81523d988e3ac03d5577973f2">mtr_t::Impl::m_state</a></div><div class="ttdeci">mtr_state_t m_state</div><div class="ttdoc">State of the transaction. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:205</div></div>
<div class="ttc" id="structCounter_1_1Shards_html"><div class="ttname"><a href="structCounter_1_1Shards.html">Counter::Shards&lt; 128 &gt;</a></div></div>
<div class="ttc" id="namespaceundo_html_af16fb6085ef2e93316f4b550861c179c"><div class="ttname"><a href="namespaceundo.html#af16fb6085ef2e93316f4b550861c179c">undo::is_active</a></div><div class="ttdeci">bool is_active(space_id_t space_id, bool get_latch=true)</div><div class="ttdef"><b>Definition:</b> trx0purge.cc:1137</div></div>
<div class="ttc" id="structmtr__t_html_a50f9a1979f3e919714c8e3ddb0397322"><div class="ttname"><a href="structmtr__t.html#a50f9a1979f3e919714c8e3ddb0397322">mtr_t::has_modifications</a></div><div class="ttdeci">bool has_modifications() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:557</div></div>
<div class="ttc" id="mtr0types_8h_html_addc7f5310a633a6152ec95a84322d6fb"><div class="ttname"><a href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fb">mtr_state_t</a></div><div class="ttdeci">mtr_state_t</div><div class="ttdef"><b>Definition:</b> mtr0types.h:282</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_a2fbdb2e0948c885eb286c9bea91059a1"><div class="ttname"><a href="classmtr__t_1_1Logging.html#a2fbdb2e0948c885eb286c9bea91059a1">mtr_t::Logging::unmark_mtr</a></div><div class="ttdeci">void unmark_mtr(size_t index)</div><div class="ttdoc">unmark a no logging mtr. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:294</div></div>
<div class="ttc" id="structmtr__t_html_a4aa5b9a74d58411942653f6b479d6026"><div class="ttname"><a href="structmtr__t.html#a4aa5b9a74d58411942653f6b479d6026">mtr_t::m_impl</a></div><div class="ttdeci">Impl m_impl</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:639</div></div>
<div class="ttc" id="structmtr__t_html_aa68c4044f1c32276a5bd2385b118eee6"><div class="ttname"><a href="structmtr__t.html#aa68c4044f1c32276a5bd2385b118eee6">mtr_t::is_inside_ibuf</a></div><div class="ttdeci">bool is_inside_ibuf() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:489</div></div>
<div class="ttc" id="structmtr__t_html_a84fc922492f4d1bd0931d62874741e3a"><div class="ttname"><a href="structmtr__t.html#a84fc922492f4d1bd0931d62874741e3a">mtr_t::get_memo</a></div><div class="ttdeci">mtr_buf_t * get_memo()</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:575</div></div>
<div class="ttc" id="mtr0types_8h_html_a84bed98f1f44be6de72e9486e75ce3f9"><div class="ttname"><a href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9">mtr_log_t</a></div><div class="ttdeci">mtr_log_t</div><div class="ttdoc">Logging modes for a mini-transaction. </div><div class="ttdef"><b>Definition:</b> mtr0types.h:41</div></div>
<div class="ttc" id="structmtr__t_html_a95cb37601c1d42044a766d7a5eec92c7"><div class="ttname"><a href="structmtr__t.html#a95cb37601c1d42044a766d7a5eec92c7">mtr_t::get_flush_observer</a></div><div class="ttdeci">FlushObserver * get_flush_observer() const</div><div class="ttdoc">Get flush observer. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:501</div></div>
<div class="ttc" id="srv0srv_8h_html"><div class="ttname"><a href="srv0srv_8h.html">srv0srv.h</a></div><div class="ttdoc">The server main program. </div></div>
<div class="ttc" id="structmtr__t_html_a57ac236848f2e4395dcda24632ebf60f"><div class="ttname"><a href="structmtr__t.html#a57ac236848f2e4395dcda24632ebf60f">mtr_t::m_commit_lsn</a></div><div class="ttdeci">lsn_t m_commit_lsn</div><div class="ttdoc">LSN at commit time. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:642</div></div>
<div class="ttc" id="mtr0types_8h_html_addc7f5310a633a6152ec95a84322d6fba3bf727dacb4af2889bb952bed03751bd"><div class="ttname"><a href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fba3bf727dacb4af2889bb952bed03751bd">MTR_STATE_COMMITTING</a></div><div class="ttdef"><b>Definition:</b> mtr0types.h:285</div></div>
<div class="ttc" id="structmtr__t_html_a7848bb73a5f6561bc9accab705579be0"><div class="ttname"><a href="structmtr__t.html#a7848bb73a5f6561bc9accab705579be0">mtr_t::set_modified</a></div><div class="ttdeci">void set_modified()</div><div class="ttdoc">Note that the mini-transaction has modified data. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:465</div></div>
<div class="ttc" id="mtr0mtr_8h_html_ab9fc71d5a86029fd87087b543ea1daf4"><div class="ttname"><a href="mtr0mtr_8h.html#ab9fc71d5a86029fd87087b543ea1daf4">mtr_commit_mlog_test_filling_block</a></div><div class="ttdeci">void mtr_commit_mlog_test_filling_block(log_t &amp;log, size_t space_left=0)</div><div class="ttdoc">Reserves space in the log buffer and writes a single MLOG_TEST. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.cc:1151</div></div>
<div class="ttc" id="mysqld_8cc_html_ae851b490bae2ad91e401b972664fde81"><div class="ttname"><a href="mysqld_8cc.html#ae851b490bae2ad91e401b972664fde81">read_only</a></div><div class="ttdeci">bool read_only</div><div class="ttdef"><b>Definition:</b> mysqld.cc:1183</div></div>
<div class="ttc" id="mysql_8cc_html_adfa69ae672499b1037123a1f17c5552b"><div class="ttname"><a href="mysql_8cc.html#adfa69ae672499b1037123a1f17c5552b">index</a></div><div class="ttdeci">char * index(const char *, int c)</div><div class="ttdef"><b>Definition:</b> mysql.cc:2928</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_a2843d2da1764019b8a8a38e78248fb32aadbb3c8587b09b4487f9c62d7dd867e5"><div class="ttname"><a href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32aadbb3c8587b09b4487f9c62d7dd867e5">mtr_t::Logging::ENABLED_DBLWR</a></div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:237</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_a2843d2da1764019b8a8a38e78248fb32"><div class="ttname"><a href="classmtr__t_1_1Logging.html#a2843d2da1764019b8a8a38e78248fb32">mtr_t::Logging::State</a></div><div class="ttdeci">State</div><div class="ttdoc">mtr global redo logging state. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:231</div></div>
<div class="ttc" id="structmtr__t_html_acbb46d15006a7dd38a1fc39fee131755"><div class="ttname"><a href="structmtr__t.html#acbb46d15006a7dd38a1fc39fee131755">mtr_t::has_committed</a></div><div class="ttdeci">bool has_committed() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:547</div></div>
<div class="ttc" id="mtr0types_8h_html_ae8bcc01a7143e0c3a836c8941f386c3a"><div class="ttname"><a href="mtr0types_8h.html#ae8bcc01a7143e0c3a836c8941f386c3a">mtr_memo_type_t</a></div><div class="ttdeci">mtr_memo_type_t</div><div class="ttdoc">Types for the mlock objects to store in the mtr memo; NOTE that the first 3 values must be RW_S_LATCH...</div><div class="ttdef"><b>Definition:</b> mtr0types.h:258</div></div>
<div class="ttc" id="log0types_8h_html"><div class="ttname"><a href="log0types_8h.html">log0types.h</a></div><div class="ttdoc">Redo log types. </div></div>
<div class="ttc" id="namespaceCounter_html_a7ba056d7d4c2cd809eca09fc5fe2e075"><div class="ttname"><a href="namespaceCounter.html#a7ba056d7d4c2cd809eca09fc5fe2e075">Counter::total</a></div><div class="ttdeci">Type total(const Shards&lt; COUNT &gt; &amp;shards) noexcept</div><div class="ttdoc">Get the total value of all shards. </div><div class="ttdef"><b>Definition:</b> ut0counter.h:332</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_a877176bfa9fb233149816763f984b1b6"><div class="ttname"><a href="structmtr__t_1_1Impl.html#a877176bfa9fb233149816763f984b1b6">mtr_t::Impl::m_mtr</a></div><div class="ttdeci">mtr_t * m_mtr</div><div class="ttdoc">Owning mini-transaction. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:217</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_a4588f6734ccf0b5786392b87fe81df3a"><div class="ttname"><a href="classmtr__t_1_1Logging.html#a4588f6734ccf0b5786392b87fe81df3a">mtr_t::Logging::mark_mtr</a></div><div class="ttdeci">bool mark_mtr(size_t index)</div><div class="ttdoc">Mark a no-logging mtr to indicate that it would not generate redo log and system is crash unsafe...</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:275</div></div>
<div class="ttc" id="http__auth__backend__plugin_8cc_html_aee70c8416f705726100824ba89f1e090"><div class="ttname"><a href="http__auth__backend__plugin_8cc.html#aee70c8416f705726100824ba89f1e090">start</a></div><div class="ttdeci">static void start(mysql_harness::PluginFuncEnv *env)</div><div class="ttdef"><b>Definition:</b> http_auth_backend_plugin.cc:161</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_ac643e840dd2a71dae28b6f5dba5eed09"><div class="ttname"><a href="classmtr__t_1_1Logging.html#ac643e840dd2a71dae28b6f5dba5eed09">mtr_t::Logging::is_disabled</a></div><div class="ttdeci">bool is_disabled() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:308</div></div>
<div class="ttc" id="structmtr__memo__slot__t_html"><div class="ttname"><a href="structmtr__memo__slot__t.html">mtr_memo_slot_t</a></div><div class="ttdoc">Mini-transaction memo stack slot. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:160</div></div>
<div class="ttc" id="structmtr__t_html_a9a34889c30e7764db785de94b074ab33"><div class="ttname"><a href="structmtr__t.html#a9a34889c30e7764db785de94b074ab33">mtr_t::set_flush_observer</a></div><div class="ttdeci">void set_flush_observer(FlushObserver *observer)</div><div class="ttdoc">Set flush observer. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:507</div></div>
<div class="ttc" id="buf0types_8h_html"><div class="ttname"><a href="buf0types_8h.html">buf0types.h</a></div><div class="ttdoc">The database buffer pool global types for the directory. </div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_a7ab3324aca4bbf10b063cbe41287a154"><div class="ttname"><a href="structmtr__t_1_1Impl.html#a7ab3324aca4bbf10b063cbe41287a154">mtr_t::Impl::m_inside_ibuf</a></div><div class="ttdeci">bool m_inside_ibuf</div><div class="ttdoc">true if inside ibuf changes </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:182</div></div>
<div class="ttc" id="classmtr__t_1_1Command_html"><div class="ttname"><a href="classmtr__t_1_1Command.html">mtr_t::Command</a></div><div class="ttdef"><b>Definition:</b> mtr0mtr.cc:336</div></div>
<div class="ttc" id="classFlushObserver_html"><div class="ttname"><a href="classFlushObserver.html">FlushObserver</a></div><div class="ttdoc">We use FlushObserver to track flushing of non-redo logged pages in bulk create index(BtrBulk.cc).Since we disable redo logging during a index build, we need to make sure that all dirty pages modifed by the index build are flushed to disk before any redo logged operations go to the index. </div><div class="ttdef"><b>Definition:</b> buf0flu.h:275</div></div>
<div class="ttc" id="structmtr__t_html_a5d6d30cebb05dfbdfe3caeebe9e7576b"><div class="ttname"><a href="structmtr__t.html#a5d6d30cebb05dfbdfe3caeebe9e7576b">mtr_t::is_active</a></div><div class="ttdeci">bool is_active() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:495</div></div>
<div class="ttc" id="mtr0types_8h_html_a84bed98f1f44be6de72e9486e75ce3f9acb38ddbc32b67f5e2f6526ab12d6a4da"><div class="ttname"><a href="mtr0types_8h.html#a84bed98f1f44be6de72e9486e75ce3f9acb38ddbc32b67f5e2f6526ab12d6a4da">MTR_LOG_NO_REDO</a></div><div class="ttdoc">Don&amp;#39;t generate REDO log but add dirty pages to flush list. </div><div class="ttdef"><b>Definition:</b> mtr0types.h:49</div></div>
<div class="ttc" id="mtr0types_8h_html_addc7f5310a633a6152ec95a84322d6fbac2b1f9ea34a93b8a8305f4fa4494ae62"><div class="ttname"><a href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbac2b1f9ea34a93b8a8305f4fa4494ae62">MTR_STATE_INIT</a></div><div class="ttdef"><b>Definition:</b> mtr0types.h:283</div></div>
<div class="ttc" id="trx0types_8h_html"><div class="ttname"><a href="trx0types_8h.html">trx0types.h</a></div><div class="ttdoc">Transaction system global type definitions. </div></div>
<div class="ttc" id="structmtr__memo__slot__t_html_a60699ec7dbfd14cd125e5e4dd1bd20f4"><div class="ttname"><a href="structmtr__memo__slot__t.html#a60699ec7dbfd14cd125e5e4dd1bd20f4">mtr_memo_slot_t::type</a></div><div class="ttdeci">ulint type</div><div class="ttdoc">type of the stored object (MTR_MEMO_S_LOCK, ...) </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:165</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_ad3f5a1cbaebcba43059930fbab97673a"><div class="ttname"><a href="structmtr__t_1_1Impl.html#ad3f5a1cbaebcba43059930fbab97673a">mtr_t::Impl::m_log</a></div><div class="ttdeci">mtr_buf_t m_log</div><div class="ttdoc">mini-transaction log </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:176</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_af10203a976b39d912e1be65deae882cd"><div class="ttname"><a href="structmtr__t_1_1Impl.html#af10203a976b39d912e1be65deae882cd">mtr_t::Impl::m_flush_observer</a></div><div class="ttdeci">FlushObserver * m_flush_observer</div><div class="ttdoc">Flush Observer. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:208</div></div>
<div class="ttc" id="mtr0types_8h_html_addc7f5310a633a6152ec95a84322d6fbab108a28d90c60572abd2e2371dcae9c3"><div class="ttname"><a href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbab108a28d90c60572abd2e2371dcae9c3">MTR_STATE_ACTIVE</a></div><div class="ttdef"><b>Definition:</b> mtr0types.h:284</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_a3349502821f20c758810c3ce966dd559"><div class="ttname"><a href="structmtr__t_1_1Impl.html#a3349502821f20c758810c3ce966dd559">mtr_t::Impl::m_n_log_recs</a></div><div class="ttdeci">ib_uint32_t m_n_log_recs</div><div class="ttdoc">Count of how many page initial log records have been written to the mtr log. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:198</div></div>
<div class="ttc" id="ut0dbg_8h_html_a17113dab7f37e298e889ac8818ab13d0"><div class="ttname"><a href="ut0dbg_8h.html#a17113dab7f37e298e889ac8818ab13d0">ut_ad</a></div><div class="ttdeci">#define ut_ad(EXPR)</div><div class="ttdoc">Debug assertion. </div><div class="ttdef"><b>Definition:</b> ut0dbg.h:66</div></div>
<div class="ttc" id="structmtr__t_html_a0987e1b53ee9a5f93eb043350dfe88b5"><div class="ttname"><a href="structmtr__t.html#a0987e1b53ee9a5f93eb043350dfe88b5">mtr_t::is_dirty</a></div><div class="ttdeci">bool is_dirty() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:591</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html"><div class="ttname"><a href="classmtr__t_1_1Logging.html">mtr_t::Logging</a></div><div class="ttdoc">mtr global logging </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:222</div></div>
<div class="ttc" id="ut0dbg_8h_html_a14595937e3433e1d84a3e5bca4958a96"><div class="ttname"><a href="ut0dbg_8h.html#a14595937e3433e1d84a3e5bca4958a96">ut_error</a></div><div class="ttdeci">#define ut_error</div><div class="ttdoc">Abort execution. </div><div class="ttdef"><b>Definition:</b> ut0dbg.h:62</div></div>
<div class="ttc" id="structmtr__t_html_a4bde0d70a0e4760b0630c695c90d8dae"><div class="ttname"><a href="structmtr__t.html#a4bde0d70a0e4760b0630c695c90d8dae">mtr_t::get_log</a></div><div class="ttdeci">mtr_buf_t * get_log()</div><div class="ttdoc">Get the buffered redo log of this mini-transaction. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:608</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_aee55df93b0cb8ed6a6a368d3a8b6662b"><div class="ttname"><a href="classmtr__t_1_1Logging.html#aee55df93b0cb8ed6a6a368d3a8b6662b">mtr_t::Logging::m_count_nologging_mtr</a></div><div class="ttdeci">Shards m_count_nologging_mtr</div><div class="ttdoc">Number of no logging mtrs currently running. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:333</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_a7c6100f0bb92446971835c022fde8da5"><div class="ttname"><a href="structmtr__t_1_1Impl.html#a7c6100f0bb92446971835c022fde8da5">mtr_t::Impl::m_log_mode</a></div><div class="ttdeci">mtr_log_t m_log_mode</div><div class="ttdoc">specifies which operations should be logged; default value MTR_LOG_ALL </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:202</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_ad9cdd810fd6f803814655efb1b09a02d"><div class="ttname"><a href="structmtr__t_1_1Impl.html#ad9cdd810fd6f803814655efb1b09a02d">mtr_t::Impl::m_modifications</a></div><div class="ttdeci">bool m_modifications</div><div class="ttdoc">true if the mini-transaction modified buffer pool pages </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:185</div></div>
<div class="ttc" id="mtr0types_8h_html_addc7f5310a633a6152ec95a84322d6fbac68876238c9eca2e6457c39e36922512"><div class="ttname"><a href="mtr0types_8h.html#addc7f5310a633a6152ec95a84322d6fbac68876238c9eca2e6457c39e36922512">MTR_STATE_COMMITTED</a></div><div class="ttdef"><b>Definition:</b> mtr0types.h:286</div></div>
<div class="ttc" id="structmtr__t_html_acc8807462d867ea1bb2504b39b55239c"><div class="ttname"><a href="structmtr__t.html#acc8807462d867ea1bb2504b39b55239c">mtr_t::commit_lsn</a></div><div class="ttdeci">lsn_t commit_lsn() const</div><div class="ttdoc">Get the LSN of commit(). </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:476</div></div>
<div class="ttc" id="mtr0types_8h_html_abef9c3a0bceb1a41296836b1be5bde33"><div class="ttname"><a href="mtr0types_8h.html#abef9c3a0bceb1a41296836b1be5bde33">MTR_MAGIC_N</a></div><div class="ttdeci">#define MTR_MAGIC_N</div><div class="ttdef"><b>Definition:</b> mtr0types.h:279</div></div>
<div class="ttc" id="structmtr__t_html_a1052c89090caf6debedcf490e008acb4"><div class="ttname"><a href="structmtr__t.html#a1052c89090caf6debedcf490e008acb4">mtr_t::get_log</a></div><div class="ttdeci">const mtr_buf_t * get_log() const</div><div class="ttdoc">Get the buffered redo log of this mini-transaction. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:600</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_a054ad19de05c21920c905cc2f16749db"><div class="ttname"><a href="classmtr__t_1_1Logging.html#a054ad19de05c21920c905cc2f16749db">mtr_t::Logging::dblwr_disabled</a></div><div class="ttdeci">bool dblwr_disabled() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:311</div></div>
<div class="ttc" id="namespacefile_html"><div class="ttname"><a href="namespacefile.html">file</a></div><div class="ttdef"><b>Definition:</b> os0file.h:85</div></div>
<div class="ttc" id="structmtr__t_html_a567517d4a6102fb3cf7100ecc03b9763"><div class="ttname"><a href="structmtr__t.html#a567517d4a6102fb3cf7100ecc03b9763">mtr_t::is_async</a></div><div class="ttdeci">bool is_async() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:378</div></div>
<div class="ttc" id="namespaceCounter_html_a023ef5324f702e17ab0d296546bf1876"><div class="ttname"><a href="namespaceCounter.html#a023ef5324f702e17ab0d296546bf1876">Counter::inc</a></div><div class="ttdeci">Type inc(Shards&lt; COUNT &gt; &amp;shards, size_t id)</div><div class="ttdoc">Increment the counter of a shard by 1. </div><div class="ttdef"><b>Definition:</b> ut0counter.h:292</div></div>
<div class="ttc" id="classmtr__t_1_1Logging_html_ae5dff5a196ee6c50388ac7eca02d6e0b"><div class="ttname"><a href="classmtr__t_1_1Logging.html#ae5dff5a196ee6c50388ac7eca02d6e0b">mtr_t::Logging::is_enabled</a></div><div class="ttdeci">bool is_enabled() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:304</div></div>
<div class="ttc" id="hp__test1_8cc_html_a6eec09a91807e20d7b3d6ef3da594067"><div class="ttname"><a href="hp__test1_8cc.html#a6eec09a91807e20d7b3d6ef3da594067">flags</a></div><div class="ttdeci">static int flags[50]</div><div class="ttdef"><b>Definition:</b> hp_test1.cc:39</div></div>
<div class="ttc" id="libmysql_2authentication__win_2common_8h_html_a0c8186d9b9b7880309c27230bbb5e69d"><div class="ttname"><a href="libmysql_2authentication__win_2common_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a></div><div class="ttdeci">unsigned char byte</div><div class="ttdoc">Blob class. </div><div class="ttdef"><b>Definition:</b> common.h:159</div></div>
<div class="ttc" id="structmtr__t_html"><div class="ttname"><a href="structmtr__t.html">mtr_t</a></div><div class="ttdoc">Mini-transaction handle and buffer. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:169</div></div>
<div class="ttc" id="structmtr__t_html_a9b7d1f4291d80ce417b0ad1fdbfe0940"><div class="ttname"><a href="structmtr__t.html#a9b7d1f4291d80ce417b0ad1fdbfe0940">mtr_t::get_memo</a></div><div class="ttdeci">const mtr_buf_t * get_memo() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:570</div></div>
<div class="ttc" id="structmtr__t_html_ad2293be314e618f9453bced83d6adfdc"><div class="ttname"><a href="structmtr__t.html#ad2293be314e618f9453bced83d6adfdc">mtr_t::s_logging</a></div><div class="ttdeci">static Logging s_logging</div><div class="ttdoc">Instance level logging information for all mtrs. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:635</div></div>
<div class="ttc" id="structmtr__memo__slot__t_html_aba6b26df48618b6d6e704af6815816a7"><div class="ttname"><a href="structmtr__memo__slot__t.html#aba6b26df48618b6d6e704af6815816a7">mtr_memo_slot_t::object</a></div><div class="ttdeci">void * object</div><div class="ttdoc">pointer to the object </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:162</div></div>
<div class="ttc" id="structmtr__t_html_aea17ef007d058fa26c5c61de1517875e"><div class="ttname"><a href="structmtr__t.html#aea17ef007d058fa26c5c61de1517875e">mtr_t::~mtr_t</a></div><div class="ttdeci">~mtr_t()</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:351</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_ac018aa062636848b9babfe00857f1f75"><div class="ttname"><a href="structmtr__t_1_1Impl.html#ac018aa062636848b9babfe00857f1f75">mtr_t::Impl::m_magic_n</a></div><div class="ttdeci">ulint m_magic_n</div><div class="ttdoc">For checking corruption. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:212</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_a912d862a5a63d83512c93405ee23ca1c"><div class="ttname"><a href="structmtr__t_1_1Impl.html#a912d862a5a63d83512c93405ee23ca1c">mtr_t::Impl::m_shard_index</a></div><div class="ttdeci">size_t m_shard_index</div><div class="ttdoc">Shard index used for incrementing global counter at start. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:194</div></div>
<div class="ttc" id="structmtr__t_html_a4a74412c5bdc5bc9e64bb9d8eb12a233"><div class="ttname"><a href="structmtr__t.html#a4a74412c5bdc5bc9e64bb9d8eb12a233">mtr_t::m_sync</a></div><div class="ttdeci">bool m_sync</div><div class="ttdoc">true if it is synchronous mini-transaction </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:645</div></div>
<div class="ttc" id="mtr0types_8h_html"><div class="ttname"><a href="mtr0types_8h.html">mtr0types.h</a></div><div class="ttdoc">Mini-transaction buffer global types. </div></div>
<div class="ttc" id="classTHD_html"><div class="ttname"><a href="classTHD.html">THD</a></div><div class="ttdoc">For each client connection we create a separate thread with THD serving as a thread/connection descri...</div><div class="ttdef"><b>Definition:</b> sql_class.h:803</div></div>
<div class="ttc" id="structmtr__t_html_aa8e35e00d8a3e542fdf3e934e5249ca1"><div class="ttname"><a href="structmtr__t.html#aa8e35e00d8a3e542fdf3e934e5249ca1">mtr_t::is_committing</a></div><div class="ttdeci">bool is_committing() const</div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:552</div></div>
<div class="ttc" id="structmtr__t_html_acc55dec377f4c619c5d706f44b9186e5"><div class="ttname"><a href="structmtr__t.html#acc55dec377f4c619c5d706f44b9186e5">mtr_t::get_savepoint</a></div><div class="ttdeci">ulint get_savepoint() const</div><div class="ttdoc">Return current size of the buffer. </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:388</div></div>
<div class="ttc" id="structmtr__t_1_1Impl_html_a383809a09ce50213e7a9492b3d018594"><div class="ttname"><a href="structmtr__t_1_1Impl.html#a383809a09ce50213e7a9492b3d018594">mtr_t::Impl::m_made_dirty</a></div><div class="ttdeci">bool m_made_dirty</div><div class="ttdoc">true if mtr has made at least one buffer pool page dirty </div><div class="ttdef"><b>Definition:</b> mtr0mtr.h:179</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_70f20ecf11358dff00a0daf546d3147e.html">storage</a></li><li class="navelem"><a class="el" href="dir_3fec0aa9607ea05e0bb1c96aee1a8c4e.html">innobase</a></li><li class="navelem"><a class="el" href="dir_9b7ed1f29269ffabdc4c5f5522a0db25.html">include</a></li><li class="navelem"><a class="el" href="mtr0mtr_8h.html">mtr0mtr.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
