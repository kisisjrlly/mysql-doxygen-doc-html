<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: locksys::Latches Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classlocksys_1_1Latches.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classlocksys_1_1Latches-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">locksys::Latches Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The class which handles the logic of latching of lock_sys queues themselves.  
 <a href="classlocksys_1_1Latches.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="lock0latches_8h_source.html">lock0latches.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches_1_1Page__shards.html">Page_shards</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches_1_1Table__shards.html">Table_shards</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock.html">Unique_sharded_rw_lock</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A helper wrapper around Shared_rw_lock which simplifies:  <a href="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3b2cc5241d4c2a26e322bcc5dddae038"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a3b2cc5241d4c2a26e322bcc5dddae038">~Latches</a> ()</td></tr>
<tr class="memdesc:a3b2cc5241d4c2a26e322bcc5dddae038"><td class="mdescLeft">&#160;</td><td class="mdescRight">For some reason clang 6.0.0 and 7.0.0 (but not 8.0.0) fail at linking stage if we completely omit the destructor declaration, or use.  <a href="#a3b2cc5241d4c2a26e322bcc5dddae038">More...</a><br /></td></tr>
<tr class="separator:a3b2cc5241d4c2a26e322bcc5dddae038"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad076de955c4e1d26055867701c025320"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#ad076de955c4e1d26055867701c025320">owns_exclusive_global_latch</a> () const</td></tr>
<tr class="memdesc:ad076de955c4e1d26055867701c025320"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests if lock_sys latch is exclusively owned by the current thread.  <a href="#ad076de955c4e1d26055867701c025320">More...</a><br /></td></tr>
<tr class="separator:ad076de955c4e1d26055867701c025320"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6f3d09b325d036c079b56c75ba332e0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#aa6f3d09b325d036c079b56c75ba332e0">owns_shared_global_latch</a> () const</td></tr>
<tr class="memdesc:aa6f3d09b325d036c079b56c75ba332e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests if lock_sys latch is owned in shared mode by the current thread.  <a href="#aa6f3d09b325d036c079b56c75ba332e0">More...</a><br /></td></tr>
<tr class="separator:aa6f3d09b325d036c079b56c75ba332e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab685cef95e71a5584dfece5de67758ec"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#ab685cef95e71a5584dfece5de67758ec">owns_page_shard</a> (const <a class="el" href="classpage__id__t.html">page_id_t</a> &amp;page_id) const</td></tr>
<tr class="memdesc:ab685cef95e71a5584dfece5de67758ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests if given page shard can be safely accessed by the current thread.  <a href="#ab685cef95e71a5584dfece5de67758ec">More...</a><br /></td></tr>
<tr class="separator:ab685cef95e71a5584dfece5de67758ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c2315538ff3e1bbfd312b8c5643df7c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a8c2315538ff3e1bbfd312b8c5643df7c">owns_table_shard</a> (const <a class="el" href="structdict__table__t.html">dict_table_t</a> &amp;table) const</td></tr>
<tr class="memdesc:a8c2315538ff3e1bbfd312b8c5643df7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests if given table shard can be safely accessed by the current thread.  <a href="#a8c2315538ff3e1bbfd312b8c5643df7c">More...</a><br /></td></tr>
<tr class="separator:a8c2315538ff3e1bbfd312b8c5643df7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a8b30ff77f9565adec8c15dd187aa6938"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a8b30ff77f9565adec8c15dd187aa6938">Lock_mutex</a> = ib_mutex_t</td></tr>
<tr class="separator:a8b30ff77f9565adec8c15dd187aa6938"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69b0dfb71231f6f4b722a5b4204dbfc4"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a69b0dfb71231f6f4b722a5b4204dbfc4">Padded_mutex</a> = <a class="el" href="structut_1_1Cacheline__padded.html">ut::Cacheline_padded</a>&lt; <a class="el" href="classlocksys_1_1Latches.html#a8b30ff77f9565adec8c15dd187aa6938">Lock_mutex</a> &gt;</td></tr>
<tr class="separator:a69b0dfb71231f6f4b722a5b4204dbfc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a468bb290b800c7a187a01193693c525a"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a468bb290b800c7a187a01193693c525a">pad1</a> [<a class="el" href="namespaceut.html#a018665aeb2da2c629663fd9218adc755">ut::INNODB_CACHE_LINE_SIZE</a>] = {}</td></tr>
<tr class="memdesc:a468bb290b800c7a187a01193693c525a"><td class="mdescLeft">&#160;</td><td class="mdescRight">padding to prevent other memory update hotspots from residing on the same memory cache line  <a href="#a468bb290b800c7a187a01193693c525a">More...</a><br /></td></tr>
<tr class="separator:a468bb290b800c7a187a01193693c525a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cdc487610b269186e5ab794fde6b86b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock.html">Unique_sharded_rw_lock</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a8cdc487610b269186e5ab794fde6b86b">global_latch</a></td></tr>
<tr class="separator:a8cdc487610b269186e5ab794fde6b86b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bbcf7eba7615b9161ca94223bcb69e6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classlocksys_1_1Latches_1_1Page__shards.html">Page_shards</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a1bbcf7eba7615b9161ca94223bcb69e6">page_shards</a></td></tr>
<tr class="separator:a1bbcf7eba7615b9161ca94223bcb69e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1eb90bc2ebd5346bfb957a5e86e926b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classlocksys_1_1Latches_1_1Table__shards.html">Table_shards</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#af1eb90bc2ebd5346bfb957a5e86e926b">table_shards</a></td></tr>
<tr class="separator:af1eb90bc2ebd5346bfb957a5e86e926b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a3bc6e738932fa2ee7dbf5e88afed1b2a"><td class="memItemLeft" align="right" valign="top">static constexpr size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a3bc6e738932fa2ee7dbf5e88afed1b2a">SHARDS_COUNT</a> = 512</td></tr>
<tr class="memdesc:a3bc6e738932fa2ee7dbf5e88afed1b2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of page shards, and also number of table shards.  <a href="#a3bc6e738932fa2ee7dbf5e88afed1b2a">More...</a><br /></td></tr>
<tr class="separator:a3bc6e738932fa2ee7dbf5e88afed1b2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:af30da8cea74d55d77a2978f651ee4138"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#af30da8cea74d55d77a2978f651ee4138">Global_exclusive_latch_guard</a></td></tr>
<tr class="separator:af30da8cea74d55d77a2978f651ee4138"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8a50a3d0ac09cf9c92937fad6285dbe"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#ac8a50a3d0ac09cf9c92937fad6285dbe">Global_exclusive_try_latch</a></td></tr>
<tr class="separator:ac8a50a3d0ac09cf9c92937fad6285dbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5ad2f7f52c9e8bb1afcfc1007a85cf5"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#ab5ad2f7f52c9e8bb1afcfc1007a85cf5">Global_shared_latch_guard</a></td></tr>
<tr class="separator:ab5ad2f7f52c9e8bb1afcfc1007a85cf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7782cbe4975a006561e23ff5b2d9eeb1"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a7782cbe4975a006561e23ff5b2d9eeb1">Shard_naked_latch_guard</a></td></tr>
<tr class="separator:a7782cbe4975a006561e23ff5b2d9eeb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae235535502761c160e5fcf6461b76776"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#ae235535502761c160e5fcf6461b76776">Shard_naked_latches_guard</a></td></tr>
<tr class="separator:ae235535502761c160e5fcf6461b76776"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6433a6b0cf3a2b375fa1b0d58afa0027"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlocksys_1_1Latches.html#a6433a6b0cf3a2b375fa1b0d58afa0027">Unsafe_global_latch_manipulator</a></td></tr>
<tr class="memdesc:a6433a6b0cf3a2b375fa1b0d58afa0027"><td class="mdescLeft">&#160;</td><td class="mdescRight">You should not use this functionality in new code.  <a href="#a6433a6b0cf3a2b375fa1b0d58afa0027">More...</a><br /></td></tr>
<tr class="separator:a6433a6b0cf3a2b375fa1b0d58afa0027"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The class which handles the logic of latching of lock_sys queues themselves. </p>
<p>The lock requests for table locks and record locks are stored in queues, and to allow concurrent operations on these queues, we need a mechanism to latch these queues in safe and quick fashion. In the past we had a single latch which protected access to all of them. Now, we use more granular approach. In extreme, one could imagine protecting each queue with a separate latch. To avoid having too many latch objects, and having to create and remove them on demand, we use a more conservative approach. The queues are grouped into a fixed number of shards, and each shard is protected by its own mutex.</p>
<p>However, there are several rare events in which we need to "stop the world" - latch all queues, to prevent any activity inside lock-sys. One way to accomplish this would be to simply latch all the shards one by one, but it turns out to be way too slow in debug runs, where such "stop the world" events are very frequent due to lock_sys validation.</p>
<p>To allow for efficient latching of everything, we've introduced a global_latch, which is a read-write latch. Most of the time, we operate on one or two shards, in which case it is sufficient to s-latch the global_latch and then latch shard's mutex. For the "stop the world" operations, we x-latch the global_latch, which prevents any other thread from latching any shard.</p>
<p>However, it turned out that on ARM architecture, the default implementation of read-write latch (rw_lock_t) is too slow because increments and decrements of the number of s-latchers is implemented as read-update-try-to-write loop, which means multiple threads try to modify the same cache line disrupting each other. Therefore, we use a sharded version of read-write latch (Sharded_rw_lock), which internally uses multiple instances of rw_lock_t, spreading the load over several cache lines. Note that this sharding is a technical internal detail of the global_latch, which for all other purposes can be treated as a single entity.</p>
<p>This his how this conceptually looks like: </p><div class="fragment"><div class="line">[                           global latch                                ]</div><div class="line">                                |</div><div class="line">                                v</div><div class="line">[table shard 1] ... [table shard 512] [<a class="code" href="ctype-mb_8cc.html#adf406aa6822ceac22d62ef63cc2879c0">page</a> shard 1] ... [<a class="code" href="ctype-mb_8cc.html#adf406aa6822ceac22d62ef63cc2879c0">page</a> shard 512]</div></div><!-- fragment --><p>So, for example access two queues for two records involves following steps:</p><ol type="1">
<li>s-latch the global_latch</li>
<li>identify the 2 pages to which the records belong</li>
<li>identify the lock_sys 2 hash buckets which contain the queues for given pages</li>
<li>identify the 2 shard ids which contain these two buckets</li>
<li>latch mutexes for the two shards in the order of their addresses</li>
</ol>
<p>All of the steps above (except 2, as we usually know the page already) are accomplished with the help of single line: </p><pre class="fragment">locksys::Shard_latches_guard guard{*block_a, *block_b};
</pre><p>And to "stop the world" one can simply x-latch the global latch by using: </p><pre class="fragment">locksys::Global_exclusive_latch_guard guard{};
</pre><p>This class does not expose too many public functions, as the intention is to rather use friend guard classes, like the Shard_latches_guard demonstrated. </p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a8b30ff77f9565adec8c15dd187aa6938"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b30ff77f9565adec8c15dd187aa6938">&#9670;&nbsp;</a></span>Lock_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using locksys::Latches::Lock_mutex =  ib_mutex_t</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a69b0dfb71231f6f4b722a5b4204dbfc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69b0dfb71231f6f4b722a5b4204dbfc4">&#9670;&nbsp;</a></span>Padded_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using locksys::Latches::Padded_mutex =  <a class="el" href="structut_1_1Cacheline__padded.html">ut::Cacheline_padded</a>&lt;<a class="el" href="classlocksys_1_1Latches.html#a8b30ff77f9565adec8c15dd187aa6938">Lock_mutex</a>&gt;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a3b2cc5241d4c2a26e322bcc5dddae038"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b2cc5241d4c2a26e322bcc5dddae038">&#9670;&nbsp;</a></span>~Latches()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">locksys::Latches::~Latches </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>For some reason clang 6.0.0 and 7.0.0 (but not 8.0.0) fail at linking stage if we completely omit the destructor declaration, or use. </p>
<p>~Latches() = default;</p>
<p>This might be somehow connected to one of these: <a href="https://bugs.llvm.org/show_bug.cgi?id=28280">https://bugs.llvm.org/show_bug.cgi?id=28280</a> <a href="https://github.com/android/ndk/issues/143">https://github.com/android/ndk/issues/143</a> <a href="https://reviews.llvm.org/D45898">https://reviews.llvm.org/D45898</a> So, this declaration is just to make clang 6.0.0 and 7.0.0 happy. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ad076de955c4e1d26055867701c025320"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad076de955c4e1d26055867701c025320">&#9670;&nbsp;</a></span>owns_exclusive_global_latch()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> locksys::Latches::owns_exclusive_global_latch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Tests if lock_sys latch is exclusively owned by the current thread. </p>
<dl class="section return"><dt>Returns</dt><dd>true iff the current thread owns exclusive global lock_sys latch </dd></dl>

</div>
</div>
<a id="ab685cef95e71a5584dfece5de67758ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab685cef95e71a5584dfece5de67758ec">&#9670;&nbsp;</a></span>owns_page_shard()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> locksys::Latches::owns_page_shard </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classpage__id__t.html">page_id_t</a> &amp;&#160;</td>
          <td class="paramname"><em>page_id</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Tests if given page shard can be safely accessed by the current thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">page_id</td><td>The space_id and page_no of the page </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true iff the current thread owns exclusive global lock_sys latch or both a shared global lock_sys latch and mutex protecting the page shard </dd></dl>

</div>
</div>
<a id="aa6f3d09b325d036c079b56c75ba332e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6f3d09b325d036c079b56c75ba332e0">&#9670;&nbsp;</a></span>owns_shared_global_latch()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> locksys::Latches::owns_shared_global_latch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Tests if lock_sys latch is owned in shared mode by the current thread. </p>
<dl class="section return"><dt>Returns</dt><dd>true iff the current thread owns shared global lock_sys latch </dd></dl>

</div>
</div>
<a id="a8c2315538ff3e1bbfd312b8c5643df7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c2315538ff3e1bbfd312b8c5643df7c">&#9670;&nbsp;</a></span>owns_table_shard()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> locksys::Latches::owns_table_shard </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdict__table__t.html">dict_table_t</a> &amp;&#160;</td>
          <td class="paramname"><em>table</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Tests if given table shard can be safely accessed by the current thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">table</td><td>the table </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true iff the current thread owns exclusive global lock_sys latch or both a shared global lock_sys latch and mutex protecting the table shard </dd></dl>

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a id="af30da8cea74d55d77a2978f651ee4138"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af30da8cea74d55d77a2978f651ee4138">&#9670;&nbsp;</a></span>Global_exclusive_latch_guard</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classlocksys_1_1Global__exclusive__latch__guard.html">Global_exclusive_latch_guard</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac8a50a3d0ac09cf9c92937fad6285dbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8a50a3d0ac09cf9c92937fad6285dbe">&#9670;&nbsp;</a></span>Global_exclusive_try_latch</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classlocksys_1_1Global__exclusive__try__latch.html">Global_exclusive_try_latch</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ab5ad2f7f52c9e8bb1afcfc1007a85cf5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5ad2f7f52c9e8bb1afcfc1007a85cf5">&#9670;&nbsp;</a></span>Global_shared_latch_guard</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classlocksys_1_1Global__shared__latch__guard.html">Global_shared_latch_guard</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a7782cbe4975a006561e23ff5b2d9eeb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7782cbe4975a006561e23ff5b2d9eeb1">&#9670;&nbsp;</a></span>Shard_naked_latch_guard</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classlocksys_1_1Shard__naked__latch__guard.html">Shard_naked_latch_guard</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ae235535502761c160e5fcf6461b76776"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae235535502761c160e5fcf6461b76776">&#9670;&nbsp;</a></span>Shard_naked_latches_guard</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classlocksys_1_1Shard__naked__latches__guard.html">Shard_naked_latches_guard</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a6433a6b0cf3a2b375fa1b0d58afa0027"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6433a6b0cf3a2b375fa1b0d58afa0027">&#9670;&nbsp;</a></span>Unsafe_global_latch_manipulator</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classlocksys_1_1Unsafe__global__latch__manipulator.html">Unsafe_global_latch_manipulator</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>You should not use this functionality in new code. </p>
<p>Instead use Global_exclusive_latch_guard. This is intended only to be use within lock0* module, thus this class is only accessible through lock0priv.h. It is only used by lock_rec_fetch_page() as a workaround. </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a8cdc487610b269186e5ab794fde6b86b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cdc487610b269186e5ab794fde6b86b">&#9670;&nbsp;</a></span>global_latch</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlocksys_1_1Latches_1_1Unique__sharded__rw__lock.html">Unique_sharded_rw_lock</a> locksys::Latches::global_latch</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a468bb290b800c7a187a01193693c525a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a468bb290b800c7a187a01193693c525a">&#9670;&nbsp;</a></span>pad1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char locksys::Latches::pad1[<a class="el" href="namespaceut.html#a018665aeb2da2c629663fd9218adc755">ut::INNODB_CACHE_LINE_SIZE</a>] = {}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>padding to prevent other memory update hotspots from residing on the same memory cache line </p>

</div>
</div>
<a id="a1bbcf7eba7615b9161ca94223bcb69e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bbcf7eba7615b9161ca94223bcb69e6">&#9670;&nbsp;</a></span>page_shards</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlocksys_1_1Latches_1_1Page__shards.html">Page_shards</a> locksys::Latches::page_shards</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a3bc6e738932fa2ee7dbf5e88afed1b2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bc6e738932fa2ee7dbf5e88afed1b2a">&#9670;&nbsp;</a></span>SHARDS_COUNT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr size_t locksys::Latches::SHARDS_COUNT = 512</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of page shards, and also number of table shards. </p>
<p>Must be a power of two </p>

</div>
</div>
<a id="af1eb90bc2ebd5346bfb957a5e86e926b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1eb90bc2ebd5346bfb957a5e86e926b">&#9670;&nbsp;</a></span>table_shards</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlocksys_1_1Latches_1_1Table__shards.html">Table_shards</a> locksys::Latches::table_shards</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>storage/innobase/include/<a class="el" href="lock0latches_8h_source.html">lock0latches.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacelocksys.html">locksys</a></li><li class="navelem"><a class="el" href="classlocksys_1_1Latches.html">Latches</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
