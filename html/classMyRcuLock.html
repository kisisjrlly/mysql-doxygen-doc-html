<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: MyRcuLock&lt; T &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classMyRcuLock.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classMyRcuLock-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">MyRcuLock&lt; T &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A class that implements a limited version of the Read-Copy-Update lock pattern.  
 <a href="classMyRcuLock.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="my__rcu__lock_8h_source.html">my_rcu_lock.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock_1_1ReadLock.html">ReadLock</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">High level read API for readers.  <a href="classMyRcuLock_1_1ReadLock.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1a6e67ac8d3df17c33e3dee4f97954f2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#a1a6e67ac8d3df17c33e3dee4f97954f2">MyRcuLock</a> (const T *<a class="el" href="storage_2temptable_2src_2plugin_8cc.html#ab877fb50c3274ceddd69d119c420740f">init</a>)</td></tr>
<tr class="memdesc:a1a6e67ac8d3df17c33e3dee4f97954f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up the RCU lock and the global.  <a href="#a1a6e67ac8d3df17c33e3dee4f97954f2">More...</a><br /></td></tr>
<tr class="separator:a1a6e67ac8d3df17c33e3dee4f97954f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9152f4560e372566eddbc568ce22b912"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#a9152f4560e372566eddbc568ce22b912">MyRcuLock</a> (const <a class="el" href="classMyRcuLock.html">MyRcuLock</a> &amp;)=delete</td></tr>
<tr class="memdesc:a9152f4560e372566eddbc568ce22b912"><td class="mdescLeft">&#160;</td><td class="mdescRight">disabled  <a href="#a9152f4560e372566eddbc568ce22b912">More...</a><br /></td></tr>
<tr class="separator:a9152f4560e372566eddbc568ce22b912"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2baa2f16992818e1e19d44909288801a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#a2baa2f16992818e1e19d44909288801a">operator=</a> (const <a class="el" href="classMyRcuLock.html">MyRcuLock</a> &amp;)=delete</td></tr>
<tr class="memdesc:a2baa2f16992818e1e19d44909288801a"><td class="mdescLeft">&#160;</td><td class="mdescRight">disabled  <a href="#a2baa2f16992818e1e19d44909288801a">More...</a><br /></td></tr>
<tr class="separator:a2baa2f16992818e1e19d44909288801a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae291748f35f22b4acc22a96d0f93f999"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#ae291748f35f22b4acc22a96d0f93f999">~MyRcuLock</a> ()</td></tr>
<tr class="memdesc:ae291748f35f22b4acc22a96d0f93f999"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="#ae291748f35f22b4acc22a96d0f93f999">More...</a><br /></td></tr>
<tr class="separator:ae291748f35f22b4acc22a96d0f93f999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0656165d917c1273932faca008225da"><td class="memItemLeft" align="right" valign="top">const T *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#ad0656165d917c1273932faca008225da">rcu_read</a> ()</td></tr>
<tr class="memdesc:ad0656165d917c1273932faca008225da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Low level API: start reading.  <a href="#ad0656165d917c1273932faca008225da">More...</a><br /></td></tr>
<tr class="separator:ad0656165d917c1273932faca008225da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a12490956232946722d8a60d22693bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#a9a12490956232946722d8a60d22693bf">rcu_end_read</a> ()</td></tr>
<tr class="memdesc:a9a12490956232946722d8a60d22693bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Low level API: end reading.  <a href="#a9a12490956232946722d8a60d22693bf">More...</a><br /></td></tr>
<tr class="separator:a9a12490956232946722d8a60d22693bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83c044eb83cfb52947686b629afd25c3"><td class="memItemLeft" align="right" valign="top">const T *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#a83c044eb83cfb52947686b629afd25c3">rcu_write</a> (const T *newT)</td></tr>
<tr class="memdesc:a83c044eb83cfb52947686b629afd25c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Low level API: write a new global and return the old one.  <a href="#a83c044eb83cfb52947686b629afd25c3">More...</a><br /></td></tr>
<tr class="separator:a83c044eb83cfb52947686b629afd25c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bca0d53853dfb92f56bd4e46c79ab0a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#a0bca0d53853dfb92f56bd4e46c79ab0a">wait_for_no_readers</a> ()</td></tr>
<tr class="memdesc:a0bca0d53853dfb92f56bd4e46c79ab0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Low level API: wait for no active readers.  <a href="#a0bca0d53853dfb92f56bd4e46c79ab0a">More...</a><br /></td></tr>
<tr class="separator:a0bca0d53853dfb92f56bd4e46c79ab0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2db1f31c4a93c8e73eb34a679dc92d64"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#a2db1f31c4a93c8e73eb34a679dc92d64">write_wait_and_delete</a> (const T *newT)</td></tr>
<tr class="memdesc:a2db1f31c4a93c8e73eb34a679dc92d64"><td class="mdescLeft">&#160;</td><td class="mdescRight">A RCU writer API.  <a href="#a2db1f31c4a93c8e73eb34a679dc92d64">More...</a><br /></td></tr>
<tr class="separator:a2db1f31c4a93c8e73eb34a679dc92d64"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:add512ce555b5cb1a3fa1577ebc7856ff"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; const T * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#add512ce555b5cb1a3fa1577ebc7856ff">rcu_global_</a></td></tr>
<tr class="memdesc:add512ce555b5cb1a3fa1577ebc7856ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">the global pointer to protect  <a href="#add512ce555b5cb1a3fa1577ebc7856ff">More...</a><br /></td></tr>
<tr class="separator:add512ce555b5cb1a3fa1577ebc7856ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dba6cd5f44e774bc46fc7bfaf4f5bc0"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#a1dba6cd5f44e774bc46fc7bfaf4f5bc0">rcu_padding_</a> [128]</td></tr>
<tr class="memdesc:a1dba6cd5f44e774bc46fc7bfaf4f5bc0"><td class="mdescLeft">&#160;</td><td class="mdescRight">padding to break the CPU cache lines  <a href="#a1dba6cd5f44e774bc46fc7bfaf4f5bc0">More...</a><br /></td></tr>
<tr class="separator:a1dba6cd5f44e774bc46fc7bfaf4f5bc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae231011023c6c2378668e3162e033232"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; long &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyRcuLock.html#ae231011023c6c2378668e3162e033232">rcu_readers_</a></td></tr>
<tr class="memdesc:ae231011023c6c2378668e3162e033232"><td class="mdescLeft">&#160;</td><td class="mdescRight">the readers counter  <a href="#ae231011023c6c2378668e3162e033232">More...</a><br /></td></tr>
<tr class="separator:ae231011023c6c2378668e3162e033232"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename T&gt;<br />
class MyRcuLock&lt; T &gt;</h3>

<p>A class that implements a limited version of the Read-Copy-Update lock pattern. </p>
<p>When you have a global variable that is mostly read and seldomly changed you need to make sure your readers get minimal overhead eventually at the cost of slowing down your writers.</p>
<p>It is implemented as an atomic pointer to the protected global (the template class). You can safely read from it and you can safely write a new version of the global. The problem is how and when to dispose of the old version(s) of the global that are swapped out by the write.</p>
<p>The full RCU implemetnation solves this in a very generic way. But we here take a simplification: we assume that there will be frequent times when there's not gonna be active readers.</p>
<p>If we count atomically the active readers (by calling <a class="el" href="classMyRcuLock.html#ad0656165d917c1273932faca008225da">MyRcuLock::rcu_read()</a> before reading and by calling <a class="el" href="classMyRcuLock.html#a9a12490956232946722d8a60d22693bf">MyRcuLock::rcu_end_read()</a> when we're done using the value of the global we have received from <a class="el" href="classMyRcuLock.html#ad0656165d917c1273932faca008225da">MyRcuLock::rcu_read()</a> we can detect these times by simply looping over the atomic count (<a class="el" href="classMyRcuLock.html#ae231011023c6c2378668e3162e033232">MyRcuLock::rcu_readers_</a>) and waiting for a 0 to come out (this is exactly what <a class="el" href="classMyRcuLock.html#a0bca0d53853dfb92f56bd4e46c79ab0a">MyRcuLock::wait_for_no_readers()</a> does). Once we get a zero we know that no existing readers will use the old value(s) of the global and new readers will get the new value of the global. So if we get that zero we know that we can safely dispose of all the old values we hold.</p>
<p>Intended usage</p>
<p>We instantiate <a class="el" href="classMyRcuLock.html">MyRcuLock</a> once for each global we want to protect.</p>
<p>To read we instantiate the utility class <a class="el" href="classMyRcuLock_1_1ReadLock.html">MyRcuLock::ReadLock</a> and we access the value by casting it to the type we need. Once the <a class="el" href="classMyRcuLock_1_1ReadLock.html">MyRcuLock::ReadLock</a> goes out of scope we can't access the global value or copies of it anymore.</p>
<p>To write we fully prepare the new value of the global and then call <a class="el" href="classMyRcuLock.html#a83c044eb83cfb52947686b629afd25c3">MyRcuLock::rcu_write()</a>. That returns the old value of the global.</p>
<p>Now we need to dispose of that old value. For that we wait until there's no active readers by calling <a class="el" href="classMyRcuLock.html#a0bca0d53853dfb92f56bd4e46c79ab0a">MyRcuLock::wait_for_no_readers()</a> and then, if that succeeds we delete the old value. This is exactly what <a class="el" href="classMyRcuLock.html#a2db1f31c4a93c8e73eb34a679dc92d64">MyRcuLock::write_wait_and_delete()</a> does.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>The class of the global protected pointer </td></tr>
  </table>
  </dd>
</dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a1a6e67ac8d3df17c33e3dee4f97954f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a6e67ac8d3df17c33e3dee4f97954f2">&#9670;&nbsp;</a></span>MyRcuLock() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::<a class="el" href="classMyRcuLock.html">MyRcuLock</a> </td>
          <td>(</td>
          <td class="paramtype">const T *&#160;</td>
          <td class="paramname"><em>init</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set up the RCU lock and the global. </p>
<p>Initializes the global and the reader counter.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">init</td><td>A value to store into the global. Can be NULL. Should not be used after the call </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9152f4560e372566eddbc568ce22b912"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9152f4560e372566eddbc568ce22b912">&#9670;&nbsp;</a></span>MyRcuLock() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::<a class="el" href="classMyRcuLock.html">MyRcuLock</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt; &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>disabled </p>

</div>
</div>
<a id="ae291748f35f22b4acc22a96d0f93f999"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae291748f35f22b4acc22a96d0f93f999">&#9670;&nbsp;</a></span>~MyRcuLock()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::~<a class="el" href="classMyRcuLock.html">MyRcuLock</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor. </p>
<p>Calls <a class="el" href="classMyRcuLock.html#a2db1f31c4a93c8e73eb34a679dc92d64">MyRcuLock::write_wait_and_delete</a> to set the global to NULL and dispose of the old value </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a2baa2f16992818e1e19d44909288801a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2baa2f16992818e1e19d44909288801a">&#9670;&nbsp;</a></span>operator=()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt; &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>disabled </p>

</div>
</div>
<a id="a9a12490956232946722d8a60d22693bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a12490956232946722d8a60d22693bf">&#9670;&nbsp;</a></span>rcu_end_read()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::rcu_end_read </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Low level API: end reading. </p>
<p>Marks the place where the pointer returned by <a class="el" href="win32_8h.html#ac964c1144d52dfefcb8d4dcd1ce9121b">MyRcuLock::read()</a> is not going to be accessed any longer.</p>
<p>The recommended high level API is <a class="el" href="classMyRcuLock_1_1ReadLock.html">MyRcuLock::ReadLock</a> </p><dl class="section warning"><dt>Warning</dt><dd>Each call to <a class="el" href="classMyRcuLock.html#ad0656165d917c1273932faca008225da">MyRcuLock::rcu_read()</a> must be coupled with a call to <a class="el" href="classMyRcuLock.html#a9a12490956232946722d8a60d22693bf">MyRcuLock::rcu_end_read()</a>. And the value returned by <a class="el" href="win32_8h.html#ac964c1144d52dfefcb8d4dcd1ce9121b">MyRcuLock::read()</a> should not be used after calling <a class="el" href="classMyRcuLock.html#a9a12490956232946722d8a60d22693bf">MyRcuLock::rcu_end_read()</a> </dd></dl>

</div>
</div>
<a id="ad0656165d917c1273932faca008225da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0656165d917c1273932faca008225da">&#9670;&nbsp;</a></span>rcu_read()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const T* <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::rcu_read </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Low level API: start reading. </p>
<p>Returns a copy of the global that you can safely use until <a class="el" href="classMyRcuLock.html#a9a12490956232946722d8a60d22693bf">MyRcuLock::rcu_end_read()</a> is called </p><dl class="section warning"><dt>Warning</dt><dd>Don't forget to call <a class="el" href="classMyRcuLock.html#a9a12490956232946722d8a60d22693bf">MyRcuLock::rcu_end_read()</a> when done. </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>the copy of the global </dd></dl>

</div>
</div>
<a id="a83c044eb83cfb52947686b629afd25c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83c044eb83cfb52947686b629afd25c3">&#9670;&nbsp;</a></span>rcu_write()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const T* <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::rcu_write </td>
          <td>(</td>
          <td class="paramtype">const T *&#160;</td>
          <td class="paramname"><em>newT</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Low level API: write a new global and return the old one. </p>
<p>The high level API for writers is <a class="el" href="classMyRcuLock.html#a2db1f31c4a93c8e73eb34a679dc92d64">MyRcuLock::write_wait_and_delete()</a></p>
<dl class="section note"><dt>Note</dt><dd>you need to safely dispose of the returned old global. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newT</td><td>a pointer to a fully prepared new global that starts getting used immediately after being set. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the old value of the global </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classMyRcuLock.html#a0bca0d53853dfb92f56bd4e46c79ab0a">MyRcuLock::wait_for_no_readers()</a> </dd></dl>

</div>
</div>
<a id="a0bca0d53853dfb92f56bd4e46c79ab0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bca0d53853dfb92f56bd4e46c79ab0a">&#9670;&nbsp;</a></span>wait_for_no_readers()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::wait_for_no_readers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Low level API: wait for no active readers. </p>
<p>Call this to wait for a state when there's no active readers. Optionally pass a functor to call at each check and stop if instructed.</p>
<p>The high level API to call is <a class="el" href="classMyRcuLock.html#a2db1f31c4a93c8e73eb34a679dc92d64">MyRcuLock::write_wait_and_delete()</a></p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>if the function was stopped by the functor </td></tr>
    <tr><td class="paramname">false</td><td>if an actual moment of 0 readers was detected </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2db1f31c4a93c8e73eb34a679dc92d64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2db1f31c4a93c8e73eb34a679dc92d64">&#9670;&nbsp;</a></span>write_wait_and_delete()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::write_wait_and_delete </td>
          <td>(</td>
          <td class="paramtype">const T *&#160;</td>
          <td class="paramname"><em>newT</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A RCU writer API. </p>
<p>Stores a new value into the global, waits for when it's safe to dispose of the old one and calls delete on it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newT</td><td>The new value to store into the global</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>the function was stopped by the functor. The old value was lost. </td></tr>
    <tr><td class="paramname">false</td><td>operation succeeded and the old value was disposed of </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="add512ce555b5cb1a3fa1577ebc7856ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add512ce555b5cb1a3fa1577ebc7856ff">&#9670;&nbsp;</a></span>rcu_global_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;const T *&gt; <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::rcu_global_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>the global pointer to protect </p>

</div>
</div>
<a id="a1dba6cd5f44e774bc46fc7bfaf4f5bc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dba6cd5f44e774bc46fc7bfaf4f5bc0">&#9670;&nbsp;</a></span>rcu_padding_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::rcu_padding_[128]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>padding to break the CPU cache lines </p>

</div>
</div>
<a id="ae231011023c6c2378668e3162e033232"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae231011023c6c2378668e3162e033232">&#9670;&nbsp;</a></span>rcu_readers_</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;long&gt; <a class="el" href="classMyRcuLock.html">MyRcuLock</a>&lt; T &gt;::rcu_readers_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>the readers counter </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>include/<a class="el" href="my__rcu__lock_8h_source.html">my_rcu_lock.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classMyRcuLock.html">MyRcuLock</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
