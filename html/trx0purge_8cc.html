<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: storage/innobase/trx/trx0purge.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('trx0purge_8cc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">trx0purge.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Purge old versions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;new&gt;</code><br />
<code>#include &quot;<a class="el" href="clone0api_8h_source.html">clone0api.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="clone0clone_8h_source.html">clone0clone.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dict0dd_8h_source.html">dict0dd.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fil0fil_8h_source.html">fil0fil.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fsp0fsp_8h_source.html">fsp0fsp.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fsp0sysspace_8h_source.html">fsp0sysspace.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fsp0types_8h_source.html">fsp0types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fut0fut_8h_source.html">fut0fut.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ha__prototypes_8h_source.html">ha_prototypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mach0data_8h_source.html">mach0data.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mtr0log_8h_source.html">mtr0log.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__compiler_8h_source.html">my_compiler.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__dbug_8h_source.html">my_dbug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="my__inttypes_8h_source.html">my_inttypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="os0thread_8h_source.html">os0thread.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="que0que_8h_source.html">que0que.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="read0read_8h_source.html">read0read.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="row0purge_8h_source.html">row0purge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="row0upd_8h_source.html">row0upd.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="srv0mon_8h_source.html">srv0mon.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="srv0srv_8h_source.html">srv0srv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="srv0start_8h_source.html">srv0start.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sync0sync_8h_source.html">sync0sync.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trx0purge_8h_source.html">trx0purge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trx0rec_8h_source.html">trx0rec.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trx0roll_8h_source.html">trx0roll.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trx0rseg_8h_source.html">trx0rseg.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trx0trx_8h_source.html">trx0trx.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespaceundo"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html">undo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9df4199555184ff95a6d389c00c67f0a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="que0types_8h.html#a3052106eec0aaf80a6028b16f70372b1">que_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a9df4199555184ff95a6d389c00c67f0a">trx_purge_graph_build</a> (<a class="el" href="structtrx__t.html">trx_t</a> *trx, ulint n_purge_threads)</td></tr>
<tr class="memdesc:a9df4199555184ff95a6d389c00c67f0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds a purge 'query' graph.  <a href="#a9df4199555184ff95a6d389c00c67f0a">More...</a><br /></td></tr>
<tr class="separator:a9df4199555184ff95a6d389c00c67f0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbc9fee734e5a7d2931609022989b293"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#adbc9fee734e5a7d2931609022989b293">trx_purge_sys_create</a> (ulint n_purge_threads, <a class="el" href="trx0types_8h.html#a2b2af0c3abd146b437f5659794024755">purge_pq_t</a> *purge_queue)</td></tr>
<tr class="memdesc:adbc9fee734e5a7d2931609022989b293"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates the global purge system control structure and inits the history mutex.  <a href="#adbc9fee734e5a7d2931609022989b293">More...</a><br /></td></tr>
<tr class="separator:adbc9fee734e5a7d2931609022989b293"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c1e3207fbaaea5efc45a547f0c34a2c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a9c1e3207fbaaea5efc45a547f0c34a2c">trx_purge_sys_close</a> ()</td></tr>
<tr class="memdesc:a9c1e3207fbaaea5efc45a547f0c34a2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees the global purge system control structure.  <a href="#a9c1e3207fbaaea5efc45a547f0c34a2c">More...</a><br /></td></tr>
<tr class="separator:a9c1e3207fbaaea5efc45a547f0c34a2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a038daf1686506987a6d46cc11b826046"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a038daf1686506987a6d46cc11b826046">trx_purge_add_update_undo_to_history</a> (<a class="el" href="structtrx__t.html">trx_t</a> *trx, <a class="el" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> *undo_ptr, <a class="el" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *undo_page, <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> update_rseg_history_len, ulint n_added_logs, <a class="el" href="structmtr__t.html">mtr_t</a> *mtr)</td></tr>
<tr class="memdesc:a038daf1686506987a6d46cc11b826046"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds the update undo log as the first log in the history list.  <a href="#a038daf1686506987a6d46cc11b826046">More...</a><br /></td></tr>
<tr class="separator:a038daf1686506987a6d46cc11b826046"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7239737fb980febcbd3f42e25df94925"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a7239737fb980febcbd3f42e25df94925">trx_purge_remove_log_hdr</a> (<a class="el" href="trx0types_8h.html#a8bdb9d55e50652fb2ff0952e136d5aba">trx_rsegf_t</a> *rseg_hdr, <a class="el" href="trx0types_8h.html#a64150d81cbf5eba60e4a902c2c8d7a1a">trx_ulogf_t</a> *log_hdr, <a class="el" href="structmtr__t.html">mtr_t</a> *mtr)</td></tr>
<tr class="memdesc:a7239737fb980febcbd3f42e25df94925"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove an rseg header from the history list.  <a href="#a7239737fb980febcbd3f42e25df94925">More...</a><br /></td></tr>
<tr class="separator:a7239737fb980febcbd3f42e25df94925"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ffb03fd35f5982eaa3b1e1d94c8da46"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a5ffb03fd35f5982eaa3b1e1d94c8da46">trx_purge_free_segment</a> (<a class="el" href="structtrx__rseg__t.html">trx_rseg_t</a> *rseg, <a class="el" href="structfil__addr__t.html">fil_addr_t</a> hdr_addr, <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> noredo)</td></tr>
<tr class="memdesc:a5ffb03fd35f5982eaa3b1e1d94c8da46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees a rollback segment which is in the history list.  <a href="#a5ffb03fd35f5982eaa3b1e1d94c8da46">More...</a><br /></td></tr>
<tr class="separator:a5ffb03fd35f5982eaa3b1e1d94c8da46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a324e5af1f29e781d298a1f2638cf0d6d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a324e5af1f29e781d298a1f2638cf0d6d">trx_purge_truncate_rseg_history</a> (<a class="el" href="structtrx__rseg__t.html">trx_rseg_t</a> *rseg, const <a class="el" href="structpurge__iter__t.html">purge_iter_t</a> *limit)</td></tr>
<tr class="memdesc:a324e5af1f29e781d298a1f2638cf0d6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes unnecessary history data from a rollback segment.  <a href="#a324e5af1f29e781d298a1f2638cf0d6d">More...</a><br /></td></tr>
<tr class="separator:a324e5af1f29e781d298a1f2638cf0d6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2631c559ccdf84403ba8570d2efcc8a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#af2631c559ccdf84403ba8570d2efcc8a">undo::init_space_id_bank</a> ()</td></tr>
<tr class="memdesc:af2631c559ccdf84403ba8570d2efcc8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the undo tablespace space_id bank which is a lock free repository for information about the space IDs used for undo tablespaces.  <a href="namespaceundo.html#af2631c559ccdf84403ba8570d2efcc8a">More...</a><br /></td></tr>
<tr class="separator:af2631c559ccdf84403ba8570d2efcc8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef97c77981be1c6e488d387a1dea3e5e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#aef97c77981be1c6e488d387a1dea3e5e">undo::use_space_id</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id)</td></tr>
<tr class="memdesc:aef97c77981be1c6e488d387a1dea3e5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Note that the undo space number for a space ID is being used.  <a href="namespaceundo.html#aef97c77981be1c6e488d387a1dea3e5e">More...</a><br /></td></tr>
<tr class="separator:aef97c77981be1c6e488d387a1dea3e5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad607fb01104acc911f24ffa281906791"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#ad607fb01104acc911f24ffa281906791">undo::unuse_space_id</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id)</td></tr>
<tr class="memdesc:ad607fb01104acc911f24ffa281906791"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark an undo number associated with a given space_id as unused and available to be resused.  <a href="namespaceundo.html#ad607fb01104acc911f24ffa281906791">More...</a><br /></td></tr>
<tr class="separator:ad607fb01104acc911f24ffa281906791"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5a62e4fb65a13d1c06c6a0e581baea2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#ad5a62e4fb65a13d1c06c6a0e581baea2">undo::next_space_id</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id, <a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_num)</td></tr>
<tr class="memdesc:ad5a62e4fb65a13d1c06c6a0e581baea2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a valid undo space_id or SPACE_UNKNOWN, return the next space_id for the given space number.  <a href="namespaceundo.html#ad5a62e4fb65a13d1c06c6a0e581baea2">More...</a><br /></td></tr>
<tr class="separator:ad5a62e4fb65a13d1c06c6a0e581baea2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade47a613763c8dce313daddcca6974da"><td class="memItemLeft" align="right" valign="top"><a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#ade47a613763c8dce313daddcca6974da">undo::next_space_id</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id)</td></tr>
<tr class="memdesc:ade47a613763c8dce313daddcca6974da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a valid undo space_id, return the next space_id for that space number.  <a href="namespaceundo.html#ade47a613763c8dce313daddcca6974da">More...</a><br /></td></tr>
<tr class="separator:ade47a613763c8dce313daddcca6974da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42b14e65523c0d309adf946839edb480"><td class="memItemLeft" align="right" valign="top"><a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a42b14e65523c0d309adf946839edb480">undo::use_next_space_id</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_num)</td></tr>
<tr class="memdesc:a42b14e65523c0d309adf946839edb480"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark that the given undo space number is being used and return the next available space_id for that space number.  <a href="namespaceundo.html#a42b14e65523c0d309adf946839edb480">More...</a><br /></td></tr>
<tr class="separator:a42b14e65523c0d309adf946839edb480"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71d8d24a97e030f84e99b4520f819ba3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a71d8d24a97e030f84e99b4520f819ba3">undo::get_next_available_space_num</a> ()</td></tr>
<tr class="memdesc:a71d8d24a97e030f84e99b4520f819ba3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the next available undo space ID to be used for a new explicit undo tablespaces.  <a href="namespaceundo.html#a71d8d24a97e030f84e99b4520f819ba3">More...</a><br /></td></tr>
<tr class="separator:a71d8d24a97e030f84e99b4520f819ba3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a0eafa70b59e422ece6a63fdffe4a5a"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a1a0eafa70b59e422ece6a63fdffe4a5a">undo::make_space_name</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id)</td></tr>
<tr class="memdesc:a1a0eafa70b59e422ece6a63fdffe4a5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a standard undo tablespace name from a space_id.  <a href="namespaceundo.html#a1a0eafa70b59e422ece6a63fdffe4a5a">More...</a><br /></td></tr>
<tr class="separator:a1a0eafa70b59e422ece6a63fdffe4a5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c2c38add781aa24744ca18d72275eb2"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a1c2c38add781aa24744ca18d72275eb2">undo::make_file_name</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id)</td></tr>
<tr class="memdesc:a1c2c38add781aa24744ca18d72275eb2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a standard undo tablespace file name from a space_id.  <a href="namespaceundo.html#a1c2c38add781aa24744ca18d72275eb2">More...</a><br /></td></tr>
<tr class="separator:a1c2c38add781aa24744ca18d72275eb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa459988289fe75d0bb0e1da38dc99bc4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#aa459988289fe75d0bb0e1da38dc99bc4">undo::inject_crash</a> (const char *injection_point_name)</td></tr>
<tr class="memdesc:aa459988289fe75d0bb0e1da38dc99bc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inject a crash if a certain SET GLOBAL DEBUG has been set.  <a href="namespaceundo.html#aa459988289fe75d0bb0e1da38dc99bc4">More...</a><br /></td></tr>
<tr class="separator:aa459988289fe75d0bb0e1da38dc99bc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8199343283d3fa2224c8ae81559bbced"><td class="memItemLeft" align="right" valign="top"><a class="el" href="db0err_8h.html#a6fdd08971b32ee513b20967238f1654d">dberr_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a8199343283d3fa2224c8ae81559bbced">undo::start_logging</a> (<a class="el" href="classTablespace.html">Tablespace</a> *undo_space)</td></tr>
<tr class="memdesc:a8199343283d3fa2224c8ae81559bbced"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the truncate log file.  <a href="namespaceundo.html#a8199343283d3fa2224c8ae81559bbced">More...</a><br /></td></tr>
<tr class="separator:a8199343283d3fa2224c8ae81559bbced"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1774e724560168aac019b197d462b205"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a1774e724560168aac019b197d462b205">undo::done_logging</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_num)</td></tr>
<tr class="memdesc:a1774e724560168aac019b197d462b205"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark completion of undo truncate action by writing magic number to the log file and then removing it from the disk.  <a href="namespaceundo.html#a1774e724560168aac019b197d462b205">More...</a><br /></td></tr>
<tr class="separator:a1774e724560168aac019b197d462b205"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08cb53aed10b0a9c48eded240d1d0674"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a08cb53aed10b0a9c48eded240d1d0674">undo::is_active_truncate_log_present</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_num)</td></tr>
<tr class="memdesc:a08cb53aed10b0a9c48eded240d1d0674"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if TRUNCATE_DDL_LOG file exist.  <a href="namespaceundo.html#a08cb53aed10b0a9c48eded240d1d0674">More...</a><br /></td></tr>
<tr class="separator:a08cb53aed10b0a9c48eded240d1d0674"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab76dbc44dc03e9fec6840a9b11fb9731"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#ab76dbc44dc03e9fec6840a9b11fb9731">undo::add_space_to_construction_list</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id)</td></tr>
<tr class="memdesc:ab76dbc44dc03e9fec6840a9b11fb9731"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add undo tablespace to s_under_construction vector.  <a href="namespaceundo.html#ab76dbc44dc03e9fec6840a9b11fb9731">More...</a><br /></td></tr>
<tr class="separator:ab76dbc44dc03e9fec6840a9b11fb9731"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72ffda44ae989b04483e8f1957c5cc14"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a72ffda44ae989b04483e8f1957c5cc14">undo::clear_construction_list</a> ()</td></tr>
<tr class="memdesc:a72ffda44ae989b04483e8f1957c5cc14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear the s_under_construction vector.  <a href="namespaceundo.html#a72ffda44ae989b04483e8f1957c5cc14">More...</a><br /></td></tr>
<tr class="separator:a72ffda44ae989b04483e8f1957c5cc14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab061a1907548cdd2fe2221cdf5b1d70b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#ab061a1907548cdd2fe2221cdf5b1d70b">undo::is_under_construction</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id)</td></tr>
<tr class="memdesc:ab061a1907548cdd2fe2221cdf5b1d70b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is an undo tablespace under constuction at the moment.  <a href="namespaceundo.html#ab061a1907548cdd2fe2221cdf5b1d70b">More...</a><br /></td></tr>
<tr class="separator:ab061a1907548cdd2fe2221cdf5b1d70b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95f7e056728b73387da841676376d24b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#a95f7e056728b73387da841676376d24b">undo::set_active</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id)</td></tr>
<tr class="memdesc:a95f7e056728b73387da841676376d24b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set an undo tablespace active.  <a href="namespaceundo.html#a95f7e056728b73387da841676376d24b">More...</a><br /></td></tr>
<tr class="separator:a95f7e056728b73387da841676376d24b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af16fb6085ef2e93316f4b550861c179c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceundo.html#af16fb6085ef2e93316f4b550861c179c">undo::is_active</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_id, <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> get_latch=<a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a>)</td></tr>
<tr class="separator:af16fb6085ef2e93316f4b550861c179c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68948faf7a9927284e9d2a5b71c137c9"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a68948faf7a9927284e9d2a5b71c137c9">trx_purge_mark_undo_for_truncate</a> (size_t truncate_count)</td></tr>
<tr class="memdesc:a68948faf7a9927284e9d2a5b71c137c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decide if an undo truncation needs to be done at this time.  <a href="#a68948faf7a9927284e9d2a5b71c137c9">More...</a><br /></td></tr>
<tr class="separator:a68948faf7a9927284e9d2a5b71c137c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2194cdbcb60a7693dcc9d12520a087c"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#aa2194cdbcb60a7693dcc9d12520a087c">trx_purge_check_if_marked_undo_is_empty</a> (<a class="el" href="structpurge__iter__t.html">purge_iter_t</a> *limit)</td></tr>
<tr class="memdesc:aa2194cdbcb60a7693dcc9d12520a087c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterate over selected UNDO tablespace and check if all the rsegs that resides in the tablespace have been freed.  <a href="#aa2194cdbcb60a7693dcc9d12520a087c">More...</a><br /></td></tr>
<tr class="separator:aa2194cdbcb60a7693dcc9d12520a087c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38e7c430e3e0c49a6064dbbe3309ae3c"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a38e7c430e3e0c49a6064dbbe3309ae3c">trx_purge_truncate_marked_undo_low</a> (<a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a> space_num, std::string space_name)</td></tr>
<tr class="memdesc:a38e7c430e3e0c49a6064dbbe3309ae3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Truncate the marked undo tablespace.  <a href="#a38e7c430e3e0c49a6064dbbe3309ae3c">More...</a><br /></td></tr>
<tr class="separator:a38e7c430e3e0c49a6064dbbe3309ae3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cf843b0284f8b2870ca192d8787ec4c"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a6cf843b0284f8b2870ca192d8787ec4c">trx_purge_truncate_marked_undo</a> ()</td></tr>
<tr class="memdesc:a6cf843b0284f8b2870ca192d8787ec4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Truncate the marked undo tablespace.  <a href="#a6cf843b0284f8b2870ca192d8787ec4c">More...</a><br /></td></tr>
<tr class="separator:a6cf843b0284f8b2870ca192d8787ec4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9642a3dc1d3d255a91fd3441b1414f6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#ac9642a3dc1d3d255a91fd3441b1414f6">trx_purge_truncate_history</a> (<a class="el" href="structpurge__iter__t.html">purge_iter_t</a> *limit, const <a class="el" href="classReadView.html">ReadView</a> *view)</td></tr>
<tr class="memdesc:ac9642a3dc1d3d255a91fd3441b1414f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes unnecessary history data from rollback segments.  <a href="#ac9642a3dc1d3d255a91fd3441b1414f6">More...</a><br /></td></tr>
<tr class="separator:ac9642a3dc1d3d255a91fd3441b1414f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc1dcbb16d4f841ec7ab804f201ab4db"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#acc1dcbb16d4f841ec7ab804f201ab4db">trx_purge_rseg_get_next_history_log</a> (<a class="el" href="structtrx__rseg__t.html">trx_rseg_t</a> *rseg, ulint *n_pages_handled)</td></tr>
<tr class="memdesc:acc1dcbb16d4f841ec7ab804f201ab4db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the last not yet purged history log info in rseg when we have purged a whole undo log.  <a href="#acc1dcbb16d4f841ec7ab804f201ab4db">More...</a><br /></td></tr>
<tr class="separator:acc1dcbb16d4f841ec7ab804f201ab4db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41cc780b62c46dcd2f3bcf276ec21bfd"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a41cc780b62c46dcd2f3bcf276ec21bfd">trx_purge_read_undo_rec</a> (<a class="el" href="structtrx__purge__t.html">trx_purge_t</a> *<a class="el" href="trx0purge_8cc.html#a541f29f529bf5e372a2f1a21067413d9">purge_sys</a>, const <a class="el" href="classpage__size__t.html">page_size_t</a> &amp;page_size)</td></tr>
<tr class="memdesc:a41cc780b62c46dcd2f3bcf276ec21bfd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Position the purge sys "iterator" on the undo record to use for purging.  <a href="#a41cc780b62c46dcd2f3bcf276ec21bfd">More...</a><br /></td></tr>
<tr class="separator:a41cc780b62c46dcd2f3bcf276ec21bfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a628c446e5dbf3f78632e5011984628fe"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a628c446e5dbf3f78632e5011984628fe">trx_purge_choose_next_log</a> (void)</td></tr>
<tr class="memdesc:a628c446e5dbf3f78632e5011984628fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Chooses the next undo log to purge and updates the info in purge_sys.  <a href="#a628c446e5dbf3f78632e5011984628fe">More...</a><br /></td></tr>
<tr class="separator:a628c446e5dbf3f78632e5011984628fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab855f5c2456ffcd2d566212f9cabc565"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#ab855f5c2456ffcd2d566212f9cabc565">trx_purge_get_next_rec</a> (ulint *n_pages_handled, <a class="el" href="mem0mem_8h.html#a29a10a74bdb0acc8a530dd6ec3c8538a">mem_heap_t</a> *heap)</td></tr>
<tr class="memdesc:ab855f5c2456ffcd2d566212f9cabc565"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the next record to purge and updates the info in the purge system.  <a href="#ab855f5c2456ffcd2d566212f9cabc565">More...</a><br /></td></tr>
<tr class="separator:ab855f5c2456ffcd2d566212f9cabc565"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dc1589f039d038b527a838e2f54e06b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a3dc1589f039d038b527a838e2f54e06b">trx_purge_fetch_next_rec</a> (<a class="el" href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a> *modifier_trx_id, <a class="el" href="trx0types_8h.html#ad3ccac613ce33a8680d147c4a4f12e94">roll_ptr_t</a> *roll_ptr, ulint *n_pages_handled, <a class="el" href="mem0mem_8h.html#a29a10a74bdb0acc8a530dd6ec3c8538a">mem_heap_t</a> *heap)</td></tr>
<tr class="memdesc:a3dc1589f039d038b527a838e2f54e06b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fetches the next undo log record from the history list to purge.  <a href="#a3dc1589f039d038b527a838e2f54e06b">More...</a><br /></td></tr>
<tr class="separator:a3dc1589f039d038b527a838e2f54e06b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4088f983f68992c88052bc57f5104da"><td class="memItemLeft" align="right" valign="top">static ulint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#ab4088f983f68992c88052bc57f5104da">trx_purge_attach_undo_recs</a> (const ulint n_purge_threads, ulint batch_size)</td></tr>
<tr class="memdesc:ab4088f983f68992c88052bc57f5104da"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function runs a purge batch.  <a href="#ab4088f983f68992c88052bc57f5104da">More...</a><br /></td></tr>
<tr class="separator:ab4088f983f68992c88052bc57f5104da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a094928abbc72d1b03f7ffd3de52cf6"><td class="memItemLeft" align="right" valign="top">static ulint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a8a094928abbc72d1b03f7ffd3de52cf6">trx_purge_dml_delay</a> (void)</td></tr>
<tr class="memdesc:a8a094928abbc72d1b03f7ffd3de52cf6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the DML delay required.  <a href="#a8a094928abbc72d1b03f7ffd3de52cf6">More...</a><br /></td></tr>
<tr class="separator:a8a094928abbc72d1b03f7ffd3de52cf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab652abf3c7365b7cd180fd677335963a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#ab652abf3c7365b7cd180fd677335963a">trx_purge_wait_for_workers_to_complete</a> ()</td></tr>
<tr class="memdesc:ab652abf3c7365b7cd180fd677335963a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for pending purge jobs to complete.  <a href="#ab652abf3c7365b7cd180fd677335963a">More...</a><br /></td></tr>
<tr class="separator:ab652abf3c7365b7cd180fd677335963a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e61aaed5696e77f011dbb0202cda124"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a6e61aaed5696e77f011dbb0202cda124">trx_purge_truncate</a> (void)</td></tr>
<tr class="memdesc:a6e61aaed5696e77f011dbb0202cda124"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove old historical changes from the rollback segments.  <a href="#a6e61aaed5696e77f011dbb0202cda124">More...</a><br /></td></tr>
<tr class="separator:a6e61aaed5696e77f011dbb0202cda124"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a764719f5eb6568c8f276ec573795a629"><td class="memItemLeft" align="right" valign="top">ulint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a764719f5eb6568c8f276ec573795a629">trx_purge</a> (ulint n_purge_threads, ulint batch_size, <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> truncate)</td></tr>
<tr class="memdesc:a764719f5eb6568c8f276ec573795a629"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function runs a purge batch.  <a href="#a764719f5eb6568c8f276ec573795a629">More...</a><br /></td></tr>
<tr class="separator:a764719f5eb6568c8f276ec573795a629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c2a941905b29d3d7320ac22a7907979"><td class="memItemLeft" align="right" valign="top"><a class="el" href="trx0purge_8h.html#a24f2aad063c0ba63115ceda360bc552c">purge_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a9c2a941905b29d3d7320ac22a7907979">trx_purge_state</a> (void)</td></tr>
<tr class="memdesc:a9c2a941905b29d3d7320ac22a7907979"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the purge state.  <a href="#a9c2a941905b29d3d7320ac22a7907979">More...</a><br /></td></tr>
<tr class="separator:a9c2a941905b29d3d7320ac22a7907979"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae30c5dcdbe5b1874929e4f500da1737e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#ae30c5dcdbe5b1874929e4f500da1737e">trx_purge_stop</a> (void)</td></tr>
<tr class="memdesc:ae30c5dcdbe5b1874929e4f500da1737e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop purge and wait for it to stop, move to PURGE_STATE_STOP.  <a href="#ae30c5dcdbe5b1874929e4f500da1737e">More...</a><br /></td></tr>
<tr class="separator:ae30c5dcdbe5b1874929e4f500da1737e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bc4826ae735874601cc1c72888dea3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a8bc4826ae735874601cc1c72888dea3f">trx_purge_run</a> (void)</td></tr>
<tr class="memdesc:a8bc4826ae735874601cc1c72888dea3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resume purge, move to PURGE_STATE_RUN.  <a href="#a8bc4826ae735874601cc1c72888dea3f">More...</a><br /></td></tr>
<tr class="separator:a8bc4826ae735874601cc1c72888dea3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a798884422b685cf9df686d8b6d3db32b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a798884422b685cf9df686d8b6d3db32b">srv_max_purge_lag</a> = 0</td></tr>
<tr class="memdesc:a798884422b685cf9df686d8b6d3db32b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum allowable purge history length.  <a href="#a798884422b685cf9df686d8b6d3db32b">More...</a><br /></td></tr>
<tr class="separator:a798884422b685cf9df686d8b6d3db32b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefa679d428ad69992c427131b2f8857a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#aefa679d428ad69992c427131b2f8857a">srv_max_purge_lag_delay</a> = 0</td></tr>
<tr class="memdesc:aefa679d428ad69992c427131b2f8857a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Max DML user threads delay in micro-seconds.  <a href="#aefa679d428ad69992c427131b2f8857a">More...</a><br /></td></tr>
<tr class="separator:aefa679d428ad69992c427131b2f8857a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a541f29f529bf5e372a2f1a21067413d9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structtrx__purge__t.html">trx_purge_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a541f29f529bf5e372a2f1a21067413d9">purge_sys</a> = <a class="el" href="auth__ldap__sasl__client_8cc.html#ae7bd12bd7c9e418a420087971d0a7e31">nullptr</a></td></tr>
<tr class="memdesc:a541f29f529bf5e372a2f1a21067413d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The global data structure coordinating a purge.  <a href="#a541f29f529bf5e372a2f1a21067413d9">More...</a><br /></td></tr>
<tr class="separator:a541f29f529bf5e372a2f1a21067413d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac100a05d9ad16d870dbdb433a51b6706"><td class="memItemLeft" align="right" valign="top">static constexpr int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#ac100a05d9ad16d870dbdb433a51b6706">PURGE_CHECK_UNDO_TRUNCATE_DELAY_IN_MS</a> = 1000</td></tr>
<tr class="memdesc:ac100a05d9ad16d870dbdb433a51b6706"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a short delay between checks.  <a href="#ac100a05d9ad16d870dbdb433a51b6706">More...</a><br /></td></tr>
<tr class="separator:ac100a05d9ad16d870dbdb433a51b6706"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abef5943276ba3db271c3f5664e6910e2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#abef5943276ba3db271c3f5664e6910e2">srv_purge_view_update_only_debug</a></td></tr>
<tr class="separator:abef5943276ba3db271c3f5664e6910e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4184550032b087d957d421817443b95d"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="trx0purge_8cc.html#a4184550032b087d957d421817443b95d">trx_purge_ignore_rec</a></td></tr>
<tr class="memdesc:a4184550032b087d957d421817443b95d"><td class="mdescLeft">&#160;</td><td class="mdescRight">A sentinel undo record used as a return value when we have a whole undo log which can be skipped by purge.  <a href="#a4184550032b087d957d421817443b95d">More...</a><br /></td></tr>
<tr class="separator:a4184550032b087d957d421817443b95d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Purge old versions. </p>
<p>Created 3/26/1996 Heikki Tuuri </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a764719f5eb6568c8f276ec573795a629"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a764719f5eb6568c8f276ec573795a629">&#9670;&nbsp;</a></span>trx_purge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ulint trx_purge </td>
          <td>(</td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>n_purge_threads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>batch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>truncate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function runs a purge batch. </p>
<dl class="section return"><dt>Returns</dt><dd>number of undo log pages handled in the batch </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">n_purge_threads</td><td>in: number of purge tasks to submit to the work queue </td></tr>
    <tr><td class="paramname">batch_size</td><td>in: the maximum number of records to purge in one batch </td></tr>
    <tr><td class="paramname">truncate</td><td>in: truncate history if true </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a038daf1686506987a6d46cc11b826046"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a038daf1686506987a6d46cc11b826046">&#9670;&nbsp;</a></span>trx_purge_add_update_undo_to_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trx_purge_add_update_undo_to_history </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtrx__t.html">trx_t</a> *&#160;</td>
          <td class="paramname"><em>trx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtrx__undo__ptr__t.html">trx_undo_ptr_t</a> *&#160;</td>
          <td class="paramname"><em>undo_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="page0types_8h.html#ac84908ddc97c37107986280aa8f37897">page_t</a> *&#160;</td>
          <td class="paramname"><em>undo_page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>update_rseg_history_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>n_added_logs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structmtr__t.html">mtr_t</a> *&#160;</td>
          <td class="paramname"><em>mtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds the update undo log as the first log in the history list. </p>
<p>in: mtr</p>
<p>Removes the update undo log segment from the rseg slot if it is too big for reuse. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trx</td><td>in: transaction </td></tr>
    <tr><td class="paramname">undo_ptr</td><td>in/out: update undo log. </td></tr>
    <tr><td class="paramname">undo_page</td><td>in: update undo log header page, x-latched </td></tr>
    <tr><td class="paramname">update_rseg_history_len</td><td>in: if true: update rseg history len else skip updating it. </td></tr>
    <tr><td class="paramname">n_added_logs</td><td>in: number of logs added </td></tr>
    <tr><td class="paramname">mtr</td><td>in: mtr </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab4088f983f68992c88052bc57f5104da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4088f983f68992c88052bc57f5104da">&#9670;&nbsp;</a></span>trx_purge_attach_undo_recs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ulint trx_purge_attach_undo_recs </td>
          <td>(</td>
          <td class="paramtype">const ulint&#160;</td>
          <td class="paramname"><em>n_purge_threads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>batch_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function runs a purge batch. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n_purge_threads</td><td>number of purge threads </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">batch_size</td><td>number of pages to purge </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of undo log pages handled in the batch </dd></dl>

</div>
</div>
<a id="aa2194cdbcb60a7693dcc9d12520a087c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2194cdbcb60a7693dcc9d12520a087c">&#9670;&nbsp;</a></span>trx_purge_check_if_marked_undo_is_empty()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> trx_purge_check_if_marked_undo_is_empty </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structpurge__iter__t.html">purge_iter_t</a> *&#160;</td>
          <td class="paramname"><em>limit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Iterate over selected UNDO tablespace and check if all the rsegs that resides in the tablespace have been freed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">limit</td><td>truncate_limit </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a628c446e5dbf3f78632e5011984628fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a628c446e5dbf3f78632e5011984628fe">&#9670;&nbsp;</a></span>trx_purge_choose_next_log()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_choose_next_log </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Chooses the next undo log to purge and updates the info in purge_sys. </p>
<p>This function is used to initialize purge_sys when the next record to purge is not known, and also to update the purge system info on the next record when purge has handled the whole undo log for a transaction. </p>

</div>
</div>
<a id="a8a094928abbc72d1b03f7ffd3de52cf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a094928abbc72d1b03f7ffd3de52cf6">&#9670;&nbsp;</a></span>trx_purge_dml_delay()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ulint trx_purge_dml_delay </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the DML delay required. </p>
<dl class="section return"><dt>Returns</dt><dd>delay in microseconds or ULINT_MAX </dd></dl>

</div>
</div>
<a id="a3dc1589f039d038b527a838e2f54e06b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dc1589f039d038b527a838e2f54e06b">&#9670;&nbsp;</a></span>trx_purge_fetch_next_rec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a>* trx_purge_fetch_next_rec </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="trx0types_8h.html#a91afca43a639c098efe14a9069a1d4ec">trx_id_t</a> *&#160;</td>
          <td class="paramname"><em>modifier_trx_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="trx0types_8h.html#ad3ccac613ce33a8680d147c4a4f12e94">roll_ptr_t</a> *&#160;</td>
          <td class="paramname"><em>roll_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulint *&#160;</td>
          <td class="paramname"><em>n_pages_handled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mem0mem_8h.html#a29a10a74bdb0acc8a530dd6ec3c8538a">mem_heap_t</a> *&#160;</td>
          <td class="paramname"><em>heap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fetches the next undo log record from the history list to purge. </p>
<p>It must be released with the corresponding release function. </p><dl class="section return"><dt>Returns</dt><dd>copy of an undo log record or pointer to trx_purge_ignore_rec, if the whole undo log can skipped in purge; NULL if none left </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">modifier_trx_id</td><td>out: modifier trx id. this is the trx that created the undo record. </td></tr>
    <tr><td class="paramname">roll_ptr</td><td>out: roll pointer to undo record </td></tr>
    <tr><td class="paramname">n_pages_handled</td><td>in/out: number of UNDO log pages handled </td></tr>
    <tr><td class="paramname">heap</td><td>in: memory heap where copied </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5ffb03fd35f5982eaa3b1e1d94c8da46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ffb03fd35f5982eaa3b1e1d94c8da46">&#9670;&nbsp;</a></span>trx_purge_free_segment()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_free_segment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtrx__rseg__t.html">trx_rseg_t</a> *&#160;</td>
          <td class="paramname"><em>rseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfil__addr__t.html">fil_addr_t</a>&#160;</td>
          <td class="paramname"><em>hdr_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>noredo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Frees a rollback segment which is in the history list. </p>
<p>Removes the rseg hdr from the history list. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rseg</td><td>rollback segment </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hdr_addr</td><td>file address of log_hdr </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">noredo</td><td>skip redo logging. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab855f5c2456ffcd2d566212f9cabc565"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab855f5c2456ffcd2d566212f9cabc565">&#9670;&nbsp;</a></span>trx_purge_get_next_rec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a>* trx_purge_get_next_rec </td>
          <td>(</td>
          <td class="paramtype">ulint *&#160;</td>
          <td class="paramname"><em>n_pages_handled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mem0mem_8h.html#a29a10a74bdb0acc8a530dd6ec3c8538a">mem_heap_t</a> *&#160;</td>
          <td class="paramname"><em>heap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the next record to purge and updates the info in the purge system. </p>
<dl class="section return"><dt>Returns</dt><dd>copy of an undo log record or pointer to the dummy undo log record </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">n_pages_handled</td><td>in/out: number of UNDO pages handled </td></tr>
    <tr><td class="paramname">heap</td><td>in: memory heap where copied </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9df4199555184ff95a6d389c00c67f0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9df4199555184ff95a6d389c00c67f0a">&#9670;&nbsp;</a></span>trx_purge_graph_build()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="que0types_8h.html#a3052106eec0aaf80a6028b16f70372b1">que_t</a>* trx_purge_graph_build </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtrx__t.html">trx_t</a> *&#160;</td>
          <td class="paramname"><em>trx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>n_purge_threads</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Builds a purge 'query' graph. </p>
<p>The actual purge is performed by executing this query graph. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">trx</td><td>transaction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_purge_threads</td><td>number of purge threads </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>own: the query graph </dd></dl>

</div>
</div>
<a id="a68948faf7a9927284e9d2a5b71c137c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68948faf7a9927284e9d2a5b71c137c9">&#9670;&nbsp;</a></span>trx_purge_mark_undo_for_truncate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> trx_purge_mark_undo_for_truncate </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>truncate_count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Decide if an undo truncation needs to be done at this time. </p>
<p>If an undo tablespace is already marked, return that so that this truncation will get finished. If none is marked, iterate over all the UNDO tablespaces and check if any qualify to be truncated. Normal operation; Choose the marked space. If none are marked, choose an explicitly inactive space. If none exist, check if conditions allow implicit truncation. If conditions allow, choose an implicitly inactive space. If none exist and no space has been truncated yet, look for an undo space that is too big. Fast shutdown; Do not truncate. This routine is not called. Slow shutdown; Choose the marked space. If none are marked, choose an explicitly inactive space. If none exist, check if conditions allow implicit truncation. If conditions allow, ignoring the previous truncate count, look for an undo space that is too big. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">truncate_count</td><td>number of times this is called in a loop </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if an undo tablespace was marked for truncate. </dd></dl>

</div>
</div>
<a id="a41cc780b62c46dcd2f3bcf276ec21bfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41cc780b62c46dcd2f3bcf276ec21bfd">&#9670;&nbsp;</a></span>trx_purge_read_undo_rec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_read_undo_rec </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtrx__purge__t.html">trx_purge_t</a> *&#160;</td>
          <td class="paramname"><em>purge_sys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classpage__size__t.html">page_size_t</a> &amp;&#160;</td>
          <td class="paramname"><em>page_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Position the purge sys "iterator" on the undo record to use for purging. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">purge_sys</td><td>purge instance </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">page_size</td><td>page size </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7239737fb980febcbd3f42e25df94925"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7239737fb980febcbd3f42e25df94925">&#9670;&nbsp;</a></span>trx_purge_remove_log_hdr()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_remove_log_hdr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="trx0types_8h.html#a8bdb9d55e50652fb2ff0952e136d5aba">trx_rsegf_t</a> *&#160;</td>
          <td class="paramname"><em>rseg_hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="trx0types_8h.html#a64150d81cbf5eba60e4a902c2c8d7a1a">trx_ulogf_t</a> *&#160;</td>
          <td class="paramname"><em>log_hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structmtr__t.html">mtr_t</a> *&#160;</td>
          <td class="paramname"><em>mtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove an rseg header from the history list. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rseg_hdr</td><td>Rollback segment header </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">log_hdr</td><td>Undo log segment header </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">mtr</td><td>Mini-transaction. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="acc1dcbb16d4f841ec7ab804f201ab4db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc1dcbb16d4f841ec7ab804f201ab4db">&#9670;&nbsp;</a></span>trx_purge_rseg_get_next_history_log()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_rseg_get_next_history_log </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtrx__rseg__t.html">trx_rseg_t</a> *&#160;</td>
          <td class="paramname"><em>rseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulint *&#160;</td>
          <td class="paramname"><em>n_pages_handled</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Updates the last not yet purged history log info in rseg when we have purged a whole undo log. </p>
<p>Advances also purge_sys-&gt;purge_trx_no past the purged log. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rseg</td><td>in: rollback segment </td></tr>
    <tr><td class="paramname">n_pages_handled</td><td>in/out: number of UNDO pages handled </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8bc4826ae735874601cc1c72888dea3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bc4826ae735874601cc1c72888dea3f">&#9670;&nbsp;</a></span>trx_purge_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trx_purge_run </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resume purge, move to PURGE_STATE_RUN. </p>

</div>
</div>
<a id="a9c2a941905b29d3d7320ac22a7907979"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c2a941905b29d3d7320ac22a7907979">&#9670;&nbsp;</a></span>trx_purge_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="trx0purge_8h.html#a24f2aad063c0ba63115ceda360bc552c">purge_state_t</a> trx_purge_state </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the purge state. </p>
<dl class="section return"><dt>Returns</dt><dd>purge state. </dd></dl>

</div>
</div>
<a id="ae30c5dcdbe5b1874929e4f500da1737e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae30c5dcdbe5b1874929e4f500da1737e">&#9670;&nbsp;</a></span>trx_purge_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trx_purge_stop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop purge and wait for it to stop, move to PURGE_STATE_STOP. </p>

</div>
</div>
<a id="a9c1e3207fbaaea5efc45a547f0c34a2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c1e3207fbaaea5efc45a547f0c34a2c">&#9670;&nbsp;</a></span>trx_purge_sys_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trx_purge_sys_close </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees the global purge system control structure. </p>

</div>
</div>
<a id="adbc9fee734e5a7d2931609022989b293"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbc9fee734e5a7d2931609022989b293">&#9670;&nbsp;</a></span>trx_purge_sys_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trx_purge_sys_create </td>
          <td>(</td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>n_purge_threads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="trx0types_8h.html#a2b2af0c3abd146b437f5659794024755">purge_pq_t</a> *&#160;</td>
          <td class="paramname"><em>purge_queue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates the global purge system control structure and inits the history mutex. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n_purge_threads</td><td>number of purge threads </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">purge_queue</td><td>UNDO log min binary heap </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6e61aaed5696e77f011dbb0202cda124"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e61aaed5696e77f011dbb0202cda124">&#9670;&nbsp;</a></span>trx_purge_truncate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_truncate </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove old historical changes from the rollback segments. </p>

</div>
</div>
<a id="ac9642a3dc1d3d255a91fd3441b1414f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9642a3dc1d3d255a91fd3441b1414f6">&#9670;&nbsp;</a></span>trx_purge_truncate_history()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_truncate_history </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structpurge__iter__t.html">purge_iter_t</a> *&#160;</td>
          <td class="paramname"><em>limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classReadView.html">ReadView</a> *&#160;</td>
          <td class="paramname"><em>view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes unnecessary history data from rollback segments. </p>
<p>NOTE that when this function is called, the caller must not have any latches on undo log pages! </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">limit</td><td>in: truncate limit </td></tr>
    <tr><td class="paramname">view</td><td>in: purge view </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6cf843b0284f8b2870ca192d8787ec4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cf843b0284f8b2870ca192d8787ec4c">&#9670;&nbsp;</a></span>trx_purge_truncate_marked_undo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> trx_purge_truncate_marked_undo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Truncate the marked undo tablespace. </p>
<p>This wrapper does initial preparation and handles cleanup. </p><dl class="section return"><dt>Returns</dt><dd>true for success, false for failure </dd></dl>

</div>
</div>
<a id="a38e7c430e3e0c49a6064dbbe3309ae3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38e7c430e3e0c49a6064dbbe3309ae3c">&#9670;&nbsp;</a></span>trx_purge_truncate_marked_undo_low()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> trx_purge_truncate_marked_undo_low </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="api0api_8h.html#a02e9c11b4a9783f4b0b89fcf060f8f28">space_id_t</a>&#160;</td>
          <td class="paramname"><em>space_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>space_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Truncate the marked undo tablespace. </p>
<p>This layer handles locking of marked_rsegs and undo::spaces. </p><dl class="section return"><dt>Returns</dt><dd>true for success, false for failure </dd></dl>

</div>
</div>
<a id="a324e5af1f29e781d298a1f2638cf0d6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a324e5af1f29e781d298a1f2638cf0d6d">&#9670;&nbsp;</a></span>trx_purge_truncate_rseg_history()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_truncate_rseg_history </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtrx__rseg__t.html">trx_rseg_t</a> *&#160;</td>
          <td class="paramname"><em>rseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structpurge__iter__t.html">purge_iter_t</a> *&#160;</td>
          <td class="paramname"><em>limit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes unnecessary history data from a rollback segment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rseg</td><td>in: rollback segment </td></tr>
    <tr><td class="paramname">limit</td><td>in: truncate offset </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab652abf3c7365b7cd180fd677335963a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab652abf3c7365b7cd180fd677335963a">&#9670;&nbsp;</a></span>trx_purge_wait_for_workers_to_complete()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void trx_purge_wait_for_workers_to_complete </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Wait for pending purge jobs to complete. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ac100a05d9ad16d870dbdb433a51b6706"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac100a05d9ad16d870dbdb433a51b6706">&#9670;&nbsp;</a></span>PURGE_CHECK_UNDO_TRUNCATE_DELAY_IN_MS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr int64_t PURGE_CHECK_UNDO_TRUNCATE_DELAY_IN_MS = 1000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Wait for a short delay between checks. </p>

</div>
</div>
<a id="a541f29f529bf5e372a2f1a21067413d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a541f29f529bf5e372a2f1a21067413d9">&#9670;&nbsp;</a></span>purge_sys</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structtrx__purge__t.html">trx_purge_t</a>* purge_sys = <a class="el" href="auth__ldap__sasl__client_8cc.html#ae7bd12bd7c9e418a420087971d0a7e31">nullptr</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The global data structure coordinating a purge. </p>

</div>
</div>
<a id="a798884422b685cf9df686d8b6d3db32b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a798884422b685cf9df686d8b6d3db32b">&#9670;&nbsp;</a></span>srv_max_purge_lag</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> srv_max_purge_lag = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum allowable purge history length. </p>
<p>&lt;=0 means 'infinite'. </p>

</div>
</div>
<a id="aefa679d428ad69992c427131b2f8857a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefa679d428ad69992c427131b2f8857a">&#9670;&nbsp;</a></span>srv_max_purge_lag_delay</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="my__inttypes_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> srv_max_purge_lag_delay = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Max DML user threads delay in micro-seconds. </p>

</div>
</div>
<a id="abef5943276ba3db271c3f5664e6910e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abef5943276ba3db271c3f5664e6910e2">&#9670;&nbsp;</a></span>srv_purge_view_update_only_debug</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> srv_purge_view_update_only_debug</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4184550032b087d957d421817443b95d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4184550032b087d957d421817443b95d">&#9670;&nbsp;</a></span>trx_purge_ignore_rec</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="trx0types_8h.html#a0b302ec5d015d6388eb98277b58048c7">trx_undo_rec_t</a> trx_purge_ignore_rec</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A sentinel undo record used as a return value when we have a whole undo log which can be skipped by purge. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_70f20ecf11358dff00a0daf546d3147e.html">storage</a></li><li class="navelem"><a class="el" href="dir_3fec0aa9607ea05e0bb1c96aee1a8c4e.html">innobase</a></li><li class="navelem"><a class="el" href="dir_7d6b8692e14baa729600e27a3e4f8b7c.html">trx</a></li><li class="navelem"><a class="el" href="trx0purge_8cc.html">trx0purge.cc</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
