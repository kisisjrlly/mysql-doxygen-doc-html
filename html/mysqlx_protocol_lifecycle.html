<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: Life Cycle</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mysqlx_protocol_lifecycle.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Life Cycle </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Topics in this section:</p>
<ul>
<li><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Connection">Connection </a></li>
<li><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Session">Session </a></li>
<li><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Stages_of_Session_Setup">Stages of Session Setup </a></li>
<li><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Authentication">Authentication </a></li>
<li><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Pipelining">Pipelining </a></li>
<li><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Extensions">Extensions </a></li>
</ul>
<p>The following list describes some of the terms introduced in this section:</p>
<dl class="section user"><dt>Transport</dt><dd>Transport layer that exchanges data: TCP sockets, Unix Sockets, TLS, and so on.</dd></dl>
<dl class="section user"><dt>Connection</dt><dd>A lower-level connection between two Endpoints.</dd></dl>
<dl class="section user"><dt>Session</dt><dd>The session maintains the state. User-Variables, Temporary Tables, and so on.</dd></dl>
<dl class="section user"><dt>Messages</dt><dd><a class="el" href="mysqlx_protocol_messages.html">Messages</a> are exchanged between Endpoints. On a higher level they build a sequence of Messages with a initial and final Message.</dd></dl>
<dl class="section user"><dt>Endpoints</dt><dd>A client or a server.</dd></dl>
<h1><a class="anchor" id="lifecycle_Connection"></a>
Connection </h1>
<p>A default connection supports:</p>
<ul>
<li>supports connection capability negotiation via <a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesGet.html">Mysqlx::Connection::CapabilitiesGet</a> and <a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesSet.html">Mysqlx::Connection::CapabilitiesSet</a></li>
<li>must support at least one of the following:<ul>
<li><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_TLS_Extension">TLS Extension</a> and PLAIN <a class="el" href="mysqlx_protocol_authentication.html">Authentication</a> or</li>
<li>MYSQL41 <a class="el" href="mysqlx_protocol_authentication.html">Authentication</a> or another challenge response authentication mechanism or</li>
<li>SHA256_MEMORY <a class="el" href="mysqlx_protocol_authentication.html">Authentication</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="lifecycle_Session"></a>
Session </h1>
<p>A session owns state like:</p>
<ul>
<li>current schema</li>
<li>current character set</li>
<li>temporary tables</li>
<li>user variables</li>
<li>open transactions</li>
</ul>
<p>A session is used by the server and the protocol to manage state.</p>
<p>Sessions are:</p>
<ul>
<li>opened with <a class="el" href="structMysqlx_1_1Session_1_1AuthenticateStart.html">Mysqlx::Session::AuthenticateStart</a></li>
<li>reset session state with <a class="el" href="structMysqlx_1_1Session_1_1Reset.html">Mysqlx::Session::Reset</a></li>
<li>re-authenticate session with <a class="el" href="structMysqlx_1_1Session_1_1Reset.html">Mysqlx::Session::Reset</a></li>
<li>closed with <a class="el" href="structMysqlx_1_1Session_1_1Close.html">Mysqlx::Session::Close</a></li>
</ul>
<p>Closing a session releases all session related data.</p>
<h1><a class="anchor" id="lifecycle_Stages_of_Session_Setup"></a>
Stages of Session Setup </h1>
<p>After a client connects to the server it:</p>
<ul>
<li>may ask for the servers capabilities with <a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesGet.html">Mysqlx::Connection::CapabilitiesGet</a></li>
<li>may ask the server to use optional protocol features with <a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesSet.html">Mysqlx::Connection::CapabilitiesSet</a></li>
<li>MUST authenticate</li>
<li>may send commands</li>
</ul>
<p>In the <b>Negotiation</b> step the client checks which features the server supports on the protocol side.</p>
<p>After a successful finish of the <b>Authentication</b> step the previous Session is discarded and a new Session is created.</p>
<p>Further <b>Command</b> Messages run within a Session.</p>
<h1><a class="anchor" id="lifecycle_Authentication"></a>
Authentication </h1>
<p><a class="el" href="mysqlx_protocol_authentication.html">Authentication</a> supports several authentication mechanisms that can be discovered with <a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesGet.html">Mysqlx::Connection::CapabilitiesGet</a>.</p>
<p><code>authentication.mechanisms</code></p>
<p>Server-side supported SASL mechanism:</p>
<ul>
<li>before TLS connection established: <code>["MYSQL41", "SHA256_MEMORY"]</code></li>
<li>after TLS connection established: <code>["PLAIN", "SHA256_MEMORY", "MYSQL41"]</code></li>
</ul>
<p>Required mechanisms:</p>
<ul>
<li>PLAIN (over SSL) RFC; <a href="https://tools.ietf.org/html/rfc4616.html">RFC 4616</a> (required)</li>
</ul>
<p>Other known mechanisms:</p>
<ul>
<li>MYSQL41 (MySQL 4.1 auth mechanism)</li>
<li>SHA256_MEMORY</li>
</ul>
<h1><a class="anchor" id="lifecycle_Pipelining"></a>
Pipelining </h1>
<p>The messages may be pipelined:</p>
<ul>
<li>the client may send the messages without waiting for a reply first</li>
<li>the client should only send messages which safely trigger an Error packet</li>
</ul>
<p>For the server it is no difference if the messages from client where sent in a bulk or if the client waited. The network and send/receive buffers of the Operation System will act as queue.</p>
<p><a class="el" href="mysqlx_protocol_expectations.html">Expectations</a> help to control the behavior of following messages if a pipelined message fails.</p>
<dl class="section user"><dt>Tip</dt><dd>For more information, see <a class="el" href="mysqlx_protocol_implementation.html">Implementation Notes</a>.</dd></dl>
<h1><a class="anchor" id="lifecycle_Extensions"></a>
Extensions </h1>
<p>If the result of <a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesGet.html">Mysqlx::Connection::CapabilitiesGet</a> contains a extension key from the table below it supports the feature.</p>
<table class="doxtable">
<tr>
<th>Name </th><th>Extension </th><th>Read/Write</th><th>Version  </th></tr>
<tr>
<td><code>tls</code> </td><td><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_TLS_Extension">TLS</a> </td><td>RW </td><td>5.7 </td></tr>
<tr>
<td><code>authentication.mechanisms</code> </td><td><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Authentication_mechanisms_Extension">Authentication mechanisms</a> </td><td>R </td><td>5.7 </td></tr>
<tr>
<td><code>doc.formats</code> </td><td><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Doc_formats_Extension">Doc formats</a> </td><td>R </td><td>5.7 </td></tr>
<tr>
<td><code>client.interactive</code> </td><td><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Client_interactive_Extension">Client interactive</a> </td><td>RW </td><td>8.0 </td></tr>
<tr>
<td><code>compression</code> </td><td><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Compression_Extension">Compression</a> </td><td>RW </td><td>8.0.18 </td></tr>
<tr>
<td><code>node_type</code> </td><td><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Node_type_Extension">Node type</a> </td><td>R </td><td>5.7 </td></tr>
<tr>
<td><code>client.pwd_expire_ok</code> </td><td><a class="el" href="mysqlx_protocol_lifecycle.html#lifecycle_Client_pwd_expire_ok_Extension">Client pwd expire ok</a> </td><td>RW </td><td>5.7 </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>More extensions can be added in future iterations as long as they are announced in <code>CapabilitiesGet()</code> and documented.</dd></dl>
<h2><a class="anchor" id="lifecycle_TLS_Extension"></a>
TLS Extension</h2>
<p>The client may assume that the server supports a set of features by default and skip the <a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesGet.html">Mysqlx::Connection::CapabilitiesGet</a> step:</p>
<ul>
<li>if the TLS extension isn't supported, then the <a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesSet.html">Mysqlx::Connection::CapabilitiesSet</a> will fail</li>
<li>if it is supported, then it will succeed</li>
</ul>
<div class="fragment"><div class="line">Feature: extensions</div><div class="line">  Scenario: connecting with TLS, fast path</div><div class="line">    Given a client side X.509 certificate is provided with user name &quot;foo&quot;</div><div class="line">    And client certificate is valid</div><div class="line">    When connecting with TLS established</div><div class="line">    Then handshake should be single-step</div></div><!-- fragment --><p><a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesGet.html">Mysqlx::Connection::CapabilitiesGet</a></p><ul>
<li><code>0</code>: supported, not in use</li>
<li><code>1</code>: supported, in use</li>
</ul>
<p><a class="el" href="structMysqlx_1_1Connection_1_1CapabilitiesSet.html">Mysqlx::Connection::CapabilitiesSet</a></p><ul>
<li><code>1</code>: switch to TLS connection after server-side Ok</li>
</ul>
<p>If the server doesn't support the capability, then it will return an error.</p>
<dl class="section note"><dt>Note</dt><dd>Disabling TLS on a connection may not be supported by the server and should result in an error.</dd></dl>
<h2><a class="anchor" id="lifecycle_Authentication_mechanisms_Extension"></a>
Authentication mechanisms Extension</h2>
<p>This capability return a list that informs the client, which authentication mechanism may be used while authentication (AuthenticationStart message).</p>
<dl class="section note"><dt>Note</dt><dd>This list is combination of what server support (has implemented) and current state of the connection. For example, authentication method like <code>PLAIN</code> is going to be visiable after SSL actication or on SECURE channel:</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="mysqlx_protocol_authentication.html">Authentication</a> section for more detail about differen authentication mechanisms</dd></dl>
<h2><a class="anchor" id="lifecycle_Doc_formats_Extension"></a>
Document formats Extension</h2>
<p>This extension informs how document are encoded by the server. Currently documents are in text format, still in future it could be changed to some binary encoding and user might be able to change the format.</p>
<h2><a class="anchor" id="lifecycle_Client_interactive_Extension"></a>
Interactive client Extension</h2>
<p>This extension changes, which timeout-values are used by the server when its waiting for first byte of a new request. Its enabled by setting <code>client.interactive</code> capability to <code>true</code>, it changes the default of <a href="https://dev.mysql.com/doc/refman/8.0/en/x-plugin-options-system-variables.html#sysvar_mysqlx_wait_timeout"><code>mysqlx_wait_timeout</code></a> variable, which is going to be initialized from <a href="https://dev.mysql.com/doc/refman/8.0/en/x-plugin-options-system-variables.html#sysvar_mysqlx_interactive_timeout"><code>mysqlx_interactive_timeout</code></a> variable.</p>
<dl class="section note"><dt>Note</dt><dd>Interactive clients, are application which send their requests after user input, for example <code>mysql</code> or <code>mysqlsh</code>. In such case the admin of an server might consider to extend the timeout values, and shorten for scripts that do SQL batch execution.</dd></dl>
<h2><a class="anchor" id="lifecycle_Compression_Extension"></a>
Compression Extension</h2>
<p>This extension informs what compression algorithms are permitted for use on X Protocol connections. Currently, the Deflate, LZ4, and zstd algorithms are supported and permitted by default. To disallow any of the algorithms, the user can set <a href="https://dev.mysql.com/doc/refman/8.0/en/x-plugin-options-system-variables.html#sysvar_mysqlx_compression_algorithms"><code>mysqlx_compression_algorithms</code></a> variable to include only the ones permitted.</p>
<h2><a class="anchor" id="lifecycle_Node_type_Extension"></a>
Node type Extension</h2>
<p>This is rather an information to what network node the client connected. Currently the capability transfers "mysql" value, which points to MySQL Server, still intermediate network elements like MySQL Router might consider changing this value to "router".</p>
<h2><a class="anchor" id="lifecycle_Client_pwd_expire_ok_Extension"></a>
Client pasword expire ok Extension</h2>
<p>This extension changes, behavior on server side, where authentication fails when expired MySQL Server account is used. Setting <code>client.interactive</code> capability to <code>true</code> waiting for first byte of a new request. Its enabled by setting <code>client.pwd_expire_oke</code> capability to <code>true</code>, makes the authentication pass which allows user to change the password. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="mysqlx_protocol.html">X %Protocol</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
