<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: mysqltest Commands</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('PAGE_MYSQL_TEST_COMMANDS.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mysqltest Commands </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> supports the commands described in this section.</p>
<p>Command names are not case sensitive.</p>
<p>Some examples of command use are given, but you can find many more by searching the test case files in the <b>mysql-test/t</b> directory.</p>
<ul>
<li>
<p class="startli"><code>append_file <b>file_name</b> [<b>terminator</b>]</code></p>
<p><b>append_file</b> is like <b>write_file</b> except that the lines up to the terminator are added to the end of the file. The file is created if it does not exist. The file name argument is subject to variable substitution.</p>
<pre class="fragment">write_file $MYSQL_TMP_DIR/data01;
line one for the file
line two for the file
EOF
append_file $MYSQL_TMP_DIR/data01;
line three for the file
EOF</pre><pre class="fragment">write_file $MYSQL_TMP_DIR/data02 END_OF_FILE;
line one for the file
line two for the file
END_OF_FILE
append_file $MYSQL_TMP_DIR/data02 END_OF_FILE;
line three for the file
END_OF_FILE</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>assert (<b>expr</b>)</code></p>
<p>Assert that <b>expr</b> is true; otherwise terminate the test program with an error message indicating that <b>expr</b> failed. <b>expr</b> is parsed as it is for <code>if()</code> and <code>while()</code>, as described at <a class="el" href="PAGE_MYSQL_TEST_FLOW_CONTROL.html">mysqltest Flow Control Constructs</a>.</p>
<pre class="fragment">       assert(1);
       assert($x);
       assert(!$x);
       assert(`select count(*) from t1`);</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>cat_file <b>file_name</b></code></p>
<p><b>cat_file</b> writes the contents of the file to the output. The file name argument is subject to variable substitution.</p>
<pre class="fragment">cat_file $MYSQL_TMP_DIR/data01;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>change_user [<b>user_name</b>], [<b>password</b>], [<b>db_name</b>]</code></p>
<p>Changes the current user and causes the database specified by <b><em>db_name</em></b> to become the default database for the current connection.</p>
<pre class="fragment">change_user root;
--change_user root,,test</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>character_set <b>charset_name</b></code></p>
<p>Set the default character set to <b><em>charset_name</em></b>. Initially, the character set is latin1.</p>
<pre class="fragment">character_set utf8;
--character_set sjis</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>chmod <b>octal_mode file_name</b></code></p>
<p>Change the mode of the given file. The file mode must be given as a four-digit octal number. The file name argument is subject to variable substitution, but must evaluate to a literal file name, not a file name pattern.</p>
<pre class="fragment">chmod 0644 $MYSQL_TMP_DIR/data_xxx01;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>connect (<b>name</b>, <b>host_name</b>, <b>user_name</b>, <b>password</b>, <b>db_name</b> [,<b>port_num</b> [,<b>socket</b> [,<b>options</b> [,<b>default_auth</b> [,<b>compression algorithm</b>, [,<b>compression level</b>]]]]]])</code></p>
<p>Open a connection to the server and make the connection the current connection.</p>
<p>The arguments to <b>connect</b> are:</p>
<ul>
<li>
<p class="startli"><b><em>name</em></b> is the name for the connection (for use with the <b>connection</b>, <b>disconnect</b>, and <b>dirty_close</b> commands). This name must not already be in use by an open connection. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>host_name</em></b> indicates the host where the server is running. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>user_name</em></b> and <b><em>password</em></b> are the user name and password of the MySQL account to use. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>db_name</em></b> is the default database to use. As a special case, *<b>NO-ONE</b>* means that no default database should be selected. You can also leave <b><em>db_name</em></b> blank to select no database. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>port_num</em></b>, if given, is the TCP/IP port number to use for the connection. This parameter can be given by using a variable. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>socket</em></b>, if given, is the socket file to use for connections to <b>localhost</b>. This parameter can be given by using a variable. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>options</em></b> can be one or more of the following words, separated by spaces:</p>
<ul>
<li>
<p class="startli"><code>CLEARTEXT</code>: Enable use of the cleartext authentication plugin. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>COMPRESS</code>: Use the compressed client/server protocol, if available. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>PIPE</code>: Use the named-pipe connection protocol, if available. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>SHM</code>: Use the shared-memory connection protocol, if available. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>SOCKET</code>: Use the socket-file connection protocol. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>SSL</code>:Use SSL network protocol to have encrypted connection. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>TCP</code>: Use the TCP/IP connection protocol. </p>
<p class="endli"></p>
</li>
</ul>
<p>Passing <b>PIPE</b> or <b>SHM</b> on non-Windows systems causes an error, and, similarly, passing <b>SOCKET</b> on Windows systems causes an error. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>default_auth</em></b> is the name of an authentication plugin. It is passed to the <b>mysql_options()</b> C API function using the <b>MYSQL_DEFAULT_AUTH</b> option. If <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> does not find the plugin, use the <b>&ndash;plugin-dir</b> option to specify the directory where the plugin is located. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>compression algorithm</em></b> is the name of compression algorithm to be used to compress data transferred between client server. It is passed to the <b>mysql_options()</b> C API function using the <b>MYSQL_OPT_COMPRESSION_ALGORITHMS</b> option. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b><em>zstd compression level</em></b> is the extent of compression to be applied when zstd compression algorithm is used. It is passed to the <b>mysql_options()</b> C API function using the <b>MYSQL_OPT_COMPRESSION_ALGORITHMS</b> option. </p>
<p class="endli"></p>
</li>
<li>
<b><em>compression level</em></b> is the extent of compression to be applied based on the compression algorithm used. It is passed to the <b>mysql_options()</b> C API function using the <b>MYSQL_OPT_COMPRESSION_ALGORITHMS</b> option.  </li>
</ul>
<p>To omit an argument, just leave it blank. For an omitted argument, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> uses an empty string for the first five arguments and the <b><em>options</em></b> argument. For omitted port or socket options, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> uses the default port or socket.</p>
<pre class="fragment">connect (conn1,localhost,root,,);
connect (conn2,localhost,root,mypass,test);
connect (conn1,127.0.0.1,root,,test,$MASTER_MYPORT);</pre><p>The last example assumes that the <b>$MASTER_MYPORT</b> variable has already been set (perhaps as an environment variable).</p>
<p>If a connection attempt fails initially, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> retries five times if the abort-on-error setting is enabled. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>connection <b>connection_name</b></code></p>
<p>Select <b><em>connection_name</em></b> as the current connection. To select the connection that <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> opens when it starts, use the name default.</p>
<pre class="fragment">connection master;
connection conn2;
connection default;</pre><p>A variable can be used to specify the <b><em>connection_name</em></b> value. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>let $var= convert_error(<b>error</b>)</code></p>
<p>This is not a command as such but rather a function that can be used in <b>let</b> statements. If the argument is a number, it returns the name of the corresponding error, or <b>&lt;Unknown&gt;</b> if no such error exists. If the argument is an error name, it returns the corresponding number, or fails if the error name is unknown. If the argument is 0 or an empty string, it returns 0. The function can also take a variable as argument.</p>
<pre class="fragment">let $errvar1=convert_error(ER_UNKNOWN_ERROR);
let $errvar2=convert_error(1450);
let $errvar3=convert_error($errvar1);</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>copy_file <b>from_file to_file</b> [<b>retry</b>]</code></p>
<p>Copy the file <b><em>from_file</em></b> to the file <b><em>to_file</em></b>. The command fails if <b><em>to_file</em></b> already exists. The file name arguments are subject to variable substitution.</p>
<p><b>copy_file</b> can also take an optional argument <b>retry</b>. If the command fails due to an environmental issue, the command can be retried for a <b>retry</b> number of times. Each retry happens after an interval of one second.</p>
<pre class="fragment">copy_file $MYSQL_TMP_DIR/copy1.txt $MYSQL_TMP_DIR/copy2.txt;
copy_file $MYSQL_TMP_DIR/foo.txt $MYSQL_TMP_DIR/foo2.txt 5;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>copy_files_wildcard <b>src_dir_name dst_dir_name</b> <b>pattern</b> [<b>retry</b>]</code></p>
<p>Copy all files that match the pattern in the source directory to the destination directory. Patterns can use <b>?</b> to represent any single character, or <b>*</b> for any sequence of 0 or more characters. The <b>.</b> character is treated like any other. The pattern may not include <b>/</b>. If all the files need to be copied, the <b>*</b> wildcard can be used.</p>
<p><b>copy_files_wildcard</b> can also take an optional argument <b>retry</b>. If the command fails due to an environmental issue, the command can be retried for a <b>retry</b> number of times. Each retry happens after an interval of one second.</p>
<p>The command works like this:</p>
<ul>
<li>
<p class="startli">Files that match the pattern are copied from the source directory to the destination directory. Overwriting of files is permitted. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Copying does not apply to directories matching the pattern or matching files in subdirectories. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">If the source or destination directory is not present, an error occurs. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">If no files match the specified pattern, an error occurs. </p>
<p class="endli"></p>
</li>
<li>
If the source directory has no files, an error occurs.  </li>
</ul>
<pre class="fragment">copy_files_wildcard $MYSQLTEST_VARDIR/std_data/ $MYSQLTEST_VARDIR/copy1/ *.txt;
copy_files_wildcard $MYSQLTEST_VARDIR/std_data/ $MYSQLTEST_VARDIR/copy1/ *.txt 5;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>dec <b>$var_name</b></code></p>
<p>Decrement a numeric variable. If the variable does not have a numeric value, the result is undefined.</p>
<pre class="fragment">dec $count;
dec $2;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>delimiter <b>str</b></code></p>
<p>Set the command delimiter to <b><em>str</em></b>, which may consist of 1 to 15 characters. The default delimiter is the semicolon character (“<b>;</b>”).</p>
<pre class="fragment">delimiter /;
--delimiter stop</pre><p>This is useful or needed when you want to include long SQL statements like <b>CREATE PROCEDURE</b> which include semicolon delimited statements but need to be interpreted as a single statement by <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a>. If you have set the delimiter to “<b>/</b>” as in the previous example, you can set it back to the default like this:</p>
<pre class="fragment">delimiter ;|</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>die [<b>message</b>]</code></p>
<p>Aborts the test with an error code after printing the given message as the reason. Suppose that a test file contains the following line:</p>
<pre class="fragment">die Cannot continue;</pre><p>When <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> encounters that line, it produces the following result and exits:</p>
<pre class="fragment">mysqltest: At line 1: Cannot continue
not ok</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>diff_files <b>file_name1 file_name2</b></code></p>
<p>Compare the two files. The command succeeds if the files are the same, and fails if they are different or either file does not exist. The file name arguments are subject to variable substitution. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>dirty_close <b>connection_name</b></code></p>
<p>Close the named connection. This is like <b>disconnect</b> except that it calls <b>vio_delete()</b> before it closes the connection. If the connection is the current connection, you should use the <b>connection</b> command to switch to a different connection before executing further SQL statements.</p>
<p>A variable can be used to specify the <b><em>connection_name</em></b> value. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_abort_on_error</code>, <code>enable_abort_on_error</code></p>
<p>Disable or enable abort-on-error behavior. This setting is enabled by default. With this setting enabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> aborts the test when a statement sent to the server results in an unexpected error, and does not generate the <b>.reject</b> file. For discussion of reasons why it can be useful to disable this behavior, see <a class="el" href="PAGE_ERROR_HANDLING.html">Error Handling</a>.</p>
<pre class="fragment">--disable_abort_on_error
--enable_abort_on_error</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_async_client</code>, <code>enable_async_client</code></p>
<p>Disable or enable asynchronous communication between the client and the server. With this setting enabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> uses non-blocking C API's to communicate with the server.<br />
 Please note that <b>disable_async_client</b> disables asynchronous communication if it had been enabled either by the <b>&ndash;enable_async_client</b> command or the <b>&ndash;async-client</b> command line option.</p>
<pre class="fragment">--disable_async_client
--enable_async_client</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_connect_log</code>, <code>enable_connect_log</code></p>
<p>Disable or enable logging of creation or switch of connections. Connection logging is disabled by default. With this setting enabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> enters lines in the test results to show when connections are created, switched or disconnected.</p>
<p>If query logging is turned off using <b>disable_query_log</b>, connection logging is also turned off, until query log is re- enabled.</p>
<pre class="fragment">--disable_connect_log
--enable_connect_log</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_info</code>, <code>enable_info</code></p>
<p>Disable or enable additional information about SQL statement results. Information display is disabled by default. With this setting enabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> displays the affected-rows count and the output from the <b>mysql_info()</b> C API function. The “affected-rows” value is “rows selected” for statements such as <b>SELECT</b> and “rows modified” for statements that change data.</p>
<pre class="fragment">--disable_info
--enable_info</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_metadata</code>, <code>enable_metadata</code></p>
<p>Disable or enable query metadata display. Metadata display is disabled by default. With this setting enabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> adds query metadata to the result. This information consists of the values corresponding to the members of the <b>MYSQL_FIELD</b> C API data structure, for each column of the result.</p>
<pre class="fragment">--disable_metadata
--enable_metadata</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_ps_protocol</code>, <code>enable_ps_protocol</code></p>
<p>Disable or enable prepared-statement protocol. This setting is disabled by default unless the <b><code>--ps-protocol</code></b> option is given.</p>
<pre class="fragment">--disable_ps_protocol
--enable_ps_protocol</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_query_log</code>, <code>enable_query_log</code></p>
<p>Disable or enable query logging. This setting is enabled by default. With this setting enabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> echoes input SQL statements to the test result.</p>
<p>One reason to disable query logging is to reduce the amount of test output produced, which also makes comparison of actual and expected results more efficient.</p>
<pre class="fragment">--disable_query_log
--enable_query_log</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_reconnect</code>, <code>enable_reconnect</code></p>
<p>Disable or enable automatic reconnect for dropped connections. (The default depends on the client library version.) This command only applies to the current connection.</p>
<pre class="fragment">--disable_reconnect
--enable_reconnect</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_result_log</code>, <code>enable_result_log</code></p>
<p>Disable or enable the result log. This setting is enabled by default. With this setting enabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> displays query results (and results from commands such as <b>echo</b> and <b>exec</b>).</p>
<pre class="fragment">--disable_result_log
--enable_result_log</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_rpl_parse</code>, <code>enable_rpl_parse</code></p>
<p>Disable or enable parsing of statements to determine whether they go to the master or slave. The default is whatever the default is for the C API library.</p>
<pre class="fragment">--disable_rpl_parse
--enable_rpl_parse</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_session_track_info</code>, <code>enable_session_track_info</code></p>
<p>Disable or enable display of session tracking information. Session-tracking display disabled by default.</p>
<pre class="fragment">--disable_session_track_info
--enable_session_track_info</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_testcase bug_number</code>, <code>enable_testcase</code></p>
<p>Disable or enable a section from a test case. This setting is enabled by default. When disabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> ignores everything until <b>enable_testcase</b>. These commands are useful for disabling a section inside a <b>.test</b> file that fails due to a known bug, without having to disable the entire test case.</p>
<p>Bug number is a mandatory argument to <b>disable_testcase</b> command and it should be in <b>BUG#XXXX</b> format where keyword <b>BUG</b> is case-insensitive and <b>XXXX</b> should contain only digits.</p>
<pre class="fragment">--disable_testcase BUG#XXXX
--enable_testcase</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>disable_warnings</code>, <code>enable_warnings</code></p>
<p>Disable or enable warnings. This setting is enabled by default. With this setting enabled, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> uses <b>SHOW WARNINGS</b> to display any warnings produced by SQL statements.</p>
<pre class="fragment">--disable_warnings
--enable_warnings</pre><p><b>disable_warnings</b> and <b>enable_warnings</b> commands can take an optional argument specifying one or more comma-separated list of warnings to be disabled or enabled. Each warning specified should be in symbolic error name format.</p>
<pre class="fragment">--disable_warnings ER_BAD_TABLE_ERROR,ER_YES
DROP TABLE IF EXISTS t1;
--enable_warnings ER_BAD_TABLE_ERROR,ER_YES</pre><p>Or</p>
<pre class="fragment">--disable_warnings
DROP TABLE IF EXISTS t1;
--enable_warnings ER_BAD_TABLE_ERROR,ER_YES
DROP TABLE IF EXISTS t1;
--disable_warnings ER_BAD_TABLE_ERROR,ER_YES
--enable_warnings</pre><p><b>disable_warnings</b> and <b>enable_warnings</b> commands can also take a second optional argument, <b>"ONCE"</b>, which when specified will disable or enable the warnings for next statement only.</p>
<pre class="fragment">--disable_warnings ER_BAD_TABLE_ERROR ONCE
DROP TABLE IF EXISTS t1;</pre><p>Or</p>
<pre class="fragment">--disable_warnings
DROP TABLE IF EXISTS t1;
--enable_warnings ER_BAD_TABLE_ERROR ONCE
DROP TABLE IF EXISTS t1;
--enable_warnings</pre> <dl class="section note"><dt>Note</dt><dd>At the end of a test, all the disabled warnings must be enabled, else <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> will throw an error and abort the test run. </dd></dl>
</li>
<li>
<p class="startli"><code>disconnect <b>connection_name</b></code></p>
<p>Close the named connection. If the connection is the current connection, you should use the <b>connection</b> command to switch to a different connection before executing further SQL statements.</p>
<pre class="fragment">disconnect conn2;
disconnect slave;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>echo <b>text</b></code></p>
<p>Echo the text to the test result. References to variables within the text are replaced with the corresponding values. The text does not need to be enclosed in quotation marks; if it is, the quotation marks will be included in the output.</p>
<pre class="fragment">--echo Another sql_mode test
echo should return only 1 row;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>end</code></p>
<p>End an <b>if</b> or <b>while</b> block. If there is no such block open, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> exits with an error. See <a class="el" href="PAGE_MYSQL_TEST_FLOW_CONTROL.html">mysqltest Flow Control Constructs</a>, for information on flow-control constructs.</p>
<p><a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> considers <b>}</b> and end the same: Both end the current block. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>end_timer</code></p>
<p>Stop the timer. By default, the timer does not stop until just before <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> exits. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>error <b>error_code</b> [, <b>error_code</b>] ...</code></p>
<p>Specify one or more comma-separated error values that the next command is expected to return. Each <b><em>error_code</em></b> value is a MySQL-specific error number or an <b>SQLSTATE</b> value. (These are the kinds of values returned by the <b>mysql_errno()</b> and <b>mysql_sqlstate()</b> C API functions, respectively.)</p>
<p>If you specify an <b>SQLSTATE</b> value, it should begin with an <b>S</b> to enable <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> to distinguish it from a MySQL error number. For example, the error number 1050 and the SQLSTATE value <b>42S01</b> are equivalent, so the following commands specify the same expected error:</p>
<pre class="fragment">--error 1050
--error S42S01</pre><p><b>SQLSTATE</b> values should be five characters long and may contain only digits and uppercase letters.</p>
<p>It is also possible to use the symbolic error name from <b>mysqld_error.h</b>:</p>
<pre class="fragment">--error ER_TABLE_EXISTS_ERROR</pre><p>It is also possible to use symbolic error names from <b>errmsg.h</b> to refer to client errors:</p>
<pre class="fragment">--error CR_SERVER_GONE_ERROR</pre><p>Finally, you can assign either a numerical code or a symbolic error name to a variable and refer to that in the <b>error</b> command. Numbers, symbolic names and variables may be freely mixed.</p>
<p>If a statement fails with an error that has not been specified as expected by means of a <b>error</b> command, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> aborts and reports the error message returned by the MySQL server.</p>
<p>If a statement fails with an error that has been specified as expected by means of a <b>error</b> command, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> does not abort. Instead, it continues and writes a message to the result output.</p>
<ul>
<li>
<p class="startli">If an <b>error</b> command is given with a single error value and the statement fails with that error, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> reports the error message returned by the MySQL server.</p>
<p>Input:</p>
<pre class="fragment">--error S42S02
DROP TABLE t;</pre><p><a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> reports:</p>
<pre class="fragment">ERROR 42S02: Unknown table 't'</pre> <p class="endli"></p>
</li>
<li>
<p class="startli">If an <b>error</b> command is given with multiple error values and the statement fails with any of those errors, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> reports a generic message. (This is true even if the error values are all the same, a fact that can be used if you want a message that does not contain varying information such as table names.)</p>
<p>Input:</p>
<pre class="fragment">--error S41S01,S42S02
DROP TABLE t;</pre><p><a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> reports:</p>
<pre class="fragment">Got one of the listed errors</pre>  </li>
</ul>
<p>An error value of <b>0</b> or <b>S00000</b> means “no error,” so using either for an <b>error</b> command is the same as saying explicitly, “no error is expected, the statement must succeed.”.</p>
<p>To indicate that you expect success or a given error or errors, specify <b>0</b> or <b>S00000</b> first in the error list. If you put the no-error value later in the list, the test will abort if the statement is successful. That is, the following two commands have different effects: The second form literally means the next command may fail with error code 0, (rather than succeed) which in practice never happens:</p>
<pre class="fragment">--error 0,1051
--error 1051,0</pre><p>You can use <b>error</b> to specify shell status values for testing the value of shell commands executed using the <b>exec</b> command. This does not apply to <b>system</b>, for which the command status is ignored.</p>
<p>If you use <b>error</b> in combination with <b>send</b> and <b>reap</b>, the <b>error</b> should be used just before the <b>reap</b>, as this is the command that actually gives the result and the potential error.</p>
<p>Variables may also be used as arguments to the <b>error</b> command; these may contain a number (including 0), an SQLSTATE or a symbolic error name. Variables and constant values may be freely combined. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>eval <b>statement</b></code></p>
<p>Evaluate the statement by replacing references to variables within the text with the corresponding values. Then send the resulting statement to the server to be executed. Use “<b>$</b>” to specify a literal “<b>$</b>” character.</p>
<p>The advantage of using <b>eval <em>statement</em></b> versus just <b><em>statement</em></b> is that <b>eval</b> provides variable expansion.</p>
<pre class="fragment">eval USE $DB;
eval CHANGE MASTER TO MASTER_PORT=$SLAVE_MYPORT;
eval PREPARE STMT1 FROM "$my_stmt";</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>exec <b>command</b> [<b>arg</b>] ...</code></p>
<p>Execute the shell command using the <b>popen()</b> library call. References to variables within the command are replaced with the corresponding values. Use “<b>\$</b>” to specify a literal “<b>$</b>” character.</p>
<p>On Cygwin, the command is executed from <b>cmd.exe</b>, so commands such as <b>rm</b> cannot be executed with <b>exec</b>. Use <b>system</b> instead.</p>
<pre class="fragment">--exec $MYSQL_DUMP --xml --skip-create test
--exec rm $MYSQLTEST_VARDIR/tmp/t1
exec $MYSQL_SHOW test -v -v;</pre><dl class="section note"><dt>Note</dt><dd><b>exec</b> or <b>system</b> are sometimes used to perform file system operations, but the command for doing so tend to be operating system specific, which reduces test portability. <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> now has several commands to perform these operations portably, so they should be used instead: <b>remove_file</b>, <b>chmod</b>, <b>mkdir</b>, and so forth. </dd></dl>
</li>
<li>
<p class="startli"><code>exec_in_background <b>command</b> [<b>arg</b>] ...</code></p>
<p>Execute a shell command using the <b>popen()</b> library call in the background. When a command is executed using <b>exec_in_background</b>, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> does not wait for it to finish, nor attempt to read the output of it.</p>
<pre class="fragment">--exec_in_background $MYSQL_DUMP --xml --skip-create test
--exec_in_background rm $MYSQLTEST_VARDIR/tmp/t1</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>execw <b>command</b> [<b>arg</b>] ...</code></p>
<p>This is a variant of the <b>exec</b> command which is needed on Windows if the command line contains non-ASCII characters. Otherwise it works exactly the same. On platforms other than Windows there is no difference, but on Windows it uses a different version of the <b>popen()</b> library call. So if your command line contains non-ASCII characters, it is recommended to use <b>execw</b> instead of <b>exec</b>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>exit</code></p>
<p>Terminate the test case. This is considered a “normal termination.” That is, using <b>exit</b> does not result in evaluation of the test case as having failed. It is not necessary to use <b>exit</b> at the end of a test case, as the test case will terminate normally when reaching the end without failure. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>expr <b>$var_name</b>= <b>operand1 operator operand2</b></code></p>
<p>Evaluate an expression and assign the result to a variable. The result is also the return value of the expr command itself.</p>
<pre class="fragment">--let $val1= 10
--let $var2= 20
--expr $res= $var1 + $var2
--echo $res</pre><p><b>operand1</b> and <b>operand2</b> must be valid variables.</p>
<p>expr supports these mathematical operators:</p>
<pre class="fragment">+  Addition
-  Subtraction
*  Multiplication
/  Division
%  Modulo</pre><p>expr supports these logical operators:</p>
<pre class="fragment">&amp;&amp;  Logical AND
||  Logical OR</pre><p>expr supports these bitwise operators:</p>
<pre class="fragment">&amp;  Binary AND
|  Binary OR
^  Binary XOR
&lt;&lt; Binary left shift
&gt;&gt; Binary right shift</pre><p>Operations are subject to these conditions:</p>
<ul>
<li>Operations that do not support noninteger operands truncate such operands to integer values.</li>
<li>If the result is an infinite value, expr returns the inf keyword.</li>
<li>Division by 0 results in an infinite value. </li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>file_exists <b>file_name</b> [<b>retry</b>]</code></p>
<p><b>file_exists</b> succeeds if the named file exists and fails otherwise. The file name argument is subject to variable substitution.</p>
<p><b>file_exists</b> can also take an optional argument <b>retry</b>. If the command fails due to an environmental issue, the command can be retried for a <b>retry</b> number of times. Each retry happens after an interval of one second.</p>
<pre class="fragment">file_exists /etc/passwd;
file_exists /etc/passwd 5;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>force-cpdir <b>src_dir_name dst_dir_name</b></code></p>
<p>Copies the source directory, <b><em>src_dir_name</em></b>, to the destination directory, <b><em>dst_dir_name</em></b>. The copy operation is recursive, so it copies subdirectories. Returns 0 for success and 1 for failure.</p>
<pre class="fragment">--force-cpdir testdir testdir2</pre><p>If the source directory does not exist, an error occurs.</p>
<p>If the destination directory does not exist, <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> creates it before copying the source directory. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>force-rmdir <b>dir_name</b></code></p>
<p>Remove a directory named <b><em>dir_name</em></b>. Returns 0 for success and 1 for failure.</p>
<pre class="fragment">--force-rmdir testdir</pre><p><b>force-rmdir</b> removes the directory as well as its contents, if any, unlike <b>rmdir</b>, which fails if the directory to be removed contains any files or directories. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>horizontal_results</code></p>
<p>Set the default query result display format to horizontal. Initially, the default is to display results horizontally.</p>
<pre class="fragment">--horizontal_results</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>if (<b>expr</b>)</code></p>
<p>Begin an if block, which continues until an <b>end</b> or <b>}</b> line. <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> executes the block if the expression is non-zero. There is no provision for <b>else</b> with <b>if</b>. See <a class="el" href="PAGE_MYSQL_TEST_FLOW_CONTROL.html">mysqltest Flow Control Constructs</a>, for further information about <b>if</b> statements.</p>
<pre class="fragment">let $counter= 0;
if ($counter)
{
  echo Counter is not 0;
}

if (!$counter)
{
  echo Counter is 0;
}</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>inc <b>$var_name</b></code></p>
<p>Increment a numeric variable. If the variable does not have a numeric value, the result is undefined.</p>
<pre class="fragment">--inc $i;
inc $3;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>let <b>$var_name</b> = <b>value</b></code></p>
<p><code>let <b>$var_name</b> = query_get_value(<b>query</b>, <b>col_name</b>, <b>row_num</b>)</code></p>
<p>Assign a value to a variable. The variable name cannot contain whitespace or the “<b>=</b>” character. Except for the one-digit <b>$0</b> to <b>$9</b>, it cannot begin with a number. <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> aborts with an error if the value is erroneous.</p>
<p>References to variables within <b><em>value</em></b> are replaced with their corresponding values.</p>
<p>If the <b>let</b> command is specified as a normal command (that is, not beginning with “<b>&ndash;</b>”), <b><em>value</em></b> includes everything up to the command delimiter, and thus can span multiple lines.</p>
<pre class="fragment">--let $1= 0
let $count= 10;</pre><p>When assigning a literal string to a variable, no quoting is required even if the string contains spaces. If the string does include quotation marks, they will be trated like any other characters and be included in the string value. This is important to be aware of when using the variable in an SQL statement.</p>
<p>The result from executing a query can be assigned to a variable by enclosing the query within backtick (“`”) characters:</p>
<pre class="fragment">let $q= `SELECT VERSION()`;</pre><p>The <b>let</b> command can set environment variables, not just <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> test language variables. To assign a value to an environment variable rather than a test language variable, just omit the dollar sign:</p>
<pre class="fragment">let $mysqltest_variable= foo;
let ENV_VARIABLE= bar;</pre><p>This is useful in interaction with external tools. In particular, when using the <b>perl</b> command, the Perl code cannot access test language variables, but it can access environment variables. For example, the following statement can access the <b>ENV_VARIABLE</b> value:</p>
<pre class="fragment">print $ENV{'ENV_VARIABLE'};</pre><p>The <b>let</b> syntax also allows the retrieval of a value from a query result set produced by a statement such as <b>SELECT</b> or <b>SHOW</b>. See the description of <b>query_get_value()</b> for more information. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>mkdir <b>dir_name</b></code></p>
<p>Create a directory named <b><em>dir_name</em></b>. Returns 0 for success and 1 for failure.</p>
<pre class="fragment">--mkdir testdir</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>list_files <b>dir_name</b> [<b>pattern</b>]</code></p>
<p><b>list_files</b> lists the files in the named directory. If a pattern is given, lists only file(s) matching the pattern, which may contain wild cards.</p>
<pre class="fragment">--list_files $MYSQLD_DATADIR/test t1*</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>list_files_append_file <b>file_name dir_name</b> [<b>pattern</b>]</code></p>
<p><b>list_files_append_file</b> works like <b>list_files</b>, but rather than outputting the file list, it is appended to the file named in the first argument. If the file does not exist, it is created.</p>
<pre class="fragment">--list_files_append_file $MYSQL_TMP_DIR/filelist $MYSQL_TMP_DIR/testdir *.txt;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>list_files_write_file <b>file_name dir_name</b> [<b>pattern</b>]</code></p>
<p><b>list_files_write_file</b> works like <b>list_files_append_file</b>, but creates a new file to write the file list to. If the file already exists, it will be replaced.</p>
<pre class="fragment">--list_files_write_file $MYSQL_TMP_DIR/filelist $MYSQL_TMP_DIR/testdir *.txt;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>lowercase_result</code></p>
<p>Output from the following SQL statement will be converted to lowercase. This is sometimes needed to ensure consistent result across different platforms. If this is combined with one of the <b>replace</b> commands or with <b>sorted_result</b>, both will take effect on the output, with conversion to lowercase being applied first.</p>
<pre class="fragment">--lowercase_result</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>move_file <b>from_name to_name</b> [<b>retry</b>]</code></p>
<p><b>move_file</b> renames <b><em>from_name</em></b> to <b><em>to_name</em></b>. The file name arguments are subject to variable substitution, but must evaluate to a literal file name, not a file name pattern.</p>
<p><b>move_file</b> can also take an optional argument <b>retry</b>. If the command fails due to an environmental issue, the command can be retried for a <b>retry</b> number of times. Each retry happens after an interval of one second.</p>
<pre class="fragment">move_file $MYSQL_TMP_DIR/data01 $MYSQL_TMP_DIR/test.out;
move_file $MYSQL_TMP_DIR/data01 $MYSQL_TMP_DIR/test.out 5;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>output <b>file_name</b></code></p>
<p>Direct output from the next SQL statement to the named file rather than to the test output. If the file already exists, it will be overwritten. Only the next SQL statement will have its output redirected.</p>
<pre class="fragment">output $MYSQL_TMP_DIR/out-file</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>perl [<b>terminator</b>]</code></p>
<p>Use Perl to execute the following lines of the test file. The lines end when a line containing the terminator is encountered. The default terminator is <b>EOF</b>, but a different terminator can be provided.</p>
<pre class="fragment">perl;
print "This is a test\n";
EOF</pre><pre class="fragment">perl END_OF_FILE;
print "This is another test\n";
END_OF_FILE</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>ping</code></p>
<p>Ping the server. This executes the <b>mysql_ping()</b> C API function. The function result is discarded. The effect is that if the connection has dropped and reconnect is enabled, pinging the server causes a reconnect. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>query [<b>statement</b>]</code></p>
<p>Send the statement to the server to be executed. The <b>query</b> command can be used to force <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> to send a statement to the server even if it begins with a keyword that is a <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> command. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>query_get_value(<b>query</b>, <b>col_name</b>, <b>row_num</b>)</code></p>
<p>The <b>query_get_value()</b> function can be used only on the right hand side of a variable assigment in a <b>let</b> statement.</p>
<p><b>query_get_value()</b> enables retrieval of a value from a query result set produced by a statement such as <b>SELECT</b> or <b>SHOW</b>. The first argument indicates the query to execute. The second and third arguments indicate the column name and row number that specify which value to extract from the result set. The column name is case sensitive. Row numbers begin with 1. The arguments can be given literally or supplied using variables.</p>
<p>Suppose that the test file contains this input:</p>
<pre class="fragment">CREATE TABLE t1(a INT, b VARCHAR(255), c DATETIME);
SHOW COLUMNS FROM t1;
let $value= query_get_value(SHOW COLUMNS FROM t1, Type, 1);
echo $value;</pre><p>The result will be:</p>
<pre class="fragment">CREATE TABLE t1(a INT, b VARCHAR(255), c DATETIME);
SHOW COLUMNS FROM t1;
Field   Type    Null    Key     Default Extra
a       int(11) YES             NULL
b       varchar(255)    YES             NULL
c       datetime        YES             NULL
int(11)</pre><p>If the query fails, an error message occurs and the test fails. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>query_horizontal <b>statement</b></code></p>
<p>Execute the statement and display its result horizontally.</p>
<pre class="fragment">query_horizontal SELECT PI();</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>query_vertical <b>statement</b></code></p>
<p>Execute the statement and display its result vertically.</p>
<pre class="fragment">query_vertical SELECT PI();</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>reap</code></p>
<p>Receive the result of the statement sent with the <b>send</b> command within the current session. You should not use <b>reap</b> unless a statement has been sent with <b>send</b>, and you should not use <b>send</b> again if there is an outstanding <b>send</b> that has not been processed with <b>reap</b>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>remove_file <b>file_name</b> [<b>retry</b>]</code></p>
<p><b>remove_file</b> removes the file. It fails with an error if the file does not exist. The file name argument is subject to variable substitution, but must evaluate to a literal file name, not a file name pattern.</p>
<p><b>remove_file</b> also takes an optional argument <b>retry</b>. If the command fails due to an environmental issue, the command can be retried for a <b>retry</b> number of times. Each retry happens after an interval of one second.</p>
<pre class="fragment">remove_file $MYSQL_TMP_DIR/data01;
remove_file $MYSQL_TMP_DIR/data01 5</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>remove_files_wildcard <b>dir_name</b> <b>pattern</b> [<b>retry</b>]</code></p>
<p>Remove all files in the named directory that match the pattern. Removal does not apply to directories matching the pattern or matching files in subdirectories. Patterns can use <b>?</b> to represent any single character, or <b>*</b> for any sequence of 0 or more characters. The <b>.</b> character is treated like any other. The pattern may not include <b>/</b>. If all the files need to be removed, the <b>*</b> wildcard can be used.</p>
<p><b>remove_files_wildcard</b> can also take an optional argument <b>retry</b>. If the command fails due to an environmental issue, the command can be retried for a <b>retry</b> number of times. Each retry happens after an interval of one second.</p>
<pre class="fragment">remove_files_wildcard $MYSQL_TMP_DIR file*.txt;
remove_files_wildcard $MYSQL_TMP_DIR file*.txt 5;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>replace_column <b>col_num</b> <b>value</b> [<b>col_num value</b>] ...</code></p>
<p>Replace strings in the output from the next statement. The value in <b><em>col_num</em></b> is replaced by the corresponding <b><em>value</em></b>. There can be more than one <b><em>col_num/value</em></b> pair. Column numbers start with 1.</p>
<p>A replacement value can be double-quoted. (Use “<b>"</b>” to specify a double quote within a replacement string.) Variables can be used in a replacement value if it is not double-quoted.</p>
<p>If mixed <b>replace_<em>xxx</em></b> commands are given, only the final one applies.</p>
<dl class="section note"><dt>Note</dt><dd>Although <b>replace_regex</b> and <b>replace_result</b> affect the output from <b>exec</b>, <b>replace_column</b> does not because <b>exec</b> output is not necessarily columnar.</dd></dl>
<pre class="fragment">--replace_column 9 #
replace_column 1 b 2 d;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>replace_numeric_round <b>precision</b></code></p>
<p>Rounds off floating point numbers. <b>precision</b> is the number of digits after the decimal point to which the result will be rounded off to. It can only be a number between 0 and 16.</p>
<p>If the precision is 0, then the value is rounded off to the nearest whole number. Trailing zeroes after the decimal point are removed from the numbers.</p>
<p>Numbers which are <b>greater than <em>1e10</em></b> or <b> lesser than <em> -1e10 </em></b> are represented using the exponential notation after they are rounded off.</p>
<pre class="fragment">--replace_numeric_round 6
SELECT 12379.79459775333;
12379.794598

replace_numeric_round 0;
SELECT 876.87302;
877</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>replace_regex <b>/pattern/replacement/</b>[i] ...</code></p>
<p>In the output from the next statement, find strings within columns of the result set that match <b><em>pattern</em></b> (a regular expression) and replace them with <b><em>replacement</em></b>. Each instance of a string in a column that matches the pattern is replaced. Matching is case sensitive by default. Specify the optional <b>i</b> modifier to cause matching to be case insensitive.</p>
<p>The syntax for allowable patterns is same as the <b>std::ECMAScript</b> syntax. The pattern can contain parentheses to mark substrings matched by parts of the pattern. These substrings can be referenced in the replacement string: An instance of <b><em>N</em></b> in the replacement string causes insertion of the <b><em>N</em>-th</b> substring matched by the pattern. For example, the following command matches <b>strawberry</b> and replaces it with <b>raspberry</b> and <b>strawberry</b>:</p>
<pre class="fragment">--replace_regex /(strawberry)/raspberry and \1/</pre><p>Multiple <b><em>pattern/replacement</em></b> pairs may be given. The following command replaces instances of <b>A</b> with <b>C</b> (the first pattern replaces <b>A</b> with <b>B</b>, the second replaces <b>B</b> with <b>C</b>):</p>
<pre class="fragment">--replace_regex /A/B/ /B/C/</pre><p>If a given pattern is not found, no error occurs and the input is unchanged. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>replace_result <b>from_val to_val</b> [<b>from_val to_val</b>] ...</code></p>
<p>Replace strings in the result. Each occurrence of <b><em>from_val</em></b> is replaced by the corresponding <b><em>to_val</em></b>. There can be more than <b><em>from_val/to_val</em></b> pair. Arguments can be quoted with single quotation marks or double quotation marks. Variable references within the arguments are expanded before replacement occurs. Values are matched literally. To use patterns, use the <b>replace_regex</b> command.</p>
<pre class="fragment">--replace_result 1024 MAX_KEY_LENGTH 3072 MAX_KEY_LENGTH
replace_result $MASTER_MYPORT MASTER_PORT;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>reset_connection</code></p>
<p>Reset the connection state by calling <a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-reset-connection.html">mysql_reset_connection()</a>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>result_format <b>version</b></code></p>
<p>Set the format to the specified version, which is either 1 for the current, default behavior, or to 2 which is an extended alternative format. The setting is in effect until it is changed or until the end of the test.</p>
<p>In format version 2, empty lines and indentation in the test file are preserveded in the result. Also, comments indicated by a double ## are copied verbatim to the result. Comments using a single # are not copied. Format version 2 makes it easier for humans to read the result output, but at the cost of somewhat larger files due to the white space and comments.</p>
<pre class="fragment">--result_format 2</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>rmdir <b>dir_name</b></code></p>
<p>Remove a directory named <b><em>dir_name</em></b>. Returns 0 for success and 1 for failure.</p>
<pre class="fragment">--rmdir testdir</pre><p><b>rmdir</b> fails if the directory to be removed contains any files or directories. To remove the directory as well as its contents, if any, use <b>force-rmdir</b>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>save_master_pos</code></p>
<p>For a master replication server, save the current binary log file name and position. These values can be used for subsequent <b>sync_with_master</b> or <b>sync_slave_with_master</b> commands. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>send [<b>statement</b>]</code></p>
<p>Send a statement to the server but do not wait for the result. The result must be received with the <b>reap</b> command. You cannot execute another SQL statement on the same connection between <b>send</b> and <b>reap</b>.</p>
<p>If <b><em>statement</em></b> is omitted, the <b>send</b> command applies to the next statement executed. This means that <b>send</b> can be used on a line by itself before a statement. Thus, this command:</p>
<pre class="fragment">send SELECT 1;</pre><p>Is equivalent to these commands:</p>
<pre class="fragment">send;
SELECT 1;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>send_eval [<b>statement</b>]</code></p>
<p>Evaluate the command, then send it to the server. This is a combination of the <b>send</b> and <b>eval</b> commands, giving the functionality of both. After variable replacement has been done, it behaves like the <b>send</b> command.</p>
<p>If <b><em>statement</em></b> is omitted, the <b>send_eval</b> command applies to the next statement executed. This means that <b>send_eval</b> can be used on a line by itself before a statement. Thus, this command:</p>
<pre class="fragment">--send_eval $my_stmt</pre> <p>Is equivalent to these commands:</p>
<pre class="fragment">--send_eval
$my_stmt;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>send_quit <b>connection</b></code></p>
<p>Sends a <b>COM_QUIT</b> command to the server on the named connection.</p>
<pre class="fragment">send_quit con;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>send_shutdown</code></p>
<p>Sends a shutdown command to the server but does not wait for it to complete the shutdown. Test execution proceeds as soon as the shutdown command is sent. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>shutdown_server [<b>timeout</b>]</code></p>
<p>Stops the server. This command waits for the server to shut down by monitoring its process ID (PID) file. If the server's process ID file is not gone after <b><em>timeout</em></b> seconds, the process will be killed. If <b><em>timeout</em></b> is omitted, the default is 60 seconds.</p>
<pre class="fragment">shutdown_server;
shutdown_server 30;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>skip [<b>message</b>]</code></p>
<p>Skips the rest of the test file after printing the given message as the reason. This can be used after checking a condition that must be satisfied, as a way of performing an exit that displays a reason. References to variables within the message are replaced with the corresponding values. Suppose that the test file <b>mytest.test</b> has these contents:</p>
<pre class="fragment">let $var= 0;
if (!$var)
{
  skip value of \$var is '$var', skipping test;
}
echo This command is never reached;</pre><p>Executing <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> -x mytest.test yields these results:</p>
<pre class="fragment">The test './mytest' is not supported by this installation
Detected in file ./mytest at line 4
reason: value of $var is '0', skipping test</pre><p>If the test is run from <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a>, you will instead see the test result as <b>[ skipped ]</b> followed by the message.</p>
<pre class="fragment">main.mytest          [ skipped ]  value of $var is '0', skipping test</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>sleep <b>num</b></code></p>
<p>Sleep <b><em>num</em></b> seconds. <b><em>num</em></b> need not be a whole number and can have a fractional part as well i.e., the command supports sleeping for intervals shorter than 1 second.</p>
<pre class="fragment">--sleep 10
sleep 0.5;</pre><p>Try not to use <b>sleep</b> command more than necessary. The more of them there are, the slower the test suite becomes. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>sorted_result</code></p>
<p>Sort the output from the next statement if it produces a result set. <b>sorted_result</b> is applied just before displaying the result, after any other result modifiers that might have been specified, such as <b>replace_result</b> or <b>replace_column</b>. If the next statement produces no result set, <b>sorted_result</b> has no effect because there is nothing to sort.</p>
<pre class="fragment">sorted_result;
SELECT 2 AS "my_col" UNION SELECT 1;
let $my_stmt=SELECT 2 AS "my_col" UNION SELECT 1;
--sorted_result
eval $my_stmt;
--sorted_result
--replace_column 1 #
SELECT '1' AS "my_col1",2 AS "my_col2"
UNION
SELECT '2',1;</pre><p><b>sorted_result</b> sorts the entire result of the next query. If this involves constructs such as <b>UNION</b>, stored procedures, or multi-statements, the output will be in a fixed order, but all the results will be sorted together and might appear somewhat strange.</p>
<p>The purpose of the <b>sorted_result</b> command is to produce output with a deterministic order for a given set of result rows. It is possible to use <b>ORDER BY</b> to sort query results, but that can sometimes present its own problems. For example, if the optimizer is being investigated for some bug, <b>ORDER BY</b> might order the result but return an incorrect set of rows. <b>sorted_result</b> can be used to produce sorted output even in the absence of <b>ORDER BY</b>.</p>
<p><b>sorted_result</b> is useful for eliminating differences between test runs that may otherwise be difficult to compensate for. Results without <b>ORDER BY</b> are not guaranteed to be returned in any given order, so the result for a given query might differ between test runs. For example, the order might vary between different server versions, so a result file created by one server might fail when compared to the result created by another server. The same is true for different storage engines. <b>sorted_result</b> eliminates these order differences by producing a deterministic row order.</p>
<p>Other ways to eliminate differences from results without use of <b>sorted_result</b> include:</p>
<ul>
<li>Remove columns from the select list to reduce variability in the output</li>
<li>Use aggregate functions such as <b>AVG()</b> on all columns of the select list</li>
<li>Use <b>ORDER BY</b></li>
</ul>
<p>The use of aggregate functions or <b>ORDER BY</b> may also have the advantage of exposing other bugs by introducing additional stress on the server. The choice of whether to use <b>sorted_result</b> or <b>ORDER BY</b> (or perhaps both) may be dictated by whether you are trying to expose bugs, or avoid having them affect results. This means that care should be taken with <b>sorted_result</b> because it has the potential of hiding server bugs that result in true problems with result order. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>partially_sorted_result <b>start_column</b></code></p>
<p>Similarly to <b>sorted_result</b>, but assumes that the first <b>start_column</b> columns are already sorted, sorting only on the remaining ones. This is useful if you wish to verify a partial ordering property, e.g. that <b>SELECT a,b,c ORDER BY a</b>. In this case, you could use <b>partially_sorted_result 1</b> to sort only on b and c, giving deterministic results without masking bugs where sorting on a column would not work correctly.</p>
<p><code>sorted_result</code> is functionally equal to <code>partially_sorted_result 0</code>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>source <b>file_name</b></code></p>
<p>Read test input from the named file.</p>
<p>If you find that several test case files contain a common section of commands (for example, statements that create a standard set of tables), you can put those commands in another file and those test cases that need the file can include it by means of a <b>source <em>file_name</em></b> command. This enables you to write the code just once rather than in multiple test cases.</p>
<p>Normally, the file name in the <b>source</b> command is relative to the <b>mysql-test</b> directory because <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> usually is invoked in that directory.</p>
<p>A sourced file can use <b>source</b> to read other files, but take care to avoid a loop. The maximum nesting level is 16.</p>
<pre class="fragment">--source include/have_csv.inc
source include/varchar.inc;</pre><p>The file name can include variable references. Variables are expanded including any quotation marks in the values, so normally the values should not include quotation marks. Suppose that <b>/tmp/junk</b> contains this line:</p>
<pre class="fragment">SELECT 'I am a query';</pre><p>The following example shows one way in which variable references could be used to specify the file name:</p>
<pre class="fragment">let $dir= /tmp;
let $file= junk;
source $dir/$file;</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>start_timer</code></p>
<p>Restart the timer, overriding any timer start that occurred earlier. By default, the timer starts when <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> begins execution. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>sync_slave_with_master [<b>connection_name</b>]</code></p>
<p>Executing this command is equivalent to executing the following commands:</p>
<pre class="fragment">save_master_pos;
connection connection_name;
sync_with_master 0;</pre><p>If <b><em>connection_name</em></b> is not specified, the connection named <b>slave</b> is used.</p>
<p>The effect is to save the replication coordinates (binary log file name and position) for the server on the current connection (which is assumed to be a master replication server), and then switch to a slave server and wait until it catches up with the saved coordinates. Note that this command implicitly changes the current connection.</p>
<p>A variable can be used to specify the <b><em>connection_name</em></b> value. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>sync_with_master <b>offset</b></code></p>
<p>For a slave replication server, wait until it has caught up with the master. The position to synchronize to is the position saved by the most recent <b>save_master_pos</b> command plus offset.</p>
<p>To use this command, <b>save_master_pos</b> must have been executed at some point earlier in the test case to cause <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> to save the master's replication coordinates. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>vertical_results</code></p>
<p>Set the default query result display format to vertical. Initially, the default is to display results horizontally.</p>
<pre class="fragment">--vertical_results</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>wait_for_slave_to_stop</code></p>
<p>Poll the current connection, which is assumed to be a connection to a slave replication server, by executing <b>SHOW STATUS LIKE 'Slave_running'</b> statements until the result is <b>OFF</b>.</p>
<p>For information about alternative means of slave server control, see <a class="el" href="PAGE_WRITING_REPLICATION_TESTS.html">Writing Replication Tests</a>. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>while (<b>expr</b>)</code></p>
<p>Begin a <b>while</b> loop block, which continues until an <b>end</b> line. <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> executes the block repeatedly as long as the expression is true (non-zero). See <a class="el" href="PAGE_MYSQL_TEST_FLOW_CONTROL.html">mysqltest Flow Control Constructs</a>, for further information about while statements.</p>
<p>Make sure that the loop includes some exit condition that eventually occurs. This can be done by writing <b><em>expr</em></b> so that it becomes false at some point.</p>
<pre class="fragment">let $i=5;
while ($i)
{
  echo $i;
  dec $i;
}</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><code>write_file <b>file_name</b> [<b>terminator</b>]</code></p>
<p>Write the following lines of the test file to the given file, until a line containing the terminator is encountered. The default terminator is <code>EOF</code>, but a different terminator can be provided. The file name argument is subject to variable substitution. An error occurs if the file already exists.</p>
<pre class="fragment">write_file $MYSQL_TMP_DIR/data01;
line one for the file
line two for the file
EOF</pre><pre class="fragment">write_file $MYSQL_TMP_DIR/data02 END_OF_FILE;
line one for the file
line two for the file
END_OF_FILE</pre>  </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_TESTING_TOOLS.html">Testing Tools</a></li><li class="navelem"><a class="el" href="PAGE_MYSQL_TEST_RUN.html">The MySQL Test Framework</a></li><li class="navelem"><a class="el" href="PAGE_MYSQLTEST_LANGUAGE_REFERENCE.html">mysqltest Language Reference</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
