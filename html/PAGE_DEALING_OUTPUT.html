<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: Dealing with Output That Varies Per Test Run</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('PAGE_DEALING_OUTPUT.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Dealing with Output That Varies Per Test Run </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>It is best to write each test case so that the result it produces does not vary for each test run, or according to factors such as the time of day, differences in how program binaries are compiled, the operating system, and so forth.</p>
<p>For example, if the result contains the current date and time, the test engine has no way to verify that the result is correct.</p>
<p>However, sometimes a test result is inherently variable according to external factors, or perhaps there is a part of a result that you simply do not care about. <a class="el" href="PAGE_MYSQLTEST.html">mysqltest</a> provides commands that enable you to postprocess test output into a more standard format so that output variation across test runs will not trigger a result mismatch.</p>
<p>One such command is <b>replace_column</b>, which specifies that you want to replace whatever is in a given column with a string. This makes the output for that column the same for each test run.</p>
<p>To see how this command works, add the following row after the first insert in the test case:</p>
<pre class="fragment">INSERT INTO t1 VALUES (DATE_FORMAT(NOW(), '%s'),9999);
</pre><p>Then record the test result and run the test again:</p>
<pre class="fragment">shell&gt; ./mysql-test-run.pl --record foo
shell&gt; ./mysql-test-run.pl foo
</pre><p>Most likely, a failure will occur and <a class="el" href="PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a> will display the difference between the expected result and what we actually got, like this (the header has been simplified):</p>
<pre class="fragment">CURRENT_TEST: main.foo
--- r/foo.result        2009-11-17 16:22:38
+++ var/log/foo.reject        2009-11-17 16:22:47
@@ -10,15 +10,15 @@
 SELECT period FROM t1;
 period
 9410
-0038
+0047
 SELECT * FROM t1;
 Period Varor_period
 9410   9412
-0038   9999
+0047   9999
 SELECT t1.* FROM t1;
 Period Varor_period
 9410   9412
-0038   9999
+0047   9999
 SELECT * FROM t1 INNER JOIN t2 USING (Period);
 Period Varor_period
 9410   9412

mysqltest: Result content mismatch
</pre><p>The actual numbers will likely be different for your case, and the format of the diff may also vary.</p>
<p>If we are not really interested in the first column, one way to eliminate this mismatch is by using the <b>replace_column</b> command. The duration of the effect of this command is the next SQL statement, so we need one before each <b>select</b> statement:</p>
<pre class="fragment">--replace_column 1 SECONDS
SELECT period FROM t1;

--replace_column 1 SECONDS
SELECT * FROM t1;

--replace_column 1 SECONDS
SELECT t1.* FROM t1;
</pre><p>In the <b>replace_column</b> commands, <b>SECONDS</b> could be any string. Its only purpose is to map variable output onto a constant value. If we record the test result again, we will succeed each time we run the test after that. The result file will look like this:</p>
<pre class="fragment">DROP TABLE IF EXISTS t1,t2;
CREATE TABLE t1 (
Period SMALLINT(4) UNSIGNED ZEROFILL DEFAULT '0000' NOT NULL,
Varor_period SMALLINT(4) UNSIGNED DEFAULT '0' NOT NULL
);
affected rows: 0
CREATE TABLE t2 (Period SMALLINT);
affected rows: 0
INSERT INTO t1 VALUES (9410,9412);
affected rows: 1
INSERT INTO t1 VALUES (DATE_FORMAT(NOW(), '%s'),9999);
affected rows: 1
INSERT INTO t2 VALUES (9410),(9411),(9412),(9413);
affected rows: 4
info: Records: 4  Duplicates: 0  Warnings: 0
SELECT period FROM t1;
period
SECONDS
SECONDS
affected rows: 2
SELECT * FROM t1;
Period  Varor_period
SECONDS 9412
SECONDS 9999
affected rows: 2
SELECT t1.* FROM t1;
Period  Varor_period
SECONDS 9412
SECONDS 9999
affected rows: 2
SELECT * FROM t1 INNER JOIN t2 USING (Period);
Period  Varor_period
9410    9412
affected rows: 1
DROP TABLE t1, t2;
affected rows: 0
ok
</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="PAGE_TESTING_TOOLS.html">Testing Tools</a></li><li class="navelem"><a class="el" href="PAGE_MYSQL_TEST_RUN.html">The MySQL Test Framework</a></li><li class="navelem"><a class="el" href="PAGE_WRITING_TESTCASES.html">Writing Test Cases</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
