<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MySQL: Deadlock_notifier Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mysql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-mysql-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MySQL
   &#160;<span id="projectnumber">8.0.22</span>
   </div>
   <div id="projectbrief">Source Code Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classDeadlock__notifier.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="classDeadlock__notifier-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Deadlock_notifier Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A static class for reporting notifications about deadlocks.  
 <a href="classDeadlock__notifier.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aed0a077cb217d719fe7984ce27567fec"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDeadlock__notifier.html#aed0a077cb217d719fe7984ce27567fec">Deadlock_notifier</a> ()=delete</td></tr>
<tr class="separator:aed0a077cb217d719fe7984ce27567fec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a1b32b8fbb8d7043a77d61131e995774e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDeadlock__notifier.html#a1b32b8fbb8d7043a77d61131e995774e">notify</a> (const <a class="el" href="namespaceut.html#aa7abb0ab07329e68a6ec29d191da1e58">ut::vector</a>&lt; const <a class="el" href="structtrx__t.html">trx_t</a> *&gt; &amp;trxs_on_cycle, const <a class="el" href="structtrx__t.html">trx_t</a> *victim_trx)</td></tr>
<tr class="memdesc:a1b32b8fbb8d7043a77d61131e995774e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles writing the information about found deadlock to the log files and caches it for future lock_latest_err_file() calls (for example used by SHOW ENGINE INNODB STATUS)  <a href="#a1b32b8fbb8d7043a77d61131e995774e">More...</a><br /></td></tr>
<tr class="separator:a1b32b8fbb8d7043a77d61131e995774e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:ab791faefbc765331cb512de4aed46623"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDeadlock__notifier.html#ab791faefbc765331cb512de4aed46623">is_allowed_to_be_on_cycle</a> (const <a class="el" href="structlock__t.html">lock_t</a> *lock)</td></tr>
<tr class="memdesc:ab791faefbc765331cb512de4aed46623"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines if a situation in which the lock takes part in a deadlock cycle is expected (as in: handled correctly) or not (say because it is on a DD table, for which there is no reason to expect a deadlock and we don't handle deadlocks correctly).  <a href="#ab791faefbc765331cb512de4aed46623">More...</a><br /></td></tr>
<tr class="separator:ab791faefbc765331cb512de4aed46623"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1ce93d4b83e5a001ed22d720baf879c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDeadlock__notifier.html#af1ce93d4b83e5a001ed22d720baf879c">print</a> (const <a class="el" href="structtrx__t.html">trx_t</a> *trx, ulint max_query_len)</td></tr>
<tr class="memdesc:af1ce93d4b83e5a001ed22d720baf879c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print transaction data to the deadlock file and possibly to stderr.  <a href="#af1ce93d4b83e5a001ed22d720baf879c">More...</a><br /></td></tr>
<tr class="separator:af1ce93d4b83e5a001ed22d720baf879c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7adf0b7bf398a49e612d68736f94f152"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDeadlock__notifier.html#a7adf0b7bf398a49e612d68736f94f152">start_print</a> ()</td></tr>
<tr class="memdesc:a7adf0b7bf398a49e612d68736f94f152"><td class="mdescLeft">&#160;</td><td class="mdescRight">rewind(3) the file used for storing the latest detected deadlock and print a heading message to stderr if printing of all deadlocks to stderr is enabled.  <a href="#a7adf0b7bf398a49e612d68736f94f152">More...</a><br /></td></tr>
<tr class="separator:a7adf0b7bf398a49e612d68736f94f152"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2e57ed638b22d5d2bca1a5d341c809e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDeadlock__notifier.html#ac2e57ed638b22d5d2bca1a5d341c809e">print</a> (const <a class="el" href="structlock__t.html">lock_t</a> *lock)</td></tr>
<tr class="memdesc:ac2e57ed638b22d5d2bca1a5d341c809e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print lock data to the deadlock file and possibly to stderr.  <a href="#ac2e57ed638b22d5d2bca1a5d341c809e">More...</a><br /></td></tr>
<tr class="separator:ac2e57ed638b22d5d2bca1a5d341c809e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfac2b2af34fc63700f34f3464960e77"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDeadlock__notifier.html#abfac2b2af34fc63700f34f3464960e77">print</a> (const char *<a class="el" href="test__sql__9__sessions_8cc.html#af6a786aadb2fc26d9c6d8dcb60c181f9">msg</a>)</td></tr>
<tr class="memdesc:abfac2b2af34fc63700f34f3464960e77"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print a message to the deadlock file and possibly to stderr.  <a href="#abfac2b2af34fc63700f34f3464960e77">More...</a><br /></td></tr>
<tr class="separator:abfac2b2af34fc63700f34f3464960e77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30f96f5bd24721941f3efc2abb8270d0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDeadlock__notifier.html#a30f96f5bd24721941f3efc2abb8270d0">print_title</a> (size_t pos_on_cycle, const char *title)</td></tr>
<tr class="memdesc:a30f96f5bd24721941f3efc2abb8270d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints a numbered section title to the deadlock file and possibly to stderr.  <a href="#a30f96f5bd24721941f3efc2abb8270d0">More...</a><br /></td></tr>
<tr class="separator:a30f96f5bd24721941f3efc2abb8270d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A static class for reporting notifications about deadlocks. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aed0a077cb217d719fe7984ce27567fec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed0a077cb217d719fe7984ce27567fec">&#9670;&nbsp;</a></span>Deadlock_notifier()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Deadlock_notifier::Deadlock_notifier </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab791faefbc765331cb512de4aed46623"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab791faefbc765331cb512de4aed46623">&#9670;&nbsp;</a></span>is_allowed_to_be_on_cycle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="innodb__memcache_2util-src_2config__parser_8c.html#abb452686968e48b67397da5f97445f5b">bool</a> Deadlock_notifier::is_allowed_to_be_on_cycle </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structlock__t.html">lock_t</a> *&#160;</td>
          <td class="paramname"><em>lock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines if a situation in which the lock takes part in a deadlock cycle is expected (as in: handled correctly) or not (say because it is on a DD table, for which there is no reason to expect a deadlock and we don't handle deadlocks correctly). </p>
<p>The purpose of the function is to use it in an assertion failing as soon as the deadlock is identified, to give developer a chance to investigate the root cause of the situation (without such assertion, the code might continue to run and either fail at later stage when the data useful for debugging is no longer on stack, or not fail at all, which is risky). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">lock</td><td>lock found in a deadlock cycle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if we expect that this lock can take part in a deadlock cycle </dd></dl>

</div>
</div>
<a id="a1b32b8fbb8d7043a77d61131e995774e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b32b8fbb8d7043a77d61131e995774e">&#9670;&nbsp;</a></span>notify()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Deadlock_notifier::notify </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespaceut.html#aa7abb0ab07329e68a6ec29d191da1e58">ut::vector</a>&lt; const <a class="el" href="structtrx__t.html">trx_t</a> *&gt; &amp;&#160;</td>
          <td class="paramname"><em>trxs_on_cycle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtrx__t.html">trx_t</a> *&#160;</td>
          <td class="paramname"><em>victim_trx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles writing the information about found deadlock to the log files and caches it for future lock_latest_err_file() calls (for example used by SHOW ENGINE INNODB STATUS) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">trxs_on_cycle</td><td>trxs causing deadlock, i-th waits for i+1-th </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">victim_trx</td><td>the trx from trx_on_cycle which will be rolled back </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af1ce93d4b83e5a001ed22d720baf879c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1ce93d4b83e5a001ed22d720baf879c">&#9670;&nbsp;</a></span>print() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Deadlock_notifier::print </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structtrx__t.html">trx_t</a> *&#160;</td>
          <td class="paramname"><em>trx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>max_query_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Print transaction data to the deadlock file and possibly to stderr. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trx</td><td>transaction </td></tr>
    <tr><td class="paramname">max_query_len</td><td>max query length to print </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac2e57ed638b22d5d2bca1a5d341c809e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2e57ed638b22d5d2bca1a5d341c809e">&#9670;&nbsp;</a></span>print() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Deadlock_notifier::print </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structlock__t.html">lock_t</a> *&#160;</td>
          <td class="paramname"><em>lock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Print lock data to the deadlock file and possibly to stderr. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lock</td><td>record or table type lock </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abfac2b2af34fc63700f34f3464960e77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfac2b2af34fc63700f34f3464960e77">&#9670;&nbsp;</a></span>print() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Deadlock_notifier::print </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Print a message to the deadlock file and possibly to stderr. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>message to print </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a30f96f5bd24721941f3efc2abb8270d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30f96f5bd24721941f3efc2abb8270d0">&#9670;&nbsp;</a></span>print_title()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Deadlock_notifier::print_title </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>pos_on_cycle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>title</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prints a numbered section title to the deadlock file and possibly to stderr. </p>
<p>Numbers do not have to be unique, as they are used to identify transactions on the cycle, and there are multiple sections per transaction. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pos_on_cycle</td><td>The zero-based position of trx on deadlock cycle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">title</td><td>The title of the section </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7adf0b7bf398a49e612d68736f94f152"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7adf0b7bf398a49e612d68736f94f152">&#9670;&nbsp;</a></span>start_print()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Deadlock_notifier::start_print </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>rewind(3) the file used for storing the latest detected deadlock and print a heading message to stderr if printing of all deadlocks to stderr is enabled. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>storage/innobase/lock/<a class="el" href="lock0lock_8cc.html">lock0lock.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classDeadlock__notifier.html">Deadlock_notifier</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
